import{c as Vr,a as Tr,b as Dr,f as Xe,u as Pe,d as V,g as cn,e as wt,h as nt,m as To,r as _n,i as q,j as v,k as ae,o as d,l as k,n as s,w as b,p as l,t as S,q as R,R as Sl,s as O,v as o,x as D,y as ie,z as Q,A as qr,B as Sn,C as on,D as X,V as io,F as te,E as ge,G as vt,H as re,I as ve,J as Ee,K as de,L as oo,M as bt,N as ja,O as De,P as Fe,Q as lo,S as pt,T as ft,U as Dt,W as Re,X as _t,Y as La,Z as Er,_ as _l,$ as Ar,a0 as Ha,a1 as dt,a2 as Br,a3 as Nr,a4 as Ga,a5 as he,a6 as qo,a7 as Y,a8 as Wt,a9 as st,aa as At,ab as ao,ac as Rl,ad as Ka,ae as gn,af as Tt,ag as xt,ah as Cn,ai as Qe,aj as Or,ak as Ye,al as Kn,am as mt,an as We,ao as Rn,ap as xe,aq as Fl,ar as jo,as as St,at as Vl,au as Zt,av as Tl,aw as uo,ax as Jt,ay as Lo,az as co,aA as Ya,aB as Ho,aC as Dl,aD as zr,aE as Et,aF as Wa,aG as Mr,aH as Ur,aI as Qa,aJ as Xa,aK as Pr,aL as Za,aM as jr,aN as Me,aO as Lr,aP as pa,aQ as Hr,aR as Gr,aS as Kr,aT as Yr,aU as Wr,aV as Qr,aW as Xr,aX as Zr,aY as Jr,aZ as ei,a_ as ti,a$ as ni,b0 as oi,b1 as li,b2 as ai,b3 as si,b4 as ri,b5 as ii,b6 as ui,b7 as di,b8 as ci,b9 as mi,ba as pi,bb as fi,bc as vi,bd as bi,be as hi,bf as _i,bg as gi,bh as yi,bi as xi,bj as Ii,bk as ki,bl as $i,bm as wi,bn as Ci,bo as Si,bp as Ri,bq as Fi,br as Vi,bs as Ti,bt as Di,bu as qi,bv as Ei,bw as Ai,bx as Bi,by as Ni,bz as Oi,bA as zi,bB as Mi,bC as Ui,bD as Pi,bE as ji,bF as Li,bG as Hi,bH as Gi,bI as Ki,bJ as Yi,bK as Wi,bL as Qi,bM as Xi,bN as Zi,bO as Ji,bP as eu,bQ as tu,bR as nu,bS as ou,bT as lu,bU as au,bV as su,bW as ru,bX as iu,bY as uu,bZ as du,b_ as cu,b$ as mu,c0 as pu,c1 as fu,c2 as vu,c3 as bu,c4 as hu,c5 as _u,c6 as gu,c7 as yu,c8 as xu,c9 as Iu,ca as ku,cb as $u,cc as wu,cd as Cu,ce as Su,cf as Ru,cg as Fu,ch as Vu,ci as Tu,cj as Du,ck as qu,cl as Eu,cm as Au,cn as Bu,co as Nu,cp as Ou,cq as zu,cr as Mu,cs as Uu,ct as Pu,cu as ju,cv as Lu,cw as Hu,cx as Gu,cy as Ku,cz as Yu,cA as Wu,cB as Qu,cC as Xu,cD as Zu,cE as Ja,cF as Ju,cG as ed,cH as td,cI as nd,cJ as od,cK as fa,cL as ld,cM as ad,cN as sd,cO as rd,cP as id,cQ as ud,cR as es,cS as dd,cT as ql,cU as Dn,cV as qn,cW as cd,cX as md,cY as Qt,cZ as ot,c_ as Go,c$ as pd,d0 as fd,d1 as vd,d2 as bd,d3 as Eo,d4 as En,d5 as dn,d6 as hd,d7 as yn,d8 as _d,d9 as so,da as El,db as Lt,dc as ts,dd as ns,de as gd,df as Al,dg as yd,dh as Ko,di as mn,dj as xd,dk as Id,dl as An,dm as Bl,dn as kd,dp as $d,dq as Nl,dr as wd,ds as Ln,dt as Ol,du as Ao,dv as zl,dw as Cd,dx as Sd,dy as Rd,dz as Fd,dA as Vd,dB as al,dC as Td}from"./vendor-462626fd.js";const Dd=[];function qd(e,t,n){return n||(e.hash?{el:e.hash}:e.meta&&e.meta.scrollToTop===!1?{}:{left:0,top:0})}const eo=Vr({scrollBehavior:qd,history:Tr(),routes:Dd}),hn=Dr({state:{apiURL:null,url:null,menu:[],timezones:[],sidebarOpen:!1,settings:{}},mutations:{SET_SETTINGS(e,t){Object.keys(t).forEach(n=>{e.settings[n]=t[n]})},SET_TIMEZONES(e,t){e.timezones=t},SET_SIDEBAR_OPEN(e,t){e.sidebarOpen=t},SET_MENU(e,t){e.menu=t},UPDATE_MENU_ITEM(e,t){const n=Xe(e.menu,["id",t.id]);e.menu[n]=Object.assign({},e.menu[n],t.data)},SET_URL(e,t){e.url=t},SET_API_URL(e,t){e.apiURL=t}},getters:{getMenuItem:e=>t=>e.menu[Xe(e.menu,["id",t])]},actions:{logout({state:e}){Innoclapps.request().post(e.url+"/logout").then(()=>{window.location.href=Innoclapps.config("url")+"/login"})},fetchTimezones({commit:e}){Innoclapps.request().get("/timezones").then(({data:t})=>{Object.freeze(t),e("SET_TIMEZONES",t)})}},modules:{},strict:!1}),Ed="modulepreload",Ad=function(e){return"/build/"+e},va={},mo=function(t,n,a){if(!n||n.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=Ad(i),i in va)return;va[i]=!0;const u=i.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(!!a)for(let f=r.length-1;f>=0;f--){const h=r[f];if(h.href===i&&(!u||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${c}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":Ed,u||(p.as="script",p.crossOrigin=""),p.href=i,document.head.appendChild(p),u)return new Promise((f,h)=>{p.addEventListener("load",f),p.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i})};function Le(){const e=Pe(),t=V(()=>Innoclapps.config("locales")),n=V(()=>e.getters["users/current"]),a=V(()=>e.state.users.collection);function r(p){return e.getters["users/getById"](p)}function i(p){return cn(e.state.settings,p)}function u(){e.commit("table/RESET_SETTINGS"),e.commit("fields/RESET")}function c(){return!!Innoclapps.config("microsoft.client_id")}function m(){return!!Innoclapps.config("google.client_id")}return{locales:t,currentUser:n,users:a,findUserById:r,setting:i,resetStoreState:u,isGoogleApiConfigured:m,isMicrosoftGraphConfigured:c}}class Bd{constructor(){this.errors={}}set(t,n){typeof t=="object"?this.errors=t:this.set({...this.errors,[t]:wt(n)})}all(){return this.errors}has(t){return Object.hasOwn(this.errors,t)}hasAny(...t){return t.some(n=>this.has(n))}any(){return Object.keys(this.errors).length>0}first(t){if(this.has(t))return this.getAll(t)[0]}getAll(t){return wt(this.errors[t]||[])}only(...t){const n=[];return t.forEach(a=>{const r=this.first(a);r&&n.push(r)}),n}flatten(){return Object.values(this.errors).reduce((t,n)=>t.concat(n),[])}clear(t){const n={};t&&Object.keys(this.errors).forEach(a=>{a!==t&&(n[a]=this.errors[a])}),this.set(n)}}function Nd(e){return e instanceof File||e instanceof FileList}function os(e,t=new FormData,n=null){if(e===null||e==="undefined"||e.length===0)return t.append(n,e);for(const a in e)Object.hasOwn(e,a)&&zd(t,Od(n,a),e[a]);return t}function Od(e,t){return e?e+"["+t+"]":t}function zd(e,t,n){if(n instanceof Date)return e.append(t,n.toISOString());if(n instanceof File)return e.append(t,n,n.name);if(typeof n=="boolean")return e.append(t,n?"1":"0");if(n===null)return e.append(t,"");if(typeof n!="object")return e.append(t,n);os(n,e,t)}class Fn{constructor(t={},n={}){this.busy=!1,this.recentlySuccessful=!1,this.errors=new Bd,this.queryString={},this.withData(t).withOptions(n)}withData(t){this.successful=!1,this.setInitialValues(t);for(const n in t)this[n]=t[n];return this}setInitialValues(t){this.originalData=nt(t)}withOptions(t){return this.__options={resetOnSuccess:!1,...t},Object.hasOwn(t,"resetOnSuccess")&&(this.__options.resetOnSuccess=t.resetOnSuccess),this}populate(t){return this.keys().forEach(n=>{this[n]=t[n]}),this}set(t,n=null){return typeof t=="object"?Object.keys(t).forEach(a=>this.set(a,t[a])):(this.fill(t,n),this.originalData[t]=nt(n)),this}fill(t,n=null){return typeof t=="object"?Object.keys(t).forEach(a=>this.fill(a,t[a])):this[t]=n,this}withQueryString(t){return this.queryString={...this.queryString,...t},this}data(){return this.keys().reduce((t,n)=>({...t,[n]:this[n]}),{})}keys(){return Object.keys(this).filter(t=>!this.ignore().includes(t))}startProcessing(){return this.errors.clear(),this.busy=!0,this.successful=!1,this}finishProcessing(){return this.busy=!1,this.successful=!0,this.recentlySuccessful=!0,this.__options.resetOnSuccess&&this.reset(),setTimeout(()=>this.recentlySuccessful=!1,3e3),this}clear(){return this.keys().forEach(t=>{delete this[t]}),this.successful=!1,this.errors.clear(),this.queryString={},this.setInitialValues({}),this}reset(){return this.keys().forEach(t=>{this[t]=nt(this.originalData[t])}),this}getError(t){return this.errors.first(t)}get(t,n={}){return this.submit("get",t,n)}post(t,n={}){return this.submit("post",t,n)}patch(t,n={}){return this.submit("patch",t,n)}put(t,n={}){return this.submit("put",t,n)}delete(t,n={}){return this.submit("delete",t,n)}submit(t,n,a={}){this.startProcessing();let r=this.createUriData(n);const i=t==="get"?{params:To(r.queryString,this.data())}:this.hasFiles()?os(this.data()):this.data();return new Promise((u,c)=>{Innoclapps.request()[t](r.uri,i,To({params:r.queryString},a)).then(m=>{this.finishProcessing(),u(m.data)}).catch(m=>{this.busy=!1,m.response&&this.errors.set(this.extractErrors(m.response)),c(m)})})}extractErrors(t){return!t.data||typeof t.data!="object"?{error:Fn.errorMessage}:t.data.errors?{...t.data.errors}:t.data.message?{error:t.data.message}:{...t.data}}createUriData(t){let n=t.split("?"),a=n[1]?Object.fromEntries(new URLSearchParams(n[1])):{};return{uri:n[0],queryString:To(a,this.queryString)}}onKeydown(t){if(this.errors.has(t)){this.errors.clear(t);return}t.target.name?this.errors.clear(t.target.name):t.target.id&&this.errors.clear(t.target.id)}hasFiles(){for(const t in this.originalData)if(this.hasFilesDeep(this[t]))return!0;return!1}hasFilesDeep(t){if(t===null)return!1;if(typeof t=="object"){for(const n in t)if(Object.hasOwn(t,n)&&this.hasFilesDeep(t[n]))return!0}if(Array.isArray(t)){for(const n in t)if(Object.hasOwn(t,n))return this.hasFilesDeep(t[n])}return Nd(t)}ignore(){return["__options","busy","successful","recentlySuccessful","errors","originalData","queryString"]}}Fn.errorMessage="Something went wrong. Please try again.";function Ae(e={},t={}){return{form:_n(new Fn(e,t))}}const Md={class:"flex items-center justify-between"},Ud={class:"flex items-center"},Pd=["href"],jd={__name:"AuthLogin",setup(e){const{setting:t}=Le(),n=Innoclapps.config("reCaptcha")||{},a=Innoclapps.config("url"),r=q(null),i=q(null),u=q(!1),{form:c}=Ae({email:null,password:null,remember:null,"g-recaptcha-response":null}),m=V(()=>u.value);async function p(){u.value=!0,r.value.blur(),await Innoclapps.request().get(a+"/sanctum/csrf-cookie"),c.post(a+"/login").then(h=>window.location.href=h.redirect_path).finally(()=>i.value&&i.value.reset()).catch(()=>u.value=!1)}function f(h){c.fill("g-recaptcha-response",h)}return(h,g)=>{const y=v("IFormInput"),_=v("IFormError"),I=v("IFormGroup"),F=v("IFormCheckbox"),$=v("IButton"),C=ae("t");return d(),k("form",{class:"space-y-6",method:"POST",onSubmit:g[3]||(g[3]=ie((...w)=>h.submit&&h.submit(...w),["prevent"]))},[s(I,{label:h.$t("auth.login"),"label-for":"email"},{default:b(()=>[s(y,{id:"email",modelValue:l(c).email,"onUpdate:modelValue":g[0]||(g[0]=w=>l(c).email=w),type:"email",name:"email",autocomplete:"email",autofocus:"",required:""},null,8,["modelValue"]),s(_,{textContent:S(l(c).getError("email"))},null,8,["textContent"])]),_:1},8,["label"]),s(I,{label:h.$t("auth.password"),"label-for":"password"},{default:b(()=>[s(y,{id:"password",ref_key:"passwordRef",ref:r,modelValue:l(c).password,"onUpdate:modelValue":g[1]||(g[1]=w=>l(c).password=w),type:"password",name:"password",required:"",autocomplete:"current-password"},null,8,["modelValue"]),s(_,{textContent:S(l(c).getError("password"))},null,8,["textContent"])]),_:1},8,["label"]),l(n).validate?(d(),R(I,{key:0},{default:b(()=>[s(l(Sl),{ref_key:"reCaptchaRef",ref:i,sitekey:l(n).siteKey,onVerify:f},null,8,["sitekey"]),s(_,{textContent:S(l(c).getError("g-recaptcha-response"))},null,8,["textContent"])]),_:1})):O("",!0),o("div",Md,[o("div",Ud,[s(F,{id:"remember",modelValue:l(c).remember,"onUpdate:modelValue":g[2]||(g[2]=w=>l(c).remember=w),name:"remember",label:h.$t("auth.remember_me")},null,8,["modelValue","label"])]),l(t)("disable_password_forgot")?O("",!0):D((d(),k("a",{key:0,href:l(a)+"/password/reset",class:"link text-sm"},null,8,Pd)),[[C,"auth.forgot_password"]])]),s($,{type:"submit",block:"",disabled:m.value,loading:u.value,text:h.$t("auth.login"),onClick:p},null,8,["disabled","loading","text"])],32)}}},Ld={__name:"AuthPasswordEmail",setup(e){const t=Innoclapps.config("reCaptcha")||{},n=Innoclapps.config("url"),a=q(null),r=q(!1),i=q(null),{form:u}=Ae({email:null,"g-recaptcha-response":null},{resetOnSuccess:!0});async function c(){r.value=!0,i.value=null,await Innoclapps.request().get(n+"/sanctum/csrf-cookie"),u.post(n+"/password/email").then(p=>{i.value=p.message}).finally(()=>{r.value=!1,a.value&&a.value.reset()})}function m(p){u.fill("g-recaptcha-response",p)}return(p,f)=>{const h=v("IAlert"),g=v("IFormInput"),y=v("IFormError"),_=v("IFormGroup"),I=v("IButton");return d(),k("form",{class:"space-y-6",method:"POST",onSubmit:f[1]||(f[1]=ie((...F)=>p.submit&&p.submit(...F),["prevent"]))},[s(h,{variant:"success",show:i.value!==null},{default:b(()=>[Q(S(i.value),1)]),_:1},8,["show"]),s(_,{label:p.$t("auth.email_address"),"label-for":"email"},{default:b(()=>[s(g,{id:"email",modelValue:l(u).email,"onUpdate:modelValue":f[0]||(f[0]=F=>l(u).email=F),type:"email",name:"email",autocomplete:"email",autofocus:"",required:""},null,8,["modelValue"]),s(y,{textContent:S(l(u).getError("email"))},null,8,["textContent"])]),_:1},8,["label"]),l(t).validate?(d(),R(_,{key:0},{default:b(()=>[s(l(Sl),{ref_key:"reCaptchaRef",ref:a,sitekey:l(t).siteKey,onVerify:m},null,8,["sitekey"]),s(y,{textContent:S(l(u).getError("g-recaptcha-response"))},null,8,["textContent"])]),_:1})):O("",!0),s(I,{type:"submit",block:"",disabled:r.value||!l(u).email,loading:r.value,text:p.$t("passwords.send_password_reset_link"),onClick:c},null,8,["disabled","loading","text"])],32)}}},Hd=["href","textContent"],Gd={__name:"AuthPasswordReset",props:{email:String,token:{required:!0,type:String}},setup(e){const t=e,n=Innoclapps.config("url"),a=q(!1),r=q(null),{form:i}=Ae({token:t.token,email:t.email,password:null,password_confirmation:null});async function u(){a.value=!0,await Innoclapps.request().get(n+"/sanctum/csrf-cookie"),i.post(n+"/password/reset").then(c=>r.value=c.message).finally(()=>a.value=!1)}return(c,m)=>{const p=v("IAlert"),f=v("IFormInput"),h=v("IFormError"),g=v("IFormGroup"),y=v("IButton");return d(),k("form",{class:"space-y-6",method:"POST",onSubmit:m[3]||(m[3]=ie((..._)=>c.submit&&c.submit(..._),["prevent"]))},[s(p,{variant:"success",show:r.value!==null},{default:b(()=>[Q(S(r.value)+" ",1),o("a",{href:l(n)+"/login",class:"link mt-2 font-medium",textContent:S(c.$t("core::dashboard.dashboard"))},null,8,Hd)]),_:1},8,["show"]),s(g,{label:c.$t("auth.email_address"),"label-for":"email"},{default:b(()=>[s(f,{id:"email",modelValue:l(i).email,"onUpdate:modelValue":m[0]||(m[0]=_=>l(i).email=_),type:"email",name:"email",autocomplete:"email",autofocus:"",required:""},null,8,["modelValue"]),s(h,{textContent:S(l(i).getError("email"))},null,8,["textContent"])]),_:1},8,["label"]),s(g,{label:c.$t("auth.password"),"label-for":"password"},{default:b(()=>[s(f,{id:"password",modelValue:l(i).password,"onUpdate:modelValue":m[1]||(m[1]=_=>l(i).password=_),type:"password",name:"password",required:"",autocomplete:"new-password"},null,8,["modelValue"]),s(h,{textContent:S(l(i).getError("password"))},null,8,["textContent"])]),_:1},8,["label"]),s(g,{label:c.$t("auth.confirm_password"),"label-for":"password-confirm"},{default:b(()=>[s(f,{id:"password-confirm",modelValue:l(i).password_confirmation,"onUpdate:modelValue":m[2]||(m[2]=_=>l(i).password_confirmation=_),type:"password",name:"password_confirmation",required:"",autocomplete:"new-password"},null,8,["modelValue"])]),_:1},8,["label"]),s(y,{type:"submit",block:"",disabled:a.value,loading:a.value,text:c.$t("passwords.reset_password"),onClick:u},null,8,["disabled","loading","text"])],32)}}};function ls(e,t=2){if(e===0)return"0 B";const n=1024,a=t<0?0:t,r=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(a))+" "+r[i]}/*!
 * Get the contrasting color for any hex color
 * (c) 2019 Chris Ferdinandi, MIT License, https://gomakethings.com
 * Derived from work by Brian Suda, https://24ways.org/2010/calculating-color-contrast/
 * @param  {String} A hexcolor value
 * @return {String} The contrasting color (black or white)
 */function Vn(e){e.slice(0,1)==="#"&&(e=e.slice(1)),e.length===3&&(e=e.split("").map(function(i){return i+i}).join(""));var t=parseInt(e.substr(0,2),16),n=parseInt(e.substr(2,2),16),a=parseInt(e.substr(4,2),16),r=(t*299+n*587+a*114)/1e3;return r<=150?"white":"black"}function Yn(e="en"){if(typeof config<"u")return config.locale||config.fallback_locale||e;if(typeof window<"u"){const{userLanguage:t,language:n}=window.navigator;return(t||n).substr(0,2)}return e}function po(){return document.documentElement.classList.contains("dark")}function Kd(e){return new RegExp("[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}","i").test(e)}function Be(e){if(e!==null&&typeof e<"u"){if(typeof e=="string"&&e!=="")return!1;if(Array.isArray(e)&&e.length>0)return!1;if(typeof e=="object"&&Object.keys(e).length>0)return!1;if(typeof e=="boolean"||typeof e=="number")return!1}return!0}function Yd(e){return e.offsetWidth+e.offsetHeight>0}function Wd(e,t){let n=!1;e[0]=="#"&&(e=e.slice(1),n=!0);let a=parseInt(e,16),r=(a>>16)+t;r>255?r=255:r<0&&(r=0);let i=(a>>8&255)+t;i>255?i=255:i<0&&(i=0);let u=(a&255)+t;return u>255?u=255:u<0&&(u=0),(n?"#":"")+(u|i<<8|r<<16).toString(16)}function Bo(){if(Object.hasOwn(window,"__passiveEvt"))return window.__passiveEvt;let e=!1;try{const t=Object.defineProperty({},"passive",{get(){return e={passive:!0},!0}});window.addEventListener("testpassive",t,t),window.remove("testpassive",t,t)}catch{}return window.__passiveEvt=e,e}function qt(e=15){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<e;a++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function No(e){return e<59?"minutes":e>=10080?"weeks":e>=1440?"days":"hours"}function gl(e){const t=No(e);if(t==="minutes")return e;if(t==="hours")return e/60;if(t==="days")return e/1440;if(t==="weeks")return e/10080}function Qd(e,t){var n=parseInt(e.substring(1,3),16),a=parseInt(e.substring(3,5),16),r=parseInt(e.substring(5,7),16);n=parseInt(n*(100+t)/100),a=parseInt(a*(100+t)/100),r=parseInt(r*(100+t)/100),n=n<255?n:255,a=a<255?a:255,r=r<255?r:255;var i=n.toString(16).length==1?"0"+n.toString(16):n.toString(16),u=a.toString(16).length==1?"0"+a.toString(16):a.toString(16),c=r.toString(16).length==1?"0"+r.toString(16):r.toString(16);return"#"+i+u+c}function sl(e){e=e.toLowerCase().split(" ");for(var t=0;t<e.length;t++)e[t]=e[t].charAt(0).toUpperCase()+e[t].slice(1);return e.join(" ")}function Xd(e,t,n="..."){return e.substring(0,t)+n}const Ml=function(){var e=document.createElement("canvas");e.classList.add("absolute","bottom-0","w-full","h-full","confetti"),document.body.appendChild(e);var t=qr.create(e,{resize:!0});t({particleCount:300,spread:300,ticks:150,origin:{x:1}}).then(()=>{const n=e.cloneNode(!0);e.replaceWith(n),e.remove(),n.remove()})},yl=(e,t,n,a="hh:mm A",r=null)=>{const i=moment.duration(1,"day").as(n),u=[],c=moment(e,"hh:mm");r&&(r=moment(r+":00","HH:mm a"));for(let m=0;m<i;m+=t)c.add(m===0?0:t,n),(!r||r&&c.isSameOrBefore(r,"hour"))&&u.push(c.format(a));return u};class en{constructor(t=[]){this.items=nt(wt(t))}set(t){return this.items=nt(wt(t)),this}mergeValue(t,n){return this.updateValue(t,[...this.find(t).currentValue||[],...wt(n)]),this}updateValue(t,n){this.update(t,{value:n})}sync(t){return this.forEach(n=>{let a=this.extractValueFromData(n,t);a!==void 0&&(n.handleChange&&n.handleChange(a),n.value=a)}),this}populate(t){return this.forEach(n=>n.value=this.extractValueFromData(n,t)),this}dirty(){let t=!1;return this.items.forEach(n=>{n.isDirty&&n.isDirty()&&(t=!0)}),t}fill(t){return this.forEach(n=>!n.hidden&&n.fill&&n.fill(t)),t}get requiredFieldsMissingValues(){let t=!1;return this.forEach(n=>{n.isRequired&&Be(n.value)&&(t=!0)}),t}extractValueFromData(t,n){return t.belongsToRelation?Object.hasOwn(n,t.belongsToRelation)?n[t.belongsToRelation]:void 0:t.hasManyRelationship?Object.hasOwn(n,t.hasManyRelationship)?n[t.hasManyRelationship]:void 0:t.morphManyRelationship?Object.hasOwn(n,t.morphManyRelationship)?n[t.morphManyRelationship]:void 0:t.morphToManyRelationship?Object.hasOwn(n,t.morphToManyRelationship)?n[t.morphToManyRelationship]:void 0:t.attribute&&Object.hasOwn(n,t.attribute)?n[t.attribute]:void 0}find(t){let n;return this.every(a=>a.attribute==t?(n=a,!1):!0),n}has(t){return!!this.find(t)}update(t,n){let a=this.find(t);return a?(Sn(n,(r,i)=>a[i]=r),this):(console.trace("Cannot update field in collection as the field is not found. - "+t),this)}every(t){return this.items.every(n=>t(n)),this}forEach(t){return this.items.forEach(n=>t(n)),this}push(t){return this.items.push(t),this}keys(){let t=[];return this.forEach(n=>t.push(n.attribute)),t}remove(t){const n=Xe(this.items,["attribute",t]);return n!=-1?(this.items.splice(n,1),!0):!1}get totalCollapsable(){return this.all().filter(t=>t.collapsed).length}get hasCollapsable(){return this.totalCollapsable>0}isNotEmpty(){return this.all().length>0}isEmpty(){return!this.isNotEmpty()}all(){return this.items||[]}}class xl extends Fn{constructor(t,n={},a={},r=null){super(n,a),this.fields=t,this.formId=r||qt()}get isDirty(){return V(()=>this.fields instanceof en&&this.fields.dirty())}reset(){super.reset();const t=this.keys();this.fields.forEach(n=>{n.handleChange(nt(this.originalData[t[t.indexOf(n.attribute)]]))})}hydrate(){return this.fields.fill(this),this}ignore(){let t=super.ignore();return t.push("fields"),t.push("formId"),t}}const Ul=_n({});function Zd(e){delete Ul[e]}function Pl(e){return Ul[e]}function It(e,t={},n={},a=null){const r=_n(new xl(e,t,n,a));return Ul[r.formId]=r,on(()=>{Zd(r.formId)}),{form:r}}const Jd={class:"sm:flex sm:items-start"},ec={key:0,class:"mx-auto flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-danger-100 sm:mx-0 sm:h-10 sm:w-10"},tc={key:0,class:"mt-2"},nc={class:"text-sm text-neutral-500 dark:text-neutral-300"},oc={__name:"ActionDialog",props:{close:Function,cancel:Function,dialog:{type:Object,required:!0}},setup(e){const t=e,{form:n}=It([],{ids:[]}),a=V(()=>t.dialog.fields&&t.dialog.fields.isNotEmpty()),r=V(()=>!a.value&&t.dialog.message);async function i(){a.value&&t.dialog.fields.fill(n);const u=await n.fill("ids",t.dialog.ids).post(`${t.dialog.endpoint}`,{params:t.dialog.queryString});t.dialog.resolve({form:n,response:u}),t.close()}return(u,c)=>{const m=v("Icon"),p=v("FormFields"),f=v("IButton");return d(),k(te,null,[o("div",Jd,[a.value?O("",!0):(d(),k("div",ec,[s(m,{icon:"ExclamationTriangle",class:"h-6 w-6 text-danger-600"})])),o("div",{class:X([{"text-center sm:ml-4":!a.value},"mt-3 w-full sm:mt-0 sm:text-left"])},[s(l(io),{as:"h3",class:X([{"mt-2":!r.value},"text-lg/6 font-medium text-neutral-600 dark:text-white"])},{default:b(()=>[Q(S(e.dialog.title),1)]),_:1},8,["class"]),r.value?(d(),k("div",tc,[o("p",nc,S(e.dialog.message),1)])):O("",!0),a.value?(d(),R(p,{key:1,class:"mt-4",fields:e.dialog.fields,"form-id":l(n).formId,"is-floating":""},null,8,["fields","form-id"])):O("",!0)],2)]),o("div",{class:X(["mt-5 sm:mt-4 sm:flex",{"sm:ml-10 sm:pl-4":!a.value}])},[s(f,{variant:e.dialog.action.destroyable?"danger":"secondary",disabled:l(n).busy,loading:l(n).busy,text:u.$t("core::app.confirm"),class:"w-full sm:w-auto",onClick:i},null,8,["variant","disabled","loading","text"]),s(f,{variant:"white",class:"mt-2 w-full sm:ml-3 sm:mt-0 sm:w-auto",text:u.$t("core::app.cancel"),onClick:e.cancel},null,8,["text","onClick"])],2)],64)}}},lc={class:"inline-flex px-1.5 py-1"},ac={class:"ml-2 text-xs"},Bn={__name:"FieldsButtonCollapse",props:{collapsed:{required:!0,type:Boolean},total:{type:Number,required:!0}},emits:["update:collapsed"],setup(e){return(t,n)=>{const a=v("Icon"),r=ae("t");return d(),k("button",{type:"button",class:"flex items-center rounded-md border border-transparent text-neutral-500 outline-none hover:border-neutral-100 hover:bg-neutral-50 focus:border-neutral-100 dark:hover:border-neutral-700 dark:hover:bg-neutral-800 dark:focus:border-neutral-700",onClick:n[0]||(n[0]=i=>t.$emit("update:collapsed",!e.collapsed))},[o("div",lc,[s(a,{icon:e.collapsed?"ChevronDown":"ChevronUp",class:"-mt-px h-[1.1rem] w-[1.1rem]"},null,8,["icon"]),D(o("span",ac,null,512),[[r,{path:e.collapsed?"core::fields.more_fields":"core::fields.hide_fields",args:{count:e.total}}]])])])}}},sc={class:"sm:flex sm:items-start"},rc={class:"mt-3 w-full sm:mt-0 sm:text-left"},ic={class:"mt-4"},uc={class:"mb-3"},dc={class:"mt-5 sm:mt-4 sm:flex"},$o="keep",wo="replace",cc={__name:"ActionDialogBulkEdit",props:{close:Function,cancel:Function,dialog:{type:Object,required:!0}},setup(e){const t=e,n=q(!0),a=_n({}),r=q(t.dialog.fields);c();const{form:i}=It(r,{ids:[]});ge(a,p=>{Object.entries(p).forEach(([f,h])=>{r.value.update(f,{hidden:h===$o})})},{deep:!0});async function u(){try{const p=await i.clear().hydrate().fill("ids",t.dialog.ids).post(`${t.dialog.endpoint}`,{params:t.dialog.queryString});t.dialog.resolve({form:i,response:p}),t.close()}catch(p){throw m(),p}}function c(){r.value.forEach(p=>{p.hidden=!0,p.hideLabel=!0,p.toggleable=!1,p.value=null,p.beforeFieldSlotName="before-"+p.attribute+"-field",p.attribute&&(a[p.attribute]=$o)})}function m(){r.value.forEach(p=>{i.errors.has(p.attribute)&&a[p.attribute]===$o&&(a[p.attribute]=wo)})}return(p,f)=>{const h=v("IFormLabel"),g=v("ICustomSelect"),y=v("FormFields"),_=v("IButton");return d(),k(te,null,[o("div",sc,[o("div",rc,[s(l(io),{as:"h3",class:"text-lg/6 font-medium text-neutral-600 dark:text-white",textContent:S(e.dialog.title)},null,8,["textContent"]),o("div",ic,[r.value.hasCollapsable?(d(),R(Bn,{key:0,collapsed:n.value,"onUpdate:collapsed":f[0]||(f[0]=I=>n.value=I),total:r.value.totalCollapsable,class:"mb-3 ml-auto"},null,8,["collapsed","total"])):O("",!0),s(y,{fields:r.value,collapsed:n.value,"form-id":l(i).formId,"is-floating":""},vt({_:2},[re(r.value.all(),I=>({name:I.beforeFieldSlotName,fn:b(()=>[I.attribute?(d(),k("div",{key:0,class:X([I.displayNone||I.collapsed&&n.value?"hidden":"",a[I.attribute]===wo?"-mb-2":""])},[o("div",uc,[s(h,{class:"mb-1",for:I.attribute,required:a[I.attribute]===wo&&I.isRequired,label:I.label},null,8,["for","required","label"]),s(g,{modelValue:a[I.attribute],"onUpdate:modelValue":F=>a[I.attribute]=F,reduce:F=>F.value,"input-id":I.attribute,clearable:!1,options:[{value:$o,label:p.$t("core::fields.keep_existing_value")},{value:wo,label:p.$t("core::fields.replace_existing_value")}]},null,8,["modelValue","onUpdate:modelValue","reduce","input-id","options"])])],2)):O("",!0)])}))]),1032,["fields","collapsed","form-id"])])])]),o("div",dc,[s(_,{variant:"secondary",disabled:l(i).busy,loading:l(i).busy,text:p.$t("core::app.confirm"),class:"w-full sm:w-auto",onClick:u},null,8,["disabled","loading","text"]),s(_,{variant:"white",class:"mt-2 w-full sm:ml-3 sm:mt-0 sm:w-auto",text:p.$t("core::app.cancel"),onClick:e.cancel},null,8,["text","onClick"])])],64)}}};function rt(e,t){Innoclapps.$on(e,t),on(()=>{Innoclapps.$off(e,t)})}function Ct(e=!1){const t=q(e);function n(a=!0){t.value=a}return{setLoading:n,isLoading:t}}const mc={class:"group text-lg sm:flex sm:flex-col sm:items-center md:flex-row"},pc={class:"truncate md:grow"},fc={class:"flex items-center px-7 pt-4 md:pb-4"},vc={class:"ml-2 mt-px flex items-center space-x-2"},bc={key:0},hc={class:"-mt-2 ml-3.5 flex shrink-0 space-x-2 px-3 py-2 sm:-mt-0 sm:ml-0 sm:px-7 sm:py-4"},_c={__name:"Card",props:{card:Object,loading:Boolean,reloadOnQueryStringChange:{type:Boolean,default:!0},requestQueryString:Object},emits:["retrieved"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{setLoading:r,isLoading:i}=Ct(),{users:u}=Le(),c=q(null),m=V(()=>[{id:null,name:a("core::app.all")},...n.card.users||u.value].map(y=>({id:y.id,name:y.name}))),p=V(()=>n.loading||i.value),f=V(()=>n.card.ranges.length>0);n.card.withUserSelection!==!1&&typeof n.card.withUserSelection=="number"&&(c.value=Ee(m.value,["id",n.card.withUserSelection]));const h=q(Ee(n.card.ranges,y=>y.value===n.card.range)||n.card.ranges[0]);ge(()=>n.requestQueryString,()=>{n.reloadOnQueryStringChange&&g()},{deep:!0});function g(y=!1){var I;r(!0);let _={range:(I=l(h))==null?void 0:I.value,...n.requestQueryString||{},reload_cache:y&&typeof y=="boolean"};n.card.withUserSelection&&(_.user_id=c.value?c.value.id:null),Innoclapps.request().get(`/cards/${n.card.uriKey}`,{params:_}).then(({data:F})=>t("retrieved",{card:F,requestQueryString:_})).finally(()=>r(!1))}return n.card.refreshOnActionExecuted&&rt("action-executed",g),rt("refresh-cards",g),(y,_)=>{const I=v("ICardHeading"),F=v("Icon"),$=v("DropdownSelectInput"),C=v("ICard"),w=ae("i-tooltip");return d(),R(C,{overlay:p.value},{default:b(()=>[o("div",mc,[o("div",pc,[o("div",fc,[s(I,{class:"truncate"},{default:b(()=>[Q(S(e.card.name),1)]),_:1}),o("div",vc,[e.card.helpText?D((d(),k("div",bc,[s(F,{icon:"QuestionMarkCircle",class:"h-4 w-4 cursor-help text-neutral-500 hover:text-neutral-700 dark:text-white dark:hover:text-neutral-300"})])),[[w,e.card.helpText,void 0,{bottom:!0,light:!0}]]):O("",!0),o("a",{href:"#",class:"hidden text-neutral-500 group-hover:block hover:text-neutral-700 dark:text-white dark:hover:text-neutral-300",onClick:_[0]||(_[0]=ie(x=>g(!0),["prevent"]))},[s(F,{icon:"Refresh",class:X(["h-4 w-4",p.value?"animate-spin":""])},null,8,["class"])])])])]),o("div",hc,[de(y.$slots,"actions"),e.card.withUserSelection?(d(),R($,{key:0,modelValue:c.value,"onUpdate:modelValue":_[1]||(_[1]=x=>c.value=x),items:m.value,"label-key":"name","value-key":"id",placement:"bottom-end",onChange:_[2]||(_[2]=x=>g())},null,8,["modelValue","items"])):O("",!0),f.value?(d(),R($,{key:1,modelValue:h.value,"onUpdate:modelValue":_[3]||(_[3]=x=>h.value=x),placement:"bottom-end",items:e.card.ranges,onChange:_[4]||(_[4]=x=>g())},null,8,["modelValue","items"])):O("",!0)])]),de(y.$slots,"default")]),_:3},8,["overlay"])}}};function Ne(){const{currentUser:e,setting:t}=Le(),n=V(()=>r.value.indexOf("H:i")===-1),a=V(()=>e.value&&e.value.timezone?e.value.timezone:moment.tz.guess()),r=V(()=>e.value?e.value.time_format:t("time_format")),i=V(()=>e.value?e.value.date_format:t("date_format")),u=V(()=>moment().PHPconvertFormat(i.value+" "+r.value)),c=V(()=>moment().PHPconvertFormat(i.value));function m(C,w="YYYY-MM-DD HH:mm:ss"){return C&&moment.tz(C,a.value).clone().tz(Innoclapps.config("timezone")).format(w)}function p(C,w="YYYY-MM-DD HH:mm:ss"){return C&&g(C).clone().tz(a.value).format(w)}function f(C,w){return C&&g(C).clone().tz(a.value).format(w||u.value)}function h(C,w){if(!C)return C;const x=g(C).clone();return _(C)&&!/T00:00:00.000000Z$/.test(C)&&x.tz(a.value),x.format(w||c.value)}function g(C){return moment.tz(C,Innoclapps.config("timezone"))}function y(C="YYYY-MM-DD HH:mm:ss"){return g().format(C)}function _(C){return!oo(C)||C.indexOf("-")===1?!1:/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3,6}Z/.test(C)}function I(C){return!oo(C)||C.indexOf("-")<=1||C.indexOf(" ")===0||C.indexOf(":")===0?!1:/\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/.test(C)}function F(C){return!oo(C)||C.indexOf("-")===1?!1:/\d{4}-\d{2}-\d{2}$/.test(C)}function $(C,w=null){return _(C)?/T00:00:00.000000Z$/.test(C)?h(C):f(C):F(C)?h(C):I(C)?f(C):w}return{appDate:y,appMoment:g,localizedDate:h,localizedDateTime:f,dateFromAppTimezone:p,dateToAppTimezone:m,dateFormatForMoment:c,dateTimeFormatForMoment:u,currentDateFormat:i,currentTimeFormat:r,userTimezone:a,usesTwelveHourTime:n,maybeFormatDateValue:$,isISODate:_,isStandardDateTime:I,isDate:F}}function as(){let e=new WeakMap;const t=function(){e=new WeakMap},n=function(a,r,i=!0){if(a.tagName=="HTML")return!0;let u=r.getBoundingClientRect(),c,m;if(e.has(a)){const p=e.get(a);c=p.rect,m=p.parentNode}else c=arguments[3]||a.getBoundingClientRect(),m=a.parentNode,e.set(a,{rect:c,parentNode:m});return(i?c.left>=u.left:c.right>u.left)&&(i?c.right<=u.right:c.left<u.right)};return bt(t),{isColumnVisible:n,clearCache:t}}const gc=["textContent"],yc={key:0},xc={key:1},Ic={class:"mr-1 font-medium text-neutral-800 dark:text-neutral-100"},kc={class:"text-neutral-700 dark:text-neutral-300"},$c=["textContent"],wc={__name:"CardTable",props:{card:Object,stackable:{type:Boolean,default:!0}},setup(e){const t=e,n=qt(),{isColumnVisible:a}=as(),{maybeFormatDateValue:r}=Ne(),{t:i}=ve(),u=q([]),c=q({}),m=V(()=>c.value.fields.filter(_=>_.isStacked)),p=V(()=>c.value.fields.map(_=>(_.formatter=(I,F,$)=>r(I,cn($,F)),_))),f=V(()=>c.value.emptyText||i("core::app.not_enough_data")),h=V(()=>c.value.value.length>0);function g(_){c.value=_}function y(){const _=document.getElementById(n);p.value.forEach((I,F)=>{F>0&&u.value[F]&&(c.value.fields[F].isStacked=!a(u.value[F],_))})}return g(t.card),t.stackable&&ja(window,"resize",y),De(()=>{t.stackable&&Fe(y)}),(_,I)=>{const F=v("router-link"),$=v("ITable"),C=v("Card");return d(),R(C,{"no-body":"",card:e.card,onRetrieved:I[0]||(I[0]=w=>g(w.card))},{default:b(()=>[h.value?(d(),R($,{key:0,id:l(n),sticky:"","max-height":"450px"},{default:b(()=>[o("thead",null,[o("tr",null,[(d(!0),k(te,null,re(p.value,w=>(d(),k("th",{key:"th-"+w.key,ref_for:!0,ref_key:"thRefs",ref:u,class:X(["text-left",{hidden:w.isStacked}]),textContent:S(w.label)},null,10,gc))),128))])]),o("tbody",null,[(d(!0),k(te,null,re(c.value.value,w=>(d(),k("tr",{key:w[c.value.primaryKey]},[(d(!0),k(te,null,re(p.value,x=>(d(),k("td",{key:"td-"+x.key,class:X({"whitespace-nowrap":!x.isStacked,hidden:x.isStacked})},[x.key===p.value[0].key&&w.path?(d(),k("span",yc,[s(F,{class:"link",to:w.path},{default:b(()=>[Q(S(w[x.key]),1)]),_:2},1032,["to"])])):(d(),k("span",xc,S(x.formatter?x.formatter(w[x.key],x.key,w):w[x.key]),1)),x.key===p.value[0].key?(d(!0),k(te,{key:2},re(m.value,A=>(d(),k("p",{key:"stacked-"+A.key,class:"flex items-center font-normal"},[o("span",Ic,S(A.label)+": ",1),o("span",kc,S(A.formatter?A.formatter(w[A.key],A.key,w):w[A.key]),1)]))),128)):O("",!0)],2))),128))]))),128))])]),_:1},8,["id"])):(d(),k("p",{key:1,class:"pb-16 pt-12 text-center text-sm text-neutral-400 dark:text-neutral-300",textContent:S(f.value)},null,8,$c))]),_:1},8,["card"])}}},Wn=lo.create({transformRequest:[(e,t)=>(e instanceof FormData&&Cc(e)&&(t["Content-Type"]=null),e),...lo.defaults.transformRequest]});Wn.defaults.withCredentials=!0;Wn.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";Wn.defaults.headers.common["Content-Type"]="application/json";Wn.interceptors.request.use(e=>(window.Echo&&window.Echo.socketId()&&(e.headers["X-Socket-ID"]=window.Echo.socketId()),e));Wn.interceptors.response.use(e=>e,e=>{if(lo.isCancel(e))return e;e.isValidationError=()=>!1;const t=e.response.status;return t===404?Innoclapps.$emit("error-404"):t===403?Innoclapps.$emit("error-403",e):t===401?window.location.href=Innoclapps.config("url")+"/login":t===409?Innoclapps.$emit("conflict",e.response.data.message):t===419?Innoclapps.$emit("token-expired",e):t===422?(e.isValidationError=()=>!0,Innoclapps.$emit("form-validation-errors",e.response.data.errors)):t===429?Innoclapps.$emit("too-many-requests",e):t===503?Innoclapps.$emit("maintenance-mode",e.response.data.message):t>=500&&Innoclapps.$emit("error",e.response.data.message),Promise.reject(e)});function Cc(e){function t(n){if(n instanceof File)return!0;if(n instanceof Blob)return!1;if(Array.isArray(n)){for(const a of n)if(t(a))return!0}else if(typeof n=="object"&&n!==null){for(const a of Object.values(n))if(t(a))return!0}return!1}for(const[n,a]of e.entries())if(t(a))return!0;return!1}const Nn=lo.CancelToken,ba={data:[],current_page:1,per_page:25,per_page_options:[25,50,100],total:0,last_page:1,from:1,to:1};class Sc{constructor(t={}){this.state=Object.assign({},ba,t)}get pagination(){return this.buildLinks(this.currentPage,this.lastPage)}get items(){return this.state.data}get hasItems(){return this.items.length>0}get currentPage(){return this.getPaginationAttribute("current_page")}set currentPage(t){this.setPaginationAttribute("current_page",t)}get from(){return this.getPaginationAttribute("from")}get to(){return this.getPaginationAttribute("to")}get lastPage(){return this.getPaginationAttribute("last_page")}get perPage(){return this.getPaginationAttribute("per_page")}set perPage(t){this.setPaginationAttribute("per_page",t),this.currentPage=1}get total(){return this.getPaginationAttribute("total")}get perPageOptions(){let t=this.state.per_page_options,n=Number(this.perPage);return t.includes(n)||(t.push(n),t.sort(function(a,r){return a-r})),t}set perPageOptions(t){this.state.per_page_options=t}get hasPagination(){return this.lastPage>1}get shouldRenderLinks(){return this.pagination.includes(this.currentPage)}get hasNextPage(){return this.currentPage+1<=this.lastPage}get hasPreviousPage(){return this.currentPage-1>=1}previousPage(){this.page(this.currentPage-1)}nextPage(){this.page(this.currentPage+1)}page(t){this.currentPage=t}isCurrentPage(t){return this.currentPage===t}buildLinks(t,n,a=3){let r=[];for(let i=Math.max(2,t-a);i<=Math.min(n-1,t+a);i++)r.push(i);return t-a>2&&r.unshift("..."),t+a<n-1&&r.push("..."),r.unshift(1),r.push(n),r}getPaginationAttribute(t){return this.state[t]}setPaginationAttribute(t,n){return this.state[t]&&(this.state[t]=n),this}setState(t){this.state=Object.assign({},this.state,t)}flush(){this.state=ba}}const ha={data:[],meta:{current_page:1,from:1,last_page:1,per_page:25,total:0,to:1},per_page_options:[25,50,100]};class ss extends Sc{constructor(t={}){super(),this.state=Object.assign({},ha,t)}getPaginationAttribute(t){return this.state.meta[t]}setPaginationAttribute(t,n){return this.state.meta&&(this.state.meta[t]=n),this}flush(){this.state=ha}}const Rc={class:"flex items-center justify-between"},Fc={class:"flex flex-1 justify-between sm:hidden"},Vc={class:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between"},Tc={class:"text-sm text-neutral-700 dark:text-neutral-200"},Dc={class:"relative z-0 inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination"},qc=o("span",{class:"sr-only"},"Previous",-1),Ec=["onClick","textContent"],Ac=o("span",{class:"sr-only"},"Next",-1),rs={__name:"TablePagination",props:{loading:{type:Boolean,required:!1},isCurrentPageCheck:{type:Function,required:!0},renderLinks:{type:Boolean,required:!0},links:{type:Array},hasNextPage:{type:Boolean,required:!0},hasPreviousPage:{type:Boolean,required:!0},from:{type:Number,required:!0},to:{type:Number,required:!0},total:{type:Number,required:!0},size:{type:String,default:"md",validator(e){return["sm","md"].includes(e)}}},emits:["go-to-previous","go-to-next","go-to-page"],setup(e){return(t,n)=>{const a=v("IButton"),r=v("Icon"),i=ae("t");return d(),k("div",Rc,[o("div",Fc,[s(a,{variant:"white",size:e.size,disabled:!e.hasPreviousPage||e.loading,text:t.$t("pagination.previous"),onClick:n[0]||(n[0]=u=>t.$emit("go-to-previous"))},null,8,["size","disabled","text"]),s(a,{variant:"white",size:e.size,disabled:!e.hasNextPage||e.loading,text:t.$t("pagination.next"),onClick:n[1]||(n[1]=u=>t.$emit("go-to-next"))},null,8,["size","disabled","text"])]),o("div",Vc,[o("div",null,[D(o("p",Tc,null,512),[[i,{path:"core::table.info",args:{from:e.from,to:e.to,total:e.total}}]])]),o("div",null,[o("nav",Dc,[e.renderLinks?(d(),k(te,{key:0},[o("a",{href:"#",class:X([{"px-2 py-1":e.size==="sm","px-2 py-1.5":e.size==="md","pointer-events-none opacity-60":!e.hasPreviousPage||e.loading},"relative inline-flex items-center rounded-l-md border border-neutral-300 bg-white text-sm font-medium text-neutral-500 hover:bg-neutral-50 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700"]),onClick:n[2]||(n[2]=ie(u=>t.$emit("go-to-previous"),["prevent"]))},[qc,s(r,{icon:"ChevronLeft",class:X({"h-4 w-4":e.size==="sm","h-5 w-5":e.size==="md"})},null,8,["class"])],2),(d(!0),k(te,null,re(e.links,(u,c)=>(d(),k(te,{key:c},[u==="..."?(d(),k("span",{key:0,class:X([{"px-3 py-1":e.size==="sm","px-4 py-1.5":e.size==="md"},"relative inline-flex items-center border border-neutral-300 bg-white text-sm font-medium text-neutral-700 dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-300"])}," ... ",2)):(d(),k("a",{key:1,href:"#","aria-current":"page",class:X(["relative inline-flex items-center border text-sm font-medium focus:outline-none",e.isCurrentPageCheck(u)?"z-10 border-primary-500 bg-primary-50 text-primary-600 dark:border-primary-500 dark:bg-primary-500 dark:text-white":"border-neutral-300 bg-white text-neutral-500 hover:bg-neutral-50 dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700",{"px-3 py-1":e.size==="sm","px-4 py-1.5":e.size==="md","pointer-events-none opacity-60":e.loading}]),onClick:ie(m=>t.$emit("go-to-page",u),["prevent"]),textContent:S(u)},null,10,Ec))],64))),128)),o("a",{href:"#",class:X(["relative inline-flex items-center rounded-r-md border border-neutral-300 bg-white text-sm font-medium text-neutral-500 hover:bg-neutral-50 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700",{"px-2 py-1":e.size==="sm","px-2 py-1.5":e.size==="md","pointer-events-none opacity-60":!e.hasNextPage||e.loading}]),onClick:n[3]||(n[3]=ie(u=>t.$emit("go-to-next"),["prevent"]))},[Ac,s(r,{icon:"ChevronRight",class:X({"h-4 w-4":e.size==="sm","h-5 w-5":e.size==="md"})},null,8,["class"])],2)],64)):O("",!0)])])])])}}},Bc={class:"flex items-center space-x-1 text-sm text-neutral-600 dark:text-white"},Nc={__name:"TablePerPageOptions",props:{disabled:Boolean,collection:{required:!0,type:Object}},emits:["change"],setup(e){return(t,n)=>{const a=v("DropdownSelectInput"),r=ae("t");return d(),k("div",Bc,[D(o("span",null,null,512),[[r,"core::table.length_menu.show"]]),s(a,{modelValue:e.collection.perPage,"onUpdate:modelValue":n[0]||(n[0]=i=>e.collection.perPage=i),items:e.collection.perPageOptions,disabled:e.disabled,onChange:n[1]||(n[1]=i=>t.$emit("change",i))},null,8,["modelValue","items","disabled"]),D(o("span",null,null,512),[[r,"core::table.length_menu.entries"]])])}}},Oc={__name:"TableSimpleDataCell",props:{field:{type:Object,required:!0},item:{type:Object,required:!0},formatter:{type:Function,required:!0}},setup(e){const t=e,n=V(()=>({row:t.item,column:t.field,formatted:a.value})),a=V(()=>t.formatter(t.item,t.field));return(r,i)=>(d(),k("td",{class:X(["whitespace-nowrap",e.item.tdClass?e.item.tdClass:null])},[de(r.$slots,"default",pt(ft(n.value)))],2))}},zc=["onClick"],Mc=["textContent"],Uc={__name:"TableSimpleHeaderCell",props:{isSortable:Boolean,heading:String,headingKey:{type:String,required:!0},ctx:{type:Object,required:!0}},emits:["update:ctx"],setup(e,{expose:t,emit:n}){const a=e,r=q(null),i=V(()=>a.ctx.sortBy===a.headingKey),u=V(()=>a.ctx.direction==="asc"&&i.value);function c(){const m={};i.value?(m.sortBy=a.headingKey,m.direction=a.ctx.direction==="desc"?"asc":"desc"):(m.sortBy=a.headingKey,m.direction="desc"),n("update:ctx",Object.assign({},a.ctx,m))}return t({$el:r}),(m,p)=>{const f=v("Icon");return d(),k("th",{ref_key:"elRef",ref:r,class:"group text-left"},[e.isSortable?(d(),k("a",{key:0,href:"#",class:"inline-flex w-full items-center hover:text-neutral-700 focus:outline-none dark:hover:text-neutral-400",onClick:ie(c,["prevent"])},[Q(S(e.heading)+" ",1),s(f,{icon:u.value?"ChevronUp":"ChevronDown",class:X(["ml-1.5 h-3 w-3",i.value?"opacity-100":"opacity-0 group-hover:opacity-100"])},null,8,["icon","class"])],8,zc)):(d(),k("span",{key:1,textContent:S(e.heading)},null,8,Mc))],512)}}},Pc={class:"mt-2 flex items-center font-normal"},jc={class:"mr-1 font-medium text-neutral-800 dark:text-neutral-100"},Lc={__name:"TableSimpleStackedDataCell",props:{field:{type:Object,required:!0},item:{type:Object,required:!0},formatter:{type:Function,required:!0}},setup(e){const t=e,n=V(()=>({row:t.item,column:t.field,formatted:a.value})),a=V(()=>t.formatter(t.item,t.field));return(r,i)=>(d(),k("div",Pc,[o("span",jc,S(e.field.label)+": ",1),de(r.$slots,"default",pt(ft(n.value)))]))}},Hc={class:"flex flex-col items-center justify-between px-7 py-3 md:flex-row"},Gc={key:0,class:"w-full md:w-auto"},Kc={key:0},Yc=["textContent"],Wc={class:"text-neutral-700 dark:text-neutral-300"},Qc={key:0},Xc=["colspan"],is={__name:"TableSimple",props:{stackable:Boolean,requestUri:{required:!0,type:String},requestQueryString:Object,tableId:{required:!0,type:String},actionColumn:Boolean,initialData:Object,fields:Array,searchable:{type:Boolean,default:!0},sortBy:String,tableProps:{type:Object,default(){return{}}}},emits:["data-loaded"],setup(e,{expose:t,emit:n}){const a=e,{t:r}=ve(),{setLoading:i,isLoading:u}=Ct(),{isColumnVisible:c}=as(),m=q(null),p=q(""),f=q(!1);let h=null;const g=q(new ss),y=q(null),_=_n({}),I=q({sortBy:null,direction:null}),F=q([]),$=V(()=>g.value.hasItems?"":u.value?"...":p.value?r("core::app.no_search_results"):r("core::table.empty")),C=V(()=>a.fields.filter(U=>_[U.key])),w=V(()=>a.fields.length),x=V(()=>({page:g.value.currentPage,per_page:g.value.perPage,q:p.value,order:[{field:I.value.sortBy||a.sortBy,direction:I.value.direction||"asc"}],...a.requestQueryString||{}})),A=Dt(z,400);ge(()=>g.value.currentPage,z,{immediate:!0});function N(U,P){return P.formatter?P.formatter(U[P.key],P.key,U):U[P.key]}function T(U){y.value=U,E()}function E(){z()}async function B(){M(),i(!0);let{data:U}=await Innoclapps.request().get(`/${a.requestUri}`,{params:x.value,cancelToken:new Nn(P=>h=P)});g.value.setState(U.value?U.value:U),n("data-loaded",{items:g.value.items,requestQueryString:x.value}),a.stackable&&Fe(j),i(!1)}function z(){!f.value&&a.initialData?(f.value=!0,g.value.setState(a.initialData),a.stackable&&Fe(j)):y.value!==null?(g.value.setState(y.value),y.value=null,a.stackable&&Fe(j)):B()}function M(){h&&h()}function j(){a.fields.forEach((U,P)=>{P>0&&F.value[P]&&(_[U.key]=!c(F.value[P].$el,m.value.$el))})}return a.stackable&&ja(window,"resize",j),on(()=>{g.value.flush()}),t({reload:E,replaceCollection:T}),(U,P)=>{const H=v("SearchInput"),L=v("router-link"),Z=v("ITable"),J=v("IOverlay");return d(),k("div",null,[o("div",Hc,[s(Nc,{collection:g.value,class:"mb-2 md:mb-0",disabled:l(u),onChange:z},null,8,["collection","disabled"]),e.searchable?(d(),k("div",Gc,[s(H,{modelValue:p.value,"onUpdate:modelValue":P[0]||(P[0]=K=>p.value=K),onInput:l(A)},null,8,["modelValue","onInput"])])):O("",!0)]),s(J,{show:l(u)},{default:b(()=>[s(Z,Re({id:e.tableId},e.tableProps,{ref_key:"tableRef",ref:m}),{default:b(()=>[o("thead",null,[o("tr",null,[(d(!0),k(te,null,re(e.fields,K=>(d(),R(Uc,{key:"th-"+K.key,ref_for:!0,ref_key:"tableHeadingsRef",ref:F,ctx:I.value,"onUpdate:ctx":[P[1]||(P[1]=G=>I.value=G),z],class:X({hidden:_[K.key]}),"is-sortable":K.sortable,heading:K.label,"heading-key":K.key},null,8,["ctx","class","is-sortable","heading","heading-key"]))),128))])]),o("tbody",null,[(d(!0),k(te,null,re(g.value.items,K=>(d(),k("tr",{key:"tr-"+K.id,class:X([K.trClass?K.trClass:null])},[(d(!0),k(te,null,re(e.fields,G=>(d(),R(Oc,{key:"td-"+G.key,field:G,item:K,formatter:N,class:X({hidden:_[G.key]})},{default:b(oe=>[de(U.$slots,G.key,pt(ft(oe)),()=>[G.key===e.fields[0].key&&K.path?(d(),k("span",Kc,[s(L,{class:"link",to:K.path},{default:b(()=>[Q(S(oe.formatted),1)]),_:2},1032,["to"])])):(d(),k("span",{key:1,textContent:S(oe.formatted)},null,8,Yc))]),G.key===e.fields[0].key?(d(!0),k(te,{key:0},re(C.value,pe=>(d(),R(Lc,{key:"stacked-"+pe.key,field:pe,item:K,formatter:N},{default:b(ue=>[de(U.$slots,pe.key,pt(ft(ue)),()=>[o("span",Wc,S(ue.formatted),1)])]),_:2},1032,["field","item"]))),128)):O("",!0)]),_:2},1032,["field","item","class"]))),128))],2))),128)),g.value.hasItems?O("",!0):(d(),k("tr",Qc,[o("td",{colspan:w.value,class:"is-empty"},[de(U.$slots,"empty",{text:$.value,loading:l(u),search:p.value},()=>[Q(S($.value),1)])],8,Xc)]))])]),_:3},16,["id"])]),_:3},8,["show"]),g.value.hasPagination?(d(),R(rs,{key:0,class:"px-7 py-3","is-current-page-check":K=>g.value.isCurrentPage(K),"has-next-page":g.value.hasNextPage,"has-previous-page":g.value.hasPreviousPage,links:g.value.pagination,"render-links":g.value.shouldRenderLinks,from:g.value.from,to:g.value.to,total:g.value.total,loading:l(u),size:"sm",onGoToNext:P[2]||(P[2]=K=>g.value.nextPage()),onGoToPrevious:P[3]||(P[3]=K=>g.value.previousPage()),onGoToPage:P[4]||(P[4]=K=>g.value.page(K))},null,8,["is-current-page-check","has-next-page","has-previous-page","links","render-links","from","to","total","loading"])):O("",!0)])}}},Zc={class:"mh-56 overflow-y-auto"},Jc={__name:"CardTableAsync",props:{card:Object},setup(e,{expose:t}){const n=e,{maybeFormatDateValue:a}=Ne(),r=q({}),i=q({}),u=q(null),c=V(()=>n.card.fields.map(f=>(f.formatter=(h,g,y)=>a(h,cn(y,g)),f)));function m(f){i.value=f.requestQueryString,u.value.replaceCollection(f.card.value)}function p(){u.value.reload()}return t({reload:p}),(f,h)=>{const g=v("Card");return d(),R(g,{card:e.card,"no-body":"","request-query-string":r.value,"reload-on-query-string-change":!1,onRetrieved:m},{actions:b(()=>[de(f.$slots,"actions")]),default:b(()=>[o("div",Zc,[s(is,{ref_key:"tableRef",ref:u,stackable:"",searchable:e.card.searchable,"table-id":e.card.uriKey,"table-props":{sticky:!0,maxHeight:"450px"},fields:c.value,"initial-data":e.card.value,"request-query-string":i.value,"request-uri":`cards/${e.card.uriKey}`,onDataLoaded:h[0]||(h[0]=y=>r.value=y.requestQueryString)},vt({_:2},[re(f.$slots,(y,_)=>({name:_,fn:b(I=>[de(f.$slots,_,pt(ft(I)))])}))]),1032,["searchable","table-id","fields","initial-data","request-query-string","request-uri"])])]),_:3},8,["card","request-query-string"])}}};function us(e){const t=V(()=>{const a=n.value,r=a.series.length;if(r===0)return!1;let i=!1;for(let u=0;u<r&&!(a.series[u].length>0&&(i=a.series[u].some(c=>c.value>0),i));u++);return i}),n=V(()=>({labels:_t(e.value,a=>a.label),series:[_t(e.value,a=>({meta:a.label,value:a.value,color:a.color}))]}));return{chartData:n,hasData:t}}function Mt(){return{toFixed:La,formatNumber:function(e,t={}){return Er(e,Object.assign({precision:Innoclapps.config("currency.precision"),thousand:Innoclapps.config("currency.thousands_separator"),decimal:Innoclapps.config("currency.decimal_mark")},t))},formatMoney:function(e,t=null){return t=t||Innoclapps.config("currency"),_l(e,{symbol:t.symbol,precision:t.precision,thousand:t.thousands_separator,decimal:t.decimal_mark,format:t.symbol_first==!0?"%s%v":"%v%s"})}}}const em={__name:"PresentationChart",props:{chartData:null,amountValue:null,horizontal:null,axisYOffset:{type:Number,default:30},axisXOffset:{type:Number,default:30},onlyInteger:{type:Boolean,default:!0}},setup(e){const t=e;let n=null;const a=q(null),{formatMoney:r}=Mt();function i(){n.update(t.chartData)}function u(){n&&n.detach()}return ge(()=>t.chartData,i),De(()=>{n=new Ar(a.value,t.chartData,{horizontalBars:t.horizontal,fullWidth:!0,axisY:{offset:t.axisYOffset,onlyInteger:t.onlyInteger},axisX:{onlyInteger:t.onlyInteger,offset:t.axisXOffset},plugins:[Ha({pointClass:"ct-bar",anchorToPoint:!1,appendToBody:!1,transformTooltipTextFnc:c=>t.amountValue?r(c):c})]}),n.on("draw",c=>{if(c.type==="bar"){let m=c.series[c.index].color;m&&c.element.attr({style:`stroke: ${m} !important`})}})}),bt(u),(c,m)=>(d(),k("div",{ref_key:"chartRef",ref:a,class:"ct-chart"},null,512))}},tm={key:1,class:"mt-12 text-center text-sm text-neutral-400 dark:text-neutral-300"},nm={__name:"PresentationChart",props:{card:{required:!0,type:Object},requestQueryString:{type:Object,default(){return{}}}},setup(e){const t=e,n=dt(t.card.value),a=V(()=>t.card.color||"chart-primary"),{chartData:r,hasData:i}=us(n);return(u,c)=>{const m=v("Card"),p=ae("t");return d(),R(m,{class:"h-56 md:h-52","overflow-hidden":!1,"no-body":"",card:e.card,"request-query-string":e.requestQueryString,onRetrieved:c[0]||(c[0]=f=>n.value=f.card.value)},vt({default:b(()=>[o("div",{class:X(["relative",a.value])},[l(i)?(d(),R(em,{key:0,class:"px-1","chart-data":l(r),"amount-value":e.card.amount_value,horizontal:e.card.horizontal,"only-integer":e.card.onlyInteger,"axis-y-offset":e.card.axisYOffset,"axis-x-offset":e.card.axisXOffset},null,8,["chart-data","amount-value","horizontal","only-integer","axis-y-offset","axis-x-offset"])):D((d(),k("p",tm,null,512)),[[p,"core::app.not_enough_data"]])],2)]),_:2},[re(u.$slots,(f,h)=>({name:h,fn:b(g=>[de(u.$slots,h,pt(ft(g)))])}))]),1032,["card","request-query-string"])}}},om={__name:"ProgressionChart",props:["chartData","amountValue"],setup(e){const t=e;let n=null;const a=q(null),{formatMoney:r}=Mt();function i(){n.update(t.chartData)}function u(){n&&n.detach()}return ge(()=>t.chartData,i),De(()=>{n=new Br(a.value,t.chartData,{lineSmooth:Nr.none(),fullWidth:!0,showPoint:!0,showLine:!0,showArea:!0,chartPadding:{top:10,right:1,bottom:1,left:1},low:0,axisX:{showGrid:!1,showLabel:!0,offset:0},axisY:{showGrid:!1,showLabel:!0,offset:0},plugins:[Ha({pointClass:"ct-point",anchorToPoint:!1,appendToBody:!1,transformTooltipTextFnc:c=>t.amountValue?r(c):c})]})}),bt(u),(c,m)=>(d(),k("div",{ref_key:"chartRef",ref:a,class:"ct-chart"},null,512))}},lm={key:1,class:"mt-12 text-center text-sm text-neutral-400 dark:text-neutral-300"},am={__name:"ProgressionChart",props:{card:{required:!0,type:Object},requestQueryString:{type:Object,default(){return{}}}},setup(e){const t=e,n=dt(t.card.value),a=V(()=>t.card.color||"chart-primary"),{chartData:r,hasData:i}=us(n);return(u,c)=>{const m=v("Card"),p=ae("t");return d(),R(m,{"no-body":"",class:"h-56 md:h-52","overflow-hidden":!1,card:e.card,"request-query-string":e.requestQueryString,onRetrieved:c[0]||(c[0]=f=>n.value=f.card.value)},vt({default:b(()=>[o("div",{class:X(["relative",a.value])},[l(i)?(d(),R(om,{key:0,class:"px-1","chart-data":l(r),"amount-value":e.card.amount_value},null,8,["chart-data","amount-value"])):D((d(),k("p",lm,null,512)),[[p,"core::app.not_enough_data"]])],2)]),_:2},[re(u.$slots,(f,h)=>({name:h,fn:b(g=>[de(u.$slots,h,pt(ft(g)))])}))]),1032,["card","request-query-string"])}}};const sm={key:0,class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},rm=["id","value","placeholder","disabled","name"],im={__name:"DatePicker",props:{modelValue:String,withIcon:{default:!0,type:Boolean},id:String,name:String,placeholder:String,disabled:Boolean,required:Boolean,clearable:Boolean,rounded:{type:Boolean,default:!0},mode:{type:String,default:"date",validator:e=>["date","dateTime","time"].includes(e)},size:{type:[String,Boolean],default:"",validator:e=>["sm","lg","md","",!1].includes(e)}},emits:["update:modelValue","input"],setup(e,{emit:t}){const n=e,{appMoment:a,localizedDateTime:r,dateToAppTimezone:i,dateFromAppTimezone:u,dateFormatForMoment:c,usesTwelveHourTime:m,userTimezone:p}=Ne(),{currentUser:f,setting:h}=Le(),g=q(null),y=V(()=>n.rounded&&n.size==="sm"?"rounded":n.rounded&&n.size!=="sm"&&n.size!==!1?"rounded-md":""),_=V(()=>n.mode.toLowerCase()==="datetime"),I=V(()=>n.mode.toLowerCase()==="date"),F=V(()=>{let B={};return I.value?(B.input=c.value,B.modelValue="YYYY-MM-DD"):_.value&&(B.modelValue="YYYY-MM-DD HH:mm:ss"),B}),$=V(()=>g.value?w(g.value):""),C=V(()=>{let B=Number(f?f.value.first_day_of_week:h("first_day_of_week"));return{masks:F.value,id:navigator.language,firstDayOfWeek:B+1}});ge(g,B=>{if(Be(B))return E();I.value?T(B):_.value?T(i(B)):T(B)}),ge(()=>n.modelValue,B=>{A(B)||x(B)},{immediate:!0,deep:!0});function w(B){return I.value?a(B).format(c.value):_.value?r(i(B)):B}function x(B){_.value?g.value=u(B):(I.value,g.value=B)}function A(B){if(B===g.value)return!0;if(!g.value&&B||!B&&g.value)return!1;if(_.value)return u(B)===g.value;if(I.value)return B===g.value}function N(){g.value=null}function T(B){t("update:modelValue",B),t("input",B)}function E(){T(null)}return(B,z)=>{const M=v("Icon");return d(),R(l(Ga),{modelValue:g.value,"onUpdate:modelValue":z[1]||(z[1]=j=>g.value=j),modelModifiers:{string:!0},timezone:l(p),mode:e.mode,"is-required":e.required,"is-dark":l(po)(),locale:C.value,is24hr:!l(m),"hide-time-header":!0,masks:F.value,"title-position":"left",popover:{visibility:"click",positionFixed:!0}},{default:b(j=>[de(B.$slots,"default",pt(ft({...j,inputValue:$.value})),()=>[o("div",{class:X([y.value,"relative shadow-sm"])},[e.withIcon?(d(),k("div",sm,[z[0]||(he(-1),z[0]=s(M,{icon:"Calendar",class:"h-5 w-5 text-neutral-500 dark:text-neutral-300"}),he(1),z[0])])):O("",!0),o("input",Re({id:e.id,type:"text",readonly:"",class:["form-input border-neutral-300 dark:border-neutral-500 dark:bg-neutral-700 dark:text-white dark:placeholder-neutral-400",y.value,{"pl-11":e.withIcon,"form-input-sm":e.size==="sm","form-input-lg":e.size==="lg"}],autocomplete:"off",value:$.value,placeholder:e.placeholder,disabled:e.disabled,name:e.name},qo(j.inputEvents,!0)),null,16,rm),e.clearable?D((d(),R(M,{key:1,icon:"X",class:"absolute right-3 top-2.5 h-5 w-5 cursor-pointer text-neutral-400 hover:text-neutral-600 dark:text-neutral-200 dark:hover:text-neutral-400",onClick:N},null,512)),[[Y,!!g.value]]):O("",!0)],2)])]),_:3},8,["modelValue","timezone","mode","is-required","is-dark","locale","is24hr","masks"])}}};const um={class:"flex flex-col items-center justify-start sm:flex-row"},dm={key:0,class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},cm=["id","value","placeholder","disabled","name"],mm={class:"m-2 shrink-0"},pm={key:0,class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},fm=["id","value","placeholder","disabled","name"],vm={__name:"DateRangePicker",props:{modelValue:Object,withIcon:{default:!0,type:Boolean},id:String,name:String,placeholder:String,disabled:Boolean,required:Boolean,clearable:Boolean,rounded:{type:Boolean,default:!0},rangeKeys:{type:Object,default:()=>({start:"start",end:"end"})},mode:{type:String,default:"date",validator:e=>["date","dateTime","time"].includes(e)},size:{type:[String,Boolean],default:"",validator:e=>["sm","lg","md","",!1].includes(e)}},emits:["update:modelValue","input"],setup(e,{emit:t}){const n=e,{appMoment:a,localizedDateTime:r,dateToAppTimezone:i,dateFromAppTimezone:u,dateFormatForMoment:c,usesTwelveHourTime:m,userTimezone:p}=Ne(),{currentUser:f,setting:h}=Le(),g=q(null),y=V(()=>n.rounded&&n.size==="sm"?"rounded":n.rounded&&n.size!=="sm"&&n.size!==!1?"rounded-md":""),_=V(()=>n.mode.toLowerCase()==="datetime"),I=V(()=>n.mode.toLowerCase()==="date"),F=V(()=>{let U={};return I.value?(U.input=c.value,U.modelValue="YYYY-MM-DD"):_.value&&(U.modelValue="YYYY-MM-DD HH:mm:ss"),U}),$=V(()=>({[n.rangeKeys.start]:x.value,[n.rangeKeys.end]:A.value})),C=V(()=>g.value[n.rangeKeys.start]),w=V(()=>g.value[n.rangeKeys.end]),x=V(()=>C.value?T(C.value):""),A=V(()=>w.value?T(w.value):""),N=V(()=>{let U=Number(f?f.value.first_day_of_week:h("first_day_of_week"));return{masks:F.value,id:navigator.language,firstDayOfWeek:U+1}});ge(g,U=>{if(Be(U))return j();I.value?M(U):_.value?M({[n.rangeKeys.start]:i(U[n.rangeKeys.start]),[n.rangeKeys.end]:i(U[n.rangeKeys.end])}):M(U)}),ge(()=>n.modelValue,U=>{B(U)||E(U)},{immediate:!0,deep:!0});function T(U){return I.value?a(U).format(c.value):_.value?r(i(U)):U}function E(U){I.value?g.value={[n.rangeKeys.start]:U[n.rangeKeys.start],[n.rangeKeys.end]:U[n.rangeKeys.end]}:_.value?g.value={[n.rangeKeys.start]:u(U[n.rangeKeys.start]),[n.rangeKeys.end]:u(U[n.rangeKeys.end])}:g.value=U}function B(U){if(U===g.value)return!0;if(!g.value&&U||!U&&g.value)return!1;if(_.value)return u(U[n.rangeKeys.start]===C.value)&&u(U[n.rangeKeys.end]===w.value);if(I.value)return U[n.rangeKeys.start]===C.value&&U[n.rangeKeys.end]===w.value}function z(){g.value[n.rangeKeys.start]=null,g.value[n.rangeKeys.end]=null}function M(U){t("update:modelValue",U),t("input",U)}function j(){M({[n.rangeKeys.start]:null,[n.rangeKeys.end]:null})}return(U,P)=>{const H=v("Icon");return d(),R(l(Ga),{modelValue:g.value,"onUpdate:modelValue":P[2]||(P[2]=L=>g.value=L),modelModifiers:{string:!0,range:!0},timezone:l(p),mode:e.mode,"is-required":e.required,"is-dark":l(po)(),locale:N.value,is24hr:!l(m),"hide-time-header":!0,masks:F.value,"title-position":"left",popover:{visibility:"click",positionFixed:!0}},{default:b(L=>[de(U.$slots,"default",pt(ft({...L,inputValue:$.value})),()=>[o("div",um,[o("div",{class:X([y.value,"relative grow shadow-sm"])},[e.withIcon?(d(),k("div",dm,[P[0]||(he(-1),P[0]=s(H,{icon:"Calendar",class:"h-5 w-5 text-neutral-500 dark:text-neutral-300"}),he(1),P[0])])):O("",!0),o("input",Re({id:e.id+"-"+e.rangeKeys.start,type:"text",readonly:"",class:["form-input border-neutral-300 dark:border-neutral-500 dark:bg-neutral-700 dark:text-white dark:placeholder-neutral-400",y.value,{"pl-11":e.withIcon,"form-input-sm":e.size==="sm","form-input-lg":e.size==="lg"}],autocomplete:"off",value:x.value,placeholder:e.placeholder,disabled:e.disabled,name:e.name+"-"+e.rangeKeys.start},qo(L.inputEvents[e.rangeKeys.start],!0)),null,16,cm)],2),o("span",mm,[s(H,{icon:"ArrowRight",class:"h-4 w-4 text-neutral-600"})]),o("div",{class:X([y.value,"relative grow shadow-sm"])},[e.withIcon?(d(),k("div",pm,[P[1]||(he(-1),P[1]=s(H,{icon:"Calendar",class:"h-5 w-5 text-neutral-400 dark:text-neutral-300"}),he(1),P[1])])):O("",!0),o("input",Re({id:e.id+"-"+e.rangeKeys.end,type:"text",readonly:"",class:["form-input border-neutral-300 dark:border-neutral-500 dark:bg-neutral-700 dark:text-white dark:placeholder-neutral-400",y.value,{"pl-11":e.withIcon,"form-input-sm":e.size==="sm","form-input-lg":e.size==="lg"}],autocomplete:"off",value:A.value,placeholder:e.placeholder,disabled:e.disabled,name:e.name+"-"+e.rangeKeys.end},qo(L.inputEvents[e.rangeKeys.end],!0)),null,16,fm),e.clearable?D((d(),R(H,{key:1,icon:"X",class:"absolute right-3 top-2.5 h-5 w-5 cursor-pointer text-neutral-400 hover:text-neutral-600 dark:text-neutral-200 dark:hover:text-neutral-400",onClick:z},null,512)),[[Y,!!C.value&&!!w.value]]):O("",!0)],2)])])]),_:3},8,["modelValue","timezone","mode","is-required","is-dark","locale","is24hr","masks"])}}},bm=["disabled","onClick"],hm=Object.assign({inheritAttrs:!1},{__name:"DropdownSelectInput",props:{modelValue:{required:!0},label:String,toggleClass:[Array,Object,String],items:{type:Array,default:()=>[]},maxHeight:{type:String,default:"500px"},labelKey:{type:String,default:"label"},valueKey:{type:String,default:"value"}},emits:["change","update:modelValue"],setup(e,{emit:t}){const n=e,a=V(()=>{if(n.label)return n.label;if(Wt(n.modelValue))return n.modelValue[n.labelKey];if(typeof n.modelValue=="string"||typeof n.modelValue=="number"||n.modelValue===null){if(Wt(n.items[0])){let i=Ee(n.items,[n.valueKey,n.modelValue]);return i?i[n.labelKey]:""}return n.items.find(i=>i==n.modelValue)||""}return n.modelValue});function r(i){t("update:modelValue",i),At(i,n.modelValue)||t("change",i)}return(i,u)=>{const c=v("Icon"),m=v("IDropdownItem"),p=v("IDropdown");return d(),R(p,Re({"items-class":"max-w-xs sm:max-w-sm"},i.$attrs,{full:!1}),{toggle:b(({disabled:f,noCaret:h,toggle:g})=>[de(i.$slots,"default",{label:a.value,toggle:g},()=>[o("button",{type:"button",disabled:f,class:X([e.toggleClass,"flex w-full items-center rounded-md px-1 text-sm text-neutral-800 hover:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-neutral-300 disabled:pointer-events-none disabled:opacity-60 dark:text-neutral-200 dark:hover:text-neutral-300"]),onClick:g},[de(i.$slots,"label",{label:a.value},()=>[Q(S(a.value),1)]),h?O("",!0):(d(),R(c,{key:0,icon:"ChevronDown",class:"ml-1 mt-px h-5 w-5"}))],10,bm)])]),default:b(()=>[o("div",{class:"overflow-y-auto py-1",style:st({maxHeight:e.maxHeight})},[de(i.$slots,"header"),(d(!0),k(te,null,re(e.items,f=>(d(),R(m,{key:typeof f=="object"?f[e.valueKey]:f,class:X(typeof f=="object"&&Object.hasOwn(f,"class")&&f.class?f.class:null),icon:typeof f=="object"&&f.icon?f.icon:null,"prepend-icon":typeof f=="object"&&Object.hasOwn(f,"prependIcon")?f.prependIcon:!1,disabled:typeof f=="object"&&f.disabled===!0,onClick:h=>r(f)},{default:b(()=>[Q(S(typeof f=="object"?f[e.labelKey]:f),1)]),_:2},1032,["class","icon","prepend-icon","disabled","onClick"]))),128)),de(i.$slots,"footer")],4)]),_:3},16)}}}),Oo={fr:"fr_FR",he:"he_IL",hu:"hu_HU",nb:"nb_NO",pt:"pt_PT",sv:"sv_SE",zh:"zh_CN",bg:"bg_BG"},_m={__name:"Editor",props:{modelValue:{},placeholder:{type:String,default:""},disabled:Boolean,defaultTag:{type:String,default:"p"},withImage:{default:!0,type:Boolean},withMention:Boolean,autoCompleter:[Array,Object],toolbar:String,config:Object,plugins:[Array,String]},emits:["update:modelValue","input","init"],setup(e,{expose:t,emit:n}){const a=e,r=Yn(),{t:i}=ve(),{users:u,currentUser:c}=Le(),m=q(null),p=q(!1),f=qt(),h=q(null);let g=null,y=null;ge(()=>a.autoCompleter,T=>{T&&m.value.rerender(I.value)}),ge(h,T=>{T!=a.modelValue&&(n("update:modelValue",T),n("input",T))}),ge(()=>a.modelValue,T=>{T!=h.value&&(h.value=T||"")},{immediate:!0});const _=q({menubar:!1,visual:!1,statusbar:!1,width:"100%",height:"200px",contextmenu:!1,branding:!1,forced_root_block:a.defaultTag,images_upload_handler:w,language:Object.hasOwn(Oo,r)?Oo[r]:r,automatic_uploads:!0,images_reuse_filename:!0,paste_data_images:a.withImage,relative_urls:!1,remove_script_host:!1,placeholder:a.placeholder,format_noneditable_selector:".not-used",plugins:a.plugins||["lists","autolink","link","autoresize",a.withImage?"image":""].filter(T=>T!==""),toolbar:a.toolbar||`
    blocks |
    bold italic underline strikethrough |
    forecolor backcolor |
    link${a.withImage?" image":""} |
    alignment | bullist numlist | removeformat
    `,init_instance_callback:T=>{},setup:T=>{T.concordCommands={},a.withMention&&C(T),a.autoCompleter&&$(a.autoCompleter,T),T.on("init",E=>{y=E.target,n("init")}),T.ui.registry.addGroupToolbarButton("alignment",{icon:"align-left",tooltip:tinymce.util.I18n.translate("Alignment"),items:"alignleft aligncenter alignright | alignjustify"})},content_style:`
  .mention {
    color: #212529;
    background-color: #f4f5f7;
    height: 24px;
    width: 65px;
    border-radius: 6px;
    padding: 3px 3px;
    margin-right: 2px;
    -webkit-user-select: all;
    -moz-user-select: all;
    -ms-user-select: all;
    user-select: all;
  }
  `,block_formats:`${tinymce.util.I18n.translate("Paragraph")}=p; ${tinymce.util.I18n.translate("Heading 1")}=h1; ${tinymce.util.I18n.translate("Heading 2")}=h2; ${tinymce.util.I18n.translate("Heading 3")}=h3;  ${tinymce.util.I18n.translate("Heading 4")}=h4`}),I=V(()=>{let T=a.config?Object.assign({},_.value,a.config):_.value;return po()&&(T.skin="oxide-dark",T.content_css="dark"),T}),F=V(()=>ao(_t(u.value,T=>Rl(T,["id","name"])),T=>T.id==c.value.id));function $(T,E){let B=wt(T);B.length&&B.forEach(z=>{Object.keys(z).length>0&&E.ui.registry.addAutocompleter(z.id,{trigger:z.trigger,minChars:z.minChars||0,columns:1,fetch:function(M){return new Promise(j=>j(z.list))},onAction:function(M,j,U){E.selection.setRng(j||0),E.insertContent(`${U} `),M.hide()}})})}function C(T){T.concordCommands.insertMentionUser=function(E,B,z){T.selection.setRng(z||0),T.insertContent(`<span class="mention"
                      data-mention-id="${E}"
                      contenteditable="false"
                      data-notified="false"><span data-mention-char>@</span><span data-mention-value>${B}</span>
                      </span> `)},T.ui.registry.addAutocompleter("mentions",{trigger:"@",minChars:0,columns:1,fetch:function(E){return new Promise(B=>B(_t(F.value,z=>({value:z.id.toString(),text:z.name}))))},onAction:function(E,B,z){let M=Ee(F.value,["id",parseInt(z)]);T.concordCommands.insertMentionUser(z,M.name,B),E.hide()}})}function w(T,E){const B=T.blob();return new Promise((z,M)=>{if(!/^image\//.test(B.type)){M({message:i("validation.image",{attribute:B.name}),remove:!0});return}const j=new FormData;j.append("file",B),Innoclapps.request().post(`/media/pending/${f}`,j).then(({data:U})=>z(U.preview_url)).catch(U=>{let P=U.message&&U.message.includes("413")?i("core::app.file_too_large"):U.response.data.message;M({message:P,remove:!0})})})}function x(T){h.value=T}function A(){x("")}function N(){y.focus()}return De(()=>{g=setTimeout(()=>p.value=!0,250)}),bt(()=>{g&&clearTimeout(g)}),t({focus:N,clearContent:A,setContent:x}),(T,E)=>{const B=v("IOverlay");return d(),R(B,{show:!p.value},{default:b(()=>[p.value?(d(),R(l(Ka),{key:0,ref_key:"tinymceRef",ref:m,modelValue:h.value,"onUpdate:modelValue":E[0]||(E[0]=z=>h.value=z),disabled:e.disabled,init:I.value},null,8,["modelValue","disabled","init"])):O("",!0)]),_:1},8,["show"])}}},gm=Object.assign({inheritAttrs:!1},{__name:"Layout",props:{title:String,overlay:Boolean,full:Boolean,scrollable:{type:Boolean,default:!0}},setup(e){return(t,n)=>{const a=v("IOverlay");return d(),k(te,null,[(d(),R(gn,{to:"#navbar-actions"},[de(t.$slots,"actions")])),o("main",Re({id:"main",class:["relative flex-1 focus:outline-none",{"overflow-y-auto":e.scrollable}]},t.$attrs),[o("div",{class:X({"py-8 sm:py-6":!e.full})},[o("div",{class:X(["mx-auto",{"px-4 sm:px-6 lg:px-8":!e.full}])},[o("div",{class:X({"sm:py-4":!e.full})},[s(a,{show:e.overlay},{default:b(()=>[t.$slots.actions?(d(),k("div",{key:0,class:X(["mb-4 flex justify-end lg:hidden",{"px-4 pt-10 sm:px-6 lg:px-8":e.full}])},[de(t.$slots,"actions")],2)):O("",!0),de(t.$slots,"default")]),_:3},8,["show"])],2)],2)],2)],16)],64)}}}),ct=(e,t)=>{const n=e.__vccOpts||e;for(const[a,r]of t)n[a]=r;return n},ym={},xm={class:"mx-3 h-navbar border-l border-neutral-200 dark:border-neutral-600 lg:mx-6"};function Im(e,t){return d(),k("span",xm)}const km=ct(ym,[["render",Im]]),$m={class:"relative rounded-md shadow-sm"},wm={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},Cm=Object.assign({inheritAttrs:!1},{__name:"SearchInput",props:{modelValue:{},inputId:String,placeholder:String,disabled:Boolean},emits:["click","input","update:modelValue"],setup(e,{emit:t}){const n=Dt(function(a){a instanceof KeyboardEvent&&(a=a.target.value),t("update:modelValue",a),t("input",a)},650);return(a,r)=>{const i=v("Icon"),u=v("IFormInput");return d(),k("div",$m,[o("div",wm,[s(i,{icon:"SearchSolid",class:"h-5 w-5 text-neutral-400"})]),s(u,Re(a.$attrs,{id:e.inputId,class:"pl-10",type:"search",disabled:e.disabled,"model-value":e.modelValue,placeholder:e.placeholder||a.$t("core::app.search"),onClick:r[0]||(r[0]=c=>a.$emit("click",c)),onKeydown:r[1]||(r[1]=Tt(c=>l(n)(c),["enter"])),onInput:r[2]||(r[2]=c=>l(n)(c))}),null,16,["id","disabled","model-value","placeholder"])])}}});function Je(e){let t=null,n=dt({});xt(e)?ge(e,C=>{t=C,C&&(n.value=Innoclapps.resource(C))},{immediate:!0,flush:"post"}):(t=Cn(e),n.value=Innoclapps.resource(t)||{});const a=q(!1),r=q(!1),i=q(!1),u=q(!1),c=q(!1),m=q(!1),p=V(()=>n.value.singularName);function f(){return t}async function h(C){u.value=!0;try{let{data:w}=await Innoclapps.request().get(`/${f()}/${C}`);return w}finally{u.value=!1}}async function g(C,w,x={}){let A;C instanceof Fn?A=C:A=Ae(C).form,C instanceof xl&&C.hydrate(),i.value=!0;try{const N=await A.put(`/${t}/${w}`,x);return Innoclapps.$emit("resource-updated",{resourceName:t,resourceId:w,resource:N}),Innoclapps.$emit(`${t}-updated`,N),N}finally{i.value=!1}}async function y(C){let w;C instanceof Fn?w=C:w=Ae(C).form,C instanceof xl&&C.hydrate(),a.value=!0;try{const x=await w.post(`/${t}`);return Innoclapps.$emit("resource-updated",{resourceName:t,resourceId:x.id,resource:x}),Innoclapps.$emit(`${t}-updated`,x),x}finally{a.value=!1}}async function _(C){r.value=!0;try{const w=await Innoclapps.request().delete(`/${t}/${C}`);return Innoclapps.$emit("resource-deleted",{resourceName:t,resourceId:C}),Innoclapps.$emit(`${t}-deleted`,w),w}finally{r.value=!1}}async function I(C){c.value=!0;try{const{data:w}=await Innoclapps.request().post(`/${t}/${C}/clone`);return Innoclapps.$emit("resource-cloned",{resourceName:t,resourceId:C,clonedResource:w}),Innoclapps.$emit(`${t}-cloned`,w),w}finally{c.value=!1}}async function F(C,w){m.value=!0;try{let{data:x}=await Innoclapps.request().post(`associations/${t}/${C}`,w);return x}finally{m.value=!1}}async function $(C,w){m.value=!0;try{const{data:x}=await Innoclapps.request().delete(`associations/${t}/${C}`,{data:w});return x}finally{m.value=!1}}return{retrieveResource:h,resourceBeingRetrieved:u,createResource:y,resourceBeingCreated:a,cloneResource:I,resourceBeingCloned:c,updateResource:g,resourceBeingUpdated:i,deleteResource:_,resourceBeingDeleted:r,detachAssociations:$,syncAssociations:F,associationsBeingSaved:m,resourceName:e,rawResourceName:t,getRawResourceName:f,resourceSingularName:p}}function Sm(e){return Array.isArray(e)&&e.every(t=>typeof t!="object")}function jl(e,t){let n=JSON.parse(JSON.stringify(e));for(let a in t)if(Object.hasOwn(t,a))if(t[a]&&Object.hasOwn(t[a],"_reset"))n[a]=t[a]._reset;else if(Array.isArray(n[a]))if(Sm(t[a]))n[a]=t[a];else{const r=Array.isArray(t[a])?t[a]:[t[a]];n[a]=Rm(n[a],r)}else t[a]&&t[a]._delete?delete n[a]:typeof t[a]=="object"&&t[a]!==null&&n[a]?n[a]=jl(n[a],t[a]):n[a]=t[a];return n}function Rm(e,t){let n=[...e],a=[];t.forEach(r=>{if(r&&r._delete){a.push(r.id);return}const i=e.findIndex(u=>u.id===r.id);i!==-1?n[i]=jl(e[i],r):n.push(r)});for(let r of a){const i=n.findIndex(u=>u.id===r);i!==-1&&n.splice(i,1)}return n}function fo(e,t,n={}){const{resourceSingularName:a,associationsBeingSaved:r,resourceBeingRetrieved:i,retrieveResource:u,syncAssociations:c,detachAssociations:m,resourceBeingUpdated:p,updateResource:f}=Je(e),h=Qe();let g=[],y=null;const _=q({}),I=V(()=>p.value||r.value),F=V(()=>Object.keys(_.value).length>0);xt(t)?ge(t,(B,z)=>{y=Cn(B),Cn(z)&&Cn(B)&&(_.value={},n.watchId!==!1&&Fe($))},{immediate:!0,flush:"post"}):y=Cn(t);async function $(){let B={};return h[a.value]?(B=h[a.value],delete h[a.value]):B=await u(y),B._sync_timestamp=B.updated_at.split(".")[0],E(B,!0),_}async function C(B){const z=await f(B,y);return z._sync_timestamp=z.updated_at.split(".")[0],E(z,!0),_}function w(B){const z=Object.keys(_.value);if(z.length){let M=Or(z,g),j=Rl(_.value,M);for(const U in j)B[U]=j[U];return B}else return g=Object.keys(B),B}async function x(B){let z=await c(y,B);return z._sync_timestamp=new Date,E(z,!0),_}async function A(B){const z=await m(y,B);return z._sync_timestamp=new Date,E(z,!0),_}function N(B){wt(B).forEach(z=>{Number(_.value[z])>0&&(_.value[z]=_.value[z]-1)})}function T(B){wt(B).forEach(z=>{_.value[z]=_.value[z]+1})}function E(B,z=!1){Object.hasOwn(B,"_sync_timestamp")&&(B._sync_timestamp instanceof Date&&(B._sync_timestamp=B._sync_timestamp.toISOString()),B._sync_timestamp.indexOf(".")>-1&&(B._sync_timestamp=B._sync_timestamp.split(".")[0])),z?_.value=w(B):_.value=jl(Cn(_),Cn(B))}return{resource:_,resourceBeingFetched:i,resourceBeingUpdated:I,resourceReady:F,associationsBeingSaved:r,resourceSingularName:a,fetchResource:$,updateResource:C,performUpdate:f,synchronizeResource:E,incrementResourceCount:T,decrementResourceCount:N,syncResourceAssociations:x,detachResourceAssociations:A}}function gt(e=[]){const t=Pe(),n=q(new en(e));function a(c,m={}){return t.dispatch("fields/getForResource",{resourceName:l(c),view:Innoclapps.config("fields.views.create"),...m})}function r(c,m,p={}){return t.dispatch("fields/getForResource",{resourceName:l(c),resourceId:m,view:Innoclapps.config("fields.views.detail"),...p})}function i(c,m,p={}){return t.dispatch("fields/getForResource",{resourceName:l(c),resourceId:m,view:Innoclapps.config("fields.views.update"),...p})}function u(c,m={}){return t.dispatch("fields/getForResource",{resourceName:l(c),view:Innoclapps.config("fields.views.index"),...m})}return{fields:n,getCreateFields:a,getUpdateFields:i,getDetailFields:r,getIndexFields:u}}const Fm={class:"flex justify-end space-x-2"},Vm={__name:"TheFloatingResourceModal",setup(e){const{t}=ve(),n=Qe(),a=Ye(),r=q(null),i=q(null),u=V(()=>a.query.mode),{fields:c,getUpdateFields:m}=gt(),{form:p}=It(c),f=q(!1),h=q(null),g=q(!1),y=Kn(()=>null,()=>document.querySelector("#modalClose-floatingResourceModal")),_=V(()=>String(String(a.query.floating_resource)+String(a.query.floating_resource_id))),{resource:I,resourceSingularName:F,updateResource:$,fetchResource:C,synchronizeResource:w,detachResourceAssociations:x,incrementResourceCount:A,decrementResourceCount:N}=fo(i,r,{watchId:!1});function T(){Innoclapps.$emit("floating-resource-updated",{resourceName:i.value,resourceId:r.value,resource:I.value})}async function E(){await $(p),T(),Innoclapps.success(t("core::resource.updated"))}async function B(){p.clear(),c.value.set([]),I.value={},f.value=!0,await C(),c.value.set(await m(i.value,r.value)).populate(I.value),g.value=!0}function z(){n[F.value]=I.value,n.push(I.value.path)}function M(U){h.value=U}function j(){g.value=!1,n.replace({query:Rn(a.query,["floating_resource","floating_resource_id","mode"])})}return ge(_,()=>{r.value=a.query.floating_resource_id,i.value=a.query.floating_resource,i.value&&r.value?(g.value=!1,Fe(B)):f.value=!1},{immediate:!0}),mt("setModalSubTitle",M),mt("synchronizeResource",w),mt("detachResourceAssociations",x),mt("incrementResourceCount",A),mt("decrementResourceCount",N),mt("emitUpdatedGlobalEvent",T),mt("synchronizeAndEmitUpdatedEvent",(U,P=!1)=>{w(U,P),T()}),(U,P)=>{const H=v("FieldsPlaceholder"),L=v("IButton"),Z=v("ISlideover");return d(),R(Z,{id:"floatingResourceModal",visible:f.value,"onUpdate:visible":P[0]||(P[0]=J=>f.value=J),title:l(I).display_name,"sub-title":h.value,"initial-focus":l(y),"static-backdrop":"",form:"",onHidden:j,onSubmit:E},{"modal-footer":b(()=>[o("div",Fm,[s(L,{variant:"white",disabled:!g.value,text:U.$t("core::app.view_record"),onClick:z},null,8,["disabled","text"]),u.value==="edit"?(d(),R(L,{key:0,type:"submit",variant:"primary",loading:l(p).busy,text:U.$t("core::app.save"),disabled:!g.value||l(p).busy||l(I).authorizations&&!l(I).authorizations.update},null,8,["loading","text","disabled"])):O("",!0)])]),default:b(()=>[g.value?O("",!0):(d(),R(H,{key:0})),g.value?(d(),R(We(`${l(F)}FloatingModal`),{key:1,resource:l(I),form:l(p),fields:l(c),mode:u.value},null,8,["resource","form","fields","mode"])):O("",!0)]),_:1},8,["visible","title","sub-title","initial-focus"])}}},Tm={},Dm={class:"notifications pointer-events-none fixed inset-0 flex items-start justify-end p-6 px-4 py-6"},qm={class:"w-full max-w-sm"},Em={class:"p-4"},Am={class:"flex items-center"},Bm={class:"shrink-0"},Nm={class:"ml-3 flex w-0 flex-1 justify-between"},Om=["textContent"],zm=["onClick","textContent"],Mm={class:"ml-4 flex shrink-0"},Um=["onClick"];function Pm(e,t){const n=v("icon"),a=v("Notification"),r=v("NotificationGroup");return d(),R(r,{group:"app"},{default:b(()=>[o("div",Dm,[o("div",qm,[s(a,{enter:"ease-out duration-300 transition","enter-from":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2","enter-to":"translate-y-0 opacity-100 sm:translate-x-0",leave:"transition ease-in duration-100","leave-from":"opacity-100","leave-to":"opacity-0",move:"transition duration-500","move-delay":"delay-300"},{default:b(({notifications:i,close:u})=>[(d(!0),k(te,null,re(i,(c,m)=>(d(),k("div",{key:m,class:X(["notification pointer-events-auto relative mb-2 w-full max-w-sm overflow-hidden rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5 dark:bg-neutral-800",{"border-2 border-danger-300":c.type==="error"}])},[o("div",Em,[o("div",Am,[o("div",Bm,[c.type==="success"?(d(),R(n,{key:0,icon:"CheckCircle",class:"h-5 w-5 text-success-400"})):O("",!0),c.type==="info"?(d(),R(n,{key:1,icon:"InformationCircle",class:"h-5 w-5 text-info-400"})):O("",!0),c.type==="error"?(d(),R(n,{key:2,icon:"XCircle",class:"h-5 w-5 text-danger-400"})):O("",!0)]),o("div",Nm,[o("p",{class:"w-0 flex-1 text-sm font-medium text-neutral-800 dark:text-white",textContent:S(c.text)},null,8,Om),c.action?(d(),k("button",{key:0,type:"button",class:"ml-3 shrink-0 rounded-md bg-white text-sm font-medium text-primary-600 hover:text-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",onClick:c.action.onClick,textContent:S(c.action.text)},null,8,zm)):O("",!0)]),o("div",Mm,[o("button",{type:"button",class:"inline-flex rounded-md bg-white text-neutral-400 hover:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:bg-neutral-900",onClick:p=>u(c.id)},[s(n,{icon:"X",class:"h-5 w-5"})],8,Um)])])])],2))),128))]),_:1})])])]),_:1})}const jm=ct(Tm,[["render",Pm]]),Il=xe((document==null?void 0:document.title)??null);ge(Il,e=>{e&&(document.title=e)});function Ut(e=null){const t=xe(e);return ge(t,n=>{n&&(Il.value=n)},{immediate:!0}),Il}const Lm={key:0,class:"relative"},Hm={class:"absolute -right-2 -top-5"},Gm=o("span",{class:"relative flex h-3 w-3"},[o("span",{class:"absolute inline-flex h-full w-full animate-ping rounded-full bg-primary-400 opacity-75"}),o("span",{class:"relative inline-flex h-3 w-3 rounded-full bg-primary-500"})],-1),Km=[Gm],Ym={class:"max-h-96 divide-y divide-neutral-200 overflow-y-auto dark:divide-neutral-700"},Wm=["textContent"],Qm=["textContent"],Xm={class:"flex items-center justify-end border-t border-neutral-200 bg-neutral-50 px-4 py-2 text-sm dark:border-neutral-600 dark:bg-neutral-700"},Zm={__name:"TheNavbarNotifications",setup(e){const{currentUser:t}=Le(),{localizedDateTime:n}=Ne(),a=Pe(),r=V(()=>a.getters["users/totalNotifications"]),i=V(()=>a.getters["users/hasUnreadNotifications"]),u=a.getters["users/localizeNotification"],c=V(()=>t.value.notifications.latest),m=V(()=>t.value.notifications.unread_count);function p(){a.dispatch("users/markAllNotificationsAsRead")}return(f,h)=>{const g=v("Icon"),y=v("IButton"),_=v("router-link"),I=v("IDropdownItem"),F=v("IDropdown"),$=ae("i-tooltip"),C=ae("t");return d(),R(F,{ref:"dropdownRef",placement:"bottom-end","items-class":"max-w-xs sm:max-w-sm",full:!1},{toggle:b(({toggle:w})=>[s(y,{variant:"white",rounded:!1,size:!1,class:"relative rounded-full p-1",onClick:x=>(w(),p())},{default:b(()=>[s(g,{icon:"Bell",class:"h-6 w-6"}),i.value?(d(),k("div",Lm,[D((d(),k("div",Hm,Km)),[[$,m.value,void 0,{bottom:!0}]])])):O("",!0)]),_:2},1032,["onClick"])]),default:b(()=>[o("div",{class:X(["flex items-center px-4 py-3 sm:p-4",{"border-b border-neutral-200 dark:border-neutral-700":r.value>0}])},[D(o("div",{class:X(["grow text-neutral-800 dark:text-white",{"font-medium":r.value>0,"sm:text-sm":r.value===0}])},null,2),[[C,r.value>0?"core::notifications.notifications":"core::notifications.no_notifications"]]),D((d(),R(_,{to:{name:"profile",hash:"#notifications"},class:"link ml-2",onClick:h[0]||(h[0]=()=>f.$refs.dropdownRef.hide())},{default:b(()=>[s(g,{icon:"Cog",class:"h-5 w-5"})]),_:1})),[[$,f.$t("core::settings.settings")]])],2),o("div",Ym,[(d(!0),k(te,null,re(c.value,w=>(d(),R(I,{key:w.id,title:l(u)(w),to:w.data.path},{default:b(()=>[o("p",{class:"truncate text-neutral-800 dark:text-neutral-100",textContent:S(l(u)(w))},null,8,Wm),o("span",{class:"text-xs text-neutral-500 dark:text-neutral-300",textContent:S(l(n)(w.created_at))},null,8,Qm)]),_:2},1032,["title","to"]))),128))]),D(o("div",Xm,[D(s(_,{to:{name:"notifications"},class:"link",onClick:h[1]||(h[1]=()=>f.$refs.dropdownRef.hide())},null,512),[[C,"core::app.see_all"]])],512),[[Y,r.value>0]])]),_:1},512)}}},Ll={__name:"IButton",props:{text:String,icon:String,iconClass:[String,Array,Object],to:[Object,String],tag:{default:"button",type:[String,Object]},type:{type:String,default:"button"},disabled:Boolean,loading:Boolean,rounded:{default:!0,type:Boolean},block:Boolean,variant:{type:String,default:"primary",validator(e){return["primary","secondary","danger","white","success"].includes(e)}},size:{type:[String,Boolean],default:"md",validator(e){return e===!1?!0:["sm","md","lg"].includes(e)}}},emits:["click"],setup(e,{emit:t}){const n=e,a=Qe(),r=Fl(),i=V(()=>["btn",{"btn-primary":n.variant==="primary","btn-secondary":n.variant==="secondary","btn-danger":n.variant==="danger","btn-white":n.variant==="white","btn-success":n.variant==="success","btn-sm":n.size==="sm","btn-md":n.size==="md","btn-lg":n.size==="lg",rounded:n.rounded&&n.size==="sm","rounded-md":n.rounded&&(n.size==="md"||n.size==="lg"),"w-full justify-center":n.block,"only-icon":n.icon&&!r.default&&!n.text}]);function u(c){n.to?a.push(n.to):t("click",c)}return(c,m)=>{const p=v("Icon"),f=v("ISpinner");return d(),R(We(e.tag),{type:e.type,class:X(i.value),disabled:e.disabled,tabindex:e.disabled?"-1":void 0,onClick:u},{default:b(()=>[e.icon?D((d(),R(p,{key:0,icon:e.icon,class:X(["pointer-events-none shrink-0",e.iconClass?e.iconClass:{"h-4 w-4":e.size==="sm","h-5 w-5":e.size!=="sm"},{"-ml-1 mr-2":c.$slots.default||e.text}])},null,8,["icon","class"])),[[Y,!e.loading]]):O("",!0),e.loading?(d(),R(f,{key:1,class:X([{"h-4 w-4":e.size==="sm","h-5 w-5":e.size!=="sm"},{"mr-2":c.$slots.default||e.text},"text-current"])},null,8,["class"])):O("",!0),de(c.$slots,"default",{},()=>[Q(S(e.text),1)])]),_:3},8,["type","class","disabled","tabindex"])}}},Jm={class:"w-56"},ep={class:"flex items-center justify-between border-b border-neutral-200 px-4 py-3 text-sm dark:border-neutral-700"},tp={class:"font-medium text-neutral-600 dark:text-neutral-100"},np=o("span",{class:"rounded-md bg-neutral-700 px-1.5 text-base text-neutral-100 dark:bg-neutral-600 dark:text-neutral-200"},[o("span",{class:"-mt-0.5 block"},"+")],-1),op={class:"space-y-0.5"},lp={class:"inline-flex w-full items-center justify-between"},ap=["textContent"],sp={__name:"TheNavbarQuickCreate",setup(e){const t=Pe(),n=Qe(),a=q(!1),r=V(()=>t.state.menu),i=q(null),u=V(()=>r.value.filter(p=>p.inQuickCreate)),c=V(()=>u.value.filter(p=>p.keyboardShortcutChar!==null));m();function m(){c.value.forEach(p=>{Innoclapps.addShortcut("+ "+p.keyboardShortcutChar.toLowerCase(),()=>{a.value&&i.value.hide(),n.push(p.quickCreateRoute)})})}return(p,f)=>{const h=v("IDropdownItem"),g=v("IDropdown"),y=ae("t");return d(),R(g,{ref_key:"dropdownRef",ref:i,placement:"bottom-end",full:!1,offset:15,onShow:f[0]||(f[0]=_=>a.value=!0),onHide:f[1]||(f[1]=_=>a.value=!1)},{toggle:b(({toggle:_})=>[s(Ll,{variant:"secondary",rounded:!1,size:!1,icon:"Plus","icon-class":"w-6 h-6",class:"rounded-full p-1",onClick:_},null,8,["onClick"])]),default:b(()=>[o("div",Jm,[o("div",ep,[D(o("p",tp,null,512),[[y,"core::app.quick_create"]]),np]),o("div",op,[(d(!0),k(te,null,re(u.value,(_,I)=>D((d(),R(h,{key:I,icon:_.icon,to:_.quickCreateRoute},{default:b(()=>[o("span",lp,[o("span",null,S(_.quickCreateName),1),o("span",{class:"rounded-md bg-neutral-100 px-1.5 uppercase text-neutral-500 dark:bg-neutral-700 dark:text-neutral-300",textContent:S(_.keyboardShortcutChar)},null,8,ap)])]),_:2},1032,["icon","to"])),[[Y,p.$route.path!==_.quickCreateRoute]])),128))])])]),_:1},512)}}};const rp={class:"relative z-20 flex h-navbar shrink-0 bg-white shadow dark:bg-neutral-700"},ip=o("span",{class:"sr-only"},"Open sidebar",-1),up={class:"flex flex-1 justify-between pr-4 sm:pr-6 lg:pr-8"},dp={class:"flex flex-1"},cp={class:"mx-8 hidden max-w-xs py-5 lg:block"},mp=["textContent"],pp={class:"hidden h-navbar border-l border-neutral-200 dark:border-neutral-600 lg:block"},fp={class:"flex w-full sm:relative"},vp={class:"relative flex w-full"},bp=o("label",{for:"navSearchInput",class:"sr-only"},"Search",-1),hp={class:"relative w-full text-neutral-400 focus-within:text-neutral-600 dark:focus-within:text-neutral-200"},_p={class:"pointer-events-none absolute inset-y-0 left-6 flex items-center"},gp={class:"overflow-hidden rounded-b-lg shadow-lg ring-1 ring-neutral-600 ring-opacity-5 dark:ring-neutral-700"},yp={class:"bg-white dark:bg-neutral-800"},xp={key:0,class:"max-h-screen overflow-y-auto px-5 py-3 lg:max-h-[40rem]"},Ip=["textContent"],kp={class:"block truncate font-medium"},$p={key:0,class:"text-neutral-500 group-hover:text-primary-200 dark:text-neutral-300"},wp={key:1,class:"p-3 text-center text-sm text-neutral-700 dark:text-neutral-200"},Cp={class:"ml-3 flex items-center lg:ml-6"},Sp=o("svg",{class:"h-5 w-5 text-neutral-400",viewBox:"0 0 24 24"},[o("path",{fill:"currentColor",d:"M12 2A10 10 0 0 0 2 12A10 10 0 0 0 12 22A10 10 0 0 0 22 12A10 10 0 0 0 12 2M12 4A8 8 0 0 1 20 12A8 8 0 0 1 12 20V4Z"})],-1),Rp={class:"mr-1 lg:mr-3"},Fp=o("div",{id:"navbar-actions",class:"hidden items-center lg:flex"},null,-1),Vp={class:"ml-1 md:hidden lg:ml-3"},Tp=["onClick"],Dp={class:"py-1"},qp={class:"py-1"},_a="K",Ep={__name:"TheNavbar",setup(e){const t=Ye(),n=Pe(),{localizedDateTime:a}=Ne(),{currentUser:r}=Le(),i=q(null);jo(i,()=>x());function u(N){n.commit("SET_SIDEBAR_OPEN",N)}const c=q(null),m=dt([]),p=V(()=>m.value.length>0),f=q(!1),h=q(!1),g=Ut(),_=/mac/.test(window.userAgent)?"":"Ctrl",I=!/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(window.navigator.userAgent),F=q(null);function $(){localStorage.theme="light",window.updateTheme()}function C(){localStorage.theme="dark",window.updateTheme()}function w(){localStorage.theme="system",window.updateTheme()}function x(){m.value=[],f.value=!1}const A=Dt(function(N){if(!N){m.value=[],f.value=!1;return}h.value=!0,Innoclapps.request().get("/search",{params:{q:N}}).then(({data:T})=>{m.value=T,f.value=!0}).finally(()=>h.value=!1)},650);return De(()=>{window.addEventListener("keydown",N=>{N.key==="esc"&&f.value&&x()}),I&&document.addEventListener("keydown",N=>{(N.ctrlKey||N.metaKey)&&N.key===_a.toLowerCase()&&(N.preventDefault(),document.activeElement===F.value?(F.value.blur(),x()):F.value.focus())})}),ge(()=>t.path,(N,T)=>{T!=="/"&&c.value&&(c.value=null)}),(N,T)=>{const E=v("Icon"),B=v("router-link"),z=v("IButtonIcon"),M=v("NavbarSeparator"),j=v("IAvatar"),U=v("IDropdownItem"),P=v("IDropdown"),H=ae("t"),L=ae("i-tooltip");return d(),k("div",rp,[T[0]||(he(-1),T[0]=o("button",{type:"button",class:"border-r border-neutral-200 px-3 text-neutral-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 dark:border-neutral-600 dark:text-neutral-200 md:hidden",onClick:Z=>u(!0)},[ip,s(E,{icon:"Bars3BottomLeft",class:"h-6 w-6"})],8,["onClick"]),he(1),T[0]),o("div",up,[o("div",dp,[D(o("div",cp,[o("h1",{class:"truncate font-semibold uppercase text-neutral-800 dark:text-neutral-100",textContent:S(l(g))},null,8,mp)],512),[[Y,l(g)]]),D(o("span",pp,null,512),[[Y,l(g)]]),o("div",fp,[o("div",vp,[bp,o("div",hp,[o("div",_p,[s(E,{icon:"SearchSolid",class:X(["h-5 w-5",h.value?"animate-pulse":""])},null,8,["class"])]),St([c.value],()=>D((d(),k("input",{id:"navSearchInput",ref_key:"searchInputRef",ref:F,"onUpdate:modelValue":T[1]||(T[1]=Z=>c.value=Z),autocomplete:"off",class:"peer block h-full w-full appearance-none border-transparent py-2 pl-14 pr-3 text-neutral-900 placeholder-neutral-500 focus:border-transparent focus:placeholder-neutral-400 focus:outline-none focus:ring-0 dark:bg-neutral-700 dark:text-neutral-200 dark:placeholder-neutral-400 dark:focus:placeholder-neutral-500 sm:text-sm",placeholder:N.$t("core::app.search"),type:"search",name:"search",onKeydown:T[2]||(T[2]=Tt(Z=>l(A)(c.value),["enter"])),onInput:T[3]||(T[3]=Z=>l(A)(Z.target.value))},null,40,["placeholder"])),[[Zt,c.value]]),T,4),I?St([I,!!c.value],()=>(d(),k("div",{key:0,class:"absolute left-56 top-[1.1rem] hidden peer-focus:hidden lg:block"},[D(o("kbd",{class:"inline-flex items-center rounded border border-neutral-300 px-2 font-sans text-sm font-bold text-neutral-500 dark:border-neutral-300 dark:text-neutral-300"},S(l(_))+""+S(_a),513),[[Y,!c.value]])])),T,5):O("",!0)])]),(d(),R(gn,{to:"body"},[s(Vl,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:b(()=>[D(o("div",{ref_key:"searchResultsRef",ref:i,class:"absolute left-0 top-[--navbar-height] z-30 w-screen max-w-sm transform md:left-[225px] lg:left-[340px] lg:max-w-lg"},[o("div",gp,[o("div",yp,[p.value?(d(),k("div",xp,[(d(!0),k(te,null,re(m.value,Z=>(d(),k("span",{key:Z.title},[o("p",{class:"mb-1.5 mt-3 text-sm font-medium text-neutral-900 dark:text-white",textContent:S(Z.title)},null,8,Ip),(d(!0),k(te,null,re(Z.data,J=>(d(),R(B,{key:J.path,to:J.path,class:"group relative mb-2 block whitespace-normal rounded-lg border border-neutral-100 bg-neutral-50 py-3 pl-5 pr-12 text-sm text-neutral-800 hover:border-primary-700 hover:bg-primary-600 hover:text-white dark:border-neutral-600 dark:bg-neutral-700 dark:text-white dark:hover:border-primary-600 dark:hover:bg-primary-600",onClick:T[6]||(T[6]=K=>f.value=!1)},{default:b(()=>[o("span",kp,S(J.display_name),1),J.created_at?(d(),k("span",$p,S(N.$t("core::app.created_at"))+" "+S(l(a)(J.created_at)),1)):O("",!0),s(E,{icon:"ChevronRight",class:"absolute right-4 top-7 h-4 w-4 text-current"})]),_:2},1032,["to"]))),128))]))),128))])):O("",!0),p.value?O("",!0):D((d(),k("div",wp,null,512)),[[H,"core::app.no_search_results"]])])])],512),[[Y,f.value]])]),_:1})]))])]),o("div",Cp,[T[7]||(he(-1),T[7]=D(s(z,{id:"header__moon",class:"md:block",icon:"Moon",onClick:$},null,512),[[L,N.$t("core::app.theme.switch_light"),void 0,{bottom:!0}]]),he(1),T[7]),T[8]||(he(-1),T[8]=D(s(z,{id:"header__sun",icon:"Sun",onClick:w},null,512),[[L,N.$t("core::app.theme.switch_system"),void 0,{bottom:!0}]]),he(1),T[8]),T[9]||(he(-1),T[9]=D((d(),R(z,{id:"header__indeterminate",icon:"Sun",onClick:C},{default:b(()=>[Sp]),_:1})),[[L,N.$t("core::app.theme.switch_dark"),void 0,{bottom:!0}]]),he(1),T[9]),T[10]||(he(-1),T[10]=s(M),he(1),T[10]),o("div",Rp,[s(Zm)]),T[11]||(he(-1),T[11]=o("div",{class:"hidden md:block"},[s(sp)]),he(1),T[11]),Fp,o("div",Vp,[s(P,{placement:"bottom-end",full:!1},{toggle:b(({toggle:Z})=>[o("button",{type:"button",class:"flex max-w-xs items-center rounded-full bg-white text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",onClick:Z},[s(j,{src:l(r).avatar_url,title:l(r).name},null,8,["src","title"])],8,Tp)]),default:b(()=>[T[12]||(he(-1),T[12]=o("div",{class:"divide-y divide-neutral-200 dark:divide-neutral-700"},[o("div",Dp,[s(U,{to:{name:"profile"},text:N.$t("users::profile.profile")},null,8,["text"]),s(U,{to:{name:"calendar-sync"},text:N.$t("activities::calendar.calendar_sync")},null,8,["text"]),s(U,{to:{name:"oauth-accounts"},text:N.$t("core::oauth.connected_accounts")},null,8,["text"]),N.$gate.userCan("access-api")?(d(),R(U,{key:0,to:{name:"personal-access-tokens"},text:N.$t("core::api.personal_access_tokens")},null,8,["text"])):O("",!0)]),o("div",qp,[s(U,{href:"#",text:N.$t("auth.logout"),onClick:Z=>N.$store.dispatch("logout")},null,8,["text","onClick"])])]),he(1),T[12])]),_:1})])])])])}}},Ap={class:"group mt-8 px-2"},Bp={class:"mt-1 space-y-1",role:"group","aria-labelledby":"highlights-headline"},Np=["textContent"],ga={__name:"TheSidebarHighlights",setup(e){const t=dt(Innoclapps.config("highlights"));let n=null;function a(){Innoclapps.request().get("/highlights").then(({data:i})=>{t.value=i})}function r(i){if(i.backgroundColorVariant==="warning")return"bg-warning-500";if(i.backgroundColorVariant==="danger")return"bg-danger-500";if(i.backgroundColorVariant==="info")return"bg-info-500";if(i.backgroundColorVariant==="primary")return"bg-primary-500";if(i.backgroundColorVariant==="neutral")return"bg-neutral-500"}return De(()=>{n=setInterval(a,1e3*60*10)}),bt(()=>{clearInterval(n)}),(i,u)=>{const c=v("Icon"),m=v("router-link"),p=ae("i-tooltip");return d(),k("div",Ap,[u[0]||(he(-1),u[0]=D((d(),k("h3",{id:"highlights-headline",class:"hidden px-3 text-xs font-medium uppercase tracking-wider text-neutral-50 group-hover:inline-flex group-hover:items-center"},[s(c,{icon:"QuestionMarkCircle",class:"mr-2 h-5 w-5 text-current"}),Q(" "+S(i.$t("core::app.highlights.highlights")),1)])),[[p,i.$t("core::app.highlights.refresh_interval",{interval:10}),void 0,{right:!0}]]),he(1),u[0]),o("div",Bp,[(d(!0),k(te,null,re(t.value,(f,h,g,y)=>{const _=[f.count];if(y&&y.key===f.name&&Tl(y,_))return y;const I=(d(),R(m,{key:f.name,class:"group flex items-center rounded-md px-3 py-2 text-sm font-medium text-neutral-50 hover:bg-neutral-600",to:f.route},{default:b(()=>[o("span",{class:X([f.count>0?r(f):"bg-success-500","mr-4 h-2.5 w-2.5 rounded-full"]),"aria-hidden":"true"},null,2),o("span",{class:"mr-1 truncate",textContent:S(f.name)},null,8,Np),Q(" ("+S(f.count)+") ",1)]),_:2},1032,["to"]));return I.memo=_,I},u,1),128))])])}}},Op={class:"relative flex w-56 max-w-xs flex-col bg-neutral-800 pb-4 pt-5 dark:bg-neutral-900"},zp={class:"absolute right-0 top-0 -mr-12 pt-2"},Mp=o("span",{class:"sr-only"},"Close sidebar",-1),Up={class:"flex shrink-0 items-center px-4"},Pp={key:0,class:"font-bold text-white"},jp=["src"],Lp={class:"mt-5 h-0 flex-1 overflow-y-auto"},Hp={class:"space-y-1 px-2"},Gp=["href","aria-current","onClick"],Kp=o("div",{class:"w-14 shrink-0","aria-hidden":"true"},null,-1),Yp={class:"hidden bg-neutral-800 dark:bg-neutral-900 md:flex md:shrink-0"},Wp={class:"flex w-56 flex-col"},Qp={class:"flex grow flex-col overflow-y-auto pb-4 pt-5"},Xp={class:"flex shrink-0 items-center px-4"},Zp={key:0,class:"font-bold text-white"},Jp=["src"],ef={class:"relative mt-4 inline-block px-3 text-left"},tf=["onClick"],nf={class:"flex w-full items-center justify-between"},of={class:"flex min-w-0 items-center justify-between space-x-3"},lf={class:"flex min-w-0 flex-1 flex-col"},af={class:"truncate text-sm font-medium text-neutral-800 dark:text-white"},sf={class:"truncate text-sm text-neutral-600 dark:text-neutral-300"},rf={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},uf={key:0,class:"px-4 py-3"},df={class:"inline-flex items-center text-sm text-neutral-800 dark:text-neutral-100"},cf=["textContent"],mf=["textContent"],pf={class:"py-1"},ff={class:"py-1"},vf={class:"mt-6 flex h-0 flex-1 flex-col overflow-y-auto"},bf={class:"flex-1 space-y-1 px-2"},hf=["href","aria-current","onClick"],_f={__name:"TheSidebar",setup(e){const{currentUser:t,setting:n}=Le(),a=Pe(),r=V(()=>a.state.menu),i=V(()=>a.state.sidebarOpen),u=V(()=>n("company_name")),c=Innoclapps.config("options.logo_light");function m(p){a.commit("SET_SIDEBAR_OPEN",p)}return(p,f)=>{const h=v("Icon"),g=v("router-link"),y=v("IBadge"),_=v("IAvatar"),I=v("IDropdownItem"),F=v("IDropdown");return d(),k(te,null,[s(l(co),{as:"template",show:i.value},{default:b(()=>[s(l(uo),{as:"div",static:"",class:"fixed inset-0 z-50 flex md:hidden",open:i.value,onClose:f[1]||(f[1]=$=>m(!1))},{default:b(()=>[s(l(Jt),{as:"template",enter:"transition-opacity ease-linear duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"transition-opacity ease-linear duration-300","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>[s(l(Lo),{class:"fixed inset-0 bg-neutral-600 bg-opacity-75"})]),_:1}),s(l(Jt),{as:"template",enter:"transition ease-in-out duration-300 transform","enter-from":"-translate-x-full","enter-to":"translate-x-0",leave:"transition ease-in-out duration-300 transform","leave-from":"translate-x-0","leave-to":"-translate-x-full"},{default:b(()=>[o("div",Op,[s(l(Jt),{as:"template",enter:"ease-in-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-300","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>[o("div",zp,[o("button",{type:"button",class:"ml-1 flex h-10 w-10 items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:f[0]||(f[0]=$=>m(!1))},[Mp,s(h,{icon:"X",class:"h-6 w-6 text-white"})])])]),_:1}),o("div",Up,[s(g,{class:"whitespace-normal",to:{name:"dashboard"}},{default:b(()=>[l(c)?(d(),k("img",{key:1,src:l(c),class:"h-10 max-h-14 w-auto"},null,8,jp)):(d(),k("span",Pp,S(u.value),1))]),_:1})]),o("div",Lp,[o("nav",Hp,[(d(!0),k(te,null,re(r.value,$=>(d(),R(g,{key:$.id,to:$.route,custom:""},{default:b(({href:C,navigate:w,isActive:x})=>[o("a",{href:C,class:X([x?"bg-neutral-700 text-white":"text-neutral-50 hover:bg-neutral-600","group relative flex items-center rounded-md px-2 py-2 focus:outline-none"]),"aria-current":x?"page":void 0,onClick:w},[$.icon?(d(),R(h,{key:0,icon:$.icon,class:"mr-4 h-6 w-6 shrink-0 text-neutral-300"},null,8,["icon"])):O("",!0),Q(" "+S($.name)+" ",1),$.badge?(d(),R(y,{key:1,variant:$.badgeVariant,size:"circle","wrapper-class":"absolute -left-px -top-px",text:$.badge},null,8,["variant","text"])):O("",!0),$.inQuickCreate?D((d(),R(g,{key:2,to:$.quickCreateRoute,class:X(["ml-auto rounded-md",x?"hover:bg-neutral-800":"hover:bg-neutral-700"])},{default:b(()=>[s(h,{icon:"Plus",class:"h-5 w-5"})]),_:2},1032,["to","class"])),[[Y,p.$route.path!==$.quickCreateRoute]]):O("",!0)],10,Gp)]),_:2},1032,["to"]))),128))])]),s(ga)])]),_:1}),Kp]),_:1},8,["open"])]),_:1},8,["show"]),D(o("div",Yp,[o("div",Wp,[o("div",Qp,[o("div",Xp,[s(g,{class:"whitespace-normal",to:{name:"dashboard"}},{default:b(()=>[l(c)?(d(),k("img",{key:1,src:l(c),class:"h-10 max-h-14 w-auto"},null,8,Jp)):(d(),k("span",Zp,S(u.value),1))]),_:1})]),o("div",ef,[s(F,{full:!1,"items-class":"max-w-[200px]"},{toggle:b(({toggle:$})=>[o("button",{type:"button",class:"group mt-3 w-full rounded-md bg-neutral-200 px-3.5 py-2 text-left text-sm font-medium text-neutral-700 hover:bg-neutral-300 focus:outline-none focus:ring-2 focus:ring-neutral-500 focus:ring-offset-2 focus:ring-offset-neutral-100 dark:border dark:border-neutral-600 dark:bg-neutral-700 dark:hover:bg-neutral-600 dark:focus:ring-offset-neutral-300",onClick:$},[o("span",nf,[o("span",of,[s(_,{src:l(t).avatar_url,title:l(t).name},null,8,["src","title"]),o("span",lf,[o("span",af,S(l(t).name),1),o("span",sf,S(l(t).email),1)])]),s(h,{icon:"Selector",class:"h-5 w-5 shrink-0 text-neutral-500 group-hover:text-neutral-600 dark:text-neutral-400 dark:group-hover:text-neutral-300"})])],8,tf)]),default:b(()=>[o("div",rf,[l(t).teams.length>0?(d(),k("div",uf,[o("p",df,[s(h,{icon:"UserGroup",class:"mr-1 h-5 w-5 text-neutral-600 dark:text-neutral-400"}),o("span",{textContent:S(p.$t("users::team.your_teams",l(t).teams.length))},null,8,cf)]),(d(!0),k(te,null,re(l(t).teams,$=>(d(),k("p",{key:$.id,class:"flex text-sm font-medium text-neutral-900 dark:text-neutral-300"},[o("span",{class:X(["truncate",$.user_id===l(t).id?"text-primary-600 dark:text-primary-400":""]),textContent:S($.name)},null,10,mf)]))),128))])):O("",!0),o("div",pf,[s(I,{to:{name:"profile"},text:p.$t("users::profile.profile")},null,8,["text"]),s(I,{to:{name:"calendar-sync"},text:p.$t("activities::calendar.calendar_sync")},null,8,["text"]),s(I,{to:{name:"oauth-accounts"},text:p.$t("core::oauth.connected_accounts")},null,8,["text"]),p.$gate.userCan("access-api")?(d(),R(I,{key:0,to:{name:"personal-access-tokens"},text:p.$t("core::api.personal_access_tokens")},null,8,["text"])):O("",!0)]),o("div",ff,[s(I,{href:"#",text:p.$t("auth.logout"),onClick:f[2]||(f[2]=$=>p.$store.dispatch("logout"))},null,8,["text"])])])]),_:1})]),o("div",vf,[o("nav",bf,[(d(!0),k(te,null,re(r.value,$=>(d(),R(g,{key:$.id,to:$.route,custom:""},{default:b(({href:C,navigate:w,isActive:x})=>[o("a",{href:C,class:X([x?"bg-neutral-700 text-white":"text-neutral-50 hover:bg-neutral-600","group relative flex items-center rounded-md px-2 py-2 text-sm focus:outline-none"]),"aria-current":x?"page":void 0,onClick:w},[$.icon?(d(),R(h,{key:0,icon:$.icon,class:"mr-3 h-6 w-6 shrink-0 text-neutral-300"},null,8,["icon"])):O("",!0),Q(" "+S($.name)+" ",1),$.badge?(d(),R(y,{key:1,variant:$.badgeVariant,size:"circle","wrapper-class":"absolute -left-px -top-px",text:$.badge},null,8,["variant","text"])):O("",!0),$.inQuickCreate?D((d(),R(g,{key:2,to:$.quickCreateRoute,class:X(["ml-auto hidden rounded-md group-hover:block",x?"hover:bg-neutral-800":"hover:bg-neutral-700"])},{default:b(()=>[s(h,{icon:"Plus",class:"h-5 w-5"})]),_:2},1032,["to","class"])),[[Y,p.$route.path!==$.quickCreateRoute]]):O("",!0)],10,hf)]),_:2},1032,["to"]))),128))])]),s(ga)])])],512),[[Y,["404","403","not-found"].indexOf(p.$route.name)===-1]])],64)}}},gf={__name:"IButtonClose",props:{icon:{default:"X",type:String}},setup(e){return(t,n)=>{const a=v("IButton");return d(),R(a,{icon:e.icon},null,8,["icon"])}}},yf=Object.assign({inheritAttrs:!1},{__name:"IButtonCopy",props:{text:String,tag:{type:[String,Object],default:"IButtonIcon"},successMessage:{type:String,default:"Text copied to clipboard."}},setup(e){const t=e,{copy:n,isSupported:a}=Ya({source:xe(t,"text"),legacy:!0});function r(){n(),Innoclapps.info(t.successMessage)}return(i,u)=>D((d(),k("span",null,[(d(),R(We(e.tag),Re(i.$attrs,{icon:e.tag==="IButtonIcon"?i.$attrs.icon||"Clipboard":void 0,onClick:r}),{default:b(()=>[de(i.$slots,"default")]),_:3},16,["icon"]))],512)),[[Y,l(a)]])}});const xf={},If={class:"button-group relative z-0 inline-flex rounded-md shadow-sm"};function kf(e,t){return d(),k("span",If,[de(e.$slots,"default")])}const $f=ct(xf,[["render",kf]]),ya={secondary:"text-neutral-500 hover:text-neutral-700 focus:ring-primary-500 dark:text-neutral-200 dark:hover:text-neutral-400",primary:"text-primary-600 hover:text-primary-700 focus:ring-primary-500 dark:text-primary-400 dark:hover:text-primary-500",success:"text-success-600 hover:text-success-700 focus:ring-success-500 dark:text-success-400 dark:hover:text-success-500",info:"text-info-600 hover:text-info-700 focus:ring-info-500 dark:text-info-400 dark:hover:text-info-500",warning:"text-warning-600 hover:text-warning-700 focus:ring-warning-500 dark:text-warning-400 dark:hover:text-warning-500",danger:"text-danger-600 hover:text-danger-700 focus:ring-danger-500 dark:text-danger-400 dark:hover:text-danger-500"},wf=Object.assign({inheritAttrs:!1},{__name:"IButtonIcon",props:{variant:{type:String,default:"secondary",validator(e){return Object.keys(ya).includes(e)}},to:[Object,String],icon:{required:!0,type:String},iconClass:{type:[String,Array,Object],default:"w-5 h-5"}},emits:["click"],setup(e,{emit:t}){const n=e,a=Qe(),r=V(()=>ya[n.variant]);function i(u){n.to?a.push(n.to):t("click",u)}return(u,c)=>{const m=v("Icon");return d(),k("button",Re(u.$attrs,{type:"button",class:["flex items-center rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-neutral-100",r.value],onClick:i}),[de(u.$slots,"default",{},()=>[s(m,{icon:e.icon,class:X(["pointer-events-none",e.iconClass])},null,8,["icon","class"])])],16)}}}),xa={neutral:"bg-neutral-50 text-neutral-800 hover:bg-neutral-100 focus:ring-offset-neutral-50 focus:ring-neutral-300 dark:bg-neutral-300",primary:"bg-primary-50 text-primary-800 hover:bg-primary-100 focus:ring-offset-primary-50 focus:ring-primary-600",success:"bg-success-50 text-success-800 hover:bg-success-100 focus:ring-offset-success-50 focus:ring-success-600",info:"bg-info-50 text-info-800 hover:bg-info-100 focus:ring-offset-info-50 focus:ring-info-600",warning:"bg-warning-50 text-warning-800 hover:bg-warning-100 focus:ring-offset-warning-50 focus:ring-warning-600",danger:"bg-danger-50 text-danger-800 hover:bg-danger-100 focus:ring-offset-danger-50 focus:ring-danger-600"},Cf={__name:"IButtonMinimal",props:{text:String,to:[Object,String],rounded:{default:!0,type:Boolean},icon:String,tag:{default:"button",type:[String,Object]},type:{type:String,default:"button"},disabled:Boolean,loading:Boolean,variant:{default:"primary",type:String,validator(e){return Object.keys(xa).includes(e)}}},emits:["click"],setup(e,{emit:t}){const n=e,a=Qe(),r=V(()=>[xa[n.variant],{"pointer-events-none opacity-60":n.disabled,"rounded-md":n.rounded}]);function i(u){n.to?a.push(n.to):t("click",u)}return(u,c)=>{const m=v("Icon"),p=v("ISpinner");return d(),R(We(e.tag),{type:e.type,class:X([r.value,"inline-flex items-center px-2 py-1.5 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2"]),disabled:e.disabled,tabindex:e.disabled?"-1":void 0,onClick:i},{default:b(()=>[e.icon?D((d(),R(m,{key:0,icon:e.icon,class:X(["pointer-events-none h-4 w-4 shrink-0",{"mr-2":u.$slots.default||e.text}])},null,8,["icon","class"])),[[Y,!e.loading]]):O("",!0),e.loading?(d(),R(p,{key:1,class:"mr-2 h-3 w-3 text-current"})):O("",!0),de(u.$slots,"default",{},()=>[Q(S(e.text),1)])]),_:3},8,["type","class","disabled","tabindex"])}}},Sf={install(e){e.component("IButton",Ll),e.component("IButtonClose",gf),e.component("IButtonMinimal",Cf),e.component("IButtonCopy",yf),e.component("IButtonIcon",wf),e.component("IButtonGroup",$f)}},Rf={class:"grow"},Ff=["textContent"],Vf=Object.assign({inheritAttrs:!1},{__name:"ICard",props:{tag:{type:[String,Object],default:"div"},header:String,headerClass:[String,Array,Object],actionsClass:[String,Array,Object],footerClass:[String,Array,Object],description:String,condensed:Boolean,overlay:Boolean,ring:{default:!0,type:Boolean},rounded:{default:!0,type:Boolean},shadow:{default:!0,type:Boolean},overflowHidden:{default:!0,type:Boolean},noBody:Boolean},setup(e){return(t,n)=>{const a=v("ICardHeading"),r=v("ICardBody"),i=v("ICardFooter"),u=v("IOverlay");return d(),R(u,{show:e.overlay},{default:b(()=>[(d(),R(We(e.tag),Re({class:["card bg-white dark:bg-neutral-900",{"ring-1 ring-neutral-600 ring-opacity-5 dark:ring-neutral-700 dark:ring-opacity-50":e.ring,"rounded-lg":e.rounded,shadow:e.shadow,"overflow-hidden":e.overflowHidden}]},t.$attrs),{default:b(()=>[e.header||t.$slots.header||t.$slots.actions?(d(),k("div",{key:0,class:X(["flex flex-wrap items-center justify-between border-b border-neutral-200 dark:border-neutral-700 sm:flex-nowrap",e.condensed?"px-6 py-3":"px-4 py-5 sm:px-6",e.headerClass])},[o("div",Rf,[de(t.$slots,"header",{},()=>[s(a,null,{default:b(()=>[Q(S(e.header),1)]),_:1})]),e.description?(d(),k("p",{key:0,class:"mt-1 max-w-2xl text-sm text-neutral-500 dark:text-neutral-200",textContent:S(e.description)},null,8,Ff)):O("",!0)]),t.$slots.actions?(d(),k("div",{key:0,class:X(["shrink-0 sm:ml-4",e.actionsClass])},[de(t.$slots,"actions")],2)):O("",!0)],2)):O("",!0),e.noBody?de(t.$slots,"default",{key:2}):(d(),R(r,{key:1,condensed:e.condensed},{default:b(()=>[de(t.$slots,"default")]),_:3},8,["condensed"])),t.$slots.footer?(d(),R(i,{key:3,condensed:e.condensed,class:X(e.footerClass)},{default:b(()=>[de(t.$slots,"footer")]),_:3},8,["condensed","class"])):O("",!0)]),_:3},16,["class"]))]),_:3},8,["show"])}}}),Tf={__name:"ICardBody",props:{condensed:Boolean},setup(e){return(t,n)=>(d(),k("div",{class:X(e.condensed?"px-6 py-3":"px-4 py-5 sm:px-6")},[de(t.$slots,"default")],2))}},Df={__name:"ICardFooter",props:{condensed:Boolean},setup(e){return(t,n)=>(d(),k("div",{class:X(["bg-neutral-50 dark:bg-neutral-700",e.condensed?"px-6 py-3":"px-4 py-5 sm:px-6"])},[de(t.$slots,"default")],2))}},qf={},Ef={class:"whitespace-nowrap text-lg/6 font-medium text-neutral-800 dark:text-white"};function Af(e,t){return d(),k("h3",Ef,[de(e.$slots,"default")])}const Bf=ct(qf,[["render",Af]]),Nf={install(e){e.component("ICard",Vf),e.component("ICardHeading",Bf),e.component("ICardBody",Tf),e.component("ICardFooter",Df)}};function Xt(){const e={delay:15,delayOnTouchOnly:!0,animation:0,disabled:!1,ghostClass:"drag-ghost-rounded"},t={scroll:!0,scrollSpeed:50,forceFallback:!0,...e.value};return{draggableOptions:e,scrollableDraggableOptions:t}}const Of={listClass:[String,Array,Object],listWrapperClass:[String,Array,Object],reorderable:Boolean,simple:Boolean,toggleIcon:{type:String,default:"Selector"},loading:Boolean,inputId:String,tabindex:Number,autocomplete:{type:String,default:"off"},placeholder:{type:String,default:""},autoscroll:{type:Boolean,default:!0},bordered:{type:Boolean,default:!0},shadow:{type:Boolean,default:!0},rounded:{type:Boolean,default:!0},size:{type:[String,Boolean],default:"md",validator(e){return["sm","lg","md","",!1].includes(e)}},modelValue:{},options:{type:Array,default(){return[]}},disabled:Boolean,clearable:{type:Boolean,default:!0},searchable:{type:Boolean,default:!0},multiple:Boolean,clearSearchOnSelect:{type:Boolean,default:!0},closeOnSelect:{type:Boolean,default:!0},label:{type:String,default:"label"},optionLabelProvider:Function,reduce:{type:Function,default:e=>e},selectable:{type:Function,default:e=>!0},taggable:Boolean,pushTags:Boolean,filterable:{type:Boolean,default:!0},filterBy:{type:Function,default(e,t,n){return(t||"").toLowerCase().indexOf(n.toLowerCase())>-1}},createOptionProvider:Function,optionKeyProvider:Function,optionComparatorProvider:Function,displayNewOptionsLast:Boolean,resetOnOptionsChange:{type:[Function,Boolean],default:!1}};function zf(e,t,n,a,r){const i=q(-1);let u=null;const c=V(()=>e.value.length);Ho(()=>{u=l(t)}),ge(i,()=>{l(n)&&h()}),ge(c,y=>{for(let _=0;_<y;_++)if(u(l(e)[_])){i.value=_;break}});function m(){for(let y=i.value-1;y>=0;y--)if(u(l(e)[y])){i.value=y;break}}function p(){for(let y=i.value+1;y<c.value;y++)if(u(l(e)[y])){i.value=y;break}}function f(){const y=l(e)[i.value];y&&r(y)}function h(){var _;const y=((_=a.value)==null?void 0:_.targetDomElement.children[i.value])||!1;if(y){const I=g(),{top:F,bottom:$,height:C}=y.getBoundingClientRect();if(F<I.top)return a.value.targetDomElement.scrollTop=y.offsetTop;if($>I.bottom)return a.value.targetDomElement.scrollTop=y.offsetTop-(I.height-C)}}function g(){return a.value?a.value.targetDomElement.getBoundingClientRect():{height:0,top:0,bottom:0}}return{typeAheadPointer:i,typeAheadSelect:f,typeAheadDown:p,typeAheadUp:m}}let Mf=0;function Uf(){return++Mf}const zt={__name:"TextBackground",props:{text:String,color:String,shade:{type:Boolean,default:!0},bgOpacity:{type:[String,Number],default:.2},colorShade:{type:[String,Number],default:-50}},setup(e){const t=e,n=V(()=>{if(!t.color||t.color.length!==7)return null;if(!t.shade)return{background:t.color,color:Vn(t.color)};const a=Dl(t.color);return{background:`rgba(${a.red}, ${a.green}, ${a.blue}, ${t.bgOpacity})`,color:Qd(t.color,t.colorShade)}});return(a,r)=>(d(),k("span",{style:st(n.value)},[de(a.$slots,"default",{},()=>[Q(S(e.text),1)])],4))}},Pf=["id","aria-selected"],jf={__name:"ISelectOption",props:["label","uid","index","active","isSelected","isSelectable","swatchColor"],emits:["typeAheadPointer","selected"],setup(e){const t=e,n=V(()=>t.isSelected||t.active),a=V(()=>({"bg-neutral-100/80 text-neutral-700 hover:text-neutral-900 dark:bg-neutral-700 dark:text-neutral-100 dark:hover:text-white":n.value,"text-neutral-700 dark:text-neutral-100 dark:hover:text-white":!n.value,"pointer-events-none opacity-50":!t.isSelectable}));return(r,i)=>(d(),k("li",{id:`cs${e.uid}__option-${e.index}`,role:"option",class:"relative","aria-selected":n.value?!0:null},[o("a",{href:"#",class:X(["group block px-4 py-2 text-sm focus:outline-none",a.value]),onClick:i[0]||(i[0]=ie(u=>r.$emit("selected"),["prevent"])),onMouseoverPassive:i[1]||(i[1]=ie(u=>e.isSelectable?r.$emit("typeAheadPointer",e.index):null,["self"]))},[(d(),R(We(e.swatchColor?zt:"span"),{color:e.swatchColor||void 0,class:X(e.swatchColor?"inline-flex items-center justify-center rounded-full px-2.5 font-normal leading-5 dark:!text-white":null)},{default:b(()=>[de(r.$slots,"default",{label:e.label},()=>[Q(S(e.label),1)])]),_:3},8,["color","class"]))],34),de(r.$slots,"option-inner",{index:e.index})],8,Pf))}},Lf=["disabled","title","aria-label"],Hf={__name:"ISelectSelectedOptionDeselectButton",props:{option:{required:!0},deselect:{type:Function,required:!0},disabled:Boolean,label:{type:[String,Number],required:!0}},setup(e){return(t,n)=>{const a=v("Icon");return d(),k("button",{type:"button",disabled:e.disabled,class:"ml-1 text-neutral-400 hover:text-neutral-600 focus:outline-none dark:text-neutral-200 dark:hover:text-neutral-400",title:`Deselect ${e.label}`,"aria-label":`Deselect ${e.label}`,onClick:n[0]||(n[0]=ie(r=>e.deselect(e.option),["prevent","stop"]))},[s(a,{icon:"X",class:"h-4 w-4"})],8,Lf)}}},Gf={__name:"ISelectSelectedOption",props:["option","getOptionLabel","getOptionKey","normalizeOptionForSlot","multiple","searching","disabled","deselect","simple"],setup(e){const t=e,n=V(()=>{let u={class:"dark:!text-white"};return t.option.swatch_color&&(u.color=t.option.swatch_color),(t.multiple||t.option.swatch_color)&&(u.class+=" rounded-md px-2 inline-flex items-center",t.option.swatch_color||(u.class+=" bg-neutral-100 dark:bg-neutral-500"),t.multiple&&(u.class+=" mr-2")),(t.disabled&&!t.simple||t.searching)&&(u.class+=" opacity-60 dark:opacity-80"),u}),a=V(()=>t.getOptionLabel(t.option)),r=V(()=>t.getOptionKey(t.option)),i=V(()=>t.normalizeOptionForSlot(t.option));return(u,c)=>(d(),R(We(typeof e.option=="object"&&e.option.swatch_color?zt:"span"),Re({key:r.value},n.value),{default:b(()=>[de(u.$slots,"option",Re(i.value,{optionLabel:a.value})),e.multiple&&!e.disabled?(d(),R(Hf,{key:0,deselect:e.deselect,label:a.value,option:e.option},null,8,["deselect","label","option"])):O("",!0)]),_:3},16))}};const Kf={class:"flex items-center"},Yf=["id","aria-expanded","aria-owns"],Wf={class:"mr-4 grow"},Qf=["onKeydown"],Xf={class:"inline-flex"},Zf=["disabled","onClick"],Jf={key:0},ev={key:0,class:"border-b border-neutral-200 px-4 py-3 dark:border-neutral-600"},tv={class:"relative cursor-default select-none px-4 py-2 text-sm text-neutral-600 dark:text-neutral-300"},nv={class:"absolute right-5 top-2.5 flex space-x-3"},ov=Object.assign({name:"ICustomSelect",inheritAttrs:!1},{__name:"ISelect",props:Of,emits:["update:modelValue","update:draggable","open","close","cleared","option:selecting","option:created","option:selected","option:deselecting","option:deselected","search","search:blur","search:focus"],setup(e,{expose:t,emit:n}){const a=e,{draggableOptions:r}=Xt(),i=q(null),u=q(null),c=q(null),m=q(null),p=q("body"),f=Uf(),h=q(""),g=q(!1),y=q(!1),_=q([]),I=q([]),F=q(a.loading),{floatingStyles:$}=zr(i,c,{placement:"bottom",middleware:[Wa(10),Mr()],whileElementsMounted:Ur}),{t:C}=ve(),w=V(()=>a.searchable&&!a.simple);function x(se=null){return se==null?F.value=!F.value:F.value=se}function A(se){let ke=null;return a.createOptionProvider?ke=a.createOptionProvider(se):ke=typeof le.value[0]=="object"?{[a.label]:se}:se,n("option:created",ke),ke}function N(se,ke){return se.filter(He=>{let yt=T(He);return typeof yt=="number"&&(yt=yt.toString()),a.filterBy(He,yt,ke)})}function T(se){return a.optionLabelProvider?a.optionLabelProvider(se):typeof se=="object"?Object.hasOwn(se,a.label)?se[a.label]:console.warn(`[select warn]: Label key "option.${a.label}" does not exist in options object ${JSON.stringify(se)}.`):se}function E(se){if(a.getOptionKeyProvider)return a.getOptionKeyProvider(se);if(typeof se!="object")return se;try{return Object.hasOwn(se,"id")?se.id:B(se)}catch(ke){return console.warn("[select warn]: Could not stringify this option to generate unique key. Please provide'getOptionKey' prop to return a unique key for each option.",se,ke)}}function B(se){const ke={};return Object.keys(se).sort().forEach(He=>{ke[He]=se[He]}),JSON.stringify(ke)}function z(se){Array.isArray(se)?I.value=se.map(ke=>oe(ke)):I.value=oe(se)}function M(se){n("option:selecting",se),K(se)||(a.taggable&&!ue(se)&&(n("option:created",se),W(se)),a.multiple&&(se=Ce.value.concat(se)),H(se),n("option:selected",se)),P()}function j(se){n("option:deselecting",se),H(Ce.value.filter(ke=>!G(ke,se))),n("option:deselected",se)}function U(){H(a.multiple?[]:null),n("cleared")}function P(se){a.closeOnSelect&&(J(),m.value.blur()),a.clearSearchOnSelect&&(h.value="")}function H(se){typeof a.modelValue>"u"&&(I.value=se),se!==null&&(Array.isArray(se)?se=se.map(ke=>a.reduce(ke)):se=a.reduce(se)),n("update:modelValue",se)}function L(){m.value.focus()}function Z(){g.value=!0,L()}function J(){g.value=!1}function K(se){return Ce.value.some(ke=>G(ke,se))}function G(se,ke){return a.optionComparatorProvider?a.optionComparatorProvider(se,ke,E):E(se)===E(ke)}function oe(se){const ke=yt=>JSON.stringify(a.reduce(yt))===JSON.stringify(se),He=[...a.options,..._.value].filter(ke);return He.length===1?He[0]:He.find(yt=>G(yt,I.value))||se}function pe(){if(!m.value.value.length&&Ce.value&&Ce.value.length&&a.clearable){let se=null;a.multiple&&(se=Array.from(Ce.value.slice(0,Ce.value.length-1))),H(se)}}function ue(se){return le.value.some(ke=>G(ke,se))}function ee(se){return typeof se=="object"?se:{[a.label]:se}}function W(se){_.value.push(se)}function ne(){h.value.length?h.value="":m.value.blur()}function ce(se){n("search:blur")}function fe(){n("search:focus")}const Se=V(()=>ye.value?C("core::app.no_search_results"):C("core::app.not_enough_data")),Ie=V(()=>typeof a.modelValue>"u"||!!a.reduce),Ce=V(()=>{let se=a.modelValue;return Ie.value&&(se=I.value),se?[].concat(se):[]}),le=V(()=>a.options.concat(a.pushTags?_.value:[])),ye=V(()=>!!h.value),Ge=V(()=>g.value&&!F.value),be=V(()=>et.value&&a.placeholder?a.placeholder:""),Ve=V(()=>$e.value.length),$e=V(()=>{const se=[].concat(le.value);if(!a.filterable&&!a.taggable)return se;let ke=h.value.length?N(se,h.value):se;if(a.taggable&&h.value.length){const He=A(h.value);ue(He)||(a.displayNewOptionsLast?ke.unshift(He):ke.push(He))}return ke}),et=V(()=>Ce.value.length===0),Te=V(()=>!a.multiple&&a.clearable&&!g.value&&!et.value);typeof a.modelValue<"u"&&Ie.value&&z(a.modelValue);const{typeAheadPointer:tt,typeAheadUp:at,typeAheadDown:lt,typeAheadSelect:_e}=zf($e,xe(a,"selectable"),xe(a,"autoscroll"),u,M);ge(()=>a.options,(se,ke)=>{let He=()=>typeof a.resetOnOptionsChange=="function"?a.resetOnOptionsChange(se,ke,Ce):a.resetOnOptionsChange;!a.taggable&&He()&&U(),a.modelValue&&Ie.value&&z(a.modelValue)}),ge(()=>a.modelValue,se=>{Ie.value&&z(se)}),ge(()=>a.multiple,U),ge(g,se=>{n(se?"open":"close")}),ge(h,se=>{n("search",se,x)}),ge(()=>a.loading,se=>{F.value=se});let me=null;const we=q(null);function Ue(){typeof window<"u"&&"ResizeObserver"in window&&i.value&&(me=new ResizeObserver(([se])=>{we.value=se.borderBoxSize.reduce((ke,{inlineSize:He})=>ke+He,0)}),me.observe(i.value))}function Oe(){me&&(me.disconnect(),me=void 0,we.value=null)}return De(()=>{Ue(),jo(c,J,{ignore:[i.value]}),i.value.inDialog()&&(p.value=i.value.parentDialogIdHash())}),bt(()=>{Oe()}),t({focus:L,show:Z,hide:J}),(se,ke)=>{const He=v("Icon"),yt=v("ISpinner"),Ke=v("IFormInput");return d(),k(te,null,[o("div",Re(se.$attrs,{ref_key:"reference",ref:i,role:"button",class:[{"border-primary-500 ring-1 ring-primary-500":g.value&&se.bordered&&!se.simple,"px-2.5 py-1.5":se.size==="sm","px-3 py-2":(se.size==="md"||se.size==="")&&!se.simple,"px-4 py-2.5":se.size==="lg","border border-neutral-300 dark:border-neutral-600":se.bordered&&!se.simple,rounded:se.rounded&&se.size==="sm"&&!se.simple,"rounded-md":se.rounded&&se.size!=="sm"&&se.size!==!1&&!se.simple,"shadow-sm":se.shadow&&!se.simple,"bg-white":!se.simple&&!se.disabled,"dark:bg-neutral-700":!se.simple,"bg-neutral-200":!se.simple&&se.disabled,"pointer-events-none":se.disabled},"relative w-full text-left text-sm"],onClick:ke[6]||(ke[6]=Ze=>g.value?J():Z())}),[o("div",Kf,[o("div",{id:`cs${l(f)}__combobox`,class:X(["flex items-center",{"cursor-text":w.value}]),role:"combobox","aria-expanded":Ge.value.toString(),"aria-owns":`cs${l(f)}__listbox`,"aria-label":"Search for an option"},[D(o("div",{class:X({"absolute left-auto flex opacity-40":!se.multiple&&Ge.value})},[(d(!0),k(te,null,re(Ce.value,Ze=>de(se.$slots,"selected-option-container",{option:ee(Ze),deselect:j,multiple:se.multiple,disabled:se.disabled},()=>[s(Gf,{option:Ze,simple:se.simple,"get-option-label":T,"get-option-key":E,"normalize-option-for-slot":ee,multiple:se.multiple,searching:ye.value,disabled:se.disabled,deselect:j},{option:b(ze=>[de(se.$slots,"selected-option",pt(ft(ze)),()=>[Q(S(ze.optionLabel),1)],!0)]),_:2},1032,["option","simple","multiple","searching","disabled"])],!0)),256))],2),[[Y,!h.value||se.multiple]])],10,Yf),D(o("div",Wf,[o("input",Re({ref_key:"inputSearchRef",ref:m,class:[(Ge.value||et.value||ye.value)&&!se.simple?"!w-full":"!w-0","max-w-full border-0 p-0 text-sm leading-none focus:border-0 focus:ring-0 disabled:bg-neutral-200 dark:bg-neutral-700 dark:text-white dark:placeholder-neutral-400"]},{disabled:se.disabled,placeholder:be.value,tabindex:se.tabindex,readonly:!w.value,class:"cs__search",id:se.inputId,"aria-autocomplete":"list","aria-labelledby":`cs${l(f)}__combobox`,"aria-controls":`cs${l(f)}__listbox`,type:"search",autocomplete:se.autocomplete,value:h.value,...Ge.value&&$e.value[l(tt)]?{"aria-activedescendant":`cs${l(f)}__option-${l(tt)}`}:{}},{onBlur:ce,onFocus:fe,onInput:ke[0]||(ke[0]=Ze=>h.value=Ze.target.value),onCompositionstart:ke[1]||(ke[1]=Ze=>y.value=!0),onCompositionend:ke[2]||(ke[2]=Ze=>y.value=!0),onKeydown:[Tt(pe,["delete"]),Tt(ne,["esc"]),ke[3]||(ke[3]=Tt(ie((...Ze)=>l(at)&&l(at)(...Ze),["prevent"]),["up"])),ke[4]||(ke[4]=Tt(ie((...Ze)=>l(lt)&&l(lt)(...Ze),["prevent"]),["down"])),ke[5]||(ke[5]=Tt(ie(Ze=>!y.value&&l(_e)(),["prevent"]),["enter"]))]}),null,16,Qf)],512),[[Y,!se.simple]]),o("div",Xf,[D(o("button",{ref:"clearButton",type:"button",disabled:se.disabled,class:"mr-1 text-neutral-400 hover:text-neutral-600 dark:text-neutral-200 dark:hover:text-neutral-400",title:"Clear Selected","aria-label":"Clear Selected",onClick:ie(U,["prevent","stop"])},[s(He,{icon:"X",class:X(["shrink-0 text-neutral-400",se.size!=="sm"?"h-5 w-5":"h-4 w-4"])},null,8,["class"])],8,Zf),[[Y,Te.value]]),de(se.$slots,"spinner",pt(ft({loading:F.value})),()=>[F.value?(d(),R(yt,{key:0,class:X(["mr-2 shrink-0 text-neutral-400",se.size!=="sm"?"h-5 w-5":"h-4 w-4"])},null,8,["class"])):O("",!0)],!0),!se.simple||!(se.simple&&se.disabled)?(d(),k("div",Jf,[s(He,{icon:se.toggleIcon,class:X(["text-neutral-400",se.size!=="sm"?"h-5 w-5":"h-4 w-4"])},null,8,["icon","class"])])):O("",!0)])])],16),(d(),R(gn,{to:p.value},[g.value?(d(),k("div",{key:0,ref_key:"dropdownMenuWrapperRef",ref:c,class:X(["c-popper overflow-hidden rounded-md border border-neutral-200 bg-white shadow-lg dark:border-neutral-600 dark:bg-neutral-800",se.listWrapperClass]),style:st({zIndex:99999,width:typeof we.value=="number"?`${we.value}px`:"",...l($)})},[se.simple&&se.searchable?(d(),k("div",ev,[s(Ke,{modelValue:h.value,"onUpdate:modelValue":ke[7]||(ke[7]=Ze=>h.value=Ze),type:"search",placeholder:be.value},null,8,["modelValue","placeholder"])])):O("",!0),de(se.$slots,"header",{},void 0,!0),(d(),R(l(Et),Re({...l(r),ghostClass:"drag-ghost"},{id:`cs${l(f)}__listbox`,ref_key:"dropdownMenuRef",ref:u,key:`cs${l(f)}__listbox`,"model-value":$e.value,handle:".select-option-draggable-handle",tag:"ul","item-key":Ze=>E(Ze),class:[se.listClass,"max-h-80 overflow-y-auto"],role:"listbox","onUpdate:modelValue":ke[10]||(ke[10]=Ze=>se.$emit("update:draggable",Ze))}),vt({item:b(({element:Ze,index:ze})=>[St([ze===l(tt),K(Ze),T(Ze),E(Ze)],()=>(d(),R(jf,{key:ze,uid:l(f),"swatch-color":Ze.swatch_color,index:ze,active:ze===l(tt),label:T(Ze),"is-selectable":se.selectable(Ze),"is-selected":K(Ze),onSelected:Vt=>M(Ze),onTypeAheadPointer:ke[8]||(ke[8]=Vt=>tt.value=Vt)},{default:b(({label:Vt})=>[de(se.$slots,"option",pt(ft({...ee(Ze),label:Vt})),()=>[Q(S(Vt),1)],!0)]),"option-inner":b(Vt=>[D(o("span",nv,[de(se.$slots,"option-actions",pt(ft(Vt)),void 0,!0),se.reorderable&&!ye.value?(d(),R(He,{key:0,icon:"Selector",class:"select-option-draggable-handle h-4 w-4 cursor-move text-neutral-600 dark:text-neutral-200"})):O("",!0)],512),[[Y,$e.value.length>1]])]),_:2},1032,["uid","swatch-color","index","active","label","is-selectable","is-selected","onSelected"])),ke,9)]),_:2},[Ve.value===0&&!se.loading?{name:"header",fn:b(()=>[o("li",tv,[de(se.$slots,"no-options",pt(ft({search:h.value,loading:se.loading,searching:ye.value,text:Se.value})),()=>[Q(S(Se.value),1)],!0)])]),key:"0"}:void 0]),1040,["id","model-value","item-key","class"])),de(se.$slots,"footer",{},void 0,!0)],6)):O("",!0)],8,["to"]))],64)}}}),lv=ct(ov,[["__scopeId","data-v-51ad1df1"]]);function ds(e,t,n){function a(i){i===l(n)&&e()}function r(i){i===l(n)&&t()}De(()=>{rt("modal-hide",r),rt("modal-show",a)})}function Hl(e){return V(()=>{let t=l(e);return!t||t==="sm"?"sm:max-w-lg":t==="md"?"sm:max-w-2xl":t==="lg"?"sm:max-w-3xl":t==="xl"?"sm:max-w-4xl":"sm:max-w-5xl"})}const av={class:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0"},sv=o("span",{class:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"},"",-1),rv={class:"sm:flex sm:items-start"},iv={class:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left"},uv=["innerHTML"],dv=["textContent"],cv={class:"text-sm text-neutral-500 dark:text-neutral-300"},mv=["innerHTML"],pv=["textContent"],fv={class:"mt-5 sm:ml-10 sm:mt-4 sm:flex sm:pl-4"},vv={__name:"IConfirmationDialog",props:{dialog:{required:!0,type:Object}},setup(e){const t=e,{t:n}=ve(),a=Hl(xe(t.dialog,"size")),r=q(!0),i=V(()=>t.dialog.title===!1?null:t.dialog.title||n("core::actions.confirmation_message")),u=V(()=>t.dialog.icon||"ExclamationTriangle"),c=V(()=>t.dialog.confirmVariant||"danger"),m=V(()=>t.dialog.confirmText||n("core::app.confirm")),p=V(()=>t.dialog.cancelVariant||"white");function f(){r.value=!1}function h(){t.dialog.resolve(),f()}function g(){t.dialog.reject(),f()}return(y,_)=>{const I=v("Icon"),F=v("IButton");return d(),R(l(co),{as:"template",show:r.value},{default:b(()=>[s(l(uo),{as:"div",static:"",class:"dialog fixed inset-0 overflow-y-auto",open:r.value},{default:b(()=>[o("div",av,[s(l(Jt),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>[s(l(Lo),{class:"fixed inset-0 bg-neutral-500/75 transition-opacity dark:bg-neutral-700/90"})]),_:1}),sv,s(l(Jt),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:b(()=>[o("div",{class:X(["inline-block w-full transform rounded-lg bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all dark:bg-neutral-800 sm:my-8 sm:p-6 sm:align-middle",l(a)])},[e.dialog.component?(d(),R(We(e.dialog.component),{key:0,close:f,cancel:g,dialog:e.dialog},null,8,["dialog"])):(d(),k(te,{key:1},[o("div",rv,[o("div",{class:X(["mx-auto flex h-12 w-12 shrink-0 items-center justify-center rounded-full sm:mx-0 sm:h-10 sm:w-10",e.dialog.iconWrapperColorClass?e.dialog.iconWrapperColorClass:"bg-danger-100"])},[s(I,{icon:u.value,class:X(["h-6 w-6",e.dialog.iconColorClass?e.dialog.iconColorClass:"text-danger-600"])},null,8,["icon","class"])],2),o("div",iv,[i.value?(d(),R(l(io),{key:0,as:"h3",class:X([{"mt-2":!e.dialog.message},"text-lg/6 font-medium text-neutral-600 dark:text-white"])},{default:b(()=>[e.dialog.html?(d(),k("span",{key:0,innerHTML:i.value},null,8,uv)):(d(),k("span",{key:1,textContent:S(i.value)},null,8,dv))]),_:1},8,["class"])):O("",!0),e.dialog.message?(d(),k("div",{key:1,class:X({"mt-2":!!i.value})},[o("p",cv,[e.dialog.html?(d(),k("span",{key:0,innerHTML:e.dialog.message},null,8,mv)):(d(),k("span",{key:1,textContent:S(e.dialog.message)},null,8,pv))])],2)):O("",!0)])]),o("div",fv,[s(F,{variant:c.value,class:"w-full sm:w-auto",text:m.value,onClick:h},null,8,["variant","text"]),s(F,{variant:p.value,class:"mt-3 w-full sm:ml-3 sm:mt-0 sm:w-auto",text:y.$t("core::app.cancel"),onClick:g},null,8,["variant","text"])])],64))],2)]),_:1})])]),_:1},8,["open"])]),_:1},8,["show"])}}},cs=["hidden","show","shown","ok","update:visible","submit","keydown"],ms={form:{type:Boolean},overlay:{type:Boolean,default:!0},visible:Boolean,title:String,subTitle:String,busy:Boolean,size:{type:String,default:"md",validator(e){return["sm","md","lg","xl","xxl"].includes(e)}},id:{type:String,default:qt()},okTitle:{type:String,default:"Ok"},okDisabled:Boolean,okLoading:Boolean,okVariant:{type:String,default:"primary"},okSize:String,cancelTitle:{type:String,default:"Cancel"},cancelVariant:{type:String,default:"white"},cancelDisabled:Boolean,cancelSize:String,hideFooter:Boolean,hideHeader:Boolean,hideHeaderClose:Boolean,initialFocus:{type:Object,default:null},staticBackdrop:Boolean},bv={class:"dialog-inner flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-1"},hv=o("span",{class:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"},"",-1),_v={class:"absolute right-2 top-1 pr-4 pt-4"},gv={class:"bg-white px-4 pb-4 pt-5 dark:bg-neutral-900 sm:p-6 sm:pb-4"},yv=["textContent"],xv={class:"mt-5"},Iv={key:0,class:"bg-neutral-50 px-4 py-3 dark:bg-neutral-800 sm:px-6"},kv={class:"flex justify-end space-x-3"},$v={__name:"IModal",props:ms,emits:cs,setup(e,{expose:t,emit:n}){const a=e;ds(h,g,xe(a,"id"));const r=Hl(xe(a,"size")),i=q(!1),u=q(!1),c=q(!1),m=V(()=>a.busy||a.okDisabled),p=V(()=>a.busy||a.cancelDisabled);ge(()=>a.visible,$=>$?h():g()),ge(u,$=>{$?(Fe(I),i.value=!0):F()});function f(){a.staticBackdrop||g()}function h(){n("show"),u.value=!0,n("update:visible",!0),Fe(()=>n("shown"))}function g(){c.value||(c.value=!0,u.value=!1,n("update:visible",!1),Fe(()=>{n("hidden"),c.value=!1}))}function y($){n("ok",$)}function _(){const $=document.querySelector(".dialog-inner");document.querySelector(".dialog-overlay").style.height=$.offsetHeight+"px"}function I(){document.querySelector(".dialog").addEventListener("scroll",_,Bo()),window.addEventListener("resize",_)}function F(){const $=document.querySelector(".dialog");$&&(window.removeEventListener("resize",_),$.removeEventListener("scroll",_,Bo()))}return De(()=>{a.visible&&h()}),bt(()=>{i.value&&F()}),t({hide:g,show:h}),($,C)=>{const w=v("Icon"),x=v("IButton"),A=v("IConfirmationDialog");return d(),R(l(co),{as:"template",show:u.value},{default:b(()=>[s(l(uo),{ref:"dialog",as:"div",static:"","initial-focus":$.initialFocus,class:"dialog fixed inset-0 overflow-y-auto",open:u.value,onClose:f},{default:b(()=>[o("div",bv,[s(l(Jt),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>[D(s(l(Lo),{class:"dialog-overlay absolute inset-0 bg-neutral-500/75 transition-opacity dark:bg-neutral-700/90"},null,512),[[Y,$.overlay]])]),_:1}),hv,s(l(Jt),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:b(()=>[(d(),R(We($.form?"form":"div"),{novalidate:$.form?!0:void 0,class:X([l(r),"relative z-50 inline-block w-full  overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl dark:bg-neutral-900 sm:my-8 sm:align-middle"]),onSubmit:C[0]||(C[0]=ie(N=>$.$emit("submit"),["prevent"])),onKeydownPassive:C[1]||(C[1]=N=>$.$emit("keydown",N))},{default:b(()=>[o("div",_v,[o("button",{type:"button",class:"rounded-md bg-white text-neutral-400 hover:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:bg-neutral-800",onClick:g},[s(w,{icon:"X",class:"h-6 w-6"})])]),o("div",gv,[o("div",null,[s(l(io),{class:"text-lg/6 font-medium text-neutral-700 dark:text-white",textContent:S($.title)},null,8,["textContent"]),$.subTitle?(d(),k("p",{key:0,class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S($.subTitle)},null,8,yv)):O("",!0)]),o("div",xv,[de($.$slots,"default")])]),$.hideFooter?O("",!0):(d(),k("div",Iv,[de($.$slots,"modal-footer",{cancel:g},()=>[o("div",kv,[de($.$slots,"modal-cancel",{cancel:g,title:$.cancelTitle},()=>[s(x,{variant:$.cancelVariant,disabled:p.value,size:$.cancelSize,text:$.cancelTitle,onClick:g},null,8,["variant","disabled","size","text"])]),de($.$slots,"modal-ok",{title:$.okTitle},()=>[s(x,{variant:$.okVariant,type:$.form?"submit":"button",size:$.okSize,class:"ml-4",loading:$.okLoading,disabled:m.value,text:$.okTitle,onClick:y},null,8,["variant","type","size","loading","disabled","text"])])])])]))]),_:3},40,["novalidate","class"]))]),_:3})]),$.$root.confirmationDialog?(d(),R(A,{key:0,dialog:$.$root.confirmationDialog},null,8,["dialog"])):O("",!0)]),_:3},8,["initial-focus","open"])]),_:3},8,["show"])}}},wv={class:"absolute inset-0 overflow-hidden"},Cv={class:"fixed inset-y-0 right-0 flex max-w-full pl-10"},Sv={class:"flex h-full flex-col divide-y divide-neutral-200 bg-white shadow-xl dark:divide-neutral-700 dark:bg-neutral-900"},Rv={class:"flex min-h-0 flex-1 flex-col overflow-y-scroll py-6"},Fv={key:0,class:"px-4 sm:px-6"},Vv={class:"flex items-start justify-between"},Tv={class:"space-y-1"},Dv=["textContent"],qv={class:"ml-3 flex h-7 items-center"},Ev=["id"],Av={class:"relative mt-8 flex-1 px-4 sm:px-6"},Bv={key:0,class:"shrink-0 px-4 py-4 dark:bg-neutral-800"},Nv={class:"flex flex-wrap justify-end space-x-3 sm:flex-nowrap"},Ov={__name:"ISlideover",props:ms,emits:cs,setup(e,{expose:t,emit:n}){const a=e;ds(f,h,xe(a,"id"));const r=Hl(xe(a,"size")),i=q(!1),u=q(!1),c=V(()=>a.busy||a.okDisabled),m=V(()=>a.busy||a.cancelDisabled);ge(()=>a.visible,y=>y?f():h());function p(){a.staticBackdrop||h()}function f(){n("show"),i.value=!0,n("update:visible",!0),Fe(()=>n("shown"))}function h(){u.value||(u.value=!0,i.value=!1,n("update:visible",!1),Fe(()=>{n("hidden"),u.value=!1}))}function g(y){n("ok",y)}return De(()=>{a.visible&&f()}),t({hide:h,show:f}),(y,_)=>{const I=v("Icon"),F=v("IButton"),$=v("IConfirmationDialog");return d(),R(l(co),{appear:"",as:"template",show:i.value},{default:b(()=>[s(l(uo),{as:"div",static:"","initial-focus":y.initialFocus,class:"dialog fixed inset-0 overflow-hidden",open:i.value,onClose:p},{default:b(()=>[o("div",wv,[D(s(l(Lo),{class:"absolute inset-0 bg-neutral-500/75 transition-opacity dark:bg-neutral-700/90"},null,512),[[Y,y.overlay]]),o("div",Cv,[s(l(Jt),{as:"template",enter:"transition ease-in-out duration-400 sm:duration-600","enter-from":"translate-x-full","enter-to":"translate-x-0",leave:"transition ease-in-out duration-400 sm:duration-600","leave-from":"translate-x-0","leave-to":"translate-x-full"},{default:b(()=>[(d(),R(We(y.form?"form":"div"),{novalidate:y.form?!0:void 0,class:X(["w-screen",l(r)]),onSubmit:_[0]||(_[0]=ie(C=>y.$emit("submit"),["prevent"])),onKeydownPassive:_[1]||(_[1]=C=>y.$emit("keydown",C))},{default:b(()=>[o("div",Sv,[o("div",Rv,[y.hideHeader?O("",!0):(d(),k("div",Fv,[de(y.$slots,"modal-header",{cancel:h},()=>[o("div",Vv,[o("div",Tv,[s(l(io),{class:"text-lg font-medium text-neutral-700 dark:text-white"},{default:b(()=>[de(y.$slots,"title",{title:y.title},()=>[Q(S(y.title),1)])]),_:3}),y.subTitle?(d(),k("p",{key:0,class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(y.subTitle)},null,8,Dv)):O("",!0)]),o("div",qv,[y.hideHeaderClose?O("",!0):(d(),k("button",{key:0,id:"modalClose-"+y.id,type:"button",class:"rounded-md bg-white text-neutral-400 hover:text-neutral-500 focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-neutral-800",onClick:h},[s(I,{icon:"X",class:"h-6 w-6"})],8,Ev))])])])])),o("div",Av,[de(y.$slots,"default")])]),y.hideFooter?O("",!0):(d(),k("div",Bv,[de(y.$slots,"modal-footer",{cancel:h},()=>[o("div",Nv,[de(y.$slots,"modal-cancel",{cancel:h,title:y.cancelTitle},()=>[s(F,{variant:y.cancelVariant,disabled:m.value,size:y.cancelSize,text:y.cancelTitle,onClick:h},null,8,["variant","disabled","size","text"])]),de(y.$slots,"modal-ok",{title:y.okTitle},()=>[s(F,{variant:y.okVariant,size:y.okSize,type:y.form?"submit":"button",loading:y.okLoading,disabled:c.value,text:y.okTitle,onClick:g},null,8,["variant","size","type","loading","disabled","text"])])])])]))])]),_:3},40,["novalidate","class"]))]),_:3})])]),y.$root.confirmationDialog?(d(),R($,{key:0,dialog:y.$root.confirmationDialog},null,8,["dialog"])):O("",!0)]),_:3},8,["initial-focus","open"])]),_:3},8,["show"])}}},zv={install(e,t={}){e.component("IConfirmationDialog",vv),e.component("IModal",$v),e.component("ISlideover",Ov),e.config.globalProperties.$iModal={hide(n){t.globalEmitter.$emit("modal-hide",n)},show(n){t.globalEmitter.$emit("modal-show",n)}}}},Mv=Object.assign({inheritAttrs:!1},{__name:"IDropdown",props:{text:String,full:{type:Boolean,default:!0},disabled:Boolean,loading:Boolean,rounded:{type:Boolean,default:!0},icon:{type:String},iconClass:[String,Array,Object],wrapperClass:[String,Array,Object],itemsClass:[String,Array,Object],size:{type:String,default:"md"},noCaret:Boolean,variant:{type:String,default:"white"},bordered:{type:Boolean,default:!0},arrow:{type:Boolean,default:!0},shadow:{type:Boolean,default:!0}},emits:["show","hide"],setup(e,{expose:t,emit:n}){const a={white:{backgroundColorClasses:"bg-white dark:bg-neutral-800",borderColorClasses:"border-neutral-200 dark:border-neutral-700"}};mt("hide",p);const r=q(!1),i=q(null),u=q(null);De(()=>{jo(i,p,{ignore:[".c-popper",u.value.$el]})});function c(){r.value?p():m()}function m(){r.value=!0,n("show")}function p(){r.value=!1,n("hide")}return t({show:m,hide:p}),(f,h)=>{const g=v("Icon");return d(),R(l(jr),{ref_key:"menuRef",ref:u,as:"div",class:X(e.wrapperClass)},{default:b(()=>[s(l(Qa),Re({arrow:e.arrow,offset:15,flip:"","z-index":1250,placement:"bottom",portal:"",show:r.value},{...f.$attrs,class:void 0},{enter:"transition ease-out duration-100","enter-from":"transform opacity-0 scale-95","enter-to":"transform opacity-100 scale-100",leave:"transition ease-in duration-75","leave-from":"transform opacity-100 scale-100","leave-to":"transform opacity-0 scale-95"}),{default:b(()=>[de(f.$slots,"toggle",pt(ft({disabled:e.disabled,loading:e.loading,icon:e.icon,iconClass:e.iconClass,noCaret:e.noCaret,toggle:c})),()=>[s(l(Xa),{as:Ll,variant:e.variant,disabled:e.disabled,loading:e.loading,rounded:e.rounded,size:e.size,icon:e.icon,"icon-class":e.iconClass,class:X(["w-full",f.$attrs.class,{"justify-between":!e.noCaret}]),onClick:c},{default:b(()=>[de(f.$slots,"toggle-content",{},()=>[Q(S(e.text),1)]),e.noCaret?O("",!0):(d(),R(g,{key:0,icon:"ChevronDown",class:X([e.size!=="sm"?"h-5 w-5":"h-4 w-4","-mr-1 ml-2 shrink-0"])},null,8,["class"]))]),_:3},8,["variant","disabled","loading","rounded","size","icon","icon-class","class"])]),s(l(Pr),{ref_key:"menuItemsRef",ref:i,static:"",class:X([e.itemsClass,"c-dropdown rounded-md outline-none",a.white.backgroundColorClasses,e.bordered?"border "+a.white.borderColorClasses:"",{"w-full":e.full,"shadow-lg":e.shadow}])},{default:b(()=>[e.arrow?(d(),R(l(Za),{key:0,class:X(["absolute h-5 w-5 rotate-45",a.white.backgroundColorClasses,e.bordered?"border "+a.white.borderColorClasses:""])},null,8,["class"])):O("",!0),o("div",{class:X(["relative rounded-md",a.white.backgroundColorClasses])},[de(f.$slots,"default")],2)]),_:3},8,["class"])]),_:3},16,["arrow","show"])]),_:3},8,["class"])}}}),Uv={__name:"IDropdownButton",setup(e){return(t,n)=>(d(),R(l(Xa),null,{default:b(()=>[de(t.$slots,"default")]),_:3}))}},Pv={__name:"IDropdownButtonGroup",props:{text:String,to:[Object,String],placement:{type:String,default:"bottom-end"},size:{type:String,default:"md"},disabled:Boolean,loading:Boolean,variant:{type:String,default:"primary"},icon:{type:String},type:{type:String,default:"button"},iconClass:[String,Array,Object]},emits:["click"],setup(e){return(t,n)=>{const a=v("IButton"),r=v("Icon"),i=v("IDropdown");return d(),k("span",{class:X(["relative z-0 inline-flex shadow-sm",e.size!="sm"?"rounded-md":"rounded"])},[s(a,{variant:e.variant,size:e.size,type:e.type,icon:e.icon,"icon-class":e.iconClass,to:e.to,rounded:!1,disabled:e.disabled,loading:e.loading,class:X(["focus:z-10",e.size!="sm"?"rounded-l-md":"rounded-l",{"-mr-px":!e.disabled}]),onClick:n[0]||(n[0]=u=>t.$emit("click",u))},{default:b(()=>[de(t.$slots,"button-content",{},()=>[Q(S(e.text),1)])]),_:3},8,["variant","size","type","icon","icon-class","to","disabled","loading","class"]),s(i,{placement:e.placement},{toggle:b(({toggle:u})=>[s(a,{variant:e.variant,disabled:e.disabled,size:e.size,rounded:!1,class:X(["focus:z-10",e.size!="sm"?"rounded-r-md":"rounded-r"]),onClick:u},{default:b(()=>[de(t.$slots,"dropdown-toggle-content",{},()=>[s(r,{icon:"ChevronDown",class:X(e.size==="sm"?"h-4 w-4":"h-5 w-5")},null,8,["class"])])]),_:2},1032,["variant","disabled","size","class","onClick"])]),default:b(()=>[de(t.$slots,"default")]),_:3},8,["placement"])],2)}}},jv=["href"],Lv={__name:"IDropdownItem",props:{active:Boolean,disabled:Boolean,icon:String,prependIcon:Boolean,href:String,text:String,to:[Object,String]},emits:["click"],setup(e,{emit:t}){const n=e,a=Me("hide"),r=Qe(),i=V(()=>n.href?n.href:n.to?r.resolve(n.to).href:"#");function u(c){n.disabled||((!n.to&&!n.href||n.to)&&c.preventDefault(),n.to&&r.push(n.to),t("click",c),n.href||a())}return(c,m)=>{const p=v("Icon");return d(),R(l(Lr),{disabled:e.disabled},{default:b(({active:f})=>[o("a",{href:i.value,class:X(["group block px-4 py-2 text-sm focus:outline-none",{"group flex items-center":e.icon},{"justify-between":e.icon&&e.prependIcon},f||e.active?"bg-neutral-100/80 text-neutral-700 hover:text-neutral-900 dark:bg-neutral-700 dark:text-neutral-100 dark:hover:text-white":"text-neutral-700 dark:text-neutral-100 dark:hover:text-white",e.disabled?"pointer-events-none opacity-50":null]),onClick:u},[e.icon&&!e.prependIcon?(d(),R(p,{key:0,icon:e.icon,class:X(["mr-2 h-5 w-5 shrink-0",f||e.active?"":"text-neutral-500 group-hover:text-neutral-600 dark:text-neutral-300 dark:group-hover:text-neutral-100"])},null,8,["icon","class"])):O("",!0),de(c.$slots,"default",{},()=>[Q(S(e.text),1)]),e.icon&&e.prependIcon?(d(),R(p,{key:1,icon:e.icon,class:X(["ml-2 mt-px h-5 w-5 shrink-0",f||e.active?"":"text-neutral-500 group-hover:text-neutral-600 dark:text-neutral-300 dark:group-hover:text-neutral-100"])},null,8,["icon","class"])):O("",!0)],10,jv)]),_:3},8,["disabled"])}}},Hv={class:"py-1"},Gv=Object.assign({inheritAttrs:!1},{__name:"IMinimalDropdown",props:{type:{default:"vertical",type:String}},setup(e){const t=e,n=V(()=>t.type==="horizontal"?"DotsHorizontal":"DotsVertical");return(a,r)=>{const i=v("IButtonIcon"),u=v("IDropdown");return d(),R(u,Re({"no-caret":"",full:!1},a.$attrs),{toggle:b(({toggle:c})=>[s(i,{icon:n.value,onClick:c},null,8,["icon","onClick"])]),default:b(()=>[o("div",Hv,[de(a.$slots,"default")])]),_:3},16)}}}),Kv={install(e){e.component("IDropdown",Mv),e.component("IDropdownItem",Lv),e.component("IMinimalDropdown",Gv),e.component("IDropdownButton",Uv),e.component("IDropdownButtonGroup",Pv)}},Yv={class:"flex items-start space-x-2"},Wv={class:"flex h-5 items-center"},Qv=["id","name","disabled","checked","value"],Xv={__name:"IFormCheckbox",props:{name:String,label:String,description:String,swatchColor:String,checked:[Array,String,Boolean,Number],value:{default:!0},uncheckedValue:{default:!1},disabled:Boolean,id:{type:String,default(){return qt()}}},emits:["update:checked","change"],setup(e,{emit:t}){const n=e,a=V(()=>pa(n.checked)?!!n.checked.filter(i=>String(i)===String(n.value))[0]||!1:n.checked==n.value);function r(i){const u=n.checked,c=i.target.checked;if(pa(u)){let p=Hr(u);c?p.push(n.value):p.splice(Xe(p,f=>String(f)===String(n.value)),1),t("update:checked",p),t("change",p);return}let m=c===!0?n.value:n.uncheckedValue;t("update:checked",m),t("change",m)}return(i,u)=>{const c=v("IFormLabel"),m=v("IFormText");return d(),k("div",Yv,[o("div",Wv,[o("input",{id:e.id,name:e.name,type:"checkbox",disabled:e.disabled,checked:a.value,value:e.value,class:"form-check dark:bg-neutral-700",onChange:r},null,40,Qv)]),o("div",null,[s(c,{for:e.id},{default:b(()=>[(d(),R(We(e.swatchColor?zt:"span"),{color:e.swatchColor||void 0,class:X(e.swatchColor?"inline-flex items-center justify-center rounded-full px-2.5 font-normal leading-5 dark:!text-white":null)},{default:b(()=>[de(i.$slots,"default",{},()=>[Q(S(e.label),1)])]),_:3},8,["color","class"]))]),_:3},8,["for"]),e.description?(d(),R(m,{key:0,id:e.id+"description",class:"mt-1",textContent:S(e.description)},null,8,["id","textContent"])):O("",!0)])])}}},Zv={},Jv={class:"mt-2 text-sm text-danger-600 dark:text-danger-500"};function eb(e,t){return d(),k("p",Jv,[de(e.$slots,"default")])}const tb=ct(Zv,[["render",eb]]),nb={class:"mb-3"},ob={key:1,class:"flex"},lb={class:"mb-px self-end text-xs text-neutral-600 dark:text-neutral-200"},ab={__name:"IFormGroup",props:{label:String,labelFor:String,description:String,optional:Boolean,required:Boolean},setup(e){return(t,n)=>{const a=v("IFormLabel"),r=v("IFormText"),i=ae("t");return d(),k("div",nb,[de(t.$slots,"label",{label:e.label,labelFor:e.labelFor},()=>[!e.optional&&e.label?(d(),R(a,{key:0,for:e.labelFor,label:e.label,required:e.required,class:"mb-1"},null,8,["for","label","required"])):e.label?(d(),k("div",ob,[s(a,{class:"mb-1 grow",for:e.labelFor,label:e.label},null,8,["for","label"]),D(o("span",lb,null,512),[[i,"core::app.optional"]])])):O("",!0)]),de(t.$slots,"default"),e.description?(d(),R(r,{key:0,class:"mt-2",textContent:S(e.description)},null,8,["textContent"])):O("",!0)])}}},ps={id:String,name:String,disabled:Boolean,autofocus:Boolean,required:Boolean,tabindex:[String,Number]},fs={modelValue:[String,Number],autocomplete:String,maxlength:[String,Number],minlength:[String,Number],pattern:String,placeholder:String,...ps};function vs(e,t,n){const a=q(null);function r(y){t("blur",y),n.value!==a.value&&t("change",n.value)}function i(y){t("focus",y),a.value=n.value}function u(y){t("keyup",y)}function c(y){t("keydown",y)}function m(){e.value.blur()}function p(){e.value.click()}function f(y){e.value.focus(y)}function h(){e.value.select()}function g(y){e.value.setRangeText(y)}return{setRangeText:g,select:h,focus:f,click:p,blur:m,keydownHandler:c,keyupHandler:u,blurHandler:r,focusHandler:i,valueWhenFocus:a}}const sb=["id","name","disabled","autocomplete","autofocus","type","tabindex","required","placeholder","pattern","minlength","maxlength","min","max"],rb={__name:"IFormInput",props:{rounded:{default:!0,type:Boolean},bordered:{default:!0,type:Boolean},type:{type:String,default:"text"},max:{type:[String,Number],default:void 0},min:{type:[String,Number],default:void 0},size:{type:[String,Boolean],default:"",validator(e){return["sm","lg","md","",!1].includes(e)}},...fs},emits:["update:modelValue","focus","blur","input","keyup","keydown","change"],setup(e,{expose:t,emit:n}){const a=e,r=q(null),i=V({get:()=>a.modelValue,set:F=>n("update:modelValue",F)}),{setRangeText:u,select:c,focus:m,click:p,blur:f,keydownHandler:h,keyupHandler:g,blurHandler:y,focusHandler:_}=vs(r,n,i);function I(F){n("input",F.target.value)}return t({setRangeText:u,select:c,focus:m,click:p,blur:f,inputRef:r}),(F,$)=>D((d(),k("input",{id:F.id,ref_key:"inputRef",ref:r,"onUpdate:modelValue":$[0]||($[0]=C=>i.value=C),name:F.name,disabled:F.disabled,autocomplete:F.autocomplete,autofocus:F.autofocus,type:e.type,tabindex:F.tabindex,required:F.required,placeholder:F.placeholder,pattern:F.pattern,minlength:F.minlength,maxlength:F.maxlength,min:e.min,max:e.max,class:X(["form-input dark:bg-neutral-700 dark:text-white dark:placeholder-neutral-400",{"form-input-sm":e.size==="sm","form-input-lg":e.size==="lg",rounded:e.rounded&&e.size==="sm","rounded-md":e.rounded&&e.size!=="sm"&&e.size!==!1,"border-neutral-300 dark:border-neutral-500":e.bordered,"border-transparent":!e.bordered}]),onBlur:$[1]||($[1]=(...C)=>l(y)&&l(y)(...C)),onFocus:$[2]||($[2]=(...C)=>l(_)&&l(_)(...C)),onKeyup:$[3]||($[3]=(...C)=>l(g)&&l(g)(...C)),onKeydown:$[4]||($[4]=(...C)=>l(h)&&l(h)(...C)),onInput:I},null,42,sb)),[[Gr,i.value]])}},ib=Object.assign({inheritAttrs:!1},{__name:"IFormInputDropdown",props:{width:String,height:String,maxHeight:String,inputId:{type:String,default:"input-dropdown"},modelValue:String,placeholder:String,items:Array,disabled:Boolean,full:{type:Boolean,default:!0}},emits:["update:modelValue","blur","cleared","shown"],setup(e,{emit:t}){const n=e,a=q(!1),r=dt(n.modelValue),i=q(null),u=q(null);ge(r,_=>{_!==n.modelValue&&t("update:modelValue",_)}),ge(()=>n.modelValue,_=>{_!==r.value&&(r.value=_)});function c(){a.value||(u.value.show(),a.value=!0,t("shown"))}function m(_){c()}function p(_){setTimeout(()=>t("blur"),500)}function f(){u.value.hide(),a.value=!1}function h(_){f(),r.value=_}function g(_){return _===r.value}function y(){r.value="",t("cleared"),i.value.focus(),c()}return(_,I)=>{const F=v("IFormInput"),$=v("Icon"),C=v("IDropdownItem"),w=v("IDropdown");return d(),R(w,{ref_key:"dropdownRef",ref:u,"adaptive-width":"",full:e.full,"popper-class":"bg-white rounded-md dark:bg-neutral-800"},{toggle:b(({toggle:x})=>[o("div",{style:st({width:e.width}),class:X(["relative",{"pointer-events-none":e.disabled}])},[s(F,Re({id:e.inputId},_.$attrs,{ref_key:"inputRef",ref:i,modelValue:r.value,"onUpdate:modelValue":I[0]||(I[0]=A=>r.value=A),autocomplete:"off",class:["pointer-events-none pr-8",{"sm:pointer-events-auto":!e.disabled}],disabled:e.disabled,placeholder:e.placeholder,onClick:A=>(x(),m()),onBlur:p}),null,16,["id","modelValue","class","disabled","placeholder","onClick"]),D(s($,{icon:"X",class:"absolute right-3 top-2.5 h-5 w-5 cursor-pointer text-neutral-400 hover:text-neutral-600 dark:text-neutral-200 dark:hover:text-neutral-400",onClick:y},null,512),[[Y,!!r.value]])],6)]),default:b(()=>[o("div",{style:st([{height:e.height,"overflow-y":e.maxHeight?"scroll":null,"max-height":e.maxHeight||"auto"}])},[(d(!0),k(te,null,re(e.items,(x,A)=>(d(),R(C,{key:A,active:g(x),text:x,onClick:N=>h(x)},null,8,["active","text","onClick"]))),128))],4)]),_:1},8,["full"])}}}),ub={key:0,class:"mr-1 text-sm text-danger-600"},db={__name:"IFormLabel",props:{tag:{default:"label",type:[String,Object]},label:String,required:Boolean},setup(e){const t=e,n=Fl(),a=V(()=>t.required&&(t.label||n.default()));return(r,i)=>(d(),R(We(e.tag),{class:"block text-sm font-medium text-neutral-700 dark:text-neutral-100"},{default:b(()=>[a.value?(d(),k("span",ub,"*")):O("",!0),de(r.$slots,"default",{},()=>[Q(S(e.label),1)])]),_:3}))}},cb={currency:{type:String,default:""},max:{type:Number,default:Number.MAX_SAFE_INTEGER||9007199254740991},min:{type:Number,default:Number.MIN_SAFE_INTEGER||-9007199254740991},minus:Boolean,placeholder:{type:String,default:""},emptyValue:{type:[Number,String],default:""},precision:{type:Number,default:()=>Number(Innoclapps.config("currency.precision"))},separator:{type:String,default:","},thousandSeparator:{default:()=>Innoclapps.config("currency.thousands_separator"),type:String},decimalSeparator:{default:()=>Innoclapps.config("currency.decimal_mark"),type:String},outputType:{type:String,default:"Number"},modelValue:{type:[Number,String],default:"",required:!0},disabled:Boolean,currencySymbolPosition:{type:String,default:"prefix"}},mb=Object.assign({inheritAttrs:!1},{__name:"IFormNumericInput",props:cb,emits:["change","blur","focus","update:modelValue"],setup(e,{emit:t}){const n=e,a=q(""),r=q(null);let i=null;const u=V(()=>C(a.value)),c=V(()=>C(n.modelValue,".")),m=V(()=>typeof n.decimalSeparator<"u"?n.decimalSeparator:n.separator===","?".":","),p=V(()=>typeof n.thousandSeparator<"u"?n.thousandSeparator:n.separator==="."?".":n.separator==="space"?" ":","),f=V(()=>n.currency?n.currencySymbolPosition==="suffix"?"%v %s":"%s %v":"%v");ge(c,x=>{r.value.inputRef!==document.activeElement&&(a.value=$(x))}),ge([()=>n.separator,()=>n.currency,()=>n.precision],()=>{I(c.value),a.value=$(c.value)}),De(()=>{(c.value||w())&&(I(c.value),a.value=$(c.value),i=setTimeout(()=>{I(c.value),a.value=$(c.value)},500))}),bt(()=>{i&&clearTimeout(i)});function h(x){t("change",x)}function g(x){t("blur",x),a.value=$(c.value)}function y(x){t("focus",x),c.value===0?a.value=null:a.value=_l(c.value,{symbol:"",format:"%v",thousand:"",decimal:m.value,precision:Number(n.precision)})}function _(x){I(u.value)}function I(x){x>=n.max&&F(n.max),x<=n.min&&F(n.min),x>n.min&&x<n.max&&F(x),!n.minus&&x<0&&(n.min>=0?F(n.min):F(0))}function F(x){const A=La(x,n.precision),N=n.outputType.toLowerCase()==="string"?A:Number(A);t("update:modelValue",N)}function $(x){return _l(x,{symbol:n.currency,format:f.value,precision:Number(n.precision),decimal:m.value,thousand:p.value})}function C(x,A){const N=typeof x=="string"&&x===""?n.emptyValue:x;return Kr(N,A||m.value)}function w(){return c.value===0&&n.modelValue!==""}return(x,A)=>{const N=v("IFormInput");return d(),R(N,Re({ref_key:"inputRef",ref:r,modelValue:a.value,"onUpdate:modelValue":A[0]||(A[0]=T=>a.value=T),placeholder:x.placeholder,disabled:x.disabled},x.$attrs,{type:"tel",onBlur:g,onInput:_,onFocus:y,onChange:h}),null,16,["modelValue","placeholder","disabled"])}}}),pb={class:"flex items-start"},fb=["id","name","value","disabled"],vb={__name:"IFormRadio",props:{name:String,label:String,description:String,swatchColor:String,modelValue:{},value:{},disabled:Boolean,id:{type:[String,Number],default(){return qt()}}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,a=dt(null);ge(()=>n.modelValue,i=>{a.value=i});function r(i){let u=i.target.value;u==="on"&&n.value===null&&(u=null),u==="false"?u=!1:u==="true"&&(u=!0),t("update:modelValue",u),t("change",u)}return De(()=>a.value=n.modelValue),(i,u)=>{const c=v("IFormLabel"),m=v("IFormText");return d(),k("div",pb,[D(o("input",{id:e.id,"onUpdate:modelValue":u[0]||(u[0]=p=>a.value=p),name:e.name,type:"radio",value:e.value,disabled:e.disabled,class:"form-radio dark:bg-neutral-700",onChange:r},null,40,fb),[[Yr,a.value]]),s(c,{for:e.id,class:"-mt-0.5 ml-2"},{default:b(()=>[(d(),R(We(e.swatchColor?zt:"span"),{color:e.swatchColor||void 0,class:X(e.swatchColor?"inline-flex items-center justify-center rounded-full px-2.5 font-normal leading-5 dark:!text-white":null)},{default:b(()=>[de(i.$slots,"default",{},()=>[Q(S(e.label),1)])]),_:3},8,["color","class"]))]),_:3},8,["for"]),e.description?(d(),R(m,{key:0,id:e.id+"description",class:"mt-1"},{default:b(()=>[Q(S(e.description),1)]),_:1},8,["id"])):O("",!0)])}}},bb=["id","name","autofocus","placeholder","tabindex","disabled","required","multiple","value"],hb={__name:"IFormSelect",props:{modelValue:{},placeholder:String,multiple:Boolean,rounded:{default:!0,type:Boolean},bordered:{default:!0,type:Boolean},size:{type:[String,Boolean],default:"",validator(e){return["sm","lg","",!0,!1].includes(e)}},...ps},emits:["update:modelValue","focus","blur","input","change"],setup(e,{expose:t,emit:n}){const a=q(null);function r(f){n("update:modelValue",f.target.value),n("change",f.target.value)}function i(f){n("input",f.target.value)}function u(f){n("blur",f)}function c(f){n("focus",f)}function m(){a.value.blur()}function p(f){a.value.focus(f)}return t({blur:m,focus:p}),(f,h)=>(d(),k("select",{id:f.id,ref_key:"selectRef",ref:a,name:f.name,autofocus:f.autofocus,placeholder:e.placeholder,tabindex:f.tabindex,disabled:f.disabled,required:f.required,multiple:e.multiple,class:X(["form-select dark:bg-neutral-700 dark:text-white",{"form-select-sm":e.size==="sm","form-select-lg":e.size==="lg",rounded:e.rounded&&e.size==="sm","rounded-md":e.rounded&&e.size!=="sm","border-neutral-300 dark:border-neutral-500":e.bordered,"border-transparent":!e.bordered}]),value:e.modelValue,onBlur:u,onFocus:c,onInput:i,onChange:r},[de(f.$slots,"default")],42,bb))}},_b={},gb={class:"text-sm text-neutral-500 dark:text-neutral-300"};function yb(e,t){return d(),k("p",gb,[de(e.$slots,"default")])}const xb=ct(_b,[["render",yb]]),Ib=["id","name","tabindex","autocomplete","autofocus","required","placeholder","pattern","wrap","minlength","maxlength","rows","cols","disabled"],kb={__name:"IFormTextarea",props:{rows:[String,Number],cols:[String,Number],wrap:{type:String,default:"soft"},bordered:{type:Boolean,default:!0},resizeable:{type:Boolean,default:!0},minHeight:{default:60,type:[String,Number]},...fs},emits:["update:modelValue","focus","blur","input","change","keyup","keydown"],setup(e,{expose:t,emit:n}){const a=e,r=q(null),i=V({get:()=>a.modelValue,set:w=>n("update:modelValue",w)}),{setRangeText:u,select:c,focus:m,click:p,blur:f,keydownHandler:h,keyupHandler:g,blurHandler:y,valueWhenFocus:_}=vs(r,n,i);let I=null;function F(w){w.target.style.height="auto",w.target.style.height=w.target.scrollHeight+"px"}function $(w){a.resizeable&&F(w),n("input",w.target.value)}function C(w){n("focus",w),a.resizeable&&F(w),_.value=i.value}return De(()=>{a.resizeable&&Fe(()=>{I=setTimeout(()=>{r.value.setAttribute("style","height:"+(r.value.scrollHeight||a.minHeight)+"px;")},400)})}),bt(()=>{I&&clearTimeout(I)}),t({setRangeText:u,select:c,focus:m,click:p,blur:f}),(w,x)=>D((d(),k("textarea",{id:w.id,ref_key:"textareaRef",ref:r,"onUpdate:modelValue":x[0]||(x[0]=A=>i.value=A),name:w.name,tabindex:w.tabindex,autocomplete:w.autocomplete,autofocus:w.autofocus,required:w.required,placeholder:w.placeholder,pattern:w.pattern,wrap:e.wrap,minlength:w.minlength,maxlength:w.maxlength,rows:e.rows,cols:e.cols,disabled:w.disabled,class:X([{"resize-none overflow-y-hidden":e.resizeable,"border-neutral-300 dark:border-neutral-500":e.bordered,"border-transparent":!e.bordered},"form-textarea rounded-md dark:bg-neutral-700 dark:text-white dark:placeholder-neutral-400"]),onBlur:x[1]||(x[1]=(...A)=>l(y)&&l(y)(...A)),onFocus:C,onKeyup:x[2]||(x[2]=(...A)=>l(g)&&l(g)(...A)),onKeydown:x[3]||(x[3]=(...A)=>l(h)&&l(h)(...A)),onInput:$},null,42,Ib)),[[Zt,i.value]])}},$b={__name:"IFormToggle",props:{label:String,modelValue:{},labelClass:[Array,String,Object],disabled:Boolean,value:{default:!0},uncheckedValue:{default:!1}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,a=q(!1);return ge(a,r=>{const i=r===!0?n.value:n.uncheckedValue;i!=n.modelValue&&(t("update:modelValue",i),t("change",i))}),ge(()=>n.modelValue,r=>{a.value=r==n.value},{immediate:!0}),(r,i)=>(d(),R(l(Xr),{as:"div",class:"flex items-center"},{default:b(()=>[e.label?(d(),R(l(Wr),{key:0,class:X([e.labelClass,"mr-4 text-sm text-neutral-800 dark:text-neutral-100"]),textContent:S(e.label)},null,8,["class","textContent"])):O("",!0),s(l(Qr),{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=u=>a.value=u),class:X([a.value?"bg-primary-600":"bg-neutral-200 dark:bg-neutral-500",e.disabled?"pointer-events-none opacity-60":"","relative inline-flex h-5 w-10 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"])},{default:b(()=>[o("span",{"aria-hidden":"true",class:X([a.value?"translate-x-5 dark:bg-neutral-300":"translate-x-0 dark:bg-neutral-400","pointer-events-none inline-block h-4 w-4 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"])},null,2)]),_:1},8,["modelValue","class"])]),_:1}))}},wb={install(e){e.component("IFormGroup",ab),e.component("IFormLabel",db),e.component("IFormError",tb),e.component("IFormText",xb),e.component("IFormInput",rb),e.component("IFormNumericInput",mb),e.component("IFormSelect",hb),e.component("IFormTextarea",kb),e.component("IFormCheckbox",Xv),e.component("IFormRadio",vb),e.component("IFormToggle",$b),e.component("IFormInputDropdown",ib)}},Cb={class:"text-sm text-neutral-400 dark:text-neutral-200"},Sb={__name:"IActionMessage",props:["message"],setup(e){return(t,n)=>(d(),k("div",null,[s(Vl,{"leave-active-class":"transition ease-in duration-1000","leave-class":"opacity-100","leave-to-class":"opacity-0"},{default:b(()=>[o("small",Cb,[de(t.$slots,"default",{},()=>[Q(S(e.message),1)])])]),_:3})]))}},Rb={class:"shrink-0"},Fb={class:"ml-3"},Vb=["textContent"],Tb={key:0,class:"ml-auto pl-3"},Db={class:"-mx-1.5 -my-1.5"},Do={__name:"IAlert",props:{heading:String,show:{type:Boolean,default:!0},dismissible:Boolean,rounded:{type:Boolean,default:!0},icon:String,wrapperClass:[Array,Object,String],variant:{default:"info",type:String,validator(e){return["success","info","warning","danger"].includes(e)}}},emits:["dismissed"],setup(e,{emit:t}){const n=e,a={warning:{bg:"bg-warning-50",text:"text-warning-700",heading:"text-warning-800",icon:"text-warning-400"},danger:{bg:"bg-danger-50",text:"text-danger-700",heading:"text-danger-800",icon:"text-danger-400"},success:{bg:"bg-success-50",text:"text-success-700",heading:"text-success-800",icon:"text-success-400"},info:{bg:"bg-info-50",text:"text-info-700",heading:"text-info-800",icon:"text-info-400"}},r={warning:"ExclamationTriangle",danger:"XCircle",success:"CheckCircle",info:"InformationCircle"},i=q(!1),u=V(()=>i.value?!1:n.show);function c(){i.value=!0,t("dismissed")}return(m,p)=>{const f=v("Icon");return D((d(),k("div",{class:X(["p-4",a[e.variant].bg,{"rounded-md":e.rounded}])},[o("div",{class:X(["flex",e.wrapperClass])},[o("div",Rb,[s(f,{icon:e.icon||r[e.variant],class:X(["h-5 w-5",a[e.variant].icon])},null,8,["icon","class"])]),o("div",Fb,[D(o("h3",{class:X(["text-sm font-medium",a[e.variant].heading]),textContent:S(e.heading)},null,10,Vb),[[Y,e.heading]]),o("div",{class:X(["text-sm",[a[e.variant].text,{"mt-2":e.heading}]])},[de(m.$slots,"default")],2)]),e.dismissible?(d(),k("div",Tb,[o("div",Db,[o("button",{type:"button",class:"inline-flex p-1.5 text-neutral-500 hover:opacity-50 focus:outline-none",onClick:c},[s(f,{icon:"X",class:"h-5 w-5"})])])])):O("",!0)],2)],2)),[[Y,u.value]])}}},qb=["src"],Eb={__name:"IAvatar",props:{src:{type:String,required:!0},size:{default:"sm",type:String,validator(e){return["xs","sm","lg"].includes(e)}}},setup(e){const t=e,n={xs:"h-5 w-5",sm:"h-8 w-8",lg:"h-10 w-10"},a=V(()=>["inline-block rounded-full",n[t.size]]);return(r,i)=>(d(),k("img",{class:X(a.value),src:e.src},null,10,qb))}},Ab=Object.assign({inheritAttrs:!1},{__name:"IBadge",props:{variant:{default:"neutral",type:String},rounded:{type:Boolean,default:!0},text:[String,Number],wrapperClass:[String,Array,Object],size:{default:"sm",type:String,validator(e){return["sm","lg","circle"].includes(e)}}},setup(e){const t=e,n={neutral:"bg-neutral-200 text-neutral-700 border border-neutral-300",primary:"bg-primary-100 text-primary-800 border border-primary-200",success:"bg-success-100 text-success-800 border border-success-200",info:"bg-info-100 text-info-800 border border-info-200",warning:"bg-warning-100 text-warning-800 border border-warning-200",danger:"bg-danger-100 text-danger-800 border border-danger-200"},a={sm:"px-2.5 py-0.5 text-xs",lg:"px-3 py-0.5 text-sm",circle:"px-1 min-h-full min-w-full justify-center text-xs"},r=V(()=>["inline-flex items-center font-medium",n[t.variant],a[t.size],t.rounded||t.size==="circle"?"rounded-full":null]);return(i,u)=>(d(),k("span",{class:X([e.wrapperClass,e.size==="circle"?"h-5 w-5":""])},[o("span",Re({class:r.value},i.$attrs),[de(i.$slots,"default",{},()=>[Q(S(e.text),1)])],16)],2))}}),Bb={class:"inline-flex flex-wrap"},Nb=["onClick"],Ob={__name:"IColorSwatch",props:{modelValue:String,allowRemove:{default:!0,type:Boolean},allowCustom:{default:!0,type:Boolean},swatches:Array},emits:["update:modelValue","input","remove-requested"],setup(e,{emit:t}){const n=e,a=V(()=>_t(n.swatches,p=>p.toLowerCase())),r=V(()=>n.modelValue?n.modelValue.toLowerCase():null),i=V(()=>!n.modelValue||!n.allowCustom?!1:a.value.filter(p=>p===r.value).length===0);function u(p){t("update:modelValue",p),t("input",p)}function c(){u(null),t("remove-requested")}const m=Dt(function(p){u(p)},500);return(p,f)=>{const h=v("Icon"),g=v("IFormInput");return d(),k("div",Bb,[(d(!0),k(te,null,re(a.value,y=>(d(),k("button",{key:y,type:"button",class:X([{"ring ring-offset-1":y===r.value},"mb-2 mr-1 flex h-8 w-8 items-center justify-center rounded"]),style:st({backgroundColor:y}),onClick:_=>u(y)},[y===r.value?(d(),R(h,{key:0,icon:"Check",class:"h-5 w-5",style:st({color:l(Vn)(y)})},null,8,["style"])):O("",!0)],14,Nb))),128)),s(g,{class:X(["mr-1 h-8 w-8 rounded p-0",{"border-primary-500 ring-primary-500":i.value}]),type:"color",rounded:!1,"model-value":i.value?r.value:null,onInput:l(m)},null,8,["class","model-value","onInput"]),D(o("button",{type:"button",class:"mb-2 mr-1 flex h-8 w-8 items-center justify-center rounded border border-neutral-300 bg-neutral-100 hover:bg-neutral-300",onClick:c},[s(h,{icon:"X",class:"h-5 w-5"})],512),[[Y,e.allowRemove&&e.modelValue]])])}}},zb={components:{EyeIcon:Zr,SparklesIcon:Jr,CheckBadgeIcon:ei,BanknotesIcon:ti,ClockIcon:ni,CodeBracketIcon:oi,RocketLaunchIcon:li,ChatBubbleBottomCenterTextIcon:ai,ViewfinderCircleIcon:si,SunIcon:ri,MoonIcon:ii,SpeakerphoneIcon:ui,VolumeOffIcon:di,VolumeUpIcon:ci,EmojiHappyIcon:mi,EmojiSadIcon:pi,ArrowRightIcon:fi,ArrowLeftIcon:vi,ReplyIcon:bi,CurrencyDollarIcon:hi,CursorClickIcon:_i,FilterIcon:gi,ShareIcon:yi,ListBulletIcon:xi,CogIcon:Ii,CollectionIcon:ki,ColorSwatchIcon:$i,HomeIcon:wi,LightBulbIcon:Ci,Bars3CenterLeftIcon:Si,Bars3BottomLeftIcon:Ri,MenuAlt3Icon:Fi,PhotographIcon:Vi,PlusIcon:Ti,MinusIcon:Di,MicrophoneIcon:qi,UserGroupIcon:Ei,ViewGridIcon:Ai,XIcon:Bi,SearchSolidIcon:Ni,ChartSquareBarIcon:Oi,MailIcon:zi,CalendarIcon:Mi,UsersIcon:Ui,UserIcon:Pi,OfficeBuildingIcon:ji,FolderIcon:Li,CheckCircleIcon:Hi,CheckCircleSolidIcon:Gi,CheckIcon:Ki,XCircleIcon:Yi,XCircleSolidIcon:Wi,InformationCircleIcon:Qi,ChevronUpIcon:Xi,ChevronDownIcon:Zi,ChevronLeftIcon:Ji,ChevronRightIcon:eu,ExclamationTriangleIcon:tu,ShieldExclamationIcon:nu,ShieldCheckIcon:ou,SquaresPlusIcon:lu,QuestionMarkCircleIcon:au,SelectorIcon:su,BellIcon:ru,ArrowsPointingOutIcon:iu,RefreshIcon:uu,DuplicateIcon:du,GlobeIcon:cu,DeviceMobileIcon:mu,PhoneIcon:pu,PhoneXMarkIcon:fu,AdjustmentsVerticalIcon:vu,WindowIcon:bu,DotsVerticalIcon:hu,DotsHorizontalIcon:_u,DocumentDownloadIcon:gu,DocumentAddIcon:yu,DocumentIcon:xu,DocumentTextIcon:Iu,ArrowDownLeftIcon:ku,DownloadIcon:$u,ExternalLinkIcon:wu,LinkIcon:Cu,TrashIcon:Su,PencilAltIcon:Ru,PencilIcon:Fu,StarIcon:Vu,Bars3Icon:Tu,TagIcon:Du,ViewColumnsIcon:qu,SortAscendingIcon:Eu,AtSymbolIcon:Au,BriefcaseIcon:Bu,ChatIcon:Nu,ChatAltIcon:Ou,BookOpenIcon:zu,BookmarkIcon:Mu,CameraIcon:Uu,TruckIcon:Pu,CloudArrowUpIcon:ju,PaperClipIcon:Lu,ClipboardIcon:Hu,CreditCardIcon:Gu,WrenchScrewdriverIcon:Ku,ScaleIcon:Yu},props:{type:{type:String,default:"hero"},icon:{required:!0}},setup(e){function t(){return e.type==="hero"}return{isHeroIcon:t}}};function Mb(e,t,n,a,r,i){return a.isHeroIcon?(d(),R(We(`${n.icon}Icon`),{key:0,"aria-hidden":"true"})):O("",!0)}const Ub=ct(zb,[["render",Mb]]),Pb={class:"text-center"},jb=o("path",{"vector-effect":"non-scaling-stroke","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"},null,-1),Lb={class:"mt-2 text-sm font-medium text-neutral-800 dark:text-white"},Hb={class:"mt-1 text-sm text-neutral-500 dark:text-neutral-300"},Gb={class:"mt-6"},Kb={__name:"IEmptyState",props:{title:String,description:String,buttonText:String,buttonIcon:{default:"Plus",type:String},to:[Object,String],secondButtonText:String,secondButtonIcon:{default:"Plus",type:String},secondButtonVariant:{default:"secondary",type:String},secondButtonTo:[Object,String]},emits:["click","click2"],setup(e,{emit:t}){const n=Qe();function a(r,i,u){u?n.push(u):t(i,r)}return(r,i)=>{const u=v("IButton");return d(),k("div",Pb,[i[0]||(he(-1),i[0]=(d(),k("svg",{class:"mx-auto h-12 w-12 text-neutral-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},[jb])),he(1),i[0]),o("h3",Lb,S(e.title),1),o("p",Hb,S(e.description),1),o("div",Gb,[s(u,{icon:e.buttonIcon,text:e.buttonText,onClick:i[1]||(i[1]=c=>a(c,"click",e.to))},null,8,["icon","text"]),e.secondButtonText?(d(),R(u,{key:0,class:"ml-4",variant:e.secondButtonVariant,icon:e.secondButtonIcon,text:e.secondButtonText,onClick:i[2]||(i[2]=c=>a(c,"click2",e.secondButtonTo))},null,8,["variant","icon","text"])):O("",!0)])])}}},Yb={class:"flex flex-wrap space-x-1.5"},Wb=["disabled","onClick"],Qb={__name:"IIconPicker",props:{modelValue:[String,Number],label:String,disabled:Boolean,valueField:{default:"icon"},icons:{type:Array,default:function(){return[{icon:"Mail",tooltip:null},{icon:"PencilAlt",tooltip:null},{icon:"OfficeBuilding",tooltip:null},{icon:"Phone",tooltip:null},{icon:"Calendar",tooltip:null},{icon:"Collection",tooltip:null},{icon:"Bell",tooltip:null},{icon:"AtSymbol",tooltip:null},{icon:"Briefcase",tooltip:null},{icon:"Chat",tooltip:null},{icon:"CheckCircle",tooltip:null},{icon:"BookOpen",tooltip:null},{icon:"Camera",tooltip:null},{icon:"Truck",tooltip:null},{icon:"Folder",tooltip:null},{icon:"DeviceMobile",tooltip:null},{icon:"Users",tooltip:null},{icon:"CreditCard",tooltip:null},{icon:"Clock",tooltip:null},{icon:"ShieldExclamation",tooltip:null},{icon:"WrenchScrewdriver",tooltip:null}]}}},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,a=q(n.modelValue);function r(i){a.value=i,t("update:modelValue",i),t("change",i)}return ge(()=>n.modelValue,i=>{a.value=i,t("update:modelValue",a.value),t("change",a.value)}),(i,u)=>{const c=v("Icon"),m=ae("i-tooltip");return d(),k("div",Yb,[(d(!0),k(te,null,re(e.icons,p=>D((d(),k("button",{key:p[e.valueField],type:"button",disabled:e.disabled,class:X(["flex h-9 w-10 items-center justify-center rounded-md border border-neutral-300 p-1 text-neutral-800 dark:border-neutral-500  dark:text-neutral-200",a.value===p[e.valueField]?"bg-neutral-200 hover:bg-neutral-200 dark:bg-neutral-800":"bg-white hover:bg-neutral-50 dark:bg-neutral-700 dark:hover:bg-neutral-600"]),onClick:f=>r(p[e.valueField])},[s(c,{icon:p.icon,class:"h-5 w-5"},null,8,["icon"])],10,Wb)),[[m,p.tooltip]])),128))])}}},Xb={class:"absolute inset-0 z-10"},Zb=o("div",{class:"absolute inset-0 rounded-md bg-neutral-100 opacity-60 dark:bg-neutral-700"},null,-1),Jb={key:0,class:"absolute bottom-1/2 left-1/2 z-20 translate-y-1/2"},eh={__name:"IOverlay",props:{show:Boolean},setup(e){return(t,n)=>{const a=v("ISpinner");return d(),k("div",{class:X({relative:e.show})},[de(t.$slots,"default"),D(o("div",Xb,[Zb,e.show?(d(),k("div",Jb,[de(t.$slots,"overlay",{},()=>[s(a,{class:"h-5 w-5 text-primary-500 dark:text-neutral-300"})])])):O("",!0)],512),[[Y,e.show]])],2)}}},th={class:"flex justify-between"},nh=["textContent"],oh=["onClick"],lh=Object.assign({inheritAttrs:!1},{__name:"IPopover",props:{busy:Boolean,variant:{type:String,default:"white"},placement:{type:String,default:"bottom"},bordered:{type:Boolean,default:!0},arrow:{type:Boolean,default:!0},shadow:{type:Boolean,default:!0},visible:Boolean,title:String,closeable:Boolean,disabled:Boolean},emits:["show","hide","update:visible"],setup(e,{expose:t,emit:n}){const a=e,r={white:{backgroundColorClasses:"bg-white dark:bg-neutral-800",borderColorClasses:"border-neutral-200 dark:border-neutral-700"}},i=q(!1),u=q(null),c=q(null);De(()=>{jo(u,f,{ignore:[".c-popper",".c-dropdown",c.value.$el]})});function m(){i.value?f():p()}function p(){a.disabled!==!0&&(i.value=!0,n("show"),n("update:visible",!0))}function f(){a.disabled!==!0&&(i.value=!1,n("hide"),n("update:visible",!1))}return ge(()=>a.visible,(h,g)=>{h?p():g&&f()},{}),t({show:p,hide:f}),(h,g)=>{const y=v("Icon");return d(),R(l(Xu),{ref_key:"popperRef",ref:c},{default:b(()=>[s(l(Qa),Re({...h.$attrs,class:{}},{arrow:e.arrow,offset:10,"z-index":1250,placement:e.placement,portal:"",show:i.value,enter:"transition ease-out duration-100","enter-from":"transform opacity-0 scale-95","enter-to":"transform opacity-100 scale-100",leave:"transition ease-in duration-75","leave-from":"transform opacity-100 scale-100","leave-to":"transform opacity-0 scale-95"}),{default:b(()=>[s(l(Wu),{as:"template",onClick:m},{default:b(()=>[de(h.$slots,"default")]),_:3}),s(l(Qu),{ref_key:"panelRef",ref:u,static:"",class:X([h.$attrs.class,"overflow-hidden rounded-md focus:outline-none",r[e.variant].backgroundColorClasses,e.bordered?"border "+r[e.variant].borderColorClasses:"",{"shadow-lg":e.shadow}])},{default:b(()=>[e.arrow?(d(),R(l(Za),{key:0,class:X(["absolute h-5 w-5 rotate-45",r[e.variant].backgroundColorClasses,e.bordered?"border "+r[e.variant].borderColorClasses:""])},null,8,["class"])):O("",!0),o("div",{class:X(["relative rounded-md",r[e.variant].backgroundColorClasses,{"pointer-events-none opacity-60":e.busy}])},[e.title||h.$slots.title||e.closeable?(d(),k("div",{key:0,class:X([r[e.variant].backgroundColorClasses,"px-4 py-2.5",e.bordered?"border-b "+r[e.variant].borderColorClasses:""])},[o("div",th,[o("h4",{class:"text-[0.9rem] font-medium text-neutral-800 dark:text-neutral-100",textContent:S(e.title)},null,8,nh),e.closeable?(d(),k("a",{key:0,href:"#",class:"mt-0.5 text-neutral-500 hover:text-neutral-700 focus:outline-none dark:text-neutral-300 dark:hover:text-neutral-100",onClick:ie(f,["prevent"])},[s(y,{icon:"X",class:"h-5 w-5"})],8,oh)):O("",!0)])],2)):O("",!0),de(h.$slots,"popper")],2)]),_:3},8,["class"])]),_:3},16,["arrow","placement","show"])]),_:3},512)}}}),ah={},sh=o("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),rh=o("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1);function ih(e,t){return t[0]||(he(-1),t[0]=(d(),k("svg",{class:"animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[sh,rh])),he(1),t[0])}const uh=ct(ah,[["render",ih]]),dh=Object.assign({inheritAttrs:!1},{__name:"ITable",props:{maxHeight:String,condensed:Boolean,wrapperClass:[String,Object,Array],shadow:{default:!0,type:Boolean},bordered:Boolean,sticky:Boolean},setup(e,{expose:t}){const n=q(null),a=Zu(),r=V(()=>{const i={...a};return delete i.class,delete i.style,i});return t({$el:n}),(i,u)=>(d(),k("div",{ref_key:"elRef",ref:n,class:X(["table-responsive",[e.wrapperClass,{"table-sticky-header":e.sticky}]]),style:st({maxHeight:e.maxHeight})},[o("div",Re(i.$attrs.style,{class:[i.$attrs.class,{shadow:e.shadow},{"border-x border-b border-neutral-200 dark:border-neutral-800":e.bordered}]}),[o("table",Re({class:["table-primary",{"table-condensed":e.condensed,"border-separate":e.sticky}]},r.value,{style:{borderSpacing:e.sticky?0:void 0}}),[de(i.$slots,"default")],16)],16)],6))}}),ch=o("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[o("div",{class:"h-0.5 w-full bg-primary-600"})],-1),mh={class:"mt-20 shrink-0 text-sm"},ph=o("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[o("div",{class:"h-0.5 w-full bg-neutral-200"})],-1),fh=o("span",{class:"h-2.5 w-2.5 rounded-full bg-primary-600","aria-hidden":"true"},null,-1),vh={class:"mt-20 shrink-0 text-sm font-semibold"},bh=o("div",{class:"absolute inset-0 flex items-center","aria-hidden":"true"},[o("div",{class:"h-0.5 w-full bg-neutral-200"})],-1),hh=o("span",{class:"h-2.5 w-2.5 rounded-full bg-transparent group-hover:bg-neutral-300","aria-hidden":"true"},null,-1),_h={class:"mt-20 shrink-0 text-sm"},gh={__name:"IStepCircle",props:{name:String,isLast:Boolean,spacing:{type:String,default:"md",validator(e){return["md","lg","xl"].includes(e)}},status:{type:String,validator(e){return["complete","current",""].includes(e)}}},emits:["click"],setup(e){return(t,n)=>{const a=v("Icon");return d(),k("li",{class:X([e.isLast?"":{"pr-8 sm:pr-20":e.spacing==="md","pr-10 sm:pr-36":e.spacing==="lg","pr-10 sm:pr-44":e.spacing==="xl"},"relative"])},[e.status==="complete"?(d(),k(te,{key:0},[ch,o("a",{href:"#",class:"relative flex h-8 w-8 items-center justify-center rounded-full bg-primary-600 hover:bg-primary-900",onClick:n[0]||(n[0]=ie(r=>t.$emit("click",r),["prevent"]))},[s(a,{icon:"Check",class:"h-5 w-5 text-white"}),o("span",mh,S(e.name),1)])],64)):e.status==="current"?(d(),k(te,{key:1},[ph,o("a",{href:"#",class:"relative flex h-8 w-8 items-center justify-center rounded-full border-2 border-primary-600 bg-white","aria-current":"step",onClick:n[1]||(n[1]=ie(r=>t.$emit("click",r),["prevent"]))},[fh,o("span",vh,S(e.name),1)])],64)):(d(),k(te,{key:2},[bh,o("a",{href:"#",class:"group relative flex h-8 w-8 items-center justify-center rounded-full border-2 border-neutral-300 bg-white hover:border-neutral-400",onClick:n[2]||(n[2]=ie(r=>t.$emit("click",r),["prevent"]))},[hh,o("span",_h,S(e.name),1)])],64))],2)}}},yh={},xh={"aria-label":"Progress"},Ih={class:"flex items-center"};function kh(e,t){return d(),k("nav",xh,[o("ol",Ih,[de(e.$slots,"default")])])}const $h=ct(yh,[["render",kh]]),wh=["textContent"],Ch={__name:"ITab",props:{title:String,disabled:Boolean,icon:String,badge:[String,Number],badgeVariant:{default:"info",type:String}},emits:["activated"],setup(e,{emit:t}){const n=q(null),a=Ja();return ge(a,r=>{n.value.el.isEqualNode(r)&&t("activated")}),De(()=>{n.value.el.getAttribute("aria-selected")==="true"&&t("activated")}),(r,i)=>{const u=v("Icon"),c=v("IBadge");return d(),R(l(Ju),{ref_key:"tabRef",ref:n,as:"template",disabled:e.disabled},{default:b(({selected:m})=>[o("button",{type:"button","data-tab":"true",class:X([m?"border-primary-500 text-primary-600 dark:border-primary-400 dark:text-primary-300":"border-transparent text-neutral-600 hover:border-neutral-300 hover:text-neutral-800 dark:text-neutral-100 dark:hover:border-neutral-500 dark:hover:text-neutral-300","group inline-flex min-w-full shrink-0 snap-start snap-always items-center justify-center whitespace-nowrap border-b-2 px-1 py-4 text-sm font-medium focus:outline-none sm:min-w-0",{"pointer-events-none opacity-70":e.disabled}])},[e.icon?(d(),R(u,{key:0,icon:e.icon,class:X([m?"text-primary-500 dark:text-primary-300":"text-neutral-400 group-hover:text-neutral-500 dark:text-neutral-400 dark:group-hover:text-neutral-300","-ml-0.5 mr-1.5 h-5 w-5"])},null,8,["icon","class"])):O("",!0),de(r.$slots,"default",{},()=>[o("span",{textContent:S(e.title)},null,8,wh)]),e.badge?(d(),R(c,{key:1,size:"circle","wrapper-class":"ml-1.5",variant:e.badgeVariant,text:e.badge},null,8,["variant","text"])):O("",!0)],2)]),_:3},8,["disabled"])}}},Sh={__name:"ITabGroup",props:{modelValue:Number},emits:["update:modelValue"],setup(e,{emit:t}){function n(a){t("update:modelValue",a)}return(a,r)=>(d(),R(l(ed),{"selected-index":e.modelValue,onChange:n},{default:b(()=>[de(a.$slots,"default")]),_:3},8,["selected-index"]))}},Rh=["onClick"],Fh=["onClick"],Vh={__name:"ITabList",props:{responsive:{type:Boolean,default:!0},bordered:{type:[String,Boolean],default:"bottom"},listWrapperClass:[String,Array,Object],fill:Boolean,centered:Boolean},setup(e){let t=null;const n=q(!1),a=q(!0),r=q(null);function i(){return r.value.$el.querySelector("button:first-child")}function u(){return r.value.$el.querySelector("button:last-child")}function c(){r.value.$el.scrollLeft-=i().offsetWidth}function m(){r.value.$el.scrollLeft+=u().offsetWidth}function p(){t.unobserve(i()),t.unobserve(u())}function f(y){y.forEach(_=>{_.target==u()?n.value=_.isIntersecting:_.target==i()&&(a.value=_.isIntersecting,n.value=!1)})}function h(){t=new IntersectionObserver(f,{root:r.value.$el,threshold:1})}function g(){h(),Fe(()=>{t.observe(i()),t.observe(u())})}return De(()=>{g()}),bt(()=>{p(),t=null}),(y,_)=>{const I=v("Icon");return d(),k("div",{class:X([e.bordered?"border-neutral-200 dark:border-neutral-700":"",{"border-b":e.bordered==="bottom"||e.bordered===!0},{"border-y":e.bordered==="vertical"},{"border-t":e.bordered==="top"}])},[o("div",{class:X(["flex items-center",e.listWrapperClass,{"justify-center":e.centered}])},[o("a",{href:"#",class:X([{"pointer-events-none opacity-50":a.value},"block px-1 text-neutral-500 dark:text-neutral-200 sm:hidden"]),onClick:ie(c,["prevent"])},[s(I,{icon:"ChevronLeft",class:"h-6 w-6"})],10,Rh),s(l(td),{ref_key:"listRef",ref:r,class:X(["overlow-y-hidden -mb-px flex grow snap-x snap-mandatory overflow-x-auto scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-300 sm:space-x-4 sm:px-4",{"justify-around":e.fill,"sm:grow-0":!e.fill}])},{default:b(()=>[de(y.$slots,"default")]),_:3},8,["class"]),o("a",{href:"#",class:X(["block px-1 text-neutral-500 dark:text-neutral-200 sm:hidden",{"pointer-events-none opacity-50":n.value}]),onClick:ie(m,["prevent"])},[s(I,{icon:"ChevronRight",class:"h-6 w-6"})],10,Fh)],2)],2)}}},Th={__name:"ITabPanel",props:{lazy:Boolean},emits:["activated"],setup(e,{emit:t}){const n=Ja(),a=q(null);return ge(n,r=>{!a.value.el||a.value.$||r.dataset.tab&&r.id===a.value.$el.getAttribute("aria-labelledby")&&t("activated")},{flush:"post"}),De(()=>{!a.value.el.$&&a.value.el.dataset.headlessuiState==="selected"&&t("activated")}),(r,i)=>(d(),R(l(nd),{ref_key:"panelRef",ref:a,unmount:e.lazy,class:"focus:outline-none"},{default:b(()=>[de(r.$slots,"default")]),_:3},8,["unmount"]))}},Dh={__name:"ITabPanels",setup(e){return(t,n)=>(d(),R(l(od),{class:"py-2 sm:py-4"},{default:b(()=>[de(t.$slots,"default")]),_:3}))}},qh={install(e){e.component("ITabGroup",Sh),e.component("ITabList",Vh),e.component("ITab",Ch),e.component("ITabPanels",Dh),e.component("ITabPanel",Th)}};class Eh{constructor(t){this.el=t.el,this.rootComponent=t.rootComponent,this.props=(t==null?void 0:t.props)??{},this.appContext={...(t==null?void 0:t.appContext)??{}}}mount(){const t=s(this.rootComponent,this.props);fa(t,this.el)}unmount(){fa(null,this.el)}}const Ia={__name:"ITooltip",props:{delay:{type:Number,default:300},offset:{type:Number,default:8}},setup(e){const t=e,n={dark:{wrapper:"border border-neutral-900/90 shadow-lg bg-neutral-900/90",inner:"bg-neutral-900/90",content:"text-white",arrow:"border border-neutral-900/90 bg-neutral-900/90"},light:{wrapper:"border border-neutral-200 dark:border-neutral-700 shadow-lg bg-white dark:bg-neutral-800",inner:"bg-white dark:bg-neutral-800",content:"text-neutral-700 dark:text-neutral-200",arrow:"border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-800"}},a=q(),r=q(),i=q(""),u=q("dark"),c=q(null),m=q(null),p=g=>{const y=g.target.closest("[v-tooltip]");m.value&&(clearTimeout(m.value),m.value=null),c.value!==y&&(c.value=null),y&&(m.value=setTimeout(()=>{c.value=y},t.delay))},f=async()=>{if(!c.value)return;await Fe();const g=c.value.getAttribute("v-tooltip-placement");u.value=c.value.getAttribute("v-tooltip-variant"),i.value=c.value.getAttribute("v-tooltip")||"";const y={placement:g,middleware:[Wa(t.offset),ld(),ad({element:a.value})]};sd(c.value,r.value,y).then(({x:_,y:I,placement:F,middlewareData:$})=>{var w,x;Object.assign(r.value.style,{left:`${_}px`,top:`${I}px`});const C={top:"bottom",right:"left",bottom:"top",left:"right"}[F.split("-")[0]];Object.assign(a.value.style,{...((w=$.arrow)==null?void 0:w.y)&&{top:`${$.arrow.y}px`},...((x=$.arrow)==null?void 0:x.x)&&{left:`${$.arrow.x}px`},right:"",bottom:"",[C]:"-0.25rem"})})},h=()=>{c.value=null,i.value=null};return ge(c,async g=>{g?await f():h()}),De(()=>{document.addEventListener("mouseover",p)}),bt(()=>{m.value&&clearTimeout(m.value),document.removeEventListener("mouseover",p)}),(g,y)=>(d(),R(gn,{to:"body"},[o("div",{ref_key:"tooltipRef",ref:r,class:"pointer-events-none absolute left-0 top-0 z-[1300]"},[s(Vl,{"enter-active-class":"duration-200 ease","enter-from-class":"transform opacity-0","leave-to-class":"transform opacity-0"},{default:b(()=>[c.value?(d(),k("div",{key:0,class:X(["overflow-hidden rounded-md",n[u.value].wrapper])},[o("div",{ref_key:"arrowRef",ref:a,class:X([n[u.value].arrow,"absolute h-2 w-2 rotate-45"])},null,2),o("div",{class:X(["relative max-w-sm",n[u.value].inner])},[o("div",{class:X(["px-4 py-1.5 text-center text-sm",n[u.value].content])},S(i.value),3)],2)],2)):O("",!0)]),_:1})],512)]))}},Ah=["top","top-start","top-end","right","right-start","right-end","bottom","bottom-start","bottom-end","left","left-start","left-end"],Bh=["dark","light"];function ka(e,t){return e.reduce((n,a)=>(t[a]&&(n=a),n),"")}const $a=(e,t)=>{const{modifiers:n,value:a}=t;if(!a)return;const r=ka(Ah,n)||"top",i=ka(Bh,n)||"dark";e.setAttribute("v-tooltip",a),e.getAttribute("v-tooltip-placement")||e.setAttribute("v-tooltip-placement",r),e.getAttribute("v-tooltip-variant")||e.setAttribute("v-tooltip-variant",i)},Nh={beforeMount:(e,t)=>$a(e,t),updated:(e,t)=>$a(e,t),beforeUnmount(e){e.removeAttribute("v-tooltip"),e.removeAttribute("v-tooltip-placement"),e.removeAttribute("v-tooltip-variant")}},Oh={install(e,t={}){e.component("ITooltip",Ia),e.directive("i-tooltip",Nh),new Eh({el:document.body,rootComponent:Ia,props:t,appContext:e._context}).mount()}},zh={},Mh={class:"space-y-1","aria-label":"Sidebar"};function Uh(e,t){return d(),k("nav",Mh,[de(e.$slots,"default")])}const Ph=ct(zh,[["render",Uh]]),jh=["href","onClick"],Lh={class:"truncate"},Hh=["id"],Gh=Object.assign({name:"IVerticalNavigationItem"},{__name:"IVerticalNavigationItem",props:{to:[String,Object],href:{type:String,default:"#"},fixed:Boolean,linkClass:[Array,Object,String],title:String,icon:String,iconClass:[Array,Object,String]},setup(e){const t=e,n=q(qt()),a=q(null),r=q(t.fixed===!0),i=Qe(),u=Ye(),c=Fl();ge(()=>u.fullPath,()=>{Fe(()=>{!g()&&!t.fixed&&(r.value=!1)})});const m=V(()=>c.default?c.default():[]),p=V(()=>m.value&&m.value.length>0&&m.value[0].props),f=V(()=>i.resolve(t.to)),h=V(()=>t.to?u.path==f.value.path||rd(u.path,f.value.path):r.value&&!t.fixed);function g(){return a.value?a.value.querySelectorAll(".active").length>0:!1}function y(){if(t.to){u.path!=f.value.path&&i.push(t.to);return}t.fixed||(r.value=!r.value)}return De(()=>{g()&&(r.value=!0)}),(_,I)=>{const F=v("Icon");return d(),k("div",null,[o("a",{href:e.href,class:X([h.value?"active bg-neutral-200/50 text-primary-600 dark:bg-neutral-700 dark:text-primary-300":"text-neutral-700 hover:bg-neutral-200/50 hover:text-primary-600 dark:text-neutral-100 dark:hover:dark:bg-neutral-700 dark:hover:text-primary-300","group flex items-center rounded-md px-3 py-2 text-sm font-semibold focus:outline-none",e.linkClass]),onClick:ie(y,["prevent"])},[de(_.$slots,"icon",{},()=>[e.icon?(d(),R(F,{key:0,class:X([h.value?"text-primary-600 dark:text-primary-300":"text-neutral-400 group-hover:text-primary-600 dark:text-neutral-400 dark:group-hover:text-primary-300","-ml-1 mr-3 h-6 w-6 shrink-0",e.iconClass]),icon:e.icon},null,8,["class","icon"])):O("",!0)]),de(_.$slots,"title",{title:e.title},()=>[o("span",Lh,S(e.title),1)]),!e.fixed&&p.value?(d(),R(F,{key:0,icon:"ChevronDown",class:X([h.value?"text-neutral-500":"text-neutral-400 group-hover:text-neutral-500","ml-auto mr-1 h-6 w-6 shrink-0"])},null,8,["class"])):O("",!0)],10,jh),D(o("div",{id:n.value,ref_key:"childrenRef",ref:a,class:"ml-5 mt-1"},[de(_.$slots,"default")],8,Hh),[[Y,r.value]])])}}});function On(){return{gate:Innoclapps.app.config.globalProperties.$gate}}const Kh={__name:"ResizeableFieldsWrapper",props:{disabled:Boolean,resourceName:String,initialHeightClass:String,collapsed:Boolean},setup(e,{expose:t}){const n=e,{gate:a}=On(),{resourceSingularName:r}=Je(n.resourceName),i=q(null),u=q(Innoclapps.config(`${r.value}_fields_height`)),c=V(()=>!n.disabled&&n.collapsed&&a.isSuperAdmin()),m=Dt(async function(){n.collapsed&&(await Innoclapps.request().post("/settings",{[r.value+"_fields_height"]:i.value.offsetHeight}),u.value=i.value.offsetHeight)},500);function p(){ud(i.value,m)}function f(){c.value&&id(i.value)}function h(){c.value&&Fe(p)}return De(h),bt(f),t({$el:i}),(g,y)=>(d(),k("div",{ref_key:"wrapperRef",ref:i,class:X([{"resize-y":c.value},!u.value&&e.collapsed?e.initialHeightClass:""]),style:st({height:u.value&&e.collapsed?`${u.value}px`:null})},[de(g.$slots,"default")],6))}},Yh={class:"grid grid-cols-12 gap-y-1"},Wh=Object.assign({inheritAttrs:!1},{__name:"DetailFields",props:{fields:{required:!0,type:en},collapsed:Boolean,isFloating:Boolean,resizeable:Boolean,resourceName:{required:!0,type:String},resourceId:{required:!0,type:Number},resource:{required:!0,type:Object}},emits:["updated"],setup(e){const t=e;return ge(()=>t.resource._sync_timestamp,()=>{t.fields.sync(t.resource)}),(n,a)=>(d(),R(Kh,Re({disabled:!e.resizeable,collapsed:e.collapsed,"resource-name":e.resizeable?e.resourceName:void 0},n.$attrs),{default:b(()=>[o("div",Yh,[(d(!0),k(te,null,re(e.fields.all(),r=>(d(),k("div",{key:r.attribute,class:X([r.width==="half"?"col-span-12 sm:col-span-12":"col-span-12",r.displayNone||e.collapsed&&r.collapsed?"pointer-events-none hidden":""])},[(d(),R(We(r.detailComponent),{field:r,"resource-name":e.resourceName,"resource-id":e.resourceId,resource:e.resource,"is-floating":e.isFloating,onUpdated:a[0]||(a[0]=i=>(n.$emit("updated",i),e.fields.sync(i)))},null,40,["field","resource-name","resource-id","resource","is-floating"]))],2))),128))])]),_:1},16,["disabled","collapsed","resource-name"]))}}),Qh={class:"grid grid-flow-row-dense grid-cols-3 gap-4"},Xh=["textContent"],Zh={class:"col-span-2 break-words text-sm text-neutral-800 dark:text-white"},Jh={key:0},e0={__name:"DetailFieldsItem",props:["field","resource","resourceName","resourceId","isFloating","editAction"],emits:["updated"],setup(e){const t=e,n=V(()=>!Be(t.field.value));return(a,r)=>{const i=v("FieldInlineEdit");return d(),k("div",{class:X(["group relative rounded-md px-3 py-2",e.field.isRequired&&!n.value?"bg-danger-100 hover:bg-danger-200":"hover:bg-neutral-50 dark:hover:bg-neutral-800"])},[s(i,{class:"hidden group-hover:block",field:e.field,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId,"edit-action":e.editAction,"is-floating":e.isFloating,onUpdated:r[0]||(r[0]=u=>a.$emit("updated",u))},vt({_:2},[re(a.$slots,(u,c)=>({name:c,fn:b(m=>[de(a.$slots,c,pt(ft(m)))])}))]),1032,["field","resource","resource-name","resource-id","edit-action","is-floating"]),o("div",Qh,[o("div",{class:"col-span-1 justify-self-end text-right text-sm text-neutral-500 dark:text-neutral-300",textContent:S(e.field.label)},null,8,Xh),o("div",Zh,[de(a.$slots,"field",{hasValue:n.value,value:e.field.value},()=>[n.value?(d(),k("p",Jh,S(e.field.value),1)):O("",!0)])])])],2)}}},t0=["onSubmit"],n0={class:"p-4"},o0={class:"border-t border-neutral-200 bg-neutral-50 dark:border-neutral-700 dark:bg-neutral-800"},l0={class:"flex items-center justify-end space-x-1 px-4 py-2.5"},a0=Object.assign({inheritAttrs:!1},{__name:"FieldInlineEdit",props:["field","fieldFetcher","resource","resourceName","resourceId","editAction","isFloating","width"],emits:["updated"],setup(e,{emit:t}){const n=e,a=q(null),r=q(!1),i=q(!1);let u=null;const c=q({}),m=q(new en),{form:p}=It(m),{updateResource:f}=Je(n.resourceName),h=V(()=>n.field.inlineEditPanelWidth==="medium"?"w-80":n.field.inlineEditPanelWidth==="large"?"w-96":"");function g(){a.value.hide()}function y(){u&&(u(),u=null),g()}async function _(){let w=await new Promise(x=>es(n.fieldFetcher)?x(n.fieldFetcher()):x(n.field));return c.value=w,w.inlineEditWith!==null&&(w=w.inlineEditWith),w}async function I(){let w=nt(wt(await _()));w.forEach(x=>x.width="full"),m.value.set(w).populate(n.resource),i.value=!0,r.value=!0}function F(){p.errors.clear(),r.value=!1,m.value.set([]),setTimeout(()=>{i.value=!1},300)}async function $(){const w=await f(p,n.resourceId,{cancelToken:new Nn(x=>u=x)});g(),t("updated",w)}const C=V(()=>!n.resource.authorizations.update||n.field.inlineEditDisabled===!0||cn(n.resource,`_edit_disabled.${n.field.attribute}`)?!1:n.field.inlineEditWith!==null?!0:n.field.applicableForUpdate);return(w,x)=>{const A=v("Icon"),N=v("FormFields"),T=v("IOverlay"),E=v("IButton"),B=v("IPopover");return C.value?(d(),R(B,{key:0,ref_key:"popoverRef",ref:a,class:X(h.value),portal:!1,"adaptive-width":"",title:w.$t("core::fields.update_field"),shift:"",disabled:!!e.editAction,onShow:I,onHide:F},{popper:b(()=>[o("form",{onSubmit:ie($,["prevent"])},[o("div",n0,[s(T,{show:m.value.isEmpty()},{default:b(()=>[r.value?(d(),R(N,{key:0,fields:m.value,"form-id":l(p).formId,"resource-name":e.resourceName,"resource-id":e.resourceId,"is-floating":e.isFloating,collapsed:!1},null,8,["fields","form-id","resource-name","resource-id","is-floating"])):O("",!0),de(w.$slots,"after-inline-edit-form-fields",{hidePopover:g})]),_:3},8,["show"])]),o("div",o0,[o("div",l0,[s(E,{size:"sm",variant:"white",text:w.$t("core::app.cancel"),disabled:!r.value,onClick:y},null,8,["text","disabled"]),s(E,{size:"sm",text:w.$t("core::app.save"),disabled:l(p).busy||!r.value,loading:l(p).busy,onClick:$},null,8,["text","disabled","loading"])])])],40,t0)]),default:b(()=>[o("button",Re(w.$attrs,{type:"button",class:[{"!block":i.value},"absolute right-2 z-20 my-auto -mt-0.5 mr-4 rounded-md border border-neutral-200 bg-white p-1 text-neutral-600 hover:text-neutral-800 focus:outline-none dark:border-neutral-600 dark:bg-neutral-700 dark:text-neutral-200"],onClick:x[0]||(x[0]=(...z)=>e.editAction&&e.editAction(...z))}),[s(A,{icon:"Pencil",class:"h-4 w-4"})],16)]),_:3},8,["class","title","disabled"])):O("",!0)}}}),s0={class:"flex animate-pulse"},r0={class:"flex-1 space-y-4"},i0={__name:"FieldsPlaceholder",props:{total:{default:8,type:Number}},setup(e){const t=["w-full","w-1/2","w-5/6","w-3/4"];function n(){return t[Math.floor(Math.random()*t.length)]}return(a,r)=>(d(),k("div",s0,[o("div",r0,[(d(!0),k(te,null,re(e.total,i=>(d(),k("div",{key:i,class:X(["h-9 rounded-md bg-neutral-200 dark:bg-neutral-700",n()])},null,2))),128))])]))}},u0={class:"grid grid-cols-12 gap-x-4"},d0=Object.assign({inheritAttrs:!1},{__name:"FormFields",props:{fields:{required:!0,type:[Array,en]},formId:{required:!0,type:String},collapsed:Boolean,resourceId:[String,Number],resourceName:String,except:[Array,String],only:[Array,String],isFloating:Boolean,focusFirst:Boolean},setup(e){const t=e,n=q(null);let a=null;const r=V(()=>t.only?wt(t.only):[]),i=V(()=>t.except?wt(t.except):[]),u=V(()=>{if(!t.fields)return[];let m=t.fields instanceof en?t.fields.all():t.fields;return t.only?m.filter(p=>r.value.indexOf(p.attribute)>-1):t.except?m.filter(p=>i.value.indexOf(p.attribute)===-1):m});function c(){const m=["date","datetime-local","email","file","month","number","password","range","search","tel","text","time","url","week"],p=n.value.querySelector("div:first-child input"),f=n.value.querySelector("div:first-child textarea");p&&m.indexOf(p.getAttribute("type"))>-1?p.focus():f&&f.focus()}return t.focusFirst&&(De(()=>{a=setTimeout(c,600)}),bt(()=>{a&&clearTimeout(a)})),(m,p)=>(d(),k(te,null,[o("div",Re({ref_key:"wrapperRef",ref:n},m.$attrs),[o("div",u0,[(d(!0),k(te,null,re(u.value,f=>(d(),k("div",{key:f.attribute,class:X(f.width==="half"?"col-span-12 sm:col-span-6":"col-span-12")},[de(m.$slots,`before-${f.attribute}-field`,{field:f}),o("div",{class:X(f.displayNone||f.hidden||e.collapsed&&f.collapsed?"hidden":"")},[(d(),R(We(f.formComponent),{field:f,"resource-id":e.resourceId,"resource-name":e.resourceName,"is-floating":e.isFloating,"form-id":e.formId},null,8,["field","resource-id","resource-name","is-floating","form-id"]))],2),de(m.$slots,`after-${f.attribute}-field`,{field:f})],2))),128))])],16),de(m.$slots,"after",{fields:u.value})],64))}}),c0={__name:"IndexFieldsItem",props:["resourceName","resourceId","row","field","editAction"],emits:["reload"],setup(e){const t=e,{getIndexFields:n}=gt(),a=V(()=>!Be(t.field.value));async function r(){return(await n(t.resourceName,{intent:"update",params:{resourceId:t.resourceId}})).find(u=>t.field.attribute===u.attribute)}return(i,u)=>{const c=v("FieldInlineEdit");return d(),k(te,null,[s(c,{field:e.field,"field-fetcher":r,resource:e.row,"resource-name":e.resourceName,"resource-id":e.resourceId,"edit-action":e.editAction,class:"hidden group-hover/td:block",onUpdated:u[0]||(u[0]=m=>i.$emit("reload"))},vt({_:2},[re(i.$slots,(m,p)=>({name:p,fn:b(f=>[de(i.$slots,p,pt(ft(f)))])}))]),1032,["field","resource","resource-name","resource-id","edit-action"]),de(i.$slots,"field",{hasValue:a.value,value:e.field.value})],64)}}},m0={class:"pt-8"},p0={class:"mx-auto max-w-3xl"},f0={class:"bg-white shadow dark:bg-neutral-900 sm:rounded-lg"},v0={class:"px-4 py-5 sm:p-6"},b0={class:"sm:flex sm:items-start sm:justify-between"},h0=["textContent"],_0={class:"mt-2 max-w-xl text-sm text-neutral-500 dark:text-neutral-300"},g0=["textContent"],y0={class:"mt-5 sm:ml-6 sm:mt-1 sm:flex sm:shrink-0 sm:items-center"},x0=["onSubmit"],I0={__name:"ActionPanel",props:{buttonText:{default:"Update",type:String},title:String,description:String,redirectTo:String,method:{type:String,default:"post"},action:{type:String,required:!0}},setup(e){const t=e,n=q(!1);function a(){n.value=!0,Innoclapps.request({method:t.method,url:t.action}).then(()=>{t.redirectTo?window.location.href=t.redirectTo:window.location.href=Innoclapps.config("url")}).finally(()=>n.value=!1)}return(r,i)=>{const u=v("IButton");return d(),k("div",m0,[o("div",p0,[o("div",f0,[o("div",v0,[o("div",b0,[o("div",null,[o("h3",{class:"text-lg/6 font-medium text-neutral-900 dark:text-neutral-100",textContent:S(e.title)},null,8,h0),o("div",_0,[o("p",{textContent:S(e.description)},null,8,g0)])]),o("div",y0,[o("form",{onSubmit:ie(a,["prevent"])},[s(u,{type:"submit",variant:"primary",loading:n.value,disabled:n.value,text:e.buttonText},null,8,["loading","disabled","text"])],40,x0)])])])])])])}}},k0=ql(()=>mo(()=>import("./TextCollapse-36c46725.js"),["assets/TextCollapse-36c46725.js","assets/vendor-462626fd.js"]));function $0(e){e.component("AuthLogin",jd),e.component("AuthPasswordEmail",Ld),e.component("AuthPasswordReset",Gd),e.use(dd).use(Sf).use(Nf).use(Kv).use(wb).use(zv,{globalEmitter:Innoclapps}).use(qh).use(Oh),e.component("ILayout",gm).component("IActionMessage",Sb).component("IAvatar",Eb).component("ITable",dh).component("ICustomSelect",lv).component("IOverlay",eh).component("IPopover",lh).component("IEmptyState",Kb).component("IIconPicker",Qb).component("ISpinner",uh).component("IStepsCircle",$h).component("IStepCircle",gh).component("IColorSwatch",Ob).component("IVerticalNavigation",Ph).component("IVerticalNavigationItem",Gh).component("IAlert",Do).component("IBadge",Ab),e.component("TheNavbar",Ep),e.component("NavbarSeparator",km),e.component("TheSidebar",_f),e.component("TheFloatNotifications",jm),e.component("TheFloatingResourceModal",Vm),e.component("DatePicker",im),e.component("DateRangePicker",vm),e.component("ActionPanel",I0),e.component("Icon",Ub),e.component("ActionDialog",oc),e.component("ActionBulkEdit",cc),e.component("ProgressionChart",am),e.component("PresentationChart",nm),e.component("CardTable",wc),e.component("CardTableAsync",Jc),e.component("Card",_c),e.component("TextCollapse",k0),e.component("Editor",_m),e.component("FormFields",d0),e.component("DetailFields",Wh),e.component("DetailFieldsItem",e0),e.component("IndexFieldsItem",c0),e.component("FieldsPlaceholder",i0),e.component("FieldInlineEdit",a0),e.component("DropdownSelectInput",hm),e.component("SearchInput",Cm)}const w0={beforeMount:function(e,t,n){e._showModal=()=>{Innoclapps.$emit("modal-show",t.value)},e.addEventListener("click",e._showModal)},unmounted:function(e,t,n){e.removeEventListener("click",e._showModal)}},C0={beforeMount:function(e,t){e._toggle=()=>{const n=document.getElementById(t.value);n.style.display==="none"||n.classList.contains("hidden")?(n.style.display="block",n.classList.remove("hidden")):n.style.display="none"},e.addEventListener("click",e._toggle)},unmounted:function(e,t){e.removeEventListener("click",e._toggle)}};function S0(e){e.directive("i-modal",w0),e.directive("i-toggle",C0)}function zn(){const e=q([]);function t(a,r){e.value=a,r&&r(e)}async function n(a){return Array.isArray(a)?a:a.options}return{options:e,setOptions:t,getOptions:n}}function ht(e,t,n,a,r={}){const i=Pl(n),u=q(!0),c=q(null),m=V(()=>t.value.label),p=V(()=>r.isDirty?l(r.isDirty):Be(e.value)&&Be(c.value)?!1:Array.isArray(e.value)&&Array.isArray(c.value)?!At(e.value.sort(),c.value.sort()):!At(e.value,c.value)),f=V(()=>t.value.readonly||cn(t.value,"attributes.readonly")),h=V(()=>(t.value.id||t.value.attribute)+(l(a)?"-floating":"")),g=V(()=>t.value.checkDuplicatesWith&&Object.keys(t.value.checkDuplicatesWith).length>0);async function y(x){const{data:A}=await Innoclapps.request().get(t.value.checkDuplicatesWith.url,{params:{q:x,...t.value.checkDuplicatesWith.params}});return A.length>0?A[0]:null}function _(){Array.isArray(e.value)?cd(e,x=>{I(x)},{deep:!0}):ge(e,(x,A)=>{Wt(x)&&Wt(A)&&JSON.stringify(x)===JSON.stringify(A)||I(x)},{deep:!0})}function I(x){t.value.currentValue=x,u.value&&i.errors&&i.errors.clear(t.value.attribute),t.value.emitChangeEvent&&Innoclapps.$emit(t.value.emitChangeEvent,x)}function F(){$(),c.value||(c.value=nt(e.value)),i.set(t.value.attribute,e.value)}function $(){r.setInitialValue?r.setInitialValue():e.value=qn(t.value.value)?"":t.value.value,Fe(()=>{t.value.currentValue=e.value,Fe(_)})}function C(x){if(r.fill){r.fill(x);return}x.fill(t.value.attribute,e.value)}function w(x){if(r.handleChange){r.handleChange(x);return}e.value=x,c.value=x}return Dn(()=>{t.value.fill=C,t.value.handleChange=w,t.value.isDirty=()=>p.value}),bt(()=>{t.value.isDirty=null,t.value.currentValue=null,t.value.handleChange=null,t.value.fill=null}),{field:t,label:m,fieldId:h,realInitialValue:c,isReadonly:f,initialize:F,checksForDuplicates:g,makeDuplicateCheckRequest:y}}function Yo(e,t,n,a,r={}){const{t:i}=ve(),{options:u,setOptions:c,getOptions:m}=zn(),p=q(!1),f=q(2),h=q(0),g=q(!1),y=q(!1),_=q(null),I=V(()=>!!t.value.asyncUrl),F=V(()=>!I.value),$=V(()=>I.value&&g.value?i("core::app.type_more_to_search",{characters:f.value-h.value}):""),C=V(()=>!I.value||I.value&&p.value?i("core::app.no_search_results"):i("core::app.type_to_search")),w=V(()=>r.isDirty?es(r.isDirty)?r.isDirty(e,Z):l(r.isDirty):Be(e.value)&&Be(Z.value)?!1:Be(e.value)?!Be(Z.value):Be(Z.value)?!Be(e.value):Wt(Z.value)?!At(e.value[t.value.valueKey],Z.value[t.value.valueKey]):!At(e.value[t.value.valueKey],Z.value));function x(K,G){I.value&&A(K,G)}const A=Dt(function(K,G){if(K==""){u.value=_.value!==null?_.value:[];return}const oe=K.length;if(h.value=oe,F.value||oe<f.value)return g.value=!0,K;g.value=!1,N(K,G)},400);async function N(K,G){G(!0);let{data:oe}=await Innoclapps.request().get(t.value.asyncUrl,{params:{q:K}});u.value=oe,p.value=!0,G(!1)}function T(){e.value=B(t.value.value)}function E(K){let G=B(K);e.value=G,Z.value=nt(G)}function B(K){return K&&typeof K!="object"&&u.value.length>0&&typeof u.value[0]=="object"?Ee(u.value,[t.value.valueKey,K]):K}function z(){!t.value.lazyLoad||_.value!==null||(y.value=!0,Innoclapps.request().get(t.value.lazyLoad.url,{params:t.value.lazyLoad.params}).then(({data:K})=>{u.value=(K==null?void 0:K.data)||K,_.value=u.value}).finally(()=>y.value=!1))}function M(K){return{[t.value.valueKey]:K,[t.value.labelKey]:K}}function j(K){if(r.fill){r.fill(K);return}K.fill(t.value.attribute,e.value&&e.value[t.value.valueKey]||null)}function U(){ge(()=>t.value.value,K=>E(K))}m(r.options||t.value).then(K=>c(K,()=>{J(),Fe(U)}));const{label:P,fieldId:H,isReadonly:L,realInitialValue:Z,initialize:J}=ht(e,t,n,a,{fill:j,isDirty:w,setInitialValue:T,handleChange:E});return{createOption:M,onSearch:x,onDropdownOpen:z,filterable:F,setOptions:c,options:u,lazyLoadingOptions:y,noOptionsText:C,headerText:$,prepareValue:B,field:t,label:P,fieldId:H,isReadonly:L}}const R0=["textContent"],F0=["innerHTML"],it={__name:"FormFieldsGroup",props:{formId:{required:!0,type:String},field:{required:!0,type:Object},fieldId:String,label:String},setup(e){const t=e,n=Pl(t.formId),a=q(!1),r=V(()=>t.field.toggleable&&!a.value&&!m.value),i=V(()=>t.field.helpText&&t.field.helpTextDisplay==="icon"),u=V(()=>t.field.helpText&&t.field.helpTextDisplay==="text"),c=V(()=>t.field.helpText&&t.field.helpTextDisplay==="alert"),m=V(()=>!Be(t.field.value)),p=V(()=>!r.value&&u.value?t.field.helpText:null);return(f,h)=>{const g=v("Icon"),y=v("IFormLabel"),_=v("IAlert"),I=v("IFormError"),F=v("IFormGroup"),$=ae("i-tooltip");return d(),R(F,{description:p.value},{default:b(()=>[r.value?(d(),k("a",{key:0,href:"#",class:"link flex items-center text-sm",onClick:h[0]||(h[0]=ie(C=>a.value=!0,["prevent"]))},[s(g,{icon:"Plus",class:"mr-1 h-4 w-4"}),o("span",{textContent:S(e.label)},null,8,R0)])):O("",!0),D(o("div",null,[e.label&&!e.field.hideLabel?(d(),R(y,{key:0,for:e.fieldId,class:"mb-1 inline-flex items-center",required:e.field.isRequired},{default:b(()=>[i.value?D((d(),R(g,{key:0,icon:"QuestionMarkCircle",class:"mr-1 h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-white dark:hover:text-neutral-300"},null,512)),[[$,e.field.helpText]]):O("",!0),o("span",{innerHTML:e.label},null,8,F0)]),_:1},8,["for","required"])):O("",!0),de(f.$slots,"default")],512),[[Y,!r.value]]),c.value?(d(),R(_,{key:1,variant:"info",class:"mt-3"},{default:b(()=>[Q(S(e.field.helpText),1)]),_:1})):O("",!0),l(n).getError(e.field.attribute)?(d(),R(I,{key:2,textContent:S(l(n).getError(e.field.attribute))},null,8,["textContent"])):O("",!0)]),_:3},8,["description"])}}},ut={resourceName:String,resourceId:[String,Number],field:{type:Object,required:!0},formId:{type:String,required:!0},isFloating:Boolean},V0={key:0,class:"-mt-1 block px-3 py-2 text-sm text-neutral-500 dark:text-neutral-200"},T0=o("span",{class:"block h-4 w-4 motion-safe:animate-bounce"},"...",-1),D0=[T0],q0={__name:"BelongsToField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,isReadonly:u,onSearch:c,onDropdownOpen:m,filterable:p,options:f,lazyLoadingOptions:h,noOptionsText:g,headerText:y}=Yo(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return(_,I)=>{const F=v("ICustomSelect");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":_.formId},{default:b(()=>[s(F,Re({modelValue:n.value,"onUpdate:modelValue":I[0]||(I[0]=$=>n.value=$),"input-id":l(i),disabled:l(u),filterable:l(p),options:l(f),loading:l(h),name:l(a).attribute,label:l(a).labelKey},l(a).attributes,{onSearch:l(c),onOpen:l(m)}),{"no-options":b(()=>[Q(S(l(g)),1)]),header:b(()=>[D(o("span",{class:"block px-3 py-2 text-sm text-neutral-500 dark:text-neutral-200"},S(l(y)),513),[[Y,l(y)]]),l(h)?(d(),k("span",V0,D0)):O("",!0)]),_:1},16,["modelValue","input-id","disabled","filterable","options","loading","name","label","onSearch","onOpen"])]),_:1},8,["field","label","field-id","form-id"])}}},E0=Object.freeze(Object.defineProperty({__proto__:null,default:q0},Symbol.toStringTag,{value:"Module"})),A0=["innerHTML"],B0={__name:"BooleanField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,isReadonly:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(c),(m,p)=>{const f=v("IFormCheckbox");return d(),R(it,{field:l(a),"form-id":m.formId,"field-id":l(i)},{default:b(()=>[s(f,Re({id:l(a).name,checked:n.value,"onUpdate:checked":p[0]||(p[0]=h=>n.value=h),disabled:l(u),name:l(a).name,value:l(a).trueValue},l(a).attributes,{"unchecked-value":l(a).falseValue}),{default:b(()=>[o("span",{innerHTML:l(r)},null,8,A0)]),_:1},16,["id","checked","disabled","name","value","unchecked-value"])]),_:1},8,["field","form-id","field-id"])}}},N0=Object.freeze(Object.defineProperty({__proto__:null,default:B0},Symbol.toStringTag,{value:"Module"})),O0={__name:"CheckboxField",props:ut,setup(e){const t=e,{options:n,setOptions:a,getOptions:r}=zn(),i=q([]);function u(){i.value=m(t.field.value)}function c(I){i.value=m(I),y.value=i.value}function m(I){return(qn(I)?[]:I).map(F=>F[t.field.valueKey])}const{field:p,label:f,fieldId:h,isReadonly:g,realInitialValue:y,initialize:_}=ht(i,xe(t,"field"),t.formId,xe(t,"isFloating"),{setInitialValue:u,handleChange:c});return r(t.field).then(a),De(_),(I,F)=>{const $=v("IFormCheckbox");return d(),R(it,{field:l(p),label:l(f),"form-id":I.formId,"field-id":l(h)},{default:b(()=>[o("div",{class:X({"flex items-center space-x-2":l(p).inline,"space-y-1":!l(p).inline})},[(d(!0),k(te,null,re(l(n),C=>(d(),R($,Re({key:C[l(p).valueKey],checked:i.value,"onUpdate:checked":F[0]||(F[0]=w=>i.value=w),value:C[l(p).valueKey],name:l(p).attribute},l(p).attributes,{disabled:l(g),"swatch-color":C.swatch_color,label:C[l(p).labelKey]}),null,16,["checked","value","name","disabled","swatch-color","label"]))),128))],2)]),_:1},8,["field","label","form-id","field-id"])}}},z0=Object.freeze(Object.defineProperty({__proto__:null,default:O0},Symbol.toStringTag,{value:"Module"})),M0={__name:"ColorSwatchField",props:ut,setup(e){const t=e,n=q(""),a=Innoclapps.config("favourite_colors"),{field:r,label:i,fieldId:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(c),(m,p)=>{const f=v("IColorSwatch");return d(),R(it,{field:l(r),label:l(i),"form-id":m.formId,"field-id":l(u)},{default:b(()=>[o("div",null,[s(f,{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=h=>n.value=h),swatches:l(a),"allow-remove":!l(r).isRequired},null,8,["modelValue","swatches","allow-remove"])])]),_:1},8,["field","label","form-id","field-id"])}}},U0=Object.freeze(Object.defineProperty({__proto__:null,default:M0},Symbol.toStringTag,{value:"Module"})),P0={__name:"DateField",props:ut,setup(e){const t=e,{appMoment:n}=Ne(),a=q(""),r=V(()=>{const y=(_,I)=>Be(_)&&Be(I)?!0:Be(_)&&!Be(I)||Be(I)&&!Be(_)?!1:moment(_).isSame(I);return Wt(h.value)&&Wt(a.value)?Object.keys(a.value).some(I=>!y(a.value[I],h.value[I])):!y(a.value,h.value)});function i(y){a.value=y?n(y).format("YYYY-MM-DD"):null,h.value=a.value}function u(){a.value=t.field.value?n(t.field.value).format("YYYY-MM-DD"):null}const{field:c,label:m,fieldId:p,isReadonly:f,realInitialValue:h,initialize:g}=ht(a,xe(t,"field"),t.formId,xe(t,"isFloating"),{isDirty:r,setInitialValue:u,handleChange:i});return h.value=t.field.value?n(t.field.value).format("YYYY-MM-DD"):null,De(g),(y,_)=>{const I=v("DatePicker");return d(),R(it,{field:l(c),label:l(m),"form-id":y.formId,"field-id":l(p)},{default:b(()=>[s(I,Re({id:l(p),modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=F=>a.value=F),required:l(c).isRequired,name:l(c).attribute,disabled:l(f)},l(c).attributes),null,16,["id","modelValue","required","name","disabled"])]),_:1},8,["field","label","form-id","field-id"])}}},j0=Object.freeze(Object.defineProperty({__proto__:null,default:P0},Symbol.toStringTag,{value:"Module"})),L0={__name:"DateTimeField",props:ut,setup(e){const t=e,n=q(""),a=V(()=>{const f=(h,g)=>Be(h)&&Be(g)?!0:Be(h)&&!Be(g)||Be(g)&&!Be(h)?!1:moment.utc(h).isSame(g);return Wt(m.value)&&Wt(n.value)?Object.keys(n.value).some(g=>!f(n.value[g],m.value[g])):!f(n.value,m.value)}),{field:r,label:i,fieldId:u,isReadonly:c,realInitialValue:m,initialize:p}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{isDirty:a});return De(p),(f,h)=>{const g=v("DatePicker");return d(),R(it,{field:l(r),label:l(i),"form-id":f.formId,"field-id":l(u)},{default:b(()=>[s(g,Re({id:l(u),modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=y=>n.value=y),required:l(r).isRequired,name:l(r).attribute,disabled:l(c)},l(r).attributes,{mode:"dateTime"}),null,16,["id","modelValue","required","name","disabled"])]),_:1},8,["field","label","form-id","field-id"])}}},H0=Object.freeze(Object.defineProperty({__proto__:null,default:L0},Symbol.toStringTag,{value:"Module"})),G0={class:"relative"},K0={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},Y0={__name:"DomainField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,isReadonly:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));function m(){n.value=md(n.value).domain}return De(c),(p,f)=>{const h=v("Icon"),g=v("IFormInput");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":p.formId},{default:b(()=>[o("div",G0,[o("div",K0,[s(h,{icon:"Globe",class:"h-5 w-5 text-neutral-500 dark:text-neutral-300"})]),s(g,Re({id:l(i),modelValue:n.value,"onUpdate:modelValue":f[0]||(f[0]=y=>n.value=y),disabled:l(u)},l(a).attributes,{class:"pl-11",onBlur:m}),null,16,["id","modelValue","disabled"])])]),_:1},8,["field","label","field-id","form-id"])}}},W0=Object.freeze(Object.defineProperty({__proto__:null,default:Y0},Symbol.toStringTag,{value:"Module"})),Q0={__name:"EditorField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,isReadonly:i,initialize:u}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating")),c=qt();return De(u),(m,p)=>{const f=v("Editor");return d(),R(it,{field:l(a),label:l(r),"field-id":l(c),"form-id":m.formId},{default:b(()=>[s(f,Re({modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=h=>n.value=h),disabled:l(i)},l(a).attributes),null,16,["modelValue","disabled"])]),_:1},8,["field","label","field-id","form-id"])}}},X0=Object.freeze(Object.defineProperty({__proto__:null,default:Q0},Symbol.toStringTag,{value:"Module"})),Z0={class:"relative"},J0={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},e_={class:"font-medium"},t_={class:"mt-4"},n_={class:"-mx-2 -my-1.5 flex"},o_={__name:"EmailField",props:ut,setup(e){const t=e,n=q(""),a=dt(null),{field:r,label:i,fieldId:u,isReadonly:c,initialize:m,checksForDuplicates:p,makeDuplicateCheckRequest:f}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating")),h=Dt(()=>{if(!p.value||t.resourceId||!n.value){a.value=null;return}f(n.value).then(g=>a.value=g)},700);return De(m),(g,y)=>{const _=v("Icon"),I=v("IFormInput"),F=v("i18n-t"),$=v("IButtonMinimal"),C=v("IAlert");return d(),R(it,{field:l(r),label:l(i),"field-id":l(u),"form-id":g.formId},{default:b(()=>[o("div",Z0,[o("div",J0,[s(_,{icon:"Mail",class:"h-5 w-5 text-neutral-500 dark:text-neutral-300"})]),s(I,Re({id:l(u),modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=w=>n.value=w),disabled:l(c),type:"email"},l(r).attributes,{class:"pl-11",onInput:l(h)}),null,16,["id","modelValue","disabled","onInput"]),a.value?(d(),R(C,{key:0,dismissible:"",class:"mt-2",onDismissed:y[1]||(y[1]=w=>a.value=null)},{default:b(()=>[s(F,{scope:"global",keypath:l(r).checkDuplicatesWith.lang_keypath},{display_name:b(()=>[o("span",e_,S(a.value.display_name),1)]),_:1},8,["keypath"]),o("div",t_,[o("div",n_,[s($,{tag:"a",href:a.value.path,rel:"noopener noreferrer",target:"_blank",variant:"info",icon:"ExternalLink",text:g.$t("core::app.view_record")},null,8,["href","text"])])])]),_:1})):O("",!0)])]),_:1},8,["field","label","field-id","form-id"])}}},l_=Object.freeze(Object.defineProperty({__proto__:null,default:o_},Symbol.toStringTag,{value:"Module"})),a_={class:"mb-1 mt-3"},s_=["textContent"],r_=["innerHTML"],i_=Object.assign({inheritAttrs:!1},{__name:"HeadingField",props:{field:{type:Object,require:!0}},setup(e){const t=e;return t.field.fill=()=>{},t.field.handleChange=()=>{},t.field.isDirty=()=>!1,(n,a)=>{const r=v("Icon");return d(),k("div",a_,[o("h5",{class:X(["text-base font-medium text-neutral-800 dark:text-white",[e.field.titleIcon?"inline-flex items-center":""]])},[e.field.titleIcon?(d(),R(r,{key:0,icon:e.field.titleIcon,class:"mr-1.5 h-4 w-4 text-current"},null,8,["icon"])):O("",!0),o("span",{textContent:S(e.field.title)},null,8,s_)],2),o("p",{class:"text-sm text-neutral-600 dark:text-neutral-300",innerHTML:e.field.message},null,8,r_)])}}}),u_=Object.freeze(Object.defineProperty({__proto__:null,default:i_},Symbol.toStringTag,{value:"Module"})),d_={__name:"IconPickerField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,initialize:u}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(u),(c,m)=>{const p=v("IIconPicker");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":c.formId},{default:b(()=>[s(p,Re({modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=f=>n.value=f)},l(a).attributes),null,16,["modelValue"])]),_:1},8,["field","label","field-id","form-id"])}}},c_=Object.freeze(Object.defineProperty({__proto__:null,default:d_},Symbol.toStringTag,{value:"Module"})),m_={class:"relative"},p_={key:0,class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},f_=["textContent"],v_={key:1,class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},b_=["textContent"],h_={__name:"NumericField",props:ut,setup(e){const t=e,n=q("");function a(f){n.value=f!==null?f:"",m.value=n.value}const{field:r,label:i,fieldId:u,isReadonly:c,realInitialValue:m,initialize:p}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{handleChange:a});return De(p),(f,h)=>{const g=v("IFormNumericInput");return d(),R(it,{field:l(r),label:l(i),"form-id":f.formId,"field-id":l(u)},{default:b(()=>[o("div",m_,[l(r).prependText||l(r).currency&&l(r).currency.symbol_first?(d(),k("div",p_,[o("span",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(l(r).currency?l(r).currency.iso_code:l(r).prependText)},null,8,f_)])):O("",!0),s(g,Re({id:l(u),modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=y=>n.value=y),disabled:l(c),name:l(r).attribute},l(r).attributes,{class:{"pl-14":l(r).prependText||l(r).currency&&l(r).currency.symbol_first,"pr-14":l(r).appendText||l(r).currency&&!l(r).currency.symbol_first}}),null,16,["id","modelValue","disabled","name","class"]),l(r).appendText||l(r).currency&&!l(r).currency.symbol_first?(d(),k("div",v_,[o("span",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(l(r).currency?l(r).currency.iso_code:l(r).appendText)},null,8,b_)])):O("",!0)])]),_:1},8,["field","label","form-id","field-id"])}}},__=Object.freeze(Object.defineProperty({__proto__:null,default:h_},Symbol.toStringTag,{value:"Module"})),g_={__name:"RadioField",props:ut,setup(e){const t=e,{options:n,setOptions:a,getOptions:r}=zn(),i=q(""),{field:u,label:c,fieldId:m,isReadonly:p,initialize:f}=ht(i,xe(t,"field"),t.formId,xe(t,"isFloating"),{setInitialValue:function(){qn(t.field.value)||(typeof t.field.value=="object"?i.value=t.field.value[t.field.valueKey]:i.value=t.field.value)}});return r(t.field).then(a),De(f),(h,g)=>{const y=v("IFormRadio");return d(),R(it,{field:l(u),label:l(c),"field-id":l(m),"form-id":h.formId},{default:b(()=>[o("div",{class:X({"flex items-center space-x-2":l(u).inline,"space-y-1":!l(u).inline})},[(d(!0),k(te,null,re(l(n),_=>(d(),R(y,Re({id:"radio-"+_[l(u).valueKey],key:_[l(u).valueKey]},l(u).attributes,{modelValue:i.value,"onUpdate:modelValue":g[0]||(g[0]=I=>i.value=I),name:l(u).attribute,value:_[l(u).valueKey],disabled:l(p),"swatch-color":_.swatch_color,label:_[l(u).labelKey]}),null,16,["id","modelValue","name","value","disabled","swatch-color","label"]))),128))],2)]),_:1},8,["field","label","field-id","form-id"])}}},y_=Object.freeze(Object.defineProperty({__proto__:null,default:g_},Symbol.toStringTag,{value:"Module"})),x_={class:"flex items-center"},I_={class:"mr-2"},k_={class:"flex rounded-md shadow-sm"},$_={class:"relative flex grow items-stretch"},w_={class:"flex items-center space-x-2"},C_=["value"],S_={class:"ml-2 truncate text-neutral-800 dark:text-neutral-300"},R_={__name:"ReminderField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,realInitialValue:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{setInitialValue:F,handleChange:I}),m=["minutes","hours","days","weeks"],p=q(Innoclapps.config("defaults.reminder_minutes")),f=q("minutes"),h=q(!1),g=V(()=>h.value?null:f.value==="minutes"?parseInt(p.value):f.value==="hours"?parseInt(p.value)*60:f.value==="days"?parseInt(p.value)*1440:f.value==="weeks"?parseInt(p.value)*10080:parseInt(30)),y=V(()=>f.value==="minutes"?59:f.value==="hours"?23:f.value==="days"?6:4);ge(g,$=>{n.value=$});function _($){h.value=$===void 0?!h.value:$,p.value=Innoclapps.config("defaults.reminder_minutes"),f.value="minutes"}function I($){$?(n.value=$,p.value=gl($),f.value=No($)):$===null&&t.field.cancelable?_(!0):n.value=p.value,u.value=n.value}function F(){t.field.value?(n.value=t.field.value,p.value=gl(t.field.value),f.value=No(t.field.value)):t.field.value===null&&t.field.cancelable?_():n.value=p.value}return De(c),($,C)=>{const w=v("IButtonClose"),x=v("IFormNumericInput"),A=v("IFormSelect"),N=ae("t");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":$.formId},{default:b(()=>[o("div",x_,[o("div",I_,[o("div",k_,[l(a).cancelable?(d(),R(w,{key:0,rounded:!1,icon:h.value?"Bell":"X",variant:"white",class:"relative -mr-px rounded-l-md focus:z-20",onClick:C[0]||(C[0]=T=>_())},null,8,["icon"])):O("",!0),o("div",$_,[s(x,{modelValue:p.value,"onUpdate:modelValue":C[1]||(C[1]=T=>p.value=T),type:"number",max:y.value,min:1,rounded:!1,class:X([{"rounded-r-md":l(a).cancelable,"rounded-md":!l(a).cancelable}]),disabled:h.value,precision:0,placeholder:$.$t("core::dates."+f.value)},null,8,["modelValue","max","class","disabled","placeholder"])])])]),o("div",w_,[s(A,{modelValue:f.value,"onUpdate:modelValue":C[2]||(C[2]=T=>f.value=T),disabled:h.value,class:"sm:flex-1"},{default:b(()=>[(d(),k(te,null,re(m,T=>o("option",{key:T,value:T},S($.$t("core::dates."+T)),9,C_)),64))]),_:1},8,["modelValue","disabled"]),D(o("div",S_,null,512),[[N,"core::app.reminder_before_due"]])])])]),_:1},8,["field","label","field-id","form-id"])}}},F_=Object.freeze(Object.defineProperty({__proto__:null,default:R_},Symbol.toStringTag,{value:"Module"})),V_={key:0,class:"-mt-1 block px-3 py-2 text-sm text-neutral-500 dark:text-neutral-200"},T_=o("span",{class:"block h-4 w-4 motion-safe:animate-bounce"},"...",-1),D_=[T_],q_={__name:"SelectField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,isReadonly:u,createOption:c,onSearch:m,onDropdownOpen:p,filterable:f,options:h,lazyLoadingOptions:g,noOptionsText:y,headerText:_}=Yo(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return(I,F)=>{const $=v("ICustomSelect");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":I.formId},{default:b(()=>[s($,Re({modelValue:n.value,"onUpdate:modelValue":F[0]||(F[0]=C=>n.value=C),"input-id":l(i),disabled:l(u),filterable:l(f),options:l(h),"create-option-provider":l(c),loading:l(g),name:l(a).attribute,label:l(a).labelKey},l(a).attributes,{onSearch:l(m),onOpen:l(p)}),{"no-options":b(()=>[Q(S(l(y)),1)]),header:b(()=>[D(o("span",{class:"block px-3 py-2 text-sm text-neutral-500 dark:text-neutral-200"},S(l(_)),513),[[Y,l(_)]]),l(g)?(d(),k("span",V_,D_)):O("",!0)]),_:1},16,["modelValue","input-id","disabled","filterable","options","create-option-provider","loading","name","label","onSearch","onOpen"])]),_:1},8,["field","label","field-id","form-id"])}}},E_=Object.freeze(Object.defineProperty({__proto__:null,default:q_},Symbol.toStringTag,{value:"Module"})),A_={key:0,class:"-mt-1 block px-3 py-2 text-sm text-neutral-500 dark:text-neutral-200"},B_=o("span",{class:"block h-4 w-4 motion-safe:animate-bounce"},"...",-1),N_=[B_],O_={__name:"SelectMultipleField",props:ut,setup(e){const t=e,n=q("");function a(F){let $=[];Sn(n.value,C=>{$.push(C[t.field.valueKey])}),F.fill(t.field.attribute,$)}const{field:r,label:i,fieldId:u,isReadonly:c,createOption:m,onSearch:p,onDropdownOpen:f,filterable:h,options:g,lazyLoadingOptions:y,noOptionsText:_,headerText:I}=Yo(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{isDirty:(F,$)=>Be(F.value)&&Be($.value)?!1:!At(F.value,$.value),fill:a});return(F,$)=>{const C=v("ICustomSelect");return d(),R(it,{field:l(r),label:l(i),"field-id":l(u),"form-id":F.formId},{default:b(()=>[s(C,Re({modelValue:n.value,"onUpdate:modelValue":$[0]||($[0]=w=>n.value=w),multiple:!0,"input-id":l(u),disabled:l(c),filterable:l(h),options:l(g),"create-option-provider":l(m),loading:l(y),name:l(r).attribute,label:l(r).labelKey},l(r).attributes,{onSearch:l(p),onOpen:l(f)}),{"no-options":b(()=>[Q(S(l(_)),1)]),header:b(()=>[D(o("span",{class:"block px-3 py-2 text-sm text-neutral-500 dark:text-neutral-200"},S(l(I)),513),[[Y,l(I)]]),l(y)?(d(),k("span",A_,N_)):O("",!0)]),_:1},16,["modelValue","input-id","disabled","filterable","options","create-option-provider","loading","name","label","onSearch","onOpen"])]),_:1},8,["field","label","field-id","form-id"])}}},z_=Object.freeze(Object.defineProperty({__proto__:null,default:O_},Symbol.toStringTag,{value:"Module"})),bs=Qt(()=>{const e=q([]),t=V(()=>ot(e.value,"display_order"));function n(p){return e.value.findIndex(f=>f.id==p)}function a(p){return t.value.find(f=>f.id==p)}function r(p){return t.value.filter(f=>f.type==p)}function i(p){e.value=p}function u(p){e.value.push(p)}function c(p,f){e.value[n(p)]=f}function m(p){e.value.splice(n(p),1)}return{tags:e,tagsByDisplayOrder:t,findTagById:a,findTagsByType:r,setTags:i,setTag:c,addTag:u,removeTag:m}}),M_=["onClick"],U_={class:"border-b border-neutral-200 bg-neutral-50 px-5 py-3 text-sm font-medium text-neutral-800 dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100"},P_={class:"px-5 py-4"},j_={class:"border-t border-neutral-200 bg-neutral-50 px-5 py-2 dark:border-neutral-600 dark:bg-neutral-800"},L_={class:"flex"},H_={class:"ml-auto space-x-2"},Wo={__name:"TagsSelectInput",props:{modelValue:Array,type:String,simple:Boolean},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,{tagsByDisplayOrder:a,findTagsByType:r,removeTag:i,setTag:u,findTagById:c,setTags:m,addTag:p}=bs(),f=V(()=>n.type?r(n.type):a.value),h=Innoclapps.config("favourite_colors").slice(0,-2),{form:g}=Ae({name:"",swatch_color:h[1]},{resetOnSuccess:!0}),y=q(null),_=q(!1),I=q(null),F=V(()=>_.value||!!I.value);function $(){_.value?A():N()}function C(B){I.value=B.id,g.fill("name",B.name),g.fill("swatch_color",B.swatch_color)}function w(B){m(B.map((z,M)=>({...z,display_order:M+1}))),Innoclapps.request().post("/tags/order",B.map((z,M)=>({id:z.id,display_order:M+1})))}function x(){_.value=!1,I.value=null,y.value=null,g.reset()}function A(){g.post(`/tags${n.type?`/${n.type}`:""}`).then(B=>{c(B.id)?u(B.id,B):p(B),x()})}function N(){const B=c(I.value).name;g.put(`/tags/${I.value}`).then(z=>{u(z.id,z);let M=n.modelValue.findIndex(j=>((j==null?void 0:j.name)||j)===B);if(M!==-1){let j=nt(n.modelValue[M]);typeof j=="string"?j=z.name:j.name=z.name;let U=nt(n.modelValue);U[M]=j,T(U)}x()})}function T(B){t("update:modelValue",B.map(z=>typeof z=="string"?z:z.name))}async function E(B){if(y.value===null){y.value=!1;return}let z=c(B);await Innoclapps.request().delete(`/tags/${B}`),y.value=null,n.modelValue.findIndex(j=>((j==null?void 0:j.name)||j)===z.name)!==-1&&T(n.modelValue.filter(j=>((j==null?void 0:j.name)||j)!==z.name)),i(B),x()}return(B,z)=>{const M=v("Icon"),j=v("IFormInput"),U=v("IFormError"),P=v("IFormGroup"),H=v("IFormLabel"),L=v("IColorSwatch"),Z=v("IButton"),J=v("ICustomSelect");return d(),R(J,{"model-value":e.modelValue,multiple:!0,options:f.value,reduce:K=>K.name,simple:e.simple,searchable:!F.value,placeholder:e.simple?B.$t("core::tags.search"):void 0,"toggle-icon":e.simple&&e.modelValue&&e.modelValue.length===0?"Tag":"ChevronDown","list-wrapper-class":e.simple?"min-w-[340px]":void 0,label:"name","list-class":F.value?"hidden":void 0,reorderable:B.$gate.isSuperAdmin(),"onUpdate:modelValue":T,"onUpdate:draggable":w},vt({"option-actions":b(({index:K})=>[B.$gate.isSuperAdmin()?(d(),k("a",{key:0,href:"#",class:"text-neutral-600 dark:text-neutral-200",onClick:ie(G=>C(f.value[K]),["prevent"])},[s(M,{icon:"Pencil",class:"h-4 w-4"})],8,M_)):O("",!0)]),_:2},[F.value?{name:"header",fn:b(()=>[o("div",U_,S(_.value?B.$t("core::tags.new_tag"):B.$t("core::tags.edit_tag")),1),o("div",P_,[s(P,{"label-for":"tag_name",label:B.$t("core::tags.tag_name"),required:""},{default:b(()=>[s(j,{id:"tag_name",modelValue:l(g).name,"onUpdate:modelValue":z[0]||(z[0]=K=>l(g).name=K),name:"tag_name",onKeydown:Tt($,["enter"])},null,8,["modelValue","onKeydown"]),s(U,{textContent:S(l(g).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(H,{label:B.$t("core::tags.color"),class:"mb-1",required:""},null,8,["label"]),s(L,{modelValue:l(g).swatch_color,"onUpdate:modelValue":z[1]||(z[1]=K=>l(g).swatch_color=K),"allow-remove":!1,swatches:l(h)},null,8,["modelValue","swatches"]),s(U,{textContent:S(l(g).getError("swatch_color"))},null,8,["textContent"])]),o("div",j_,[o("div",L_,[!_.value&&B.$gate.isSuperAdmin()?(d(),R(Z,{key:0,variant:"danger",icon:y.value===null?"Trash":null,text:y.value===null?void 0:B.$t("core::app.confirm"),size:"sm",onClick:z[2]||(z[2]=K=>E(I.value))},null,8,["icon","text"])):O("",!0),o("div",H_,[s(Z,{variant:"white",text:B.$t("core::app.cancel"),size:"sm",onClick:x},null,8,["text"]),s(Z,{variant:"primary",text:B.$t("core::app.save"),loading:l(g).busy,disabled:l(g).busy,size:"sm",onClick:$},null,8,["text","loading","disabled"])])])])]),key:"0"}:void 0,B.$gate.isSuperAdmin()?{name:"footer",fn:b(()=>[D(o("a",{href:"#",class:"link block border-t border-neutral-200 px-4 py-2 text-sm hover:bg-neutral-50 dark:border-neutral-600 dark:hover:bg-neutral-700",onClick:z[3]||(z[3]=ie(K=>_.value=!0,["prevent"]))}," + "+S(B.$t("core::tags.add_new")),513),[[Y,!F.value]])]),key:"1"}:void 0]),1032,["model-value","options","reduce","simple","searchable","placeholder","toggle-icon","list-wrapper-class","list-class","reorderable"])}}},G_={__name:"TagsField",props:ut,setup(e){const t=e,n=q([]);function a(){var h;n.value=((h=t.field.value)==null?void 0:h.map(g=>typeof g=="string"?g:g.name))||[]}function r(h){h.value=(h==null?void 0:h.map(g=>typeof g=="string"?g:g.name))||[],f.value=h.value}const{field:i,label:u,fieldId:c,isReadonly:m,initialize:p,realInitialValue:f}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{setInitialValue:a,handleChange:r});return De(p),(h,g)=>(d(),R(it,{field:l(i),label:l(u),"field-id":l(c),"form-id":h.formId},{default:b(()=>[s(Wo,Re({modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=y=>n.value=y),disabled:l(m),"input-id":l(c),name:l(i).attribute,type:l(i).type},l(i).attributes),null,16,["modelValue","disabled","input-id","name","type"])]),_:1},8,["field","label","field-id","form-id"]))}},K_=Object.freeze(Object.defineProperty({__proto__:null,default:G_},Symbol.toStringTag,{value:"Module"})),Y_={class:"font-medium"},W_={class:"mt-4"},Q_={class:"-mx-2 -my-1.5 flex"},X_={__name:"TextField",props:ut,setup(e){const t=e,n=q(""),a=dt(null),{field:r,label:i,fieldId:u,isReadonly:c,initialize:m,checksForDuplicates:p,makeDuplicateCheckRequest:f}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating")),h=Dt(()=>{if(!p.value||t.resourceId||!n.value){a.value=null;return}f(n.value).then(g=>a.value=g)},700);return De(m),(g,y)=>{const _=v("IFormInput"),I=v("i18n-t"),F=v("IButtonMinimal"),$=v("IAlert");return d(),R(it,{field:l(r),label:l(i),"field-id":l(u),"form-id":g.formId},{default:b(()=>[s(_,Re({id:l(u),modelValue:n.value,"onUpdate:modelValue":y[0]||(y[0]=C=>n.value=C),disabled:l(c),type:l(r).inputType||"text"},l(r).attributes,{onInput:l(h)}),null,16,["id","modelValue","disabled","type","onInput"]),a.value?(d(),R($,{key:0,dismissible:"",class:"mt-2",onDismissed:y[1]||(y[1]=C=>a.value=null)},{default:b(()=>[s(I,{scope:"global",keypath:l(r).checkDuplicatesWith.lang_keypath},{display_name:b(()=>[o("span",Y_,S(a.value.display_name),1)]),_:1},8,["keypath"]),o("div",W_,[o("div",Q_,[s(F,{tag:"a",href:a.value.path,rel:"noopener noreferrer",target:"_blank",variant:"info",icon:"ExternalLink",text:g.$t("core::app.view_record")},null,8,["href","text"])])])]),_:1})):O("",!0)]),_:1},8,["field","label","field-id","form-id"])}}},Z_=Object.freeze(Object.defineProperty({__proto__:null,default:X_},Symbol.toStringTag,{value:"Module"})),J_={__name:"TextareaField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,isReadonly:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(c),(m,p)=>{const f=v("IFormTextarea");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":m.formId},{default:b(()=>[s(f,Re({id:l(i),modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=h=>n.value=h),disabled:l(u),name:l(a).attribute},l(a).attributes),null,16,["id","modelValue","disabled","name"])]),_:1},8,["field","label","field-id","form-id"])}}},eg=Object.freeze(Object.defineProperty({__proto__:null,default:J_},Symbol.toStringTag,{value:"Module"})),hs={__name:"TimezoneInput",props:{modelValue:null,fieldId:{type:String,default:"timezone"}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,a=Pe(),r=Go(n,"modelValue",t);function i(c){return"UTC/GMT "+moment.tz(c.label).format("Z")+" "+c.label}const u=V(()=>a.state.timezones);return u.value.length===0&&a.dispatch("fetchTimezones"),(c,m)=>{const p=v("ICustomSelect");return d(),R(p,{modelValue:l(r),"onUpdate:modelValue":m[0]||(m[0]=f=>xt(r)?r.value=f:null),"input-id":e.fieldId,options:u.value},{option:b(f=>[Q(S(i(f)),1)]),_:1},8,["modelValue","input-id","options"])}}},tg={__name:"TimezoneField",props:ut,setup(e){const t=e,n=Pe(),a=q(""),{field:r,label:i,fieldId:u,isReadonly:c,initialize:m}=ht(a,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(m),n.commit("SET_TIMEZONES",t.field.timezones),(p,f)=>(d(),R(it,{field:l(r),label:l(i),"field-id":l(u),"form-id":p.formId},{default:b(()=>[s(hs,Re({modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=h=>a.value=h)},l(r).attributes,{"field-id":l(u),clearable:!0,name:l(r).attribute,disabled:l(c)}),null,16,["modelValue","field-id","name","disabled"])]),_:1},8,["field","label","field-id","form-id"]))}},ng=Object.freeze(Object.defineProperty({__proto__:null,default:tg},Symbol.toStringTag,{value:"Module"})),og={class:"relative"},lg={key:0,class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},ag=o("span",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:"https://"},null,-1),sg=[ag],rg={class:"absolute inset-y-0 right-0 flex items-center pr-3"},ig=["href"],ug={__name:"UrlField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,isReadonly:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(c),(m,p)=>{const f=v("IFormInput"),h=v("Icon");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":m.formId},{default:b(()=>[o("div",og,[l(a).https?(d(),k("div",lg,sg)):O("",!0),s(f,Re({id:l(i),modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=g=>n.value=g),disabled:l(u),type:"url"},l(a).attributes,{class:["pr-10",{"pl-16":l(a).https}]}),null,16,["id","modelValue","disabled","class"]),o("div",rg,[o("a",{href:n.value||"#",class:X([n.value?"link":"text-neutral-400 dark:text-neutral-300",{"pointer-events-none":!n.value}])},[s(h,{icon:"Link",class:"h-5 w-5"})],10,ig)])])]),_:1},8,["field","label","field-id","form-id"])}}},dg=Object.freeze(Object.defineProperty({__proto__:null,default:ug},Symbol.toStringTag,{value:"Module"})),Qo=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name"));p();function r(f){return n.value.findIndex(h=>h.id==f)}function i(f){n.value.splice(r(f),1)}function u(f){n.value.push(f)}function c(f,h){n.value[r(f)]=h}async function m(f){await Innoclapps.request().delete(`/teams/${f}`),i(f)}function p(){e(!0),Innoclapps.request().get("/teams").then(({data:f})=>n.value=f).finally(()=>e(!1))}return{teams:n,teamsByName:a,teamsAreBeingFetched:t,addTeam:u,removeTeam:i,setTeam:c,deleteTeam:m,fetchTeams:p}}),cg={class:"text-sm font-medium text-neutral-700 dark:text-neutral-100"},mg={class:"mt-2"},pg=o("legend",{class:"sr-only"},"Visibility group",-1),fg={class:"space-y-3 sm:flex sm:items-center sm:space-x-4 sm:space-y-0"},vg={class:"mt-4"},bg={class:"mt-0.5 block text-right text-xs text-neutral-500 dark:text-neutral-300"},hg={class:"mt-4"},Xo={__name:"VisibilityGroupSelector",props:{disabled:Boolean,dependsOn:Array,type:String},emits:["update:type","update:dependsOn"],setup(e){const{users:t}=Le(),{teamsByName:n}=Qo(),a=V(()=>t.value.filter(r=>!r.super_admin));return(r,i)=>{const u=v("IFormRadio"),c=v("ICustomSelect"),m=ae("t");return d(),k("div",null,[D(o("label",cg,null,512),[[m,"core::app.visibility_group.visible_to"]]),o("fieldset",mg,[pg,o("div",fg,[s(u,{"model-value":e.type,disabled:e.disabled,value:"all","onUpdate:modelValue":i[0]||(i[0]=p=>r.$emit("update:type",p)),onChange:i[1]||(i[1]=p=>r.$emit("update:dependsOn",[]))},{default:b(()=>[Q(S(r.$t("core::app.visibility_group.all")),1)]),_:1},8,["model-value","disabled"]),s(u,{"model-value":e.type,disabled:e.disabled,value:"teams","onUpdate:modelValue":i[2]||(i[2]=p=>r.$emit("update:type",p)),onChange:i[3]||(i[3]=p=>r.$emit("update:dependsOn",[]))},{default:b(()=>[Q(S(r.$t("users::team.teams")),1)]),_:1},8,["model-value","disabled"]),s(u,{"model-value":e.type,disabled:e.disabled,value:"users","onUpdate:modelValue":i[4]||(i[4]=p=>r.$emit("update:type",p)),onChange:i[5]||(i[5]=p=>r.$emit("update:dependsOn",[]))},{default:b(()=>[Q(S(r.$t("users::user.users")),1)]),_:1},8,["model-value","disabled"])])]),D(o("div",vg,[s(c,{"model-value":e.dependsOn,options:a.value,placeholder:r.$t("users::user.select"),label:"name",multiple:"",reduce:p=>p.id,"onUpdate:modelValue":i[6]||(i[6]=p=>r.$emit("update:dependsOn",p))},null,8,["model-value","options","placeholder","reduce"]),D(o("span",bg,null,512),[[m,"users::user.admin_users_excluded"]])],512),[[Y,e.type==="users"]]),D(o("div",hg,[s(c,{"model-value":e.dependsOn,options:l(n),placeholder:r.$t("users::team.select"),label:"name",multiple:"",reduce:p=>p.id,"onUpdate:modelValue":i[7]||(i[7]=p=>r.$emit("update:dependsOn",p))},null,8,["model-value","options","placeholder","reduce"])],512),[[Y,e.type==="teams"]])])}}},_g={__name:"VisibilityGroupField",props:ut,setup(e){const t=e,n=q({}),{field:a,label:r,fieldId:i,isReadonly:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{setInitialValue:m});function m(){!t.field.value||!t.field.value.type?n.value={type:"all",depends_on:[]}:n.value=t.field.value}return De(c),(p,f)=>(d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":p.formId},{default:b(()=>[s(Xo,Re({type:n.value.type,"onUpdate:type":f[0]||(f[0]=h=>n.value.type=h),dependsOn:n.value.depends_on,"onUpdate:dependsOn":f[1]||(f[1]=h=>n.value.depends_on=h)},l(a).attributes,{disabled:l(u)}),null,16,["type","dependsOn","disabled"])]),_:1},8,["field","label","field-id","form-id"]))}},gg=Object.freeze(Object.defineProperty({__proto__:null,default:_g},Symbol.toStringTag,{value:"Module"})),yg={key:1},Ht={__name:"OptionsList",props:["resourceName","resourceId","value","displayAsPills","eachOnNewLine","onClickRedirectTo","labelKey"],setup(e){const t=e,n=V(()=>t.value?wt(t.value):[]),a=V(()=>n.value.length);return(r,i)=>{const u=v("Icon");return a.value>0?(d(),k("div",{key:0,class:X(e.eachOnNewLine?"space-y-0.5":"space-x-2")},[(d(!0),k(te,null,re(n.value,(c,m)=>(d(),R(We(e.onClickRedirectTo?"router-link":"span"),{key:m,class:X([e.onClickRedirectTo&&!e.displayAsPills?"link":void 0,e.eachOnNewLine?"block":""]),to:e.onClickRedirectTo?e.onClickRedirectTo.replace("{id}",c.id):void 0},{default:b(()=>[(d(),R(We(c.swatch_color&&e.displayAsPills?zt:"span"),{color:c.swatch_color&&e.displayAsPills?c.swatch_color:void 0,class:X(["inline-flex items-center justify-center space-x-1.5",{"rounded-full px-2.5 text-sm/5 font-normal":e.displayAsPills},!c.swatch_color&&e.displayAsPills?"bg-neutral-200 dark:bg-neutral-600":c.swatch_color&&e.displayAsPills?"dark:!text-white ":""])},{default:b(()=>[c.icon?(d(),R(u,{key:0,icon:c.icon,class:"h-4 w-4 text-current"},null,8,["icon"])):O("",!0),o("span",null,S(c[e.labelKey]),1)]),_:2},1032,["color","class"]))]),_:2},1032,["class","to"]))),128))],2)):(d(),k("span",yg,""))}}},xg={__name:"BelongsToField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("DetailFieldsItem");return d(),R(a,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"label-key":e.field.labelKey,"display-as-pills":e.field.displayAsPills,"on-click-redirect-to":e.field.onOptionClickRedirectTo},null,8,["value","resource-name","resource-id","label-key","display-as-pills","on-click-redirect-to"])]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Ig=Object.freeze(Object.defineProperty({__proto__:null,default:xg},Symbol.toStringTag,{value:"Module"})),kg={__name:"BooleanField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const t=e,n=V(()=>t.field.value===t.field.trueValue);return(a,r)=>{const i=v("DetailFieldsItem");return d(),R(i,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(()=>[o("span",{class:X(["mt-0.5 inline-block h-4 w-4 rounded-full",n.value?"bg-success-400":"bg-danger-400"])},null,2)]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},$g=Object.freeze(Object.defineProperty({__proto__:null,default:kg},Symbol.toStringTag,{value:"Module"})),wg={__name:"CheckboxField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("DetailFieldsItem");return d(),R(a,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"display-as-pills":e.field.displayAsPills,"each-on-new-line":e.field.eachOnNewLine,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"label-key":e.field.labelKey},null,8,["value","resource-name","resource-id","display-as-pills","each-on-new-line","on-click-redirect-to","label-key"])]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Cg=Object.freeze(Object.defineProperty({__proto__:null,default:wg},Symbol.toStringTag,{value:"Module"})),Sg={key:1},Rg={__name:"ColorSwatchField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("DetailFieldsItem");return d(),R(a,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:r,value:i})=>[r?(d(),k("span",{key:0,class:"block h-6 w-6 rounded-md",style:st({backgroundColor:i})},null,4)):(d(),k("span",Sg,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Fg=Object.freeze(Object.defineProperty({__proto__:null,default:Rg},Symbol.toStringTag,{value:"Module"})),Vg={key:0},Tg={__name:"DateField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const{localizedDate:t}=Ne();return(n,a)=>{const r=v("DetailFieldsItem");return d(),R(r,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:i,value:u})=>[Q(S(i?l(t)(u):"")+" ",1),i?O("",!0):(d(),k("span",Vg,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Dg=Object.freeze(Object.defineProperty({__proto__:null,default:Tg},Symbol.toStringTag,{value:"Module"})),qg={key:0},Eg={__name:"DateTimeField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const{localizedDateTime:t}=Ne();return(n,a)=>{const r=v("DetailFieldsItem");return d(),R(r,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:i,value:u})=>[Q(S(i?l(t)(u):"")+" ",1),i?O("",!0):(d(),k("span",qg,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Ag=Object.freeze(Object.defineProperty({__proto__:null,default:Eg},Symbol.toStringTag,{value:"Module"})),Bg=["href"],Ng={key:1},Og={__name:"DomainField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("Icon"),r=v("DetailFieldsItem");return d(),R(r,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:i,value:u})=>[i?(d(),k("a",{key:0,href:"http://"+u,target:"_blank",rel:"noopener noreferrer",class:"link inline-flex items-center text-sm"},[Q(S(u)+" ",1),s(a,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})],8,Bg)):(d(),k("span",Ng,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},zg=Object.freeze(Object.defineProperty({__proto__:null,default:Og},Symbol.toStringTag,{value:"Module"})),Mg={key:0},Ug={__name:"EditorField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("TextCollapse"),r=v("DetailFieldsItem");return d(),R(r,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:i,value:u})=>[s(a,{text:u||""},null,8,["text"]),i?O("",!0):(d(),k("span",Mg,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Pg=Object.freeze(Object.defineProperty({__proto__:null,default:Ug},Symbol.toStringTag,{value:"Module"})),jg=["href","onClick","textContent"],Lg={key:1},Hg={__name:"EmailField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("IButtonCopy"),r=v("IDropdownItem"),i=v("IDropdown"),u=v("DetailFieldsItem");return d(),R(u,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:c,value:m})=>[c?(d(),R(i,{key:0,"no-caret":""},{toggle:b(({toggle:p})=>[o("a",{class:"link text-sm",href:"mailto:"+m,onClick:ie(p,["prevent"]),textContent:S(m)},null,8,jg)]),default:b(()=>[s(a,{"success-message":t.$t("core::fields.email_copied"),text:m,tag:"IDropdownItem"},{default:b(()=>[Q(S(t.$t("core::app.copy")),1)]),_:2},1032,["success-message","text"]),s(r,{href:"mailto:"+m,text:t.$t("core::app.open_in_app")},null,8,["href","text"])]),_:2},1024)):(d(),k("span",Lg,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Gg=Object.freeze(Object.defineProperty({__proto__:null,default:Hg},Symbol.toStringTag,{value:"Module"})),Kg={key:1},Yg={__name:"IconPickerField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("Icon"),r=v("DetailFieldsItem");return d(),R(r,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:i,value:u})=>[i?(d(),R(a,{key:0,icon:u,class:"h-5 w-5"},null,8,["icon"])):(d(),k("span",Kg,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Wg=Object.freeze(Object.defineProperty({__proto__:null,default:Yg},Symbol.toStringTag,{value:"Module"})),Qg={key:0},Xg={__name:"NumberField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const{formatNumber:t}=Mt();return(n,a)=>{const r=v("DetailFieldsItem");return d(),R(r,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:i,value:u})=>[Q(S(i?l(t)(u):"")+" ",1),i?O("",!0):(d(),k("span",Qg,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},Zg=Object.freeze(Object.defineProperty({__proto__:null,default:Xg},Symbol.toStringTag,{value:"Module"})),Jg={__name:"NumericField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e,{expose:t}){const n=e,{formatMoney:a,formatNumber:r}=Mt(),i=V(()=>{var m;let u=n.field.value;if(qn(u)&&(u=""),n.field.currency)return a(u,n.field.currency);const c=r(u,{precision:((m=n.field.attributes)==null?void 0:m.precision)||2});return(n.field.prependText||"")+c+(n.field.appendText||"")});return t({formattedValue:i}),(u,c)=>{const m=v("DetailFieldsItem");return d(),R(m,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},vt({field:b(()=>[de(u.$slots,"numeric-field",{formattedValue:i.value},()=>[Q(S(i.value),1)])]),_:2},[re(u.$slots,(p,f)=>({name:f,fn:b(h=>[de(u.$slots,f,pt(ft(h)))])}))]),1032,["field","is-floating","resource","resource-name","resource-id"])}}},ey=Object.freeze(Object.defineProperty({__proto__:null,default:Jg},Symbol.toStringTag,{value:"Module"})),ty={__name:"RadioField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const t=e,n=V(()=>t.field.value?t.field.options.find(a=>a[t.field.valueKey]==t.field.value):null);return(a,r)=>{const i=v("DetailFieldsItem");return d(),R(i,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(()=>[s(Ht,{value:n.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"display-as-pills":e.field.displayAsPills,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"label-key":e.field.labelKey},null,8,["value","resource-name","resource-id","display-as-pills","on-click-redirect-to","label-key"])]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},ny=Object.freeze(Object.defineProperty({__proto__:null,default:ty},Symbol.toStringTag,{value:"Module"})),oy={__name:"SelectField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const t=e,n=V(()=>t.field.value?t.field.options.find(a=>a[t.field.valueKey]==t.field.value):null);return(a,r)=>{const i=v("DetailFieldsItem");return d(),R(i,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(()=>[s(Ht,{value:n.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"display-as-pills":e.field.displayAsPills,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"label-key":e.field.labelKey},null,8,["value","resource-name","resource-id","display-as-pills","on-click-redirect-to","label-key"])]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},ly=Object.freeze(Object.defineProperty({__proto__:null,default:oy},Symbol.toStringTag,{value:"Module"})),ay={__name:"SelectMultipleField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("DetailFieldsItem");return d(),R(a,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"display-as-pills":e.field.displayAsPills,"each-on-new-line":e.field.eachOnNewLine,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"label-key":e.field.labelKey},null,8,["value","resource-name","resource-id","display-as-pills","each-on-new-line","on-click-redirect-to","label-key"])]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},sy=Object.freeze(Object.defineProperty({__proto__:null,default:ay},Symbol.toStringTag,{value:"Module"})),ry={__name:"TagsField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("DetailFieldsItem");return d(),R(a,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"label-key":"name","display-as-pills":!0},null,8,["value","resource-name","resource-id"])]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},iy=Object.freeze(Object.defineProperty({__proto__:null,default:ry},Symbol.toStringTag,{value:"Module"})),uy={key:0},dy={key:1},cy={__name:"TextField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("DetailFieldsItem");return d(),R(a,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:r,value:i})=>[r?(d(),k("p",uy,S(i),1)):(d(),k("span",dy,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},my=Object.freeze(Object.defineProperty({__proto__:null,default:cy},Symbol.toStringTag,{value:"Module"})),py=["textContent"],fy={key:1},vy={__name:"TextareaField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("DetailFieldsItem");return d(),R(a,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:r,value:i})=>[r?(d(),k("div",{key:0,textContent:S(i)},null,8,py)):(d(),k("span",fy,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},by=Object.freeze(Object.defineProperty({__proto__:null,default:vy},Symbol.toStringTag,{value:"Module"})),hy={key:0,class:"text-sm"},_y={class:"block text-xs text-neutral-500"},gy={key:1},yy={__name:"TimezoneField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const{appMoment:t,dateTimeFormatForMoment:n}=Ne();return(a,r)=>{const i=v("DetailFieldsItem");return d(),R(i,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:u,value:c})=>[u?(d(),k("p",hy,[Q(S(c)+" ",1),o("span",_y,S(l(t)(new Date).tz(c).format(l(n))),1)])):(d(),k("span",gy,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},xy=Object.freeze(Object.defineProperty({__proto__:null,default:yy},Symbol.toStringTag,{value:"Module"})),Iy=["href"],ky={key:1},$y={__name:"UrlField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){return(t,n)=>{const a=v("Icon"),r=v("DetailFieldsItem");return d(),R(r,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:i,value:u})=>[i?(d(),k("a",{key:0,href:u,target:"_blank",rel:"noopener noreferrer",class:"link inline-flex items-center break-all text-sm"},[Q(S(u)+" ",1),s(a,{icon:"ExternalLink",class:"ml-1 mt-0.5 h-4 w-4 self-start"})],8,Iy)):(d(),k("span",ky,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},wy=Object.freeze(Object.defineProperty({__proto__:null,default:$y},Symbol.toStringTag,{value:"Module"})),Cy={__name:"BelongsToField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[s(Ht,{value:e.field.value,field:e.field,"resource-name":e.resourceName,"resource-id":e.resourceId,"label-key":e.field.labelKey,"display-as-pills":e.field.displayAsPills,"on-click-redirect-to":e.field.onOptionClickRedirectTo},null,8,["value","field","resource-name","resource-id","label-key","display-as-pills","on-click-redirect-to"])]),_:1},8,["resource-name","resource-id","row","field"])}}},Sy=Object.freeze(Object.defineProperty({__proto__:null,default:Cy},Symbol.toStringTag,{value:"Module"})),Ry={__name:"BooleanField",props:["column","row","field","resourceName","resourceId"],setup(e){const t=e,n=V(()=>t.field.value===t.field.trueValue);return(a,r)=>{const i=v("IndexFieldsItem");return d(),R(i,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[o("span",{class:X(["mt-0.5 inline-block h-4 w-4 rounded-full",n.value?"bg-success-400":"bg-danger-400"])},null,2)]),_:1},8,["resource-name","resource-id","row","field"])}}},Fy=Object.freeze(Object.defineProperty({__proto__:null,default:Ry},Symbol.toStringTag,{value:"Module"})),Vy={__name:"CheckboxField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"display-as-pills":e.field.displayAsPills,"each-on-new-line":e.field.eachOnNewLine,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"label-key":e.field.labelKey},null,8,["value","resource-name","resource-id","display-as-pills","each-on-new-line","on-click-redirect-to","label-key"])]),_:1},8,["resource-name","resource-id","row","field"])}}},Ty=Object.freeze(Object.defineProperty({__proto__:null,default:Vy},Symbol.toStringTag,{value:"Module"})),Dy={key:1},qy={__name:"ColorSwatchField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:r,value:i})=>[r?(d(),k("span",{key:0,class:"block h-6 w-6 rounded-md",style:st({backgroundColor:i})},null,4)):(d(),k("span",Dy,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},Ey=Object.freeze(Object.defineProperty({__proto__:null,default:qy},Symbol.toStringTag,{value:"Module"})),Ay={key:0},By={__name:"DateField",props:["column","row","field","resourceName","resourceId"],setup(e){const{localizedDate:t}=Ne();return(n,a)=>{const r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[Q(S(i?l(t)(u):"")+" ",1),i?O("",!0):(d(),k("span",Ay,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},Ny=Object.freeze(Object.defineProperty({__proto__:null,default:By},Symbol.toStringTag,{value:"Module"})),Oy={key:0},zy={__name:"DateTimeField",props:["column","row","field","resourceName","resourceId"],setup(e){const{localizedDateTime:t}=Ne();return(n,a)=>{const r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[Q(S(i?l(t)(u):"")+" ",1),i?O("",!0):(d(),k("span",Oy,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},My=Object.freeze(Object.defineProperty({__proto__:null,default:zy},Symbol.toStringTag,{value:"Module"})),Uy=["href"],Py={key:1},jy={__name:"DomainField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("Icon"),r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[i?(d(),k("a",{key:0,href:"http://"+u,target:"_blank",rel:"noopener noreferrer",class:"link inline-flex items-center text-sm"},[Q(S(u)+" ",1),s(a,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})],8,Uy)):(d(),k("span",Py,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},Ly=Object.freeze(Object.defineProperty({__proto__:null,default:jy},Symbol.toStringTag,{value:"Module"})),Hy={key:0},Gy={__name:"EditorField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("TextCollapse"),r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[s(a,{text:u||""},null,8,["text"]),i?O("",!0):(d(),k("span",Hy,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},Ky=Object.freeze(Object.defineProperty({__proto__:null,default:Gy},Symbol.toStringTag,{value:"Module"})),Yy=["href","onClick","textContent"],Wy={key:1},_s={__name:"EmailField",props:["column","row","field","resourceName","resourceId"],emits:["show"],setup(e,{expose:t}){const n=q(null);return t({dropdownRef:n}),(a,r)=>{const i=v("IButtonCopy"),u=v("IDropdownItem"),c=v("IDropdown"),m=v("IndexFieldsItem");return d(),R(m,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:p,value:f})=>[p?(d(),R(c,{key:0,ref_key:"dropdownRef",ref:n,"no-caret":"",onShow:r[0]||(r[0]=h=>a.$emit("show"))},{toggle:b(({toggle:h})=>[o("a",{class:"link",href:"mailto:"+f,onClick:ie(h,["prevent"]),textContent:S(f)},null,8,Yy)]),default:b(()=>[de(a.$slots,"start",{email:f}),s(i,{"success-message":a.$t("core::fields.email_copied"),text:f,tag:"IDropdownItem"},{default:b(()=>[Q(S(a.$t("core::app.copy")),1)]),_:2},1032,["success-message","text"]),s(u,{href:"mailto:"+f,text:a.$t("core::app.open_in_app")},null,8,["href","text"])]),_:2},1536)):(d(),k("span",Wy,""))]),_:3},8,["resource-name","resource-id","row","field"])}}},Qy=Object.freeze(Object.defineProperty({__proto__:null,default:_s},Symbol.toStringTag,{value:"Module"})),Xy={key:1},Zy={__name:"IconPickerField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("Icon"),r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[i?(d(),R(a,{key:0,icon:u,class:"h-5 w-5"},null,8,["icon"])):(d(),k("span",Xy,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},Jy=Object.freeze(Object.defineProperty({__proto__:null,default:Zy},Symbol.toStringTag,{value:"Module"})),e1={key:0},t1={__name:"NumberField",props:["column","row","field","resourceName","resourceId"],setup(e){const{formatNumber:t}=Mt();return(n,a)=>{const r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[Q(S(i?l(t)(u):"")+" ",1),i?O("",!0):(d(),k("span",e1,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},n1=Object.freeze(Object.defineProperty({__proto__:null,default:t1},Symbol.toStringTag,{value:"Module"})),o1={__name:"NumericField",props:["column","row","field","resourceName","resourceId"],setup(e){const t=e,{formatMoney:n,formatNumber:a}=Mt(),r=V(()=>{var c;let i=t.field.value;if(qn(i)&&(i=""),t.field.currency)return n(i,t.field.currency);const u=a(i,{precision:((c=t.field.attributes)==null?void 0:c.precision)||2});return(t.field.prependText||"")+u+(t.field.appendText||"")});return(i,u)=>{const c=v("IndexFieldsItem");return d(),R(c,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},vt({field:b(()=>[de(i.$slots,"numeric-field",{formattedValue:r.value},()=>[Q(S(r.value),1)])]),_:2},[re(i.$slots,(m,p)=>({name:p,fn:b(f=>[de(i.$slots,p,pt(ft(f)))])}))]),1032,["resource-name","resource-id","row","field"])}}},l1=Object.freeze(Object.defineProperty({__proto__:null,default:o1},Symbol.toStringTag,{value:"Module"})),a1={__name:"RadioField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[s(Ht,{value:e.field.value,field:e.field,"resource-name":e.resourceName,"resource-id":e.resourceId,"label-key":e.field.labelKey,"display-as-pills":e.field.displayAsPills,"on-click-redirect-to":e.field.onOptionClickRedirectTo},null,8,["value","field","resource-name","resource-id","label-key","display-as-pills","on-click-redirect-to"])]),_:1},8,["resource-name","resource-id","row","field"])}}},s1=Object.freeze(Object.defineProperty({__proto__:null,default:a1},Symbol.toStringTag,{value:"Module"})),r1={__name:"SelectField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"display-as-pills":e.field.displayAsPills,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"label-key":e.field.labelKey},null,8,["value","resource-name","resource-id","display-as-pills","on-click-redirect-to","label-key"])]),_:1},8,["resource-name","resource-id","row","field"])}}},i1=Object.freeze(Object.defineProperty({__proto__:null,default:r1},Symbol.toStringTag,{value:"Module"})),u1={__name:"SelectMultipleField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"display-as-pills":e.field.displayAsPills,"each-on-new-line":e.field.eachOnNewLine,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"label-key":e.field.labelKey},null,8,["value","resource-name","resource-id","display-as-pills","each-on-new-line","on-click-redirect-to","label-key"])]),_:1},8,["resource-name","resource-id","row","field"])}}},d1=Object.freeze(Object.defineProperty({__proto__:null,default:u1},Symbol.toStringTag,{value:"Module"})),c1={__name:"TagsField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"label-key":"name","display-as-pills":!0},null,8,["value","resource-name","resource-id"])]),_:1},8,["resource-name","resource-id","row","field"])}}},m1=Object.freeze(Object.defineProperty({__proto__:null,default:c1},Symbol.toStringTag,{value:"Module"})),p1={key:0},f1={key:1},v1={__name:"TextField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:r,value:i})=>[r?(d(),k("p",p1,S(i),1)):(d(),k("span",f1,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},b1=Object.freeze(Object.defineProperty({__proto__:null,default:v1},Symbol.toStringTag,{value:"Module"})),h1=["textContent"],_1={key:1},g1={__name:"TextareaField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:r,value:i})=>[r?(d(),k("div",{key:0,class:"whitespace-pre",textContent:S(i)},null,8,h1)):(d(),k("span",_1,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},y1=Object.freeze(Object.defineProperty({__proto__:null,default:g1},Symbol.toStringTag,{value:"Module"})),x1={key:0,class:"text-sm"},I1={class:"block text-xs text-neutral-500"},k1={key:1},$1={__name:"TimezoneField",props:["column","row","field","resourceName","resourceId"],setup(e){const{appMoment:t,dateTimeFormatForMoment:n}=Ne();return(a,r)=>{const i=v("IndexFieldsItem");return d(),R(i,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:u,value:c})=>[u?(d(),k("p",x1,[Q(S(c)+" ",1),o("span",I1,S(l(t)(new Date).tz(c).format(l(n))),1)])):(d(),k("span",k1,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},w1=Object.freeze(Object.defineProperty({__proto__:null,default:$1},Symbol.toStringTag,{value:"Module"})),C1=["href"],S1={key:1},R1={__name:"UrlField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("Icon"),r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[i?(d(),k("a",{key:0,href:u,target:"_blank",rel:"noopener noreferrer",class:"link inline-flex items-center text-sm"},[Q(S(u)+" ",1),s(a,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})],8,C1)):(d(),k("span",S1,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},F1=Object.freeze(Object.defineProperty({__proto__:null,default:R1},Symbol.toStringTag,{value:"Module"})),V1={key:0,class:"inline-flex items-center"},T1=["textContent"],D1={key:1},q1={__name:"UserField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IAvatar"),r=v("IndexFieldsItem");return d(),R(r,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:i,value:u})=>[i?(d(),k("span",V1,[s(a,{src:u.avatar_url,alt:u.name,size:"xs"},null,8,["src","alt"]),o("span",{class:"ml-1 truncate",textContent:S(u.name)},null,8,T1)])):(d(),k("span",D1,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},E1=Object.freeze(Object.defineProperty({__proto__:null,default:q1},Symbol.toStringTag,{value:"Module"})),wa=Object.assign({"./fields/Form/BelongsToField.vue":E0,"./fields/Form/BooleanField.vue":N0,"./fields/Form/CheckboxField.vue":z0,"./fields/Form/ColorSwatchField.vue":U0,"./fields/Form/DateField.vue":j0,"./fields/Form/DateTimeField.vue":H0,"./fields/Form/DomainField.vue":W0,"./fields/Form/EditorField.vue":X0,"./fields/Form/EmailField.vue":l_,"./fields/Form/HeadingField.vue":u_,"./fields/Form/IconPickerField.vue":c_,"./fields/Form/NumericField.vue":__,"./fields/Form/RadioField.vue":y_,"./fields/Form/ReminderField.vue":F_,"./fields/Form/SelectField.vue":E_,"./fields/Form/SelectMultipleField.vue":z_,"./fields/Form/TagsField.vue":K_,"./fields/Form/TextField.vue":Z_,"./fields/Form/TextareaField.vue":eg,"./fields/Form/TimezoneField.vue":ng,"./fields/Form/UrlField.vue":dg,"./fields/Form/VisibilityGroupField.vue":gg}),Ca=Object.assign({"./fields/Detail/BelongsToField.vue":Ig,"./fields/Detail/BooleanField.vue":$g,"./fields/Detail/CheckboxField.vue":Cg,"./fields/Detail/ColorSwatchField.vue":Fg,"./fields/Detail/DateField.vue":Dg,"./fields/Detail/DateTimeField.vue":Ag,"./fields/Detail/DomainField.vue":zg,"./fields/Detail/EditorField.vue":Pg,"./fields/Detail/EmailField.vue":Gg,"./fields/Detail/IconPickerField.vue":Wg,"./fields/Detail/NumberField.vue":Zg,"./fields/Detail/NumericField.vue":ey,"./fields/Detail/RadioField.vue":ny,"./fields/Detail/SelectField.vue":ly,"./fields/Detail/SelectMultipleField.vue":sy,"./fields/Detail/TagsField.vue":iy,"./fields/Detail/TextField.vue":my,"./fields/Detail/TextareaField.vue":by,"./fields/Detail/TimezoneField.vue":xy,"./fields/Detail/UrlField.vue":wy}),Sa=Object.assign({"./fields/Index/BelongsToField.vue":Sy,"./fields/Index/BooleanField.vue":Fy,"./fields/Index/CheckboxField.vue":Ty,"./fields/Index/ColorSwatchField.vue":Ey,"./fields/Index/DateField.vue":Ny,"./fields/Index/DateTimeField.vue":My,"./fields/Index/DomainField.vue":Ly,"./fields/Index/EditorField.vue":Ky,"./fields/Index/EmailField.vue":Qy,"./fields/Index/IconPickerField.vue":Jy,"./fields/Index/NumberField.vue":n1,"./fields/Index/NumericField.vue":l1,"./fields/Index/RadioField.vue":s1,"./fields/Index/SelectField.vue":i1,"./fields/Index/SelectMultipleField.vue":d1,"./fields/Index/TagsField.vue":m1,"./fields/Index/TextField.vue":b1,"./fields/Index/TextareaField.vue":y1,"./fields/Index/TimezoneField.vue":w1,"./fields/Index/UrlField.vue":F1,"./fields/Index/UserField.vue":E1});function Gl(e){return e.split("/").at(-1).split(".")[0]}function A1(e){for(const t in wa)e.component(`Form${Gl(t)}`,wa[t].default)}function B1(e){for(const t in Ca)e.component(`Detail${Gl(t)}`,Ca[t].default)}function N1(e){for(const t in Sa)e.component(`Index${Gl(t)}`,Sa[t].default)}function O1(e){A1(e),B1(e),N1(e)}function z1(e,t){return fd(e,t.replace("::","."))}const Ra=pd({legacy:!1,globalInjection:!0,locale:Yn(),fallbackLocale:"en",messageResolver:z1,messages:lang}),qe={instance:Ra,t:Ra.global.t};window.Pusher=vd;class M1{constructor(t){this.config=t,this.hasDriver()&&this.configure()}configure(){window.Echo=new bd(this.getDriverConfig())}getDriverConfig(){return{broadcaster:this.config.default,...this.getConfigByDriver(this.config.default)}}hasDriver(){return this.config.default&&this.config.default!=="log"&&this.config.default!=="null"}getConfigByDriver(t){if(t==="pusher")return{key:this.config.connection.key,cluster:this.config.connection.options.cluster,encrypted:this.config.connection.options.encrypted,authorizer:(n,a)=>({authorize:(r,i)=>{Innoclapps.request().post("/broadcasting/auth",{socket_id:r,channel_name:n.name},{baseURL:"/"}).then(u=>{i(!1,u.data)}).catch(u=>{i(!0,u)})}})}}}Element.prototype.parents=function(e){for(var t=[],n=this,a=e!==void 0;(n=n.parentElement)!==null;)n.nodeType===Node.ELEMENT_NODE&&(!a||n.matches(e))&&t.push(n);return t};function gs(e){return e.parents(".dialog")[0]||null}Element.prototype.parentDialogIdHash=function(){let e=gs(this);return e?"#"+e.getAttribute("id"):""};Element.prototype.inDialog=function(){return!!gs(this)};function U1(e){var t={d:"DD",D:"ddd",j:"D",l:"dddd",N:"E",S:function(){return"["+this.format("Do").replace(/\d*/g,"")+"]"},w:"d",z:function(){return this.format("DDD")-1},W:"W",F:"MMMM",m:"MM",M:"MMM",n:"M",t:function(){return this.daysInMonth()},L:function(){return this.isLeapYear()?1:0},o:"GGGG",Y:"YYYY",y:"YY",a:"a",A:"A",B:function(){var a=this.clone().utc(),r=(a.hours()+1)%24+a.minutes()/60+a.seconds()/3600;return Math.floor(r*1e3/24)},g:"h",G:"H",h:"hh",H:"HH",i:"mm",s:"ss",u:"[u]",e:"[e]",I:function(){return this.isDST()?1:0},O:"ZZ",P:"Z",T:"[T]",Z:function(){return parseInt(this.format("ZZ"),10)*36},c:"YYYY-MM-DD[T]HH:mm:ssZ",r:"ddd, DD MMM YYYY HH:mm:ss ZZ",U:"X"},n=/[dDjlNSwzWFmMntLoYyaABgGhHisueIOPTZcrU]/g;e.fn.formatPHP=function(a){var r=this;return this.format(a.replace(n,function(i){return typeof t[i]=="function"?t[i].call(r):t[i]}))},e.fn.PHPconvertFormat=function(a){var r=this;return a.replace(n,function(i){return typeof t[i]=="function"?t[i].call(r):t[i]})}}const Fa=()=>Yn().replace("_","-").toLowerCase();Eo.locale(Eo.locales().indexOf(Fa())===-1?"en":Fa());U1(Eo);window.moment=Eo;const P1={fields:{},placeholders:null,placeholdersResources:["contacts","companies","deals"],placeholdersRequestInProgress:!1},j1={SET(e,t){e.fields[t.group]=t.fields},RESET(e){e.fields={},e.placeholders=null},SET_PLACEHOLDERS(e,t){e.placeholders=t},PLACEHOLDERS_REQUEST_IN_PROGRESS(e,t){e.placeholdersRequestInProgress=t}},L1={async getForResource({commit:e,state:t},{resourceName:n,view:a,resourceId:r,viaResource:i,viaResourceId:u,intent:c,params:m={}}){let p=n+"-"+a+(i?"-"+i:"");if(t.fields[p]!==void 0&&!r&&!m.resourceId)return t.fields[p];let{data:f}=await Innoclapps.request().get(`/${n}${r?"/"+r:""}/${a}-fields`,{params:{intent:c||a,via_resource:i,via_resource_id:u,...m}});return e("SET",{group:p,fields:f}),f},async fetchPlaceholders({commit:e,state:t}){t.placeholders!==null||t.placeholdersRequestInProgress||(e("PLACEHOLDERS_REQUEST_IN_PROGRESS",!0),await Innoclapps.request().get("/placeholders",{params:{resources:t.placeholdersResources}}).then(({data:n})=>{e("SET_PLACEHOLDERS",n)}).finally(()=>e("PLACEHOLDERS_REQUEST_IN_PROGRESS",!1)))}},H1={namespaced:!0,state:P1,mutations:j1,actions:L1};function Va(){return{condition:"and",children:[]}}function ys(e){return["is_empty","is_not_empty","is_null","is_not_null"].indexOf(e)>=0}function Kl(e){return["between","not_between"].indexOf(e)>=0}function rl(e){return["in","not_in","between","not_between"].includes(e)}const G1={filters:{},rules:{},queryBuilderRules:{},visibleRules:{},rulesAreValidFor:{},hasRulesApplied:{},activeFilters:{}},K1={SET(e,t){e.filters[t.identifier]=t.filters},SET_RULES(e,t){e.rules[t.identifier]=t.rules},UPDATE(e,t){let n=Xe(e.filters[t.identifier],["id",Number(t.filter.id)]);n!==-1&&(e.filters[t.identifier][n]=t.filter)},PUSH(e,t){e.filters[t.identifier].push(t.filter)},REMOVE(e,t){let n=Xe(e.filters[t.identifier],["id",Number(t.id)]);n!==-1&&e.filters[t.identifier].splice(n,1)},SET_ACTIVE(e,t){e.activeFilters[t.identifier]||(e.activeFilters[t.identifier]={}),e.activeFilters[t.identifier][t.view]=t.id},CLEAR_ACTIVE(e,t){delete e.activeFilters[t.identifier][t.view]},UNMARK_AS_DEFAULT(e,t){let n=Xe(e.filters[t.identifier],["id",Number(t.id)]);if(n!==-1){let a=Xe(e.filters[t.identifier][n].defaults,{view:t.view,user_id:t.userId});a!==-1&&e.filters[t.identifier][n].defaults.splice(a,1)}},SET_RULES_VISIBLE(e,t){e.visibleRules[t.identifier]||(e.visibleRules[t.identifier]={}),e.visibleRules[t.identifier][t.view]=t.visible},SET_RULES_ARE_VALID(e,t){e.rulesAreValidFor[t.identifier]||(e.rulesAreValidFor[t.identifier]={}),e.rulesAreValidFor[t.identifier][t.view]=t.value},SET_HAS_RULES_APPLIED(e,t){e.hasRulesApplied[t.identifier]||(e.hasRulesApplied[t.identifier]={}),e.hasRulesApplied[t.identifier][t.view]=t.value},RESET_BUILDER_RULES(e,t){e.queryBuilderRules[t.identifier]||(e.queryBuilderRules[t.identifier]={}),e.queryBuilderRules[t.identifier][t.view]=Va()},SET_BUILDER_RULES(e,t){e.queryBuilderRules[t.identifier]||(e.queryBuilderRules[t.identifier]={}),e.queryBuilderRules[t.identifier][t.view]=t.rules},ADD_QUERY_GROUP(e,t){t.children.push({type:"group",query:Va()})},SET_QUERY_CHILDREN(e,t){t.query.children=t.children},ADD_QUERY_CHILD(e,t){t.query.children.push(t.child)},REMOVE_QUERY_CHILD(e,t){t.query.children.splice(t.index,1)},UPDATE_QUERY_VALUE(e,t){t.query.value=t.value},UPDATE_QUERY_CONDITION(e,t){t.query.condition=t.value},UPDATE_QUERY_OPERAND(e,t){t.query.operand=t.value},UPDATE_QUERY_OPERATOR(e,t){t.query.operator=t.value}},xs=(e,t)=>{let n=null;return e.every(a=>(Object.hasOwn(a.query,"children")&&a.query.children?n=xs(a.query.children,t):a.query.rule==t&&(n=a),!n)),n},Y1={findRuleInQueryBuilder:e=>(t,n,a)=>{if(!(!e.queryBuilderRules[t]||!e.queryBuilderRules[t][n]||!e.queryBuilderRules[t][n].children))return xs(e.queryBuilderRules[t][n].children,a)},getAll:e=>t=>En(e.filters[t],["is_system_default","name"],"desc","asc"),getById:e=>(t,n)=>Ee(e.filters[t],["id",n]),getDefault:e=>(t,n,a)=>Ee(e.filters[t],r=>Ee(r.defaults,{view:n,user_id:a})),getActive:e=>(t,n)=>!e.activeFilters[t]||!e.activeFilters[t][n]?null:Ee(e.filters[t],["id",Number(e.activeFilters[t][n])]),getBuilderRules:e=>(t,n)=>!e.queryBuilderRules[t]||!e.queryBuilderRules[t][n]?{}:e.queryBuilderRules[t][n]||{},rulesAreVisible:e=>(t,n)=>!e.visibleRules[t]||!e.visibleRules[t][n]?!1:e.visibleRules[t][n]||!1,hasRulesApplied:e=>(t,n)=>!e.hasRulesApplied[t]||!e.hasRulesApplied[t][n]?!1:e.hasRulesApplied[t][n]||!1,rulesAreValid:e=>(t,n)=>!e.rulesAreValidFor[t]||!e.rulesAreValidFor[t][n]?!1:e.rulesAreValidFor[t][n]||!1,hasRules:e=>t=>e.rules[t]?e.rules[t].length>0:!1},W1={setFiltersAndRules({commit:e},t){e("SET",{identifier:t.identifier,filters:t.filters}),e("SET_RULES",{identifier:t.identifier,rules:t.rules})},clearActive({commit:e,getters:t},n){return t.getActive(n.identifier,n.view)?(e("CLEAR_ACTIVE",{identifier:n.identifier,view:n.view}),e("RESET_BUILDER_RULES",{identifier:n.identifier,view:n.view}),!0):!1},async destroy({commit:e,getters:t},n){await Innoclapps.request().delete(`filters/${n.id}`);let a=t.getActive(n.identifier,n.view);a&&Number(n.id)===Number(a.id)&&e("CLEAR_ACTIVE",{identifier:n.identifier,view:n.view}),e("REMOVE",{identifier:n.identifier,id:n.id})}},Q1={namespaced:!0,state:G1,getters:Y1,mutations:K1,actions:W1},X1={settings:{},customize:{}},Z1={SET_CUSTOMIZE_VISIBILTY(e,t){e.customize[t.id]=t.value},SET_SETTINGS(e,t){e.settings[t.id]=t.settings},UPDATE_SETTINGS(e,t){e.settings[t.id]=Object.assign({},e.settings[t.id],t.settings)},RESET_SETTINGS(e){e.settings={}}},J1={async fetchActions({commit:e},t){let{data:n}=await Innoclapps.request().get(`/${t.resourceName}/table/settings`,{params:t.params});return e("UPDATE_SETTINGS",{id:t.id,settings:{actions:n.actions}}),n.actions},async getSettings({commit:e,state:t,dispatch:n},a){let r=t.settings[a.id],i=r!==void 0;if(i&&a.force!==!0)return r;let{data:u}=await Innoclapps.request().get(`/${a.resourceName}/table/settings`,{params:a.params});return e(i?"UPDATE_SETTINGS":"SET_SETTINGS",{id:a.id,settings:Rn(u,["filters","rules"])}),n("filters/setFiltersAndRules",{identifier:u.identifier,filters:u.filters,rules:u.rules},{root:!0}),u}},ex={namespaced:!0,state:X1,mutations:Z1,actions:J1};const tx={class:"flex justify-between"},nx=["onClick","textContent"],ox={__name:"SimpleResourceCRUD",props:{resourceName:{required:!0,type:String},withCancel:{type:Boolean,default:!0},tableProps:{type:Object,default(){return{}}}},emits:["cancel","updated","created","deleted"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{resetStoreState:r}=Le(),{fields:i,getCreateFields:u,getUpdateFields:c}=gt(),{form:m}=It(i),{updateResource:p,createResource:f,retrieveResource:h,deleteResource:g}=Je(n.resourceName),y=q([{key:"id",label:a("core::app.id"),sortable:!0},{key:"name",label:a("core::fields.label"),sortable:!0}]),_=q(null),I=Innoclapps.config(`resources.${n.resourceName}.singularLabel`);function F(){m.reset(),i.value.set([])}function $(){t("cancel")}async function C(){let E=await u(n.resourceName);y.value[1].key=E[0].attribute,i.value.set(E),Innoclapps.modal().show("createRecord")}async function w(E){let B=await c(n.resourceName,E),z=await h(E);y.value[1].key=B[0].attribute,m.fill("id",E),i.value.set(B).populate(z),Innoclapps.modal().show("updateRecord")}async function x(){await f(m),T("created"),Innoclapps.modal().hide("createRecord")}async function A(){await p(m,m.id),T("updated"),Innoclapps.modal().hide("updateRecord")}async function N(E){await Innoclapps.dialog().confirm(),await g(E),T("deleted")}function T(E){Innoclapps.success(a("core::resource."+E)),_.value.reload(),r(),t(E)}return(E,B)=>{const z=v("FormFields"),M=v("IModal"),j=v("IButtonMinimal"),U=v("IButton"),P=v("IDropdownItem"),H=v("IMinimalDropdown"),L=v("ICard"),Z=ae("i-tooltip");return d(),k("div",null,[s(M,{id:"createRecord",size:"sm","static-backdrop":"","ok-title":E.$t("core::app.create"),"ok-disabled":l(m).busy,form:"",title:E.$t("core::resource.create",{resource:l(I)}),onSubmit:x,onKeydown:B[0]||(B[0]=J=>l(m).onKeydown(J)),onHidden:F},{default:b(()=>[s(z,{fields:l(i),"form-id":l(m).formId,"resource-name":e.resourceName,"is-floating":"","focus-first":""},null,8,["fields","form-id","resource-name"])]),_:1},8,["ok-title","ok-disabled","title"]),s(M,{id:"updateRecord",size:"sm","static-backdrop":"","ok-title":E.$t("core::app.save"),"ok-disabled":l(m).busy,form:"",title:E.$t("core::resource.edit",{resource:l(I)}),onHidden:F,onSubmit:A,onKeydown:B[1]||(B[1]=J=>l(m).onKeydown(J))},{default:b(()=>[s(z,{fields:l(i),"form-id":l(m).formId,"resource-name":e.resourceName,"resource-id":l(m).id,"is-floating":""},null,8,["fields","form-id","resource-name","resource-id"])]),_:1},8,["ok-title","ok-disabled","title"]),s(L,{"no-body":""},{header:b(()=>[D(s(j,{variant:"info",text:E.$t("core::app.go_back"),onClick:$},null,8,["text"]),[[Y,e.withCancel]]),de(E.$slots,"header",{},void 0,!0)]),actions:b(()=>[s(U,{icon:"plus",size:"sm",text:E.$t("core::resource.create",{resource:l(I)}),onClick:C},null,8,["text"])]),default:b(()=>[s(is,{ref_key:"tableRef",ref:_,"table-props":{shadow:!1,...e.tableProps},"table-id":e.resourceName,"request-uri":e.resourceName,"sort-by":"name",fields:y.value},{name:b(({row:J})=>[o("div",tx,[o("a",{href:"#",class:"link",onClick:ie(K=>w(J.id),["prevent"]),textContent:S(J.name)},null,8,nx),s(H,null,{default:b(()=>[s(P,{text:E.$t("core::app.edit"),icon:"PencilAlt",onClick:K=>w(J.id)},null,8,["text","onClick"]),D((d(),k("span",null,[s(P,{disabled:J.is_primary,icon:"Trash",text:E.$t("core::app.delete"),onClick:K=>N(J.id)},null,8,["disabled","text","onClick"])])),[[Z,J.is_primary?E.$t("core::resource.primary_record_delete_info",{resource:l(I)}):null]])]),_:2},1024)])]),_:1},8,["table-props","table-id","request-uri","fields"])]),_:3})])}}},vo=ct(ox,[["__scopeId","data-v-ec7c2b5d"]]),lx={class:"flex"},ax={key:0,class:"mt-2"},sx={key:1},rx={class:"mt-1 flex items-center justify-end divide-x divide-neutral-200 text-right text-sm"},ix=["onClick"],ux=["onClick"],dx={class:"relative mt-3"},cx={class:"group -mx-6 px-6"},mx={class:"option-draggable-handle absolute -left-5 top-3 z-20 hidden focus-within:block group-hover:block hover:block"},px={class:"relative"},fx=["textContent"],vx={class:"p-4"},bx={__name:"CustomFieldFormOptions",props:{form:{required:!0,type:Object}},setup(e){const t=e,{draggableOptions:n}=Xt(),a=q(null),r=q(!1),i=q(""),u=Innoclapps.config("favourite_colors");function c(){t.form.options.forEach((y,_)=>{y.display_order=_+1})}function m(){p(),Fe(()=>{a.value.focus()})}function p(y=null){t.form.options.push({name:y,display_order:t.form.options.length+1,swatch_color:null})}function f(){r.value=!1}function h(){i.value&&(i.value.split(`
`).forEach(y=>y&&p(y)),f())}async function g(y){t.form.options[y].id&&await Innoclapps.dialog().confirm(),t.form.options.splice(y,1)}return(y,_)=>{const I=v("IFormLabel"),F=v("IButtonIcon"),$=v("Icon"),C=v("i18n-t"),w=v("IAlert"),x=v("IFormTextarea"),A=v("IFormInput"),N=v("IColorSwatch"),T=v("IPopover"),E=v("IFormError"),B=v("IFormGroup"),z=ae("i-tooltip"),M=ae("t");return d(),R(B,null,{default:b(()=>[o("div",lx,[s(I,{class:"grow text-neutral-900 dark:text-neutral-100",label:y.$t("core::fields.options"),required:""},null,8,["label"]),D(s(F,{icon:"Plus",onClick:m},null,512),[[Y,!r.value],[z,y.$t("core::app.add_another")]])]),e.form.options.length===0&&!r.value?(d(),k("div",ax,[s(w,{variant:"info"},{default:b(()=>[s(C,{scope:"global",keypath:"core::fields.custom.create_option_icon",tag:"div",class:"flex"},{icon:b(()=>[s($,{icon:"Plus",class:"mx-1 h-5 w-5 cursor-pointer",onClick:m})]),_:1},8,["keypath"]),o("a",{href:"#",class:"mt-2 inline-flex items-center text-sm text-info-900 hover:text-info-700",onClick:_[0]||(_[0]=ie(j=>r.value=!0,["prevent"]))},[Q(S(y.$t("core::fields.custom.or_add_options_via_text"))+" ",1),s($,{icon:"ArrowLeft",class:"ml-1 mt-0.5 h-3 w-3"})])]),_:1})])):O("",!0),r.value?(d(),k("div",sx,[s(x,{modelValue:i.value,"onUpdate:modelValue":_[1]||(_[1]=j=>i.value=j),placeholder:y.$t("core::fields.custom.text_options_each_on_new_line")},null,8,["modelValue","placeholder"]),o("div",rx,[D(o("a",{href:"#",class:"link",onClick:ie(h,["prevent"])},null,8,ix),[[M,"core::fields.custom.convert_text_to_options"]]),D(o("a",{href:"#",class:"link ml-2 pl-2",onClick:ie(f,["prevent"])},null,8,ux),[[M,"core::app.cancel"]])])])):O("",!0),s(l(Et),Re(l(n),{list:e.form.options,"item-key":(j,U)=>U,handle:".option-draggable-handle",onSort:c}),{item:b(({element:j,index:U})=>[o("div",dx,[o("div",cx,[o("div",mx,[s(F,{icon:"Selector",class:"cursor-move text-neutral-400","icon-class":"w-4 h-4"})]),o("div",px,[j.id?(d(),k("div",{key:0,class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-sm text-neutral-500 dark:text-neutral-200",textContent:S(y.$t("core::app.id")+": "+j.id)},null,8,fx)):O("",!0),s(A,{ref_key:"optionNameRef",ref:a,modelValue:e.form.options[U].name,"onUpdate:modelValue":P=>e.form.options[U].name=P,class:X(["pr-20",{"pl-14":j.id}]),onKeydown:[Tt(ie(m,["prevent","stop"]),["enter"]),_[2]||(_[2]=P=>e.form.errors.clear("options"))]},null,8,["modelValue","onUpdate:modelValue","class","onKeydown"]),s(T,{"auto-placement":"",class:"w-72"},{popper:b(()=>[o("div",vx,[s(N,{modelValue:e.form.options[U].swatch_color,"onUpdate:modelValue":P=>e.form.options[U].swatch_color=P,swatches:l(u)},null,8,["modelValue","onUpdate:modelValue","swatches"])])]),default:b(()=>[D(s(F,{icon:"ColorSwatch",style:st({color:j.swatch_color}),class:"absolute right-11 top-2.5 -mt-px"},null,8,["style"]),[[z,y.$t("core::app.colors.color")]])]),_:2},1024),s(F,{icon:"X",class:"absolute right-3 top-2.5",onClick:P=>g(U)},null,8,["onClick"])])])])]),_:1},16,["list","item-key"]),s(E,{textContent:S(e.form.getError("options"))},null,8,["textContent"])]),_:1})}}},hx={class:"flex"},_x={class:"relative"},gx={key:0,class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-sm dark:text-white"},yx={key:0,class:"mt-4 text-sm text-danger-600 dark:text-danger-500"},Ta={__name:"CustomFieldFormFields",props:{form:{required:!0,type:Object},edit:Boolean},setup(e){const t=e,n=Innoclapps.config("fields.custom_fields"),a=Innoclapps.config("fields.custom_field_prefix"),r=Innoclapps.resources(),i=q(t.form.field_id||null),u=t.form.is_unique,c=V(()=>_t(n,(f,h)=>h)),m=V(()=>!!Ee(n,{type:t.form.field_type,optionable:!0})),p=V(()=>!!Ee(n,{type:t.form.field_type,uniqueable:!0})&&!!Ee(r,{acceptsUniqueCustomFields:!0,name:t.form.resource_name}));return ge(p,f=>{t.form.is_unique=f?t.form.is_unique!==null?t.form.is_unique:!1:null}),dn(i,f=>{t.edit||t.form.fill("field_id",f?`${a}${f}`:null)},{debounce:250}),ge(m,(f,h)=>{!f&&h?delete t.form.options:f&&(t.form.options=[])}),(f,h)=>{const g=v("ICustomSelect"),y=v("IFormError"),_=v("IFormGroup"),I=v("IFormInput"),F=v("IFormLabel"),$=v("IButtonCopy"),C=v("IFormCheckbox"),w=v("IFormText"),x=ae("t");return d(),k(te,null,[s(_,{label:f.$t("core::fields.custom.type"),"label-for":"field_type",required:""},{default:b(()=>[s(g,{modelValue:e.form.field_type,"onUpdate:modelValue":h[0]||(h[0]=A=>e.form.field_type=A),options:c.value,clearable:!1,disabled:e.edit,"onOption:selected":h[1]||(h[1]=A=>e.form.label?"":f.$refs.labelRef.focus())},null,8,["modelValue","options","disabled"]),s(y,{textContent:S(e.form.getError("field_type"))},null,8,["textContent"])]),_:1},8,["label"]),s(_,{"label-for":"label",label:f.$t("core::fields.label"),required:""},{default:b(()=>[s(I,{id:"label",ref:"labelRef",modelValue:e.form.label,"onUpdate:modelValue":h[2]||(h[2]=A=>e.form.label=A)},null,8,["modelValue"]),s(y,{textContent:S(e.form.getError("label"))},null,8,["textContent"])]),_:1},8,["label"]),m.value?(d(),R(bx,{key:0,form:e.form},null,8,["form"])):O("",!0),s(_,{description:f.$t("core::fields.custom.id_info")},{label:b(()=>[o("div",hx,[s(F,{required:"",class:"mb-1 grow",for:"field_id",label:f.$t("core::fields.custom.id")},null,8,["label"]),D(s($,{text:e.form.field_id,"success-message":f.$t("core::app.copied"),tabindex:"-1",class:"link cursor-pointer text-sm",tag:"a"},{default:b(()=>[Q(S(f.$t("core::app.copy")),1)]),_:1},8,["text","success-message"]),[[Y,e.form.field_id]])])]),default:b(()=>[o("div",_x,[e.edit?O("",!0):(d(),k("div",gx,S(l(a)),1)),s(I,{id:"field_id",modelValue:i.value,"onUpdate:modelValue":h[3]||(h[3]=A=>i.value=A),disabled:e.edit,class:X({"pl-8":!e.edit})},null,8,["modelValue","disabled","class"])]),s(y,{textContent:S(e.form.getError("field_id"))},null,8,["textContent"])]),_:1},8,["description"]),p.value?(d(),R(_,{key:1},{default:b(()=>[s(C,{checked:e.form.is_unique,"onUpdate:checked":h[4]||(h[4]=A=>e.form.is_unique=A),disabled:e.edit&&!e.form.is_unique&&!l(u),label:f.$t("core::fields.mark_as_unique")},null,8,["checked","disabled","label"]),e.edit&&e.form.is_unique===!1&&l(u)?D((d(),k("p",yx,null,512)),[[x,"core::fields.unmark_as_unique_change_info"]]):!e.edit||e.edit&&!e.form.is_unique?D((d(),R(w,{key:1,class:"mt-1"},null,512)),[[x,"core::fields.mark_as_unique_change_info"]]):O("",!0),s(y,{textContent:S(e.form.getError("is_unique"))},null,8,["textContent"])]),_:1})):O("",!0)],64)}}},xx={class:"flex h-0.5 items-center"},Ix={class:"cursor-pointer border-b border-neutral-200 px-4 py-4 dark:border-neutral-800 sm:px-6"},kx={class:"lg:flex lg:items-center lg:justify-between"},$x=["textContent"],wx={class:"mb-0 mt-3"},Cx={class:"max-h-96 overflow-y-auto"},Sx={class:"flex items-center"},Rx={class:"grow"},Fx={class:"space-x-2"},Vx={class:"text-sm font-medium text-neutral-800 dark:text-white"},Tx={class:"text-xs text-neutral-800 dark:text-white"},Dx=o("br",null,null,-1),qx={key:0,class:"text-xs font-medium text-info-600 dark:text-white"},Ex=o("br",null,null,-1),Ax={class:"flex items-center space-x-2 self-start"},Bx={key:0,class:"mt-3"},Nx={class:"inline-flex items-center"},Ox={class:"inline-flex items-center"},il={__name:"SettingsCustomizeFields",props:{group:{required:!0,type:String},view:{required:!0,type:String},heading:{type:String,required:!0},subHeading:{type:String,required:!0},collapseOption:{default:!0,type:Boolean},lazy:{default:!0,type:Boolean}},emits:["delete-requested","update-requested","saved"],setup(e,{expose:t,emit:n}){const a=e,{t:r}=ve(),i=Ye(),{resetStoreState:u}=Le(),{scrollableDraggableOptions:c}=Xt(),m=q(null),p=q(!1),f=q(!1),h=q([]),g=q(!1),y=q(!1),_=q(!1),I=V(()=>l(g)||l(y)||l(_)),F=V({set(U){h.value=U.map(P=>(P.isRequired&&(P[l(x)]=!0),!P.isUnique&&P.canUnmarkUnique&&(P.uniqueUnmarked=!0),P))},get(){return m.value?h.value.filter(U=>U.label.toLowerCase().includes(m.value.toLowerCase())):h.value}}),$=V(()=>a.view===Innoclapps.config("fields.views.update")),C=V(()=>a.view===Innoclapps.config("fields.views.detail")),w=V(()=>a.view===Innoclapps.config("fields.views.create")),x=V(()=>w.value?"showOnCreation":$.value?"showOnUpdate":C.value?"showOnDetail":"");function A(){return"/fields/settings/"+a.group+"/"+a.view}function N(){let U={};return h.value.forEach((P,H)=>{let L={order:H+1,[l(x)]:P.isRequired?!0:P[l(x)],isRequired:P.isRequired};P.canUnmarkUnique&&(L.uniqueUnmarked=P.uniqueUnmarked||!1),a.collapseOption&&(L.collapsed=P.collapsed),U[P.attribute]=L}),U}function T(U){n("update-requested",U)}function E(U){n("delete-requested",U)}function B(U){g.value=!0,Innoclapps.request().post(A(),N(),{params:{intent:a.view}}).then(()=>{u(),U&&(Innoclapps.success(r("core::fields.configured")),n("saved"))}).finally(()=>g.value=!1)}function z(){a.lazy&&p.value===!1&&j(),f.value=!f.value}function M(){y.value=!0,Innoclapps.request().delete(A()+"/reset",{params:{intent:a.view}}).then(({data:U})=>{F.value=U,u(),Innoclapps.success(r("core::fields.reseted"))}).finally(()=>y.value=!1)}async function j(){_.value=!0;let{data:U}=await Innoclapps.request().get(A(),{params:{intent:a.view}});_.value=!1,F.value=U,p.value=!0}return a.lazy||j(),i.query.view&&i.query.view===a.view&&z(),ge(()=>a.group,j),t({fetch:j,submit:B}),(U,P)=>{const H=v("ICardHeading"),L=v("IButton"),Z=v("SearchInput"),J=v("IBadge"),K=v("IButtonCopy"),G=v("IButtonIcon"),oe=v("IFormCheckbox"),pe=v("ICard"),ue=ae("i-tooltip"),ee=ae("t");return d(),R(pe,{"no-body":"",class:"mh-96"},{header:b(()=>[s(H,{class:"text-base"},{default:b(()=>[Q(S(e.heading),1)]),_:1})]),actions:b(()=>[o("div",xx,[D(s(L,{class:"mr-2",size:"sm",loading:g.value,disabled:I.value,text:U.$t("core::app.save"),onClick:P[0]||(P[0]=W=>B(!0))},null,8,["loading","disabled","text"]),[[Y,f.value]]),D(s(L,{variant:"white",class:"mr-2",loading:y.value,text:U.$t("core::app.reset"),disabled:I.value,size:"sm",onClick:M},null,8,["loading","text","disabled"]),[[Y,f.value]]),D(s(L,{variant:"white",size:"sm",loading:_.value,icon:"ChevronUp",disabled:I.value,onClick:z},null,8,["loading","disabled"]),[[Y,f.value]])])]),default:b(()=>[o("div",Ix,[o("div",kx,[o("p",{class:"text-sm text-neutral-600 dark:text-white",onClick:z,textContent:S(e.subHeading)},null,8,$x),D(s(L,{variant:"white",size:"sm",text:U.$t("core::fields.manage"),class:"mt-4 shrink-0 lg:ml-5 lg:mt-0",onClick:z},null,8,["text"]),[[Y,!f.value]])]),D(o("div",wx,[s(Z,{modelValue:m.value,"onUpdate:modelValue":P[1]||(P[1]=W=>m.value=W)},null,8,["modelValue"])],512),[[Y,f.value]])]),D(o("ul",Cx,[s(l(Et),Re(l(c),{list:F.value,"item-key":W=>e.view+" - "+W.attribute,handle:".field-draggable-handle",group:e.view}),{item:b(({element:W})=>[o("li",{class:X(["border-b border-neutral-200 px-4 py-4 dark:border-neutral-700 sm:px-6",{"bg-neutral-50 dark:bg-neutral-700/60":W.primary,"opacity-60":!W[x.value]}])},[o("div",Sx,[o("div",Rx,[o("div",Fx,[o("span",Vx,S(W.label),1),D(s(J,{variant:"info",text:U.$t("core::fields.custom.field")},null,8,["text"]),[[Y,W.customField]]),D(s(J,{variant:"success",text:U.$t("core::fields.field_is_unique")},null,8,["text"]),[[Y,W.isUnique]]),D(s(J,{variant:"warning",text:U.$t("core::fields.is_readonly")},null,8,["text"]),[[Y,W.readonly]])]),D(o("span",Tx,[Dx,Q(S(W.helpText),1)],512),[[Y,W.helpText]]),W.primary?(d(),k("span",qx,[Ex,Q(S(U.$t("core::fields.primary")),1)])):O("",!0)]),o("div",Ax,[D(s(K,{text:W.attribute,"icon-class":"h-4 w-4"},null,8,["text"]),[[ue,U.$t("core::app.copy_api_key")]]),W.customField||W.optionsViaResource?D((d(),R(G,{key:0,icon:"PencilAlt","icon-class":"h-4 w-4",onClick:ne=>T(W)},null,8,["onClick"])),[[ue,U.$t("core::app.edit")]]):O("",!0),W.customField?D((d(),R(G,{key:1,icon:"Trash","icon-class":"h-4 w-4",onClick:ne=>E(W.customField.id)},null,8,["onClick"])),[[ue,U.$t("core::app.delete")]]):O("",!0),s(G,{icon:"Selector","icon-class":"h-4 w-4",class:"field-draggable-handle cursor-move"})])]),W.primary?O("",!0):(d(),k("div",Bx,[s(oe,{checked:W[x.value],"onUpdate:checked":ne=>W[x.value]=ne,disabled:W.isRequired,label:U.$t("core::fields.visible")},null,8,["checked","onUpdate:checked","disabled","label"]),W.canUnmarkUnique?(d(),R(oe,{key:0,checked:W.isUnique&&!W.uniqueUnmarked,onChange:ne=>W.uniqueUnmarked=!ne},{default:b(()=>[o("span",Nx,[D(o("span",null,null,512),[[ee,"core::fields.mark_as_unique"]]),D(o("span",{class:"ml-1.5 mt-0.5 text-xs text-neutral-500 dark:text-neutral-300"},S(w.value?"":U.$t("core::fields.option_disabled_will_propagate",{view_name:$.value?U.$t("core::fields.settings.detail"):U.$t("core::fields.settings.update")})),513),[[Y,W.uniqueUnmarked]])])]),_:2},1032,["checked","onChange"])):O("",!0),e.collapseOption?(d(),R(oe,{key:1,checked:W.collapsed,"onUpdate:checked":ne=>W.collapsed=ne,label:U.$t("core::fields.collapsed_by_default")},null,8,["checked","onUpdate:checked","label"])):O("",!0),!W.isPrimary&&!W.readonly?(d(),R(oe,{key:2,checked:W.isRequired,"onUpdate:checked":ne=>W.isRequired=ne,onChange:ne=>ne?W[x.value]=!0:""},{default:b(()=>[o("span",Ox,[D(o("span",null,null,512),[[ee,"core::fields.is_required"]]),D(o("span",{class:"ml-1.5 mt-0.5 text-xs text-neutral-500 dark:text-neutral-300"},S(w.value?"":U.$t("core::fields.option_enabled_will_propagate",{view_name:$.value?U.$t("core::fields.settings.detail"):U.$t("core::fields.settings.update")})),513),[[Y,W.isRequired]])])]),_:2},1032,["checked","onUpdate:checked","onChange"])):O("",!0)]))],2)]),_:1},16,["list","item-key","group"])],512),[[Y,f.value]])]),_:1})}}},zx={class:"mb-3 flex items-center justify-between"},Mx=["textContent"],Ux={__name:"SettingsFields",setup(e){const{t}=ve(),n=Pe(),a=Ye(),r=Innoclapps.config("fields.views.create"),i=Innoclapps.config("fields.views.update"),u=Innoclapps.config("fields.views.detail"),c=q(null),m=q(null),p=q(null),f=q(null),{form:h}=Ae({label:null,field_type:"Text",field_id:null,resource_name:null,options:[],is_unique:null},{resetOnSuccess:!0}),g=V(()=>a.params.resourceName),y=V(()=>Innoclapps.config(`resources.${g.value}`)),_=V(()=>y.value?t("core::resource.settings.fields",{resourceName:y.value.singularLabel}):null);Ut(_),ge(g,()=>{f.value=null});function I(N){if(!N.customField){f.value=N.optionsViaResource;return}h.fill("id",N.customField.id),h.fill("label",N.customField.label),h.fill("field_type",N.customField.field_type),h.fill("field_id",N.customField.field_id),h.fill("is_unique",N.customField.is_unique),h.fill("resource_name",N.customField.resource_name),h.fill("options",nt(N.customField.options)||[]),Innoclapps.modal().show("editCustomField")}function F(){h.put(`/custom-fields/${h.id}`).then(()=>{Innoclapps.modal().hide("editCustomField"),C(),Innoclapps.success(t("core::fields.custom.updated"))})}async function $(N){await Innoclapps.dialog().confirm(),Innoclapps.request().delete(`/custom-fields/${N}`).then(()=>{C(),Innoclapps.success(t("core::fields.custom.deleted"))})}function C(){n.commit("table/RESET_SETTINGS"),n.dispatch("filters/clearActive",{identifier:g.value,view:g.value});const N=[m,p,c].filter(T=>T.value!==null);Promise.all(N.map(T=>T.value.fetch())).then(()=>{Fe(()=>N.forEach(T=>T.value.submit()))})}function w(){h.post("/custom-fields").then(()=>{Innoclapps.modal().hide("newCustomField"),C(),Innoclapps.success(t("core::fields.custom.created"))})}function x(){h.fill("resource_name",g.value)}function A(){h.reset(),h.errors.clear()}return(N,T)=>{const E=v("IModal"),B=v("IButton"),z=v("ICardHeading"),M=v("Icon"),j=v("i18n-t"),U=v("ICard"),P=ae("i-modal"),H=ae("t");return d(),k("div",null,[s(E,{id:"newCustomField",size:"sm","ok-title":N.$t("core::app.save"),"cancel-title":N.$t("core::app.cancel"),title:N.$t("core::fields.custom.create"),form:"","static-backdrop":"",onShown:x,onHidden:A,onKeydown:T[0]||(T[0]=L=>l(h).onKeydown(L)),onSubmit:w},{default:b(()=>[s(Ta,{form:l(h)},null,8,["form"])]),_:1},8,["ok-title","cancel-title","title"]),s(E,{id:"editCustomField",size:"sm",form:"","ok-title":N.$t("core::app.save"),"cancel-title":N.$t("core::app.cancel"),title:N.$t("core::fields.custom.update"),"static-backdrop":"",onKeydown:T[1]||(T[1]=L=>l(h).onKeydown(L)),onSubmit:F,onHidden:A},{default:b(()=>[s(Ta,{form:l(h),edit:!0},null,8,["form"])]),_:1},8,["ok-title","cancel-title","title"]),o("div",zx,[o("h4",{class:"whitespace-nowrap text-lg/6 font-medium text-neutral-800 dark:text-white",textContent:S(_.value)},null,8,Mx),D(s(B,{variant:"primary",icon:"Plus",size:"sm",class:"ml-3",text:N.$t("core::fields.add")},null,8,["text"]),[[P,"newCustomField"]])]),D(o("div",null,[y.value.hasDetailView?(d(),R(il,{key:0,ref_key:"detailRef",ref:c,class:"mb-3",group:g.value,view:l(u),heading:N.$t("core::fields.settings.detail"),"sub-heading":N.$t("core::fields.settings.detail_info"),onDeleteRequested:$,onUpdateRequested:I,onSaved:C},null,8,["group","view","heading","sub-heading"])):O("",!0),s(il,{ref_key:"createRef",ref:m,class:"mb-3",group:g.value,view:l(r),heading:N.$t("core::fields.settings.create"),"sub-heading":N.$t("core::fields.settings.create_info"),"collapse-option":!1,onDeleteRequested:$,onUpdateRequested:I,onSaved:C},null,8,["group","view","heading","sub-heading"]),s(il,{ref_key:"updateRef",ref:p,class:"mb-3",group:g.value,view:l(i),heading:N.$t("core::fields.settings.update"),"sub-heading":N.$t("core::fields.settings.update_info"),onDeleteRequested:$,onUpdateRequested:I,onSaved:C},null,8,["group","view","heading","sub-heading"]),s(U,{class:"mh-96","no-body":""},{header:b(()=>[D(s(z,{class:"text-base"},null,512),[[H,"core::fields.settings.list"]])]),default:b(()=>[s(j,{scope:"global",tag:"p",class:"inline-block px-4 py-4 text-sm text-neutral-600 dark:text-white sm:px-6",keypath:"core::fields.settings.list_info"},{icon:b(()=>[s(M,{icon:"DotsHorizontal",class:"mx-1 inline h-5 w-5"})]),resourceName:b(()=>[Q(S(y.value.label),1)]),_:1})]),_:1})],512),[[Y,!f.value]]),f.value?(d(),R(vo,{key:0,"resource-name":f.value,onCreated:C,onUpdated:C,onDeleted:C,onCancel:T[2]||(T[2]=L=>f.value=null)},null,8,["resource-name"])):O("",!0)])}}};function Gt(){const{t:e}=ve(),t=Pe(),n=q(!1),{form:a}=Ae(),r=dt({});function i(){Innoclapps.request().get("/settings").then(({data:m})=>{a.set(m),r.value=m,n.value=!0})}function u(m){a.post("settings").then(p=>{Innoclapps.success(e("core::settings.updated")),typeof m=="function"&&m(a,p),a.keys().forEach(f=>{Object.hasOwn(Innoclapps.appConfig.options,f)&&(Innoclapps.appConfig.options[f]=a[f],t.commit("SET_SETTINGS",{[f]:a[f]}))})})}async function c(m){await Fe(),u(m)}return i(),{isReady:n,submit:c,saveSettings:u,originalSettings:hd(r),form:a}}const Px=["onSubmit"],jx={href:"https://www.google.com/recaptcha/admin",class:"link inline-flex items-center",target:"_blank",rel:"noopener noreferrer"},Lx={class:"lg:flex lg:space-x-4"},Hx={class:"mt-4 rounded-lg border border-primary-100 bg-gradient-to-tr from-primary-50/40 from-25% to-primary-100 px-10 py-6 dark:border-neutral-800 dark:bg-gradient-to-tl dark:from-neutral-600 dark:to-neutral-900 md:flex md:items-center"},Gx=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",class:"h-14 w-14 fill-primary-700 dark:fill-neutral-200"},[o("path",{d:"M11.5 10.9c-4 0-7.9.9-11.5 2.8h22.9c-3.6-1.9-7.4-2.8-11.4-2.8zM16.7 14.8c-1.7 0-3.1 1.1-3.6 2.6-1-.3-1.9-.3-2.8-.1-.6-1.4-1.9-2.4-3.6-2.4-2.1 0-3.8 1.7-3.8 3.8 0 2.1 1.7 3.8 3.8 3.8s3.8-1.7 3.8-3.8v-.4c.8-.2 1.6-.1 2.4.2v.3c0 2.1 1.7 3.8 3.8 3.8 2.1 0 3.8-1.7 3.8-3.8 0-2.2-1.7-4-3.8-4zm-7.2 3.9c0 1.6-1.3 2.8-2.8 2.8-1.6 0-2.8-1.3-2.8-2.8s1.3-2.8 2.8-2.8c1.2 0 2.2.7 2.6 1.7.1.3.2.6.2 1.1 0-.1 0-.1 0 0zm7.2 2.8c-1.6 0-2.8-1.3-2.8-2.8s1.3-2.8 2.8-2.8 2.8 1.3 2.8 2.8-1.3 2.8-2.8 2.8zM16.7 2 9.9 3.1 6.6 2 4.4 8.7h14.5z"})],-1),Kx={class:"mt-5 md:ml-8 md:mt-0"},Yx={class:"-mb-1 text-lg font-semibold text-primary-800 dark:text-neutral-100"},Wx={class:"text-primary-700 dark:text-neutral-300 md:max-w-xl"},Qx={__name:"SettingsRecaptcha",setup(e){const{form:t,submit:n,isReady:a}=Gt();function r(){n(i=>{Innoclapps.appConfig.reCaptcha.configured=i.recaptcha_secret_key!=""&&i.recaptcha_site_key!=""})}return(i,u)=>{const c=v("Icon"),m=v("IFormInput"),p=v("IFormGroup"),f=v("IFormTextarea"),h=v("IButton"),g=v("ICard"),y=ae("t");return d(),k("form",{onSubmit:ie(r,["prevent"]),onInput:u[3]||(u[3]=_=>l(t).errors.clear(_.target.name))},[s(g,{header:i.$t("core::settings.recaptcha.recaptcha"),overlay:!l(a)},{actions:b(()=>[o("a",jx,[Q(" v2 "),s(c,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})])]),footer:b(()=>[s(h,{type:"submit",disabled:l(t).busy,text:i.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[o("div",Lx,[s(p,{class:"w-full",label:i.$t("core::settings.recaptcha.site_key"),"label-for":"recaptcha_site_key"},{default:b(()=>[s(m,{id:"recaptcha_site_key",modelValue:l(t).recaptcha_site_key,"onUpdate:modelValue":u[0]||(u[0]=_=>l(t).recaptcha_site_key=_)},null,8,["modelValue"])]),_:1},8,["label"]),s(p,{class:"w-full",label:i.$t("core::settings.recaptcha.secret_key"),"label-for":"recaptcha_secret_key"},{default:b(()=>[s(m,{id:"recaptcha_secret_key",modelValue:l(t).recaptcha_secret_key,"onUpdate:modelValue":u[1]||(u[1]=_=>l(t).recaptcha_secret_key=_)},null,8,["modelValue"])]),_:1},8,["label"])]),s(p,{description:i.$t("core::settings.recaptcha.ignored_ips_info"),label:i.$t("core::settings.recaptcha.ignored_ips"),"label-for":"recaptcha_ignored_ips"},{default:b(()=>[s(f,{id:"recaptcha_ignored_ips",modelValue:l(t).recaptcha_ignored_ips,"onUpdate:modelValue":u[2]||(u[2]=_=>l(t).recaptcha_ignored_ips=_)},null,8,["modelValue"])]),_:1},8,["description","label"]),o("div",Hx,[Gx,o("div",Kx,[D(o("h4",Yx,null,512),[[y,"core::settings.recaptcha.dont_get_locked"]]),D(o("p",Wx,null,512),[[y,"core::settings.recaptcha.ensure_recaptcha_works"]])])])]),_:1},8,["header","overlay"])],40,Px)}}},Xx={class:"px-4 py-4 sm:px-6"},Zx={class:"space-x-0 space-y-3 md:flex md:items-center md:justify-between md:space-y-0 lg:space-x-3"},Jx=["textContent"],eI=["textContent"],Tn={__name:"SettingsToggleItem",props:{heading:{type:String,required:!0},description:String,modelValue:{required:!0},checkedValue:{type:[Number,String,Boolean],default:!0},uncheckedValue:{type:[Number,String,Boolean],default:!1}},emits:["update:modelValue","change"],setup(e,{emit:t}){function n(a){t("update:modelValue",a),t("change",a)}return(a,r)=>{const i=v("IFormToggle");return d(),k("li",Xx,[o("div",Zx,[o("div",null,[o("h5",{class:"font-medium leading-relaxed text-neutral-700 dark:text-neutral-100",textContent:S(e.heading)},null,8,Jx),o("p",{class:"break-words text-sm text-neutral-600 dark:text-neutral-300",textContent:S(e.description)},null,8,eI)]),o("div",null,[s(i,{"model-value":e.modelValue,value:e.checkedValue,"unchecked-value":e.uncheckedValue,onChange:n},null,8,["model-value","value","unchecked-value"])])])])}}},tI={},nI={class:"divide-y divide-neutral-200 dark:divide-neutral-700"};function oI(e,t){return d(),k("ul",nI,[de(e.$slots,"default")])}const bo=ct(tI,[["render",oI]]),lI={__name:"SettingsSecurity",setup(e){const{form:t,submit:n,isReady:a}=Gt();return(r,i)=>{const u=v("ICard");return d(),R(u,{header:r.$t("core::settings.security.security"),"no-body":"",overlay:!l(a)},{default:b(()=>[s(bo,null,{default:b(()=>[s(Tn,{modelValue:l(t).disable_password_forgot,"onUpdate:modelValue":i[0]||(i[0]=c=>l(t).disable_password_forgot=c),heading:r.$t("core::settings.security.disable_password_forgot"),description:r.$t("core::settings.security.disable_password_forgot_info"),onChange:l(n)},null,8,["modelValue","heading","description","onChange"]),s(Tn,{modelValue:l(t).block_bad_visitors,"onUpdate:modelValue":i[1]||(i[1]=c=>l(t).block_bad_visitors=c),heading:r.$t("core::settings.security.block_bad_visitors"),description:r.$t("core::settings.security.block_bad_visitors_info"),onChange:l(n)},null,8,["modelValue","heading","description","onChange"])]),_:1})]),_:1},8,["header","overlay"])}}},aI={__name:"SettingsMenu",setup(e){const t=Innoclapps.config("settings.menu");return(n,a)=>{const r=v("IVerticalNavigationItem"),i=v("IVerticalNavigation");return d(),R(i,{class:"mb-4 sm:sticky sm:top-10 lg:mb-0"},{default:b(()=>[s(r,{title:n.$t("core::settings.general"),icon:"Cog","link-class":{"bg-neutral-50 dark:bg-neutral-600 text-primary-600 dark:text-primary-400":n.$route.name==="settings-general"},"icon-class":{"text-primary-600 dark:text-primary-300":n.$route.name==="settings-general"},href:"/settings/general",to:{name:"settings-general"}},null,8,["title","link-class","icon-class"]),(d(!0),k(te,null,re(l(t),u=>(d(),R(r,{key:u.id,title:u.title,to:u.route,href:u.route?n.$router.resolve(u.route).href:void 0,icon:u.icon},{default:b(()=>[u.children.length?(d(!0),k(te,{key:0},re(u.children,c=>(d(),R(r,{key:u.id+"-"+c.id,to:c.route,href:c.route?n.$router.resolve(c.route).href:void 0,title:c.title,icon:c.icon},null,8,["to","href","title","icon"]))),128)):O("",!0)]),_:2},1032,["title","to","href","icon"]))),128))]),_:1})}}},sI={class:"mx-auto max-w-7xl"},rI={class:"lg:grid lg:grid-cols-12 lg:gap-x-5"},iI={class:"lg:col-span-3"},uI={class:"lg:col-span-9"},dI={__name:"Settings",setup(e){const t=q(null);return yn((n,a,r)=>{n.matched&&n.matched[0]&&n.matched[0].name==="settings"&&document.getElementById("main").scrollTo({top:t.value.getBoundingClientRect().top,behavior:"smooth"}),r()}),(n,a)=>{const r=v("router-view"),i=v("ILayout");return d(),R(i,null,{default:b(()=>[o("div",sI,[o("div",rI,[o("aside",iI,[s(aI)]),o("div",{ref_key:"settingsViewRef",ref:t,class:"sm:hidden"},null,512),o("div",uI,[s(r)])])])]),_:1})}}};const cI={class:"flex items-center space-x-4"},mI={key:0},pI={class:"flex space-x-2"},fI={class:"flex space-x-1"},vI={key:0,class:"mt-2 w-full overflow-hidden rounded-md"},bI=["src"],ro={__name:"CropsAndUploadsImage",props:{showDelete:{type:Boolean,default:!0},chooseText:String,saveText:String,cancelText:String,image:String,uploadUrl:{type:String,required:!0},name:{type:String,default:"image"},cropperOptions:{type:Object,default:()=>({})}},emits:["success","cleared"],setup(e,{emit:t}){const n=e,a=ql(()=>mo(()=>import("./vue-upload-component-3e25ed60.js").then(N=>N.v),["assets/vue-upload-component-3e25ed60.js","assets/vendor-462626fd.js"])),{t:r}=ve();let i=null;const u={aspectRatio:1/1,viewMode:1},c=Innoclapps.csrfToken(),m=q(!1),p=q([]),f=q(null),h=q(null);ge(m,N=>{N?Fe(function(){h.value&&(i=new _d(h.value,Object.assign({},u,n.cropperOptions)))}):i&&(i.destroy(),i=null)});const g=V(()=>n.chooseText||r("core::app.choose_image")),y=V(()=>n.saveText||r("core::app.upload")),_=V(()=>n.cancelText||r("core::app.cancel")),I=V(()=>$.value||n.image),F=V(()=>$.value?p.value[0].url:n.image),$=V(()=>p.value.length>0);function C(){m.value=!1,p.value=[],t("cleared")}function w(){m.value=!1;let N=p.value[0],T=atob(i.getCroppedCanvas().toDataURL(N.type).split(",")[1]),E=new Uint8Array(T.length);for(let z=0;z<T.length;z++)E[z]=T.charCodeAt(z);let B=new File([E],N.name,{type:N.type});f.value.update(N.id,{file:B,type:B.type,size:B.size,active:!0})}function x(N,T,E){if(N&&!T&&Fe(function(){m.value=!0}),!N&&T&&(m.value=!1),N&&T&&(N.success!==T.success&&t("success",N.response),N.error!==T.error)){if(N.xhr.status===413){Innoclapps.error(r("core::app.file_too_large")),p.value=[];return}let B=JSON.parse(N.xhr.response);Innoclapps.error(B.message)}}function A(N,T,E){if(N&&!T&&!/\.(jpeg|png|jpg|gif|svg)$/i.test(N.name))return Innoclapps.error(r("validation.image",{attribute:N.name})),E();if(N&&(!T||N.file!==T.file)){N.url="";let B=window.URL||window.webkitURL;B&&B.createObjectURL&&(N.url=B.createObjectURL(N.file))}}return bt(()=>{i&&i.destroy()}),(N,T)=>{const E=v("IAvatar"),B=v("Icon"),z=v("ISpinner"),M=v("IButton"),j=ae("t");return d(),k("div",null,[D(o("div",cI,[I.value?(d(),k("div",mI,[de(N.$slots,"image",{src:F.value},()=>[s(E,{size:"lg",class:"mb-2",src:F.value},null,8,["src"])])])):O("",!0),o("div",pI,[s(l(a),{ref_key:"uploadRef",ref:f,modelValue:p.value,"onUpdate:modelValue":T[0]||(T[0]=U=>p.value=U),extensions:"jpg,jpeg,png",accept:"image/png,image/jpeg",name:e.name,"input-id":e.name,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":l(c)},class:"!flex cursor-pointer items-center rounded-full bg-primary-50 px-5 py-2 text-sm font-medium text-primary-800 hover:bg-primary-100 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 focus:ring-offset-primary-50","post-action":e.uploadUrl,drop:!1,onInputFilter:A,onInputFile:x},{default:b(()=>[f.value&&f.value.active?O("",!0):(d(),R(B,{key:0,icon:"CursorClick",class:"mr-2 h-4 w-4 text-current"})),f.value&&f.value.active?(d(),R(z,{key:1,class:"-mt-1 mr-2 inline-flex h-4 w-4 text-current"})):O("",!0),Q(" "+S(g.value),1)]),_:1},8,["modelValue","name","input-id","headers","post-action"]),I.value&&e.showDelete?D((d(),k("button",{key:0,type:"button",class:"inline-flex items-center rounded-full bg-danger-50 px-5 py-2 text-sm font-medium text-danger-800 hover:bg-danger-100 focus:outline-none focus:ring-2 focus:ring-danger-600 focus:ring-offset-2 focus:ring-offset-danger-50",onClick:C},null,512)),[[j,"core::app.remove"]]):O("",!0)])],512),[[Y,!m.value]]),D(o("div",null,[o("div",fI,[s(M,{type:"submit",variant:"secondary",text:y.value,onClick:w},null,8,["text"]),s(M,{variant:"white",text:_.value,onClick:T[1]||(T[1]=()=>f.value.clear())},null,8,["text"])]),$.value?(d(),k("div",vI,[o("img",{ref_key:"editedFileRef",ref:h,src:p.value[0].url},null,8,bI)])):O("",!0)],512),[[Y,$.value&&m.value]])])}}},hI={__name:"DateFormatInput",props:{modelValue:String,inputId:{type:String,default:"date_format"}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,a=Innoclapps.config("date_formats");function r(u){t("update:modelValue",u)}function i(u){return moment().formatPHP(u.label)}return De(()=>{r(n.modelValue)}),(u,c)=>{const m=v("ICustomSelect");return d(),R(m,{"input-id":e.inputId,clearable:!1,"model-value":e.modelValue,options:l(a),"onOption:selected":c[0]||(c[0]=p=>r(p))},{option:b(p=>[Q(S(p.label+" ["+i(p)+"]"),1)]),_:1},8,["input-id","model-value","options"])}}},_I=["value"],gI={__name:"TimeFormatInput",props:{modelValue:String,inputId:{type:String,default:"time_format"}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,a=Innoclapps.config("time_formats");function r(u){t("update:modelValue",u)}function i(u){return moment().formatPHP(u)}return De(()=>r(n.modelValue)),(u,c)=>{const m=v("IFormSelect");return d(),R(m,{id:e.inputId,"model-value":e.modelValue,onChange:c[1]||(c[1]=p=>r(p))},{default:b(()=>[(d(!0),k(te,null,re(l(a),p=>(d(),k("option",{key:p,value:p},[Q(S(p)+" [",1),c[0]||(he(-1),c[0]=o("span",{textContent:S(i(p))},null,8,["textContent"]),he(1),c[0]),Q("] ")],8,_I))),128))]),_:1},8,["id","model-value"])}}},yI={__name:"WeekDaySelectInput",props:{modelValue:null,inputId:{type:String,default:"first_day_of_week"},only:Array},emits:["update:modelValue"],setup(e){const t=e,{t:n}=ve(),a=[{id:1,label:n("core::app.weekdays.monday")},{id:2,label:n("core::app.weekdays.tuesday")},{id:3,label:n("core::app.weekdays.wednesday")},{id:4,label:n("core::app.weekdays.thursday")},{id:5,label:n("core::app.weekdays.friday")},{id:6,label:n("core::app.weekdays.saturday")},{id:0,label:n("core::app.weekdays.sunday")}],r=q(null),i=V(()=>t.only?a.filter(u=>t.only.indexOf(u.id)>-1):a);return ge(()=>t.modelValue,u=>{r.value=Ee(i.value,["id",Number(u)])},{immediate:!0}),(u,c)=>{const m=v("ICustomSelect");return d(),R(m,{modelValue:r.value,"onUpdate:modelValue":[c[0]||(c[0]=p=>r.value=p),c[1]||(c[1]=p=>u.$emit("update:modelValue",p))],"input-id":e.inputId,options:i.value,clearable:!1,reduce:p=>p.id},null,8,["modelValue","input-id","options","reduce"])}}},Zo={__name:"LocalizationFields",props:{firstDayOfWeek:{},timeFormat:{},dateFormat:{},locale:{},timezone:{},form:{required:!0,type:Object},exclude:{type:Array,default:()=>[]}},emits:["update:firstDayOfWeek","update:timeFormat","update:dateFormat","update:locale","update:timezone"],setup(e){const t=e,{locales:n}=Le(),a=V(()=>t.exclude.indexOf("timezone")===-1),r=V(()=>t.exclude.indexOf("locale")===-1);return(i,u)=>{const c=v("IFormError"),m=v("IFormGroup"),p=v("ICustomSelect");return d(),k("div",null,[a.value?(d(),R(m,{key:0,label:i.$t("core::app.timezone"),"label-for":"timezone"},{default:b(()=>[s(hs,{"model-value":e.form.timezone,"onUpdate:modelValue":u[0]||(u[0]=f=>i.$emit("update:timezone",f))},null,8,["model-value"]),s(c,{textContent:S(e.form.getError("timezone"))},null,8,["textContent"])]),_:1},8,["label"])):O("",!0),r.value?(d(),R(m,{key:1,label:i.$t("core::app.locale"),"label-for":"locale"},{default:b(()=>[s(p,{"input-id":"locale","model-value":e.form.locale,clearable:!1,options:l(n),"onUpdate:modelValue":u[1]||(u[1]=f=>i.$emit("update:locale",f))},null,8,["model-value","options"]),s(c,{textContent:S(e.form.getError("locale"))},null,8,["textContent"])]),_:1},8,["label"])):O("",!0),s(m,{label:i.$t("core::settings.date_format"),"label-for":"date_format"},{default:b(()=>[s(hI,{"model-value":e.form.date_format,"onUpdate:modelValue":u[2]||(u[2]=f=>i.$emit("update:dateFormat",f))},null,8,["model-value"]),s(c,{textContent:S(e.form.getError("date_format"))},null,8,["textContent"])]),_:1},8,["label"]),s(m,{label:i.$t("core::settings.time_format"),"label-for":"time_format"},{default:b(()=>[s(gI,{"model-value":e.form.time_format,"onUpdate:modelValue":u[3]||(u[3]=f=>i.$emit("update:timeFormat",f))},null,8,["model-value"]),s(c,{textContent:S(e.form.getError("time_format"))},null,8,["textContent"])]),_:1},8,["label"]),s(m,{label:i.$t("core::settings.first_day_of_week"),"label-for":"first_day_of_week"},{default:b(()=>[s(yI,{"model-value":e.form.first_day_of_week,only:[1,6,0],"onUpdate:modelValue":u[4]||(u[4]=f=>i.$emit("update:firstDayOfWeek",f))},null,8,["model-value"]),s(c,{textContent:S(e.form.getError("first_day_of_week"))},null,8,["textContent"])]),_:1},8,["label"])])}}},xI=["onSubmit"],II={class:"mb-3 text-sm font-medium text-neutral-700 dark:text-neutral-200"},kI=["src"],$I=o("hr",{class:"-mx-7 my-4 border-t border-neutral-200 dark:border-neutral-700"},null,-1),wI={class:"mb-3 text-sm font-medium text-neutral-700 dark:text-neutral-200"},CI=["src"],SI=o("hr",{class:"-mx-7 my-4 border-t border-neutral-200 dark:border-neutral-700"},null,-1),RI={class:"w-auto xl:w-1/3"},FI=o("hr",{class:"-mx-7 my-4 border-t border-neutral-200 dark:border-neutral-700"},null,-1),VI=o("hr",{class:"-mx-7 my-4 border-t border-neutral-200 dark:border-neutral-700"},null,-1),TI={class:"my-4 block"},DI={__name:"SettingsGeneral",setup(e){const t=Pe(),{setting:n,resetStoreState:a}=Le(),{form:r,submit:i,isReady:u,originalSettings:c}=Gt(),m=Innoclapps.config("privacyPolicyUrl"),p=dt([]),f=dt([]),h=dt(null),g=V(()=>t.getters["emailAccounts/accounts"]),y=V(()=>n("logo_light")),_=V(()=>n("logo_dark")),I=V(()=>Ee(g.value,["id",Number(r.system_email_account_id)])),F=V(()=>Ee(g.value,["id",Number(c.value.system_email_account_id)])),$=V(()=>c.value.system_email_account_id&&F.value),C=V(()=>c.value.system_email_account_id&&!F.value);function w(){i(()=>{r.require_calling_prefix_on_phones!==c.value.require_calling_prefix_on_phones&&a(),r.currency!==c.value.currency&&x()})}function x(){window.location.reload()}function A(E){const B="logo_"+E;r[B]&&Innoclapps.request().delete(`/logo/${E}`).then(x)}function N(){Innoclapps.request().get("currencies").then(({data:E})=>{p.value=_t(E,(B,z)=>z)})}function T(){Innoclapps.request().get("countries").then(({data:E})=>{f.value=E,r.company_country_id&&(h.value=Ee(f.value,["id",Number(r.company_country_id)]))})}return t.dispatch("emailAccounts/fetch"),N(),T(),(E,B)=>{const z=v("ICustomSelect"),M=v("IFormError"),j=v("IFormGroup"),U=v("IFormText"),P=v("IFormTextarea"),H=v("IAlert"),L=v("IButton"),Z=v("ICard"),J=v("IFormInput"),K=v("Editor"),G=ae("t");return d(),k("form",{onSubmit:ie(w,["prevent"]),onKeydown:B[15]||(B[15]=oe=>l(r).onKeydown(oe))},[s(Z,{header:E.$t("core::settings.general"),class:"mb-3",overlay:!l(u)},{footer:b(()=>[s(L,{type:"submit",disabled:l(r).busy,text:E.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[D(o("p",II,null,512),[[G,"core::app.logo.dark"]]),s(ro,{name:"logo_dark","upload-url":E.$store.state.apiURL+"/logo/dark",image:_.value,"show-delete":!!l(r).logo_dark,"cropper-options":{aspectRatio:null},"choose-text":_.value?E.$t("core::app.change"):E.$t("core::settings.choose_logo"),onCleared:B[0]||(B[0]=oe=>A("dark")),onSuccess:x},{image:b(({src:oe})=>[o("img",{src:oe,class:"h-8 w-auto"},null,8,kI)]),_:1},8,["upload-url","image","show-delete","choose-text"]),$I,D(o("p",wI,null,512),[[G,"core::app.logo.light"]]),s(ro,{name:"logo_light","show-delete":!!l(r).logo_light,"upload-url":E.$store.state.apiURL+"/logo/light",image:y.value,"cropper-options":{aspectRatio:null},"choose-text":y.value?E.$t("core::app.change"):E.$t("core::settings.choose_logo"),onCleared:B[1]||(B[1]=oe=>A("light")),onSuccess:x},{image:b(({src:oe})=>[o("img",{src:oe,class:"h-8 w-auto"},null,8,CI)]),_:1},8,["show-delete","upload-url","image","choose-text"]),SI,s(j,{label:E.$t("core::app.currency"),"label-for":"currency",class:"w-auto xl:w-1/3"},{default:b(()=>[s(z,{modelValue:l(r).currency,"onUpdate:modelValue":B[2]||(B[2]=oe=>l(r).currency=oe),"input-id":"currency",clearable:!1,options:p.value},null,8,["modelValue","options"]),s(M,{textContent:S(l(r).getError("currency"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:E.$t("core::settings.system_email"),"label-for":"system_email_account_id"},{default:b(()=>[o("div",RI,[s(z,{"input-id":"system_email_account_id",placeholder:!$.value&&C.value?E.$t("core::settings.system_email_configured"):"","model-value":I.value,disabled:!$.value&&C.value,options:g.value,label:"email","onOption:selected":B[3]||(B[3]=oe=>l(r).system_email_account_id=oe.id),onCleared:B[4]||(B[4]=oe=>l(r).system_email_account_id=null)},null,8,["placeholder","model-value","disabled","options"])]),s(U,{class:"mt-2 max-w-3xl",textContent:S(E.$t("core::settings.system_email_info"))},null,8,["textContent"]),s(M,{textContent:S(l(r).getError("system_email_account_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:E.$t("core::app.allowed_extensions"),description:E.$t("core::app.allowed_extensions_info")},{default:b(()=>[s(P,{id:"allowed_extensions",modelValue:l(r).allowed_extensions,"onUpdate:modelValue":B[5]||(B[5]=oe=>l(r).allowed_extensions=oe),rows:"2"},null,8,["modelValue"]),s(M,{textContent:S(l(r).getError("allowed_extensions"))},null,8,["textContent"])]),_:1},8,["label","description"]),FI,s(bo,{class:"-mx-6"},{default:b(()=>[s(Tn,{modelValue:l(r).require_calling_prefix_on_phones,"onUpdate:modelValue":B[6]||(B[6]=oe=>l(r).require_calling_prefix_on_phones=oe),heading:E.$t("core::settings.phones.require_calling_prefix"),description:E.$t("core::settings.phones.require_calling_prefix_info"),onChange:l(i)},null,8,["modelValue","heading","description","onChange"])]),_:1}),VI,o("div",TI,[s(H,{class:"mb-5"},{default:b(()=>[Q(S(E.$t("core::settings.update_user_account_info")),1)]),_:1}),s(Zo,{class:"w-auto xl:w-1/3",exclude:["timezone","locale"],form:l(r),"onUpdate:firstDayOfWeek":B[7]||(B[7]=oe=>l(r).first_day_of_week=oe),"onUpdate:timeFormat":B[8]||(B[8]=oe=>l(r).time_format=oe),"onUpdate:dateFormat":B[9]||(B[9]=oe=>l(r).date_format=oe)},null,8,["form"])])]),_:1},8,["header","overlay"]),s(Z,{header:E.$t("core::settings.company_information"),class:"mb-3",overlay:!l(u)},{footer:b(()=>[s(L,{type:"submit",disabled:l(r).busy,text:E.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[s(j,{class:"w-auto xl:w-1/3",label:E.$t("core::app.company.name"),"label-for":"company_name"},{default:b(()=>[s(J,{id:"company_name",modelValue:l(r).company_name,"onUpdate:modelValue":B[10]||(B[10]=oe=>l(r).company_name=oe)},null,8,["modelValue"])]),_:1},8,["label"]),s(j,{class:"w-auto xl:w-1/3",label:E.$t("core::app.company.country"),"label-for":"company_country_id"},{default:b(()=>[s(z,{modelValue:h.value,"onUpdate:modelValue":B[11]||(B[11]=oe=>h.value=oe),options:f.value,label:"name","input-id":"company_country_id","onOption:selected":B[12]||(B[12]=oe=>l(r).company_country_id=oe.id),onCleared:B[13]||(B[13]=oe=>l(r).company_country_id=null)},null,8,["modelValue","options"])]),_:1},8,["label"])]),_:1},8,["header","overlay"]),s(Z,{header:E.$t("core::app.privacy_policy"),overlay:!l(u)},{footer:b(()=>[s(L,{type:"submit",disabled:l(r).busy,text:E.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[s(K,{modelValue:l(r).privacy_policy,"onUpdate:modelValue":B[14]||(B[14]=oe=>l(r).privacy_policy=oe)},null,8,["modelValue"]),D(s(U,{tabindex:"-1",class:"mt-2"},null,512),[[G,{path:"core::settings.privacy_policy_info",args:{url:l(m)}}]])]),_:1},8,["header","overlay"])],40,xI)}}},qI={class:"rounded-md border border-neutral-200 bg-neutral-50 p-4 text-neutral-700 dark:border-neutral-500 dark:bg-neutral-700 dark:text-neutral-200"},EI={class:"max-h-96 overflow-y-auto"},AI={class:"select-all font-semibold"},Is={__name:"MailPlaceholders",props:{placeholders:Array},setup(e){return(t,n)=>{const a=v("IFormGroup");return e.placeholders&&e.placeholders.length>0?(d(),R(a,{key:0,label:t.$t("core::mail_template.placeholders.placeholders")},{default:b(()=>[o("div",qI,[o("div",EI,[(d(!0),k(te,null,re(e.placeholders,r=>(d(),k("p",{key:r.tag,class:"mb-1 text-sm"},[o("span",AI,S(r.interpolation_start)+" "+S(r.tag)+" "+S(r.interpolation_end),1),D(o("span",null," - "+S(r.description),513),[[Y,r.description]])]))),128))])])]),_:1},8,["label"])):O("",!0)}}},BI=["onSubmit"],NI={class:"flex flex-col items-center sm:flex-row"},OI={class:"flex items-center sm:mr-3"},zI={class:"mr-2 text-sm font-medium text-neutral-700 dark:text-neutral-300"},MI=["onClick"],UI={class:"flex items-center"},PI={class:"mr-2 text-sm font-medium text-neutral-700 dark:text-neutral-300"},jI={class:"border-b border-neutral-200 dark:border-neutral-700"},LI={class:"px-4 py-3"},HI={class:"text-sm font-medium text-neutral-900 dark:text-white"},GI=["onClick"],KI={class:"mb-2 flex items-center"},YI={class:"text-right"},WI={__name:"SettingsMailableTemplates",setup(e){const{t}=ve(),{setLoading:n,isLoading:a}=Ct(),{locales:r}=Le(),i=q(!1),{form:u}=Ae(),c=q("HTML"),m=q([]),p=q({}),f=q("en"),h=V(()=>c.value==="HTML"),g=V(()=>({id:"placeholders",trigger:"{",list:p.value.placeholders.filter(C=>C.tag!=="action_button").map(C=>({value:`${C.interpolation_start} ${C.tag} ${C.interpolation_end}`,text:`${C.interpolation_start} ${C.tag} ${C.interpolation_end} - ${C.description}`}))}));function y(){u.put(`/mailables/${p.value.id}`).then(C=>{let w=Xe(m.value,["id",Number(C.id)]);m.value[w]=C,Innoclapps.success(t("core::mail_template.updated"))})}function _(){n(!0),Innoclapps.request().get(`/mailables/${f.value}/locale`).then(({data:C})=>{m.value=C,I(Object.keys(p.value).length===0?C[0]:Ee(m.value,["name",p.value.name])),i.value=!0}).finally(()=>n(!1))}function I(C){p.value=C,u.set({subject:C.subject,html_template:C.html_template,text_template:C.text_template})}function F(C,w,x,A){return C.indexOf("%7B%7B%20")>-1&&C.indexOf("%20%7D%7D")>-1&&(C=C.replace("%7B%7B%20","{").replace("%20%7D%7D","}")),C}function $(){_()}return $(),(C,w)=>{const x=v("DropdownSelectInput"),A=v("Icon"),N=v("IFormInput"),T=v("IFormError"),E=v("IFormGroup"),B=v("IFormLabel"),z=v("Editor"),M=v("IFormTextarea"),j=v("IButton"),U=v("ICard"),P=ae("t");return d(),k("form",{onSubmit:ie(y,["prevent"]),onKeydown:w[5]||(w[5]=H=>l(u).onKeydown(H))},[s(U,{header:C.$t("core::mail_template.mail_templates"),overlay:l(a)},{actions:b(()=>[o("div",NI,[o("div",OI,[D(o("span",zI,null,512),[[P,"core::app.locale"]]),s(x,{modelValue:f.value,"onUpdate:modelValue":w[0]||(w[0]=H=>f.value=H),items:l(r),placement:"bottom-end",onChange:_},{default:b(({toggle:H})=>[o("button",{type:"button",class:"inline-flex w-full justify-center rounded-md border border-neutral-300 bg-white px-4 py-2 text-sm font-medium text-neutral-700 shadow-sm hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-neutral-100",onClick:H},S(f.value),9,MI)]),_:1},8,["modelValue","items"])]),o("div",UI,[D(o("span",PI,null,512),[[P,"core::mail_template.template"]]),s(x,{modelValue:p.value,"onUpdate:modelValue":w[1]||(w[1]=H=>p.value=H),items:m.value,placement:"bottom-end","value-key":"id","label-key":"name",onChange:I},{header:b(()=>[o("div",jI,[o("div",LI,[D(o("p",HI,null,512),[[P,"core::mail_template.choose_to_edit"]])])])]),default:b(({toggle:H})=>[o("button",{type:"button",class:"inline-flex w-full justify-center rounded-md border border-neutral-300 bg-white px-4 py-2 text-sm font-medium text-neutral-700 shadow-sm hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 focus:ring-offset-neutral-100",onClick:H},[s(A,{icon:"Mail",class:"mr-2 h-5 w-5"}),Q(" "+S(p.value.name),1)],8,GI)]),_:1},8,["modelValue","items"])])])]),footer:b(()=>[o("div",YI,[s(j,{type:"submit",disabled:l(u).busy,text:C.$t("core::app.save")},null,8,["disabled","text"])])]),default:b(()=>[s(E,{label:C.$t("core::mail_template.subject"),"label-for":"subject",required:""},{default:b(()=>[s(N,{id:"subject",modelValue:l(u).subject,"onUpdate:modelValue":w[2]||(w[2]=H=>l(u).subject=H),name:"subject"},null,8,["modelValue"]),s(T,{textContent:S(l(u).getError("subject"))},null,8,["textContent"])]),_:1},8,["label"]),s(E,null,{default:b(()=>[o("div",KI,[s(B,{label:C.$t("core::mail_template.message"),required:""},null,8,["label"])]),D(o("div",null,[i.value?(d(),R(z,{key:0,modelValue:l(u).html_template,"onUpdate:modelValue":w[3]||(w[3]=H=>l(u).html_template=H),config:{urlconverter_callback:F},"auto-completer":g.value},null,8,["modelValue","config","auto-completer"])):O("",!0)],512),[[Y,h.value]]),D(o("div",null,[s(M,{modelValue:l(u).text_template,"onUpdate:modelValue":w[4]||(w[4]=H=>l(u).text_template=H),rows:8,name:"text_template"},null,8,["modelValue"])],512),[[Y,!h.value]]),s(T,{textContent:S(l(u).getError("html_template"))},null,8,["textContent"]),s(T,{textContent:S(l(u).getError("text_template"))},null,8,["textContent"])]),_:1}),s(Is,{placeholders:p.value.placeholders},null,8,["placeholders"])]),_:1},8,["header","overlay"])],40,BI)}}},QI=["textContent"],XI=["textContent"],ZI={__name:"SettingsSystemInfo",setup(e){const t=q({});function n(){Innoclapps.request().get("/system/info").then(({data:r})=>t.value=r)}function a(){Innoclapps.request().post("/system/info",{},{responseType:"blob"}).then(r=>{so(r.data,"system-info.xlsx")})}return n(),(r,i)=>{const u=v("IButton"),c=v("ITable"),m=v("ICard");return d(),R(m,{header:r.$t("core::app.system_info"),"no-body":""},{actions:b(()=>[s(u,{size:"sm",icon:"DocumentDownload",variant:"white",onClick:a})]),default:b(()=>[s(c,null,{default:b(()=>[o("tbody",null,[(d(!0),k(te,null,re(t.value,(p,f)=>(d(),k("tr",{key:f},[o("td",null,[o("span",{class:"font-medium",textContent:S(f)},null,8,QI)]),o("td",null,[o("span",{class:"text-neutral-500 dark:text-neutral-300",textContent:S(p)},null,8,XI)])]))),128))])]),_:1})]),_:1},8,["header"])}}},JI={class:"inline-flex"},ek=["value"],tk=["value"],nk=o("thead",null,[o("tr",null,[o("th",{class:"text-left",width:"100%"},"Log")])],-1),ok={width:"60%",class:"whitespace-pre-line break-all"},lk={class:"mb-3 flex justify-between"},ak={class:"flex space-x-2"},sk=["textContent"],rk={__name:"SettingsSystemLogs",setup(e){const t=Ye(),n=dt({}),a=q(t.query.date||moment.utc().format("YYYY-MM-DD")),r=q(t.query.type||"ALL"),i=["ALL","INFO","EMERGENCY","CRITICAL","ALERT","ERROR","WARNING","NOTICE","DEBUG"],u={INFO:"info",DEBUG:"neutral",EMERGENCY:"danger",CRITICAL:"danger",NOTICE:"neutral",WARNING:"warning",ERROR:"danger",ALERT:"warning"};ge(a,f);const c=V(()=>n.value.logs?!r.value||r.value==="ALL"?p(n.value.logs):p(n.value.logs.filter(h=>h.type===r.value)):[]),m=V(()=>c.value&&c.value.length>0);function p(h){return h.sort(function(y,_){var I=new Date(y.timestamp),F=new Date(_.timestamp);return F-I})}function f(){Innoclapps.request().get("/system/logs",{params:{date:a.value}}).then(({data:h})=>{n.value=h,h.log_dates.indexOf(a.value)===-1&&n.value.log_dates.push(a.value)})}return f(),(h,g)=>{const y=v("IFormSelect"),_=v("IBadge"),I=v("IButtonCopy"),F=v("TextCollapse"),$=v("ITable"),C=v("ICard");return d(),R(C,{header:"Logs","no-body":""},{actions:b(()=>[o("div",JI,[s(y,{modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=w=>r.value=w),option:i,class:"mr-2",onInput:g[1]||(g[1]=w=>h.$router.replace({query:{type:w,date:a.value}}))},{default:b(()=>[(d(),k(te,null,re(i,w=>o("option",{key:w,value:w},S(w),9,ek)),64))]),_:1},8,["modelValue"]),s(y,{modelValue:a.value,"onUpdate:modelValue":g[2]||(g[2]=w=>a.value=w),onInput:g[3]||(g[3]=w=>h.$router.replace({query:{date:w,type:r.value}}))},{default:b(()=>[(d(!0),k(te,null,re(n.value.log_dates,w=>(d(),k("option",{key:w,value:w},S(w),9,tk))),128))]),_:1},8,["modelValue"])])]),default:b(()=>[s($,{class:"-mt-px"},{default:b(()=>[nk,o("tbody",null,[(d(!0),k(te,null,re(c.value,(w,x)=>(d(),k("tr",{key:x},[o("td",ok,[o("div",lk,[o("div",ak,[s(_,{text:w.type,variant:u[w.type]},null,8,["text","variant"]),s(I,{text:w.message},null,8,["text"])]),o("p",{textContent:S(w.timestamp)},null,8,sk)]),o("code",null,[s(F,{text:w.message,length:500},null,8,["text"])])])]))),128)),D(o("td",{colspan:"4",class:"p-4 text-center text-sm text-neutral-500 dark:text-neutral-300"},S(n.value.message||"No logs to show."),513),[[Y,!m.value]])])]),_:1})]),_:1})}}},ik={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},uk={class:"flex flex-col space-y-2 sm:flex-row sm:items-center sm:space-y-0"},dk={class:"grow"},ck=["textContent"],mk={class:"text-sm text-neutral-600 dark:text-neutral-300"},pk={class:"shrink-0"},fk={__name:"SettingsTools",setup(e){const{t}=ve(),n=["json-language","clear-cache","optimize","storage-link","migrate","seed-mailables"],a=q(null);function r(i){a.value=i,Innoclapps.request().get(`/tools/${i}`).then(()=>{Innoclapps.success(t("core::settings.tools.executed")),setTimeout(()=>window.location.reload(!0),1e3)}).finally(()=>a.value=!1)}return(i,u)=>{const c=v("IButton"),m=v("ICard"),p=ae("t");return d(),R(m,{header:i.$t("core::settings.tools.tools"),"no-body":""},{default:b(()=>[o("ul",ik,[(d(),k(te,null,re(n,f=>o("li",{key:f,class:"px-4 py-4 sm:px-6"},[o("div",uk,[o("div",dk,[o("h5",{class:"font-medium leading-relaxed text-neutral-900 dark:text-neutral-200",textContent:S(f)},null,8,ck),D(o("span",mk,null,512),[[p,"core::settings.tools."+f]])]),o("div",pk,[s(c,{variant:"white",size:"sm",loading:a.value===f,disabled:a.value!==null,text:i.$t("core::settings.tools.run"),onClick:h=>r(f)},null,8,["loading","disabled","text","onClick"])])])])),64))])]),_:1},8,["header"])}}},vk={class:"my-1 flex flex-col sm:flex-row sm:items-center"},bk={class:"flex grow"},hk={class:"relative grow focus-within:z-10"},_k=["placeholder"],gk={key:0},yk={class:"flex flex-col space-y-2 sm:flex-row sm:space-x-2 sm:space-y-0"},xk={class:"flex-1 rounded bg-warning-100 p-2 px-2 py-3 text-center text-warning-700"},Ik={class:"font-medium"},kk=["textContent"],$k={class:"flex-1 rounded bg-success-100 p-2 px-2 py-3 text-center text-success-700"},wk={class:"font-medium"},Ck=["textContent"],Sk={key:1},Rk={class:"text-center text-lg font-semibold text-neutral-800 dark:text-neutral-100"},Fk={class:"text-center text-sm text-neutral-600 dark:text-neutral-300"},Vk={class:"flex justify-end"},Tk={key:0,class:"divide-y divide-neutral-200 dark:divide-neutral-700"},Dk={class:"flex items-center justify-between"},qk=["innerHTML"],Ek={class:"ml-2.5 text-neutral-500 dark:text-neutral-300"},Ak=o("br",null,null,-1),Bk={class:"flex"},Nk=["href"],Ok={class:"inline-block",tabindex:"-1"},zk={class:"text-center text-sm text-neutral-500 dark:text-neutral-300"},Mk={__name:"SettingsUpdate",setup(e){const{t}=ve(),{form:n,submit:a}=Gt(),{localizedDateTime:r}=Ne(),i=Innoclapps.config("requirements.zip"),u=q({}),c=q([]),m=q(!1),p=q(!1),f=q(!1),h=V(()=>ot(c.value.map(A=>(A._date=new Date(A.date),A)),["isApplied","_date"],["asc","asc"])),g=V(()=>c.value.length>0),y=V(()=>m.value?t("core::update.update_in_progress"):t("core::update.perform")),_=V(()=>Kd(u.value.purchase_key)),I=V(()=>u.value.is_new_version_available&&_.value&&i);function F(){n.purchase_key=u.value.purchase_key,a()}function $(A){A.data==="Incorrect files permissions."?window.location.href="/errors/permissions":Innoclapps.error(A.data)}function C(){m.value=!0,Innoclapps.request().post(`/update/${u.value.purchase_key}`).then(()=>window.location.reload()).catch(({response:A})=>$(A)).finally(()=>m.value=!1)}function w(A,N){p.value=N,Innoclapps.request().post(`/patches/${A}/${u.value.purchase_key}`).then(()=>window.location.reload()).catch(({response:T})=>$(T)).finally(()=>p.value=!1)}function x(){Promise.all([Innoclapps.request().get("/update"),Innoclapps.request().get("/patches")]).then(A=>{u.value=A[0].data,c.value=A[1].data}).catch(({response:A})=>$(A)).finally(()=>f.value=!0)}return x(),(A,N)=>{const T=v("IFormLabel"),E=v("IButton"),B=v("ICard"),z=v("Icon"),M=v("IOverlay"),j=v("IBadge"),U=v("ICardBody"),P=ae("t"),H=ae("i-tooltip");return d(),k(te,null,[s(B,{class:"mb-3"},{default:b(()=>[o("div",vk,[s(T,{for:"purchase-key",class:"mb-1 shrink-0 sm:mb-0 sm:mr-4"},{default:b(()=>[Q(S(A.$t("core::app.purchase_key")),1)]),_:1}),o("div",bk,[o("div",hk,[D(o("input",{id:"purchase-key","onUpdate:modelValue":N[0]||(N[0]=L=>u.value.purchase_key=L),type:"text",placeholder:A.$t("core::app.enter_purchase_key"),class:X(["form-input rounded-l-md border-neutral-300 dark:bg-neutral-800 dark:text-white",f.value&&!_.value?"text-danger-900 placeholder-danger-400 focus:border-danger-500 focus:ring-danger-500":"dark:border-neutral-500"])},null,10,_k),[[Zt,u.value.purchase_key]])]),s(E,{variant:"white",rounded:!1,text:A.$t("core::app.save"),class:"relative -ml-px rounded-r-md",onClick:F},null,8,["text"])])])]),_:1}),s(M,{show:!l(i)&&f.value},vt({default:b(()=>[s(B,{header:A.$t("core::update.system"),class:"mb-3"},{footer:b(()=>[o("div",Vk,[s(E,{variant:"success",text:y.value,disabled:!I.value||m.value||p.value!==!1,onClick:C},null,8,["text","disabled"])])]),default:b(()=>[s(M,{show:!f.value},{default:b(()=>[u.value.is_new_version_available?(d(),k("div",gk,[o("div",yk,[o("div",xk,[D(o("h4",Ik,null,512),[[P,"core::update.installed_version"]]),o("h5",{textContent:S(u.value.installed_version)},null,8,kk)]),o("div",$k,[D(o("h4",wk,null,512),[[P,"core::update.latest_version"]]),o("h5",{textContent:S(u.value.latest_available_version)},null,8,Ck)])])])):(d(),k("div",Sk,[D(o("h4",Rk,[s(z,{icon:"EmojiHappy",class:"m-auto mb-2 h-10 w-10 text-success-500"}),Q(" "+S(A.$t("core::update.not_available")),1)],512),[[Y,f.value]]),D(o("p",Fk,null,512),[[Y,f.value],[P,"core::update.using_latest_version"]])]))]),_:1},8,["show"])]),_:1},8,["header"])]),_:2},[l(i)?void 0:{name:"overlay",fn:b(()=>[Q(S(A.$t("core::update.update_zip_is_required")),1)]),key:"0"}]),1032,["show"]),s(M,{show:!l(i)&&f.value},vt({default:b(()=>[s(B,{header:A.$t("core::update.patches"),"no-body":""},{default:b(()=>[s(M,{show:!f.value},{default:b(()=>[g.value?(d(),k("ul",Tk,[(d(!0),k(te,null,re(h.value,(L,Z)=>(d(),k("li",{key:L.token,class:"px-4 py-4 sm:px-6"},[o("div",Dk,[o("div",null,[o("p",{class:"text-sm font-medium text-neutral-800 dark:text-neutral-100",innerHTML:L.description},null,8,qk),L.isApplied?(d(),R(j,{key:0,"wrapper-class":"mr-1",variant:"success",text:A.$t("core::update.patch_applied")},null,8,["text"])):O("",!0),s(j,{variant:"neutral",text:L.token},null,8,["text"]),o("small",Ek,S(l(r)(L.date)),1),Ak]),o("div",Bk,[o("a",{href:"/patches/"+L.token+"/"+u.value.purchase_key,class:X(["link mr-3 mt-2",{"pointer-events-none opacity-70":Z>0||p.value!==!1||!_.value||!l(i)||m.value||L.isApplied}])},[s(z,{icon:"DocumentDownload",class:"h-5 w-5"})],10,Nk),D((d(),k("span",Ok,[s(E,{size:"sm",disabled:Z>0||p.value!==!1||!_.value||!l(i)||m.value||L.isApplied,onClick:J=>w(L.token,Z)},{default:b(()=>[Q(S(p.value===Z?A.$t("core::update.update_in_progress"):A.$t("core::app.apply")),1)]),_:2},1032,["disabled","onClick"])])),[[H,Z===0||L.isApplied?null:A.$t("core::update.apply_oldest_first")]])])])]))),128))])):(d(),R(U,{key:1},{default:b(()=>[D(o("p",zk,null,512),[[Y,f.value],[P,"core::update.no_patches"]])]),_:1}))]),_:1},8,["show"])]),_:1},8,["header"])]),_:2},[l(i)?void 0:{name:"overlay",fn:b(()=>[Q(S(A.$t("core::update.patch_zip_is_required")),1)]),key:"0"}]),1032,["show"])],64)}}},Uk=["onSubmit"],Pk={class:"mx-auto max-w-2xl p-4"},jk=["textContent"],Lk={class:"bg-neutral-50 px-4 py-3 dark:bg-neutral-900"},Hk={class:"flex items-center justify-end"},Gk={__name:"WorkflowsForm",props:{show:Boolean,workflow:{required:!0,type:Object},triggers:{required:!0,type:Array}},emits:["update:workflow","delete-requested","hide"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{fields:r}=gt(),{form:i}=It(r),u=q(null),c=q(null);ge(c,(w,x)=>{x&&x.fields&&x.fields.forEach(A=>{(!m.value||m.value&&A.attribute!==u.value.change_field.attribute)&&r.value.remove(A.attribute)}),w&&w.fields&&w.fields.forEach(A=>{r.value.find(A.attribute)||r.value.push(nt(A))})});const m=V(()=>u.value?!!u.value.change_field:!1),p=V(()=>c.value?c.value.fields.length>0:!1);function f(){i.put(`/workflows/${n.workflow.id}`).then(w=>{t("update:workflow",w),t("hide"),Innoclapps.success(a("core::workflow.updated"))})}function h(){i.post("/workflows").then(w=>{t("update:workflow",w),Innoclapps.success(a("core::workflow.created"))})}async function g(){await Fe(),i.hydrate(),n.workflow.id?f():h()}function y(w){c.value=null,i.errors.clear("trigger_type"),$({title:i.title,description:i.description,is_active:i.is_active}),r.value.set(m.value?[w.change_field]:[]),i.fill("trigger_type",w.identifier)}function _(w){i.errors.clear("action_type"),i.fill("action_type",w.identifier||null)}function I(){if(n.workflow.id){t("hide");return}F()}function F(){t("delete-requested",n.workflow)}function $(w={}){i.clear().set({trigger_type:w.trigger||null,action_type:w.action||null,title:w.title||null,description:w.description||null,is_active:w.is_active||!0})}function C(){u.value=Ee(n.triggers,["identifier",n.workflow.trigger_type]),c.value=Ee(u.value.actions,["identifier",n.workflow.action_type]);let w=p.value?nt(c.value.fields):[];m.value&&w.push(u.value.change_field),w=w.map(x=>(x.id=x.attribute+"-"+n.index,x)),r.value.isEmpty()?r.value.set(w).populate(n.workflow.data):r.value.sync(n.workflow.data)}return De(()=>{$({title:n.workflow.title,description:n.workflow.description,is_active:n.workflow.is_active,trigger:n.workflow.trigger_type,action:n.workflow.action_type}),n.workflow.id&&C()}),(w,x)=>{const A=v("IFormInput"),N=v("IFormError"),T=v("IFormGroup"),E=v("IFormTextarea"),B=v("ICustomSelect"),z=v("FormFields"),M=v("IFormToggle"),j=v("IButton");return d(),k("form",{onSubmit:ie(g,["prevent"])},[o("div",Pk,[o("h2",{class:"mb-4 text-lg font-medium text-neutral-700 dark:text-neutral-200",textContent:S(e.workflow.title)},null,8,jk),s(T,{"label-for":"title",label:w.$t("core::workflow.title"),required:""},{default:b(()=>[s(A,{id:"title",modelValue:l(i).title,"onUpdate:modelValue":x[0]||(x[0]=U=>l(i).title=U)},null,8,["modelValue"]),s(N,{textContent:S(l(i).getError("title"))},null,8,["textContent"])]),_:1},8,["label"]),s(T,{class:"mb-4","label-for":"description",label:w.$t("core::workflow.description"),optional:""},{default:b(()=>[s(E,{id:"description",modelValue:l(i).description,"onUpdate:modelValue":x[1]||(x[1]=U=>l(i).description=U),rows:"2"},null,8,["modelValue"]),s(N,{textContent:S(l(i).getError("description"))},null,8,["textContent"])]),_:1},8,["label"]),s(T,{label:w.$t("core::workflow.when"),required:""},{default:b(()=>[s(B,{modelValue:u.value,"onUpdate:modelValue":x[2]||(x[2]=U=>u.value=U),"input-id":"trigger",clearable:!1,label:"name",options:e.triggers,"onOption:selected":y},null,8,["modelValue","options"]),s(N,{textContent:S(l(i).getError("trigger_type"))},null,8,["textContent"])]),_:1},8,["label"]),m.value?(d(),R(T,{key:0,label:w.$t("core::workflow.field_change_to"),required:""},{default:b(()=>[s(z,{fields:l(r),"form-id":l(i).formId,only:u.value.change_field.attribute},null,8,["fields","form-id","only"])]),_:1},8,["label"])):O("",!0),u.value?(d(),R(T,{key:1,class:X({"mt--3":m.value}),label:w.$t("core::workflow.then"),required:""},{default:b(()=>[u.value?(d(),R(B,{key:0,modelValue:c.value,"onUpdate:modelValue":x[3]||(x[3]=U=>c.value=U),"input-id":"action",clearable:!1,label:"name",options:u.value.actions,"onOption:selected":_},null,8,["modelValue","options"])):O("",!0),s(N,{textContent:S(l(i).getError("action_type"))},null,8,["textContent"]),c.value?(d(),R(Is,{key:1,class:"mt-3",placeholders:c.value.placeholders},null,8,["placeholders"])):O("",!0)]),_:1},8,["class","label"])):O("",!0),p.value?(d(),R(T,{key:2},{default:b(()=>[s(z,{fields:l(r),"form-id":l(i).formId,except:m.value?u.value.change_field.attribute:[]},null,8,["fields","form-id","except"])]),_:1})):O("",!0)]),o("div",Lk,[o("div",Hk,[s(M,{modelValue:l(i).is_active,"onUpdate:modelValue":x[4]||(x[4]=U=>l(i).is_active=U),class:"mr-4 border-r border-neutral-200 pr-4 dark:border-neutral-700",label:w.$t("core::app.active")},null,8,["modelValue","label"]),s(j,{variant:"secondary",text:w.$t("core::app.cancel"),onClick:I},null,8,["text"]),s(j,{disabled:l(i).busy,text:w.$t("core::app.save"),class:"ml-2",onClick:g},null,8,["disabled","text"])])])],40,Uk)}}},Kk={class:"flex items-center px-4 py-4 sm:px-6"},Yk={class:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between"},Wk={class:"truncate"},Qk={class:"flex"},Xk={class:"mr-1"},Zk=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),Jk={class:"mt-3 flex"},e$={class:"flex items-center space-x-4 text-sm text-neutral-500"},t$={class:"text-neutral-800 dark:text-neutral-300"},n$={key:0,class:"text-sm text-neutral-800 dark:text-white"},o$={class:"mt-4 shrink-0 sm:ml-5 sm:mt-0"},l$={class:"ml-5 shrink-0"},a$={__name:"WorkflowsListItem",props:{index:{required:!0,type:Number},triggers:{required:!0,type:Array},workflow:{required:!0,type:Object}},emits:["update:workflow","delete-requested"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{localizedDateTime:r}=Ne(),i=q(!1);function u(m){Innoclapps.request().put(`/workflows/${n.workflow.id}`,{...n.workflow,data:{},...n.workflow.data,is_active:m}).then(({data:p})=>{t("update:workflow",p),Innoclapps.success(a("core::workflow.updated"))})}function c(){t("delete-requested",n.workflow)}return n.workflow.id||(i.value=!0),(m,p)=>{const f=v("IFormToggle"),h=v("IDropdownItem"),g=v("IMinimalDropdown");return d(),k(te,null,[i.value?(d(),R(Gk,{key:0,workflow:e.workflow,triggers:e.triggers,onHide:p[0]||(p[0]=y=>i.value=!1),"onUpdate:workflow":p[1]||(p[1]=y=>m.$emit("update:workflow",y)),onDeleteRequested:p[2]||(p[2]=y=>m.$emit("delete-requested",y))},null,8,["workflow","triggers"])):O("",!0),o("div",{class:X({"opacity-70":!e.workflow.is_active,hidden:i.value})},[o("div",Kk,[o("div",Yk,[o("div",Wk,[o("div",Qk,[o("a",{href:"#",class:"link flex items-center truncate text-sm font-medium",onClick:p[3]||(p[3]=ie(y=>i.value=!0,["prevent"]))},[o("span",Xk,S(e.workflow.title),1),Zk])]),o("div",Jk,[o("div",e$,[o("p",t$,S(m.$t("core::workflow.total_executions",{total:e.workflow.total_executions})),1),e.workflow.created_at?(d(),k("p",n$,S(m.$t("core::app.created_at"))+": "+S(l(r)(e.workflow.created_at)),1)):O("",!0)])])]),o("div",o$,[s(f,{label:m.$t("core::app.active"),"model-value":e.workflow.is_active,onChange:u},null,8,["label","model-value"])])]),o("div",l$,[s(g,null,{default:b(()=>[s(h,{text:m.$t("core::app.edit"),onClick:p[4]||(p[4]=y=>i.value=!0)},null,8,["text"]),s(h,{text:m.$t("core::app.delete"),onClick:c},null,8,["text"])]),_:1})])])],2)],64)}}},s$={key:0},r$={key:1,class:"p-7"},i$={class:"mt-2 block font-medium text-neutral-900 dark:text-neutral-100"},u$={class:"mt-2 block max-w-2xl text-sm text-neutral-600 dark:text-neutral-300"},d$={__name:"WorkflowsList",setup(e){const{t}=ve(),n=q([]),a=q([]),r=q(!1),i=V(()=>Array.from(a.value).sort((h,g)=>+g.is_active-+h.is_active||h.title.localeCompare(g.title))),u=V(()=>a.value.filter(h=>h.key).length>0),c=V(()=>a.value.length>0);function m(){a.value.unshift({key:qt(),title:"",description:null,is_active:!1,trigger_type:null,action_type:null})}function p(h){h.id?Innoclapps.dialog().confirm().then(()=>{f(h.id)}):a.value.splice(Xe(a.value,["key",h.key]),1)}function f(h){Innoclapps.request().delete(`/workflows/${h}`).then(()=>{a.value.splice(Xe(a.value,["id",Number(h)]),1),Innoclapps.success(t("core::workflow.deleted"))})}return Promise.all([Innoclapps.request().get("/workflows"),Innoclapps.request().get("/workflows/triggers")]).then(h=>{a.value.push(...h[0].data),n.value=h[1].data,r.value=!0}),(h,g)=>{const y=v("IButton"),_=v("Icon"),I=v("ICard"),F=ae("t");return d(),R(I,{"no-body":"",header:h.$t("core::workflow.workflows"),overlay:!r.value},{actions:b(()=>[D(s(y,{size:"sm",icon:"plus",disabled:u.value,text:h.$t("core::workflow.create"),onClick:m},null,8,["disabled","text"]),[[Y,c.value]])]),default:b(()=>[r.value?(d(),k("div",s$,[c.value?(d(),R(El,{key:0,name:"flip-list",tag:"ul",class:"divide-y divide-neutral-200 dark:divide-neutral-700"},{default:b(()=>[(d(!0),k(te,null,re(i.value,($,C)=>(d(),k("li",{key:$.id||$.key},[s(a$,{workflow:a.value[C],"onUpdate:workflow":w=>a.value[C]=w,index:C,triggers:n.value,onDeleteRequested:p},null,8,["workflow","onUpdate:workflow","index","triggers"])]))),128))]),_:1})):(d(),k("div",r$,[o("button",{type:"button",class:"relative flex w-full flex-col items-center rounded-lg border-2 border-dashed border-neutral-300 p-6 hover:border-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:border-neutral-400 dark:hover:border-neutral-300 sm:p-12",onClick:m},[s(_,{icon:"RocketLaunch",class:"mx-auto h-12 w-12 text-primary-500 dark:text-primary-400"}),D(o("span",i$,null,512),[[F,"core::workflow.create"]]),D(o("p",u$,null,512),[[F,"core::workflow.info"]])])]))])):O("",!0)]),_:1},8,["header","overlay"])}}};function ks(){function e(t,n){return _t(t,(a,r)=>{let i=Ee(n.cards,["key",a.uriKey]);return a.order=i&&Object.hasOwn(i,"order")?i.order:r+1,a.enabled=!!(!i||i.enabled||typeof i.enabled>"u"),a})}return{applyUserConfig:e}}const c$={class:"mx-auto max-w-7xl lg:max-w-6xl"},m$=["onSubmit"],p$=["textContent"],f$={class:"pointer-events-none block h-full w-full opacity-70"},v$={__name:"DashboardEdit",setup(e){const{t}=ve(),n=Qe(),a=Ye(),r=Pe(),{currentUser:i}=Le(),{applyUserConfig:u}=ks(),c=Ut(),m=q({}),p=dt({}),f=q(!1),{form:h}=Ae({cards:[],name:null,is_default:!1}),g=V(()=>i.value.dashboards),y=V(()=>g.value.length),_=V(()=>Ee(g.value,["id",Number(a.params.id)])),I=V(()=>u(p.value,_.value)),F=V(()=>y.value===1?!0:y.value>1&&_.value.is_default===!1);function $(){h.set("cards",I.value.map(w=>({key:w.uriKey,order:w.order,enabled:m.value[w.uriKey]}))),h.put(`/dashboards/${_.value.id}`).then(w=>{Innoclapps.success(t("core::dashboard.updated")),r.commit("users/UPDATE_DASHBOARD",w),n.push({name:"dashboard"})})}async function C(){if(!_.value){n.push({name:"not-found"});return}let{data:w}=await Innoclapps.request().get("/cards");p.value=w,await Fe(),I.value.forEach(x=>{m.value[x.uriKey]=x.enabled}),c.value=_.value.name,h.set("name",_.value.name),h.set("is_default",_.value.is_default),f.value=!0}return C(),(w,x)=>{const A=v("NavbarSeparator"),N=v("IButton"),T=v("IFormInput"),E=v("IFormError"),B=v("IFormGroup"),z=v("IFormCheckbox"),M=v("ICard"),j=v("ILayout");return d(),R(j,{class:"dashboard-edit"},{actions:b(()=>[D(s(A,{class:"hidden lg:block"},null,512),[[Y,f.value]]),D(s(N,{type:"button",size:"sm",disabled:l(h).busy,text:w.$t("core::app.save"),onClick:$},null,8,["disabled","text"]),[[Y,f.value]])]),default:b(()=>[o("div",c$,[o("form",{onSubmit:ie($,["prevent"]),onKeydown:x[2]||(x[2]=U=>l(h).onKeydown(U))},[s(M,{class:"mb-4",overlay:!f.value},{default:b(()=>[s(B,{"label-for":"name",label:w.$t("core::dashboard.name"),required:""},{default:b(()=>[s(T,{id:"name",modelValue:l(h).name,"onUpdate:modelValue":x[0]||(x[0]=U=>l(h).name=U)},null,8,["modelValue"]),s(E,{textContent:S(l(h).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),F.value?(d(),R(B,{key:0},{default:b(()=>[s(z,{id:"is_default",checked:l(h).is_default,"onUpdate:checked":x[1]||(x[1]=U=>l(h).is_default=U),name:"is_default",label:w.$t("core::dashboard.default")},null,8,["checked","label"]),s(E,{textContent:S(l(h).getError("is_default"))},null,8,["textContent"])]),_:1})):O("",!0)]),_:1},8,["overlay"]),(d(!0),k(te,null,re(I.value,U=>(d(),k("div",{key:U.uriKey,class:"mb-6"},[s(z,{id:"status-"+U.uriKey,checked:m.value[U.uriKey],"onUpdate:checked":P=>m.value[U.uriKey]=P,class:"mb-2",label:w.$t("core::dashboard.cards.enabled")},null,8,["id","checked","onUpdate:checked","label"]),U.description?(d(),k("p",{key:0,class:"my-2",textContent:S(U.description)},null,8,p$)):O("",!0),o("div",f$,[(d(),R(We(U.component),{card:U},null,8,["card"]))])]))),128))],40,m$)])]),_:1})}}},b$=o("div",{class:"flex"},[o("div",{class:"mr-10 h-5 grow rounded bg-neutral-200 dark:bg-neutral-700"}),o("div",{class:"h-5 w-36 rounded bg-neutral-200 dark:bg-neutral-700"})],-1),un={__name:"CardPlaceholder",props:{pulse:Boolean,size:{type:String,default:"md"}},setup(e){return(t,n)=>{const a=v("ICard");return d(),R(a,{class:X({"h-56 md:h-52":e.size==="md","h-64":e.size==="lg","animate-pulse":e.pulse})},{default:b(()=>[b$,o("div",{class:X(["mt-7 w-full bg-neutral-200 dark:bg-neutral-700",{"h-28":e.size==="md","h-40":e.size==="lg"}])},null,2)]),_:1},8,["class"])}}},h$={class:"flex items-center space-x-3 lg:space-x-6"},_$={class:"truncate"},g$={key:0,class:"before:box-inherit after:box-inherit columns-1 gap-x-6 lg:columns-2"},y$={class:"mb-5 break-inside-avoid"},x$={class:"relative"},I$={class:"dashboard-drag-handle absolute left-2 top-5 z-10 block"},Da={__name:"DashboardIndex",setup(e){const{t}=ve(),n=Qe(),a=Pe(),{currentUser:r}=Le(),{applyUserConfig:i}=ks(),{scrollableDraggableOptions:u}=Xt(),{form:c}=Ae({name:""}),m=q([]),p=q({}),f=q([]),h=q(!1);let g=null;const y=V(()=>En(Lt(i(f.value,p.value),N=>N.enabled),["order","asc"])),_=V(()=>ot(r.value.dashboards,["is_default","name"],["desc","asc"])||[]),I=V(()=>Ee(_.value,["is_default",!0])||_.value[0]);function F(N){n.push({name:"edit-dashboard",params:{id:N.id}})}function $(){c.post("/dashboards").then(N=>{Innoclapps.success(t("core::dashboard.created")),a.commit("users/ADD_DASHBOARD",N),F(N)})}function C(N){p.value=N,Fe(()=>m.value=y.value)}function w(){let T=i(f.value,p.value).map(E=>{let B=Xe(m.value,["uriKey",E.uriKey]);return{key:E.uriKey,enabled:E.enabled,order:B===-1?E.order:B+1}});Innoclapps.request().put(`/dashboards/${p.value.id}`,{cards:T}).then(({data:E})=>{C(E),a.commit("users/UPDATE_DASHBOARD",E)})}async function x(){let N=await Innoclapps.request().get("/cards",{cancelToken:new Nn(T=>g=T)});f.value=N.data,h.value=!0}async function A(N){await Innoclapps.dialog().confirm(),await Innoclapps.request().delete(`/dashboards/${N.id}`),Innoclapps.success(t("core::dashboard.deleted")),a.commit("users/REMOVE_DASHBOARD",N.id),C(I.value)}return De(()=>{x().then(()=>{Fe(()=>{C(I.value)})})}),bt(()=>{g&&g()}),(N,T)=>{const E=v("NavbarSeparator"),B=v("IDropdownItem"),z=v("IMinimalDropdown"),M=v("Icon"),j=v("IButton"),U=v("DropdownSelectInput"),P=v("IButtonIcon"),H=v("IFormInput"),L=v("IFormError"),Z=v("IFormGroup"),J=v("IModal"),K=v("ILayout");return d(),R(K,null,{actions:b(()=>[s(E,{class:"hidden lg:block"}),o("div",h$,[s(z,{type:"horizontal",placement:"bottom-end"},{default:b(()=>[s(B,{icon:"PencilAlt",text:N.$t("core::dashboard.edit_current"),onClick:T[0]||(T[0]=G=>F(p.value))},null,8,["text"]),s(B,{icon:"Plus",text:N.$t("core::dashboard.new_dashboard"),onClick:T[1]||(T[1]=G=>N.$iModal.show("newDashboard"))},null,8,["text"]),s(B,{icon:"Trash",text:N.$t("core::dashboard.delete_current"),onClick:T[2]||(T[2]=G=>A(p.value))},null,8,["text"])]),_:1}),s(U,{"adaptive-width":"","model-value":p.value,items:_.value,"label-key":"name",placement:"bottom-end","wrapper-class":"w-full",class:"min-w-0 max-w-full sm:max-w-xs","value-key":"id",onChange:C},{default:b(({label:G,toggle:oe})=>[s(j,{variant:"white",class:X(["w-full",{"pointer-events-none blur":!h.value}]),onClick:oe},{default:b(()=>[o("span",_$,S(h.value?G:"Dashboard"),1),s(M,{icon:"ChevronDown",class:"-mr-1 ml-2 h-5 w-5"})]),_:2},1032,["class","onClick"])]),label:b(({label:G})=>[p.value.is_default?(d(),R(M,{key:0,class:"mr-1 h-5 w-5",icon:"Star"})):O("",!0),Q(" "+S(G),1)]),_:1},8,["model-value","items"])])]),default:b(()=>[h.value?O("",!0):(d(),k("div",g$,[s(un,{pulse:"",class:"mb-5"}),s(un,{pulse:"",class:"mb-5",size:"lg"}),s(un,{pulse:"",class:"mb-5"}),s(un,{pulse:"",class:"mb-5"}),s(un,{pulse:"",class:"mb-5",size:"lg"}),s(un,{pulse:"",class:"mb-5",size:"lg"}),s(un,{pulse:"",class:"mb-5"}),s(un,{pulse:"",class:"mb-5"})])),s(l(Et),Re({modelValue:m.value,"onUpdate:modelValue":T[3]||(T[3]=G=>m.value=G),handle:".dashboard-drag-handle",class:"before:box-inherit after:box-inherit columns-1 gap-x-6 lg:columns-2","item-key":"uriKey"},l(u),{onChange:w}),{item:b(({element:G})=>[o("div",y$,[o("div",x$,[o("div",I$,[s(P,{icon:"Selector",class:"cursor-move","icon-class":"w-4 h-4"})]),(d(),R(We(G.component),{card:G},null,8,["card"]))])])]),_:1},16,["modelValue"]),s(J,{id:"newDashboard",size:"sm","cancel-title":N.$t("core::app.cancel"),"ok-title":N.$t("core::app.create"),form:"","ok-disabled":l(c).busy,title:N.$t("core::dashboard.create"),onSubmit:$,onKeydown:T[5]||(T[5]=G=>l(c).onKeydown(G)),onShown:T[6]||(T[6]=()=>N.$refs.inputNameRef.focus())},{default:b(()=>[s(Z,{"label-for":"name",label:N.$t("core::dashboard.name"),required:""},{default:b(()=>[s(H,{id:"name",ref:"inputNameRef",modelValue:l(c).name,"onUpdate:modelValue":T[4]||(T[4]=G=>l(c).name=G)},null,8,["modelValue"]),s(L,{textContent:S(l(c).getError("name"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1},8,["cancel-title","ok-title","ok-disabled","title"])]),_:1})}}},k$={},$$={class:"mt-20 flex flex-col flex-wrap content-center"},w$={class:"flex flex-col items-center"},C$=o("h1",{class:"mb-2 mt-6 text-3xl font-bold text-neutral-900 dark:text-white"}," 403! ",-1),S$=o("h2",{class:"text-2xl text-neutral-700 dark:text-neutral-100"}," Hang on... ",-1),R$={class:"flex flex-col justify-center"},F$={class:"mt-5 text-center text-neutral-700 dark:text-neutral-200"},V$={class:"mt-5 text-center"};function T$(e,t){const n=v("Icon"),a=v("IButton"),r=v("ILayout");return d(),R(r,{full:""},{default:b(()=>[o("div",$$,[o("div",w$,[s(n,{icon:"ShieldExclamation",class:"h-20 w-20 text-primary-300"}),C$,S$]),o("div",R$,[o("p",F$,S(e.$route.query.message||"You are not authorized to perform this action or view this page."),1),o("div",V$,[s(a,{to:"/dashboard",size:"lg"},{default:b(()=>[Q(" Go to dashboard ")]),_:1})])])])]),_:1})}const D$=ct(k$,[["render",T$]]),q$={},E$={class:"mt-20 flex flex-col flex-wrap content-center"},A$={class:"flex flex-col items-center"},B$=o("h1",{class:"mb-2 mt-6 text-3xl font-bold text-neutral-900 dark:text-white"}," Oops! ",-1),N$=o("h2",{class:"text-2xl text-neutral-700 dark:text-neutral-100"}," Page not found ",-1),O$={class:"flex flex-col justify-center"},z$=o("p",{class:"mt-5 text-neutral-700 dark:text-neutral-300"}," The page you are trying to view does not exists or you don't have permissions to access it. ",-1),M$={class:"mt-5 text-center"};function U$(e,t){const n=v("Icon"),a=v("IButton"),r=v("ILayout");return d(),R(r,{full:""},{default:b(()=>[o("div",E$,[o("div",A$,[s(n,{icon:"QuestionMarkCircle",class:"h-20 w-20 text-primary-300"}),B$,N$]),o("div",O$,[z$,o("div",M$,[s(a,{to:{name:"dashboard"},size:"lg"},{default:b(()=>[Q(" Go to dashboard ")]),_:1})])])])]),_:1})}const qa=ct(q$,[["render",U$]]),P$={class:"mt-3 flex justify-center"},xn={__name:"InfinityLoader",props:{scrollElement:String,debounce:{type:Number,default:200},offset:{type:Number,default:0},loadWhenMounted:Boolean},emits:["handle","loaded","complete","reset","pause","resume"],setup(e,{expose:t,emit:n}){const a=e,r={COMPLETE:"complete",LOADING:"loading",READY:"ready",PAUSED:"paused"},i=q(null),u=q(r.READY);let c=null,m=null;const p={loaded:()=>{n("loaded"),u.value=r.READY},complete:()=>{n("complete"),u.value=r.COMPLETE,y()},reset:()=>{n("reset"),u.value=r.READY,_()},pause:()=>{n("pause"),u.value=r.PAUSED,y()},resume:()=>{u.value===r.PAUSED&&(n("resume"),u.value=r.READY,_())}},f=V(()=>u.value===r.LOADING);function h(F){if(u.value===r.READY&&Yd(i.value)){let $=F.target;F.target===document&&($=$.scrollingElement||$.documentElement),$.scrollHeight-a.offset-$.scrollTop-$.clientHeight<1&&g()}}a.debounce?m=Dt(h,a.debounce,{trailing:!0}):m=h;function g(F=!1){(u.value===r.READY||F===!0)&&(u.value=r.LOADING,n("handle",p))}function y(){c&&c.removeEventListener("scroll",m,Bo())}function _(){c&&c.addEventListener("scroll",m,Bo())}function I(){c=a.scrollElement?document.querySelector(a.scrollElement):window,a.loadWhenMounted&&g(),_()}return De(()=>{Fe(I)}),on(y),t({attemptLoad:g,state:p}),(F,$)=>{const C=v("ISpinner");return d(),k("div",{ref_key:"rootElRef",ref:i},[de(F.$slots,"default"),o("div",P$,[D(s(C,{class:"h-4 w-4 text-primary-500"},null,512),[[Y,f.value]])])],512)}}},j$={class:"mx-auto max-w-5xl"},L$={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},H$=["onClick"],G$={class:"flex items-center px-4 py-4 sm:px-6"},K$={class:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between"},Y$={class:"truncate"},W$=["textContent"],Q$=["textContent"],X$={class:"ml-5 shrink-0"},Z$={class:"mt-2 text-sm font-medium text-neutral-800 dark:text-white"},J$={class:"p-3 text-center text-neutral-600"},ew={__name:"NotificationsIndex",setup(e){const t=Pe(),{currentUser:n}=Le(),{localizedDateTime:a}=Ne(),r=ts([]),i=q(!1),u=q(2),c=q(!1),m=V(()=>t.getters["users/hasUnreadNotifications"]),p=t.getters["users/localizeNotification"],f=V(()=>r.length);function h(){c.value=!0,t.dispatch("users/markAllNotificationsAsRead").finally(()=>c.value=!1)}function g($){t.dispatch("users/destroyNotification",r[$]).then(()=>r.splice($,1))}function y($){$.forEach(C=>{Xe($,["id",C.id])===-1&&$.push(C)})}async function _($){let{data:C}=await I();y(C.data),Fe(()=>{C.total===f.value&&(i.value=!0,$.complete())}),u.value+=1,$.loaded()}function I(){return Innoclapps.request().get(t.state.users.notificationsEndpoint,{params:{page:u.value}})}function F($){r.unshift($)}return n.value.notifications.latest.forEach($=>r.push($)),rt("new-notification-added",F),($,C)=>{const w=v("IButton"),x=v("IButtonIcon"),A=v("Icon"),N=v("ICardBody"),T=v("ICard"),E=v("ILayout"),B=ae("t");return d(),R(E,null,{default:b(()=>[o("div",j$,[s(T,{"no-body":"",header:$.$t("core::notifications.notifications")},{actions:b(()=>[D(s(w,{variant:"white",loading:c.value,size:"sm",disabled:!m.value,text:$.$t("core::notifications.mark_all_as_read"),onClick:h},null,8,["loading","disabled","text"]),[[Y,f.value>0]])]),default:b(()=>[o("ul",L$,[(d(!0),k(te,null,re(l(r),(z,M)=>(d(),k("li",{key:z.id},[o("a",{href:"#",class:"block hover:bg-neutral-50 focus:outline-none dark:hover:bg-neutral-700/60",onClick:ie(j=>$.$router.push(z.data.path),["prevent"])},[o("div",G$,[o("div",K$,[o("div",Y$,[o("p",{class:"truncate text-sm font-medium text-neutral-800 dark:text-neutral-100",textContent:S(l(p)(z))},null,8,W$),o("p",{class:"mt-2 text-sm text-neutral-500 dark:text-neutral-300",textContent:S(l(a)(z.created_at))},null,8,Q$)])]),o("div",X$,[s(x,{icon:"Trash",onClick:ie(j=>g(M),["stop"])},null,8,["onClick"])])])],8,H$)]))),128))]),s(xn,{onHandle:_}),D(s(N,{class:"text-center"},{default:b(()=>[s(A,{icon:"EmojiSad",class:"mx-auto h-12 w-12 text-neutral-400"}),D(o("h3",Z$,null,512),[[B,"core::notifications.no_notifications"]])]),_:1},512),[[Y,f.value===0]]),D(o("p",J$,null,512),[[Y,i.value],[B,"core::notifications.no_more_notifications"]])]),_:1},8,["header"])])]),_:1})}}},tw={class:"rounded-md border border-neutral-200 px-6 py-4 shadow-sm dark:border-neutral-700"},nw={class:"flex flex-col sm:flex-row sm:items-center"},ow={class:"flex items-center"},lw={class:"self-start"},aw={class:"ml-1 sm:ml-3"},sw=["textContent"],rw=o("br",null,null,-1),iw={key:0},uw={class:"text-sm text-warning-500 dark:text-warning-400"},dw={class:"ml-0 mt-2 shrink-0 grow sm:ml-auto sm:mt-0 sm:grow-0"},cw={class:"flex items-center sm:justify-center"},zo={__name:"OAuthAccount",props:{account:{type:Object},withReconnectLink:{type:Boolean,default:!0}},setup(e){const t=e,n=Ye(),a=V(()=>n.name!=="oauth-accounts"&&t.withReconnectLink);return(r,i)=>{const u=v("Icon"),c=v("router-link"),m=ae("t");return d(),k("div",tw,[o("div",nw,[o("div",ow,[o("div",lw,[o("span",{class:X(["inline-flex h-8 w-8 items-center justify-center rounded-full",[e.account.requires_auth?"bg-neutral-400":"bg-success-400"]])},[s(u,{icon:"CheckCircle",class:"h-6 w-6 text-white"})],2)]),o("div",aw,[o("span",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-200",textContent:S(e.account.email)},null,8,sw),rw,e.account.requires_auth?(d(),k("div",iw,[D(o("p",uw,null,512),[[m,"core::oauth.requires_authentication"]])])):O("",!0),de(r.$slots,"after-name")])]),o("div",dw,[o("div",cw,[D(s(c,{class:"link text-sm",to:{name:"oauth-accounts",query:{reconnect:e.account.id}}},null,8,["to"]),[[Y,a.value],[m,"core::oauth.re_authenticate"]]),de(r.$slots,"default")])])])])}}},mw={class:"mx-auto max-w-5xl"},pw={key:0,class:"space-y-3"},fw={key:1,class:"text-center"},vw={class:"mt-2 text-sm font-medium text-neutral-800 dark:text-white"},bw={__name:"OAuthAccounts",setup(e){const{t}=ve(),n=Pe(),a=Ye(),{setLoading:r,isLoading:i}=Ct(),u=q([]),c=V(()=>u.value.length>0);function m(h){window.location.href=`${Innoclapps.config("url")}/${h.type}/connect`}async function p(h){await Innoclapps.dialog().confirm(t("core::oauth.delete_warning"),{okText:t("core::app.confirm")}),await Innoclapps.request().delete(`oauth/accounts/${h}`),u.value.splice(Xe(u.value,["id",Number(h)]),1),n.commit("emailAccounts/RESET"),Innoclapps.success(t("core::oauth.deleted"))}function f(){r(!0),Innoclapps.request().get("oauth/accounts").then(({data:h})=>{u.value=h,a.query.reconnect&&m(h.find(g=>g.id==a.query.reconnect))}).finally(()=>r(!1))}return f(),(h,g)=>{const y=v("IButton"),_=v("Icon"),I=v("ICard"),F=v("router-view"),$=v("ILayout"),C=ae("t");return d(),R($,null,{default:b(()=>[o("div",mw,[s(I,{header:h.$t("core::oauth.connected_accounts"),overlay:l(i)},{default:b(()=>[c.value?(d(),k("div",pw,[(d(!0),k(te,null,re(u.value,w=>(d(),R(zo,{key:w.id,account:w},{default:b(()=>[s(y,{size:"sm",text:h.$t("core::oauth.re_authenticate"),onClick:x=>m(w)},null,8,["text","onClick"]),w.authorizations.delete?(d(),R(y,{key:0,size:"sm",class:"ml-1",variant:"white",icon:"Trash",onClick:x=>p(w.id)},null,8,["onClick"])):O("",!0)]),_:2},1032,["account"]))),128))])):D((d(),k("div",fw,[s(_,{icon:"EmojiSad",class:"mx-auto h-12 w-12 text-neutral-400"}),D(o("h3",vw,null,512),[[C,"core::oauth.no_accounts"]])],512)),[[Y,!l(i)]])]),_:1},8,["header","overlay"])]),s(F)]),_:1})}}},hw={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},_w={class:"shrink-0"},gw={class:"min-w-0 flex-1 truncate"},yw={class:"text-sm font-medium text-neutral-800 dark:text-white"},xw={class:"text-sm text-neutral-500 dark:text-neutral-300"},Iw={class:"block shrink-0 md:hidden md:group-hover:block"},kw={class:"flex items-center space-x-1"},$w={__name:"MediaUploadOutputList",props:{files:{type:Array,required:!0}},emits:["remove-requested"],setup(e){const{localizedDateTime:t}=Ne();return(n,a)=>{const r=v("Icon"),i=v("IButtonIcon");return d(),k("ul",hw,[(d(!0),k(te,null,re(e.files,(u,c)=>(d(),k("li",{key:c+u.name,class:"group flex items-center space-x-3 py-4"},[o("div",_w,[o("span",{class:X([u.xhr&&u.xhr.status>=400?"bg-danger-500 text-white":"",u.xhr&&u.xhr.status<400?"bg-success-500 text-white":"",u.xhr?"":"bg-neutral-600 text-neutral-100","inline-flex h-10 w-10 items-center justify-center rounded-full text-sm"])},[u.xhr&&u.xhr.status>=400?(d(),R(r,{key:0,icon:"X",class:"h-5 w-5"})):u.xhr?(d(),R(r,{key:1,icon:"Check",class:"h-5 w-5"})):(d(),R(r,{key:2,icon:"CloudArrowUp",class:"h-5 w-5"}))],2)]),o("div",gw,[o("p",yw,S(u.name),1),o("p",xw,S(l(t)(new Date)),1)]),o("div",Iw,[o("div",kw,[D(o("div",null,[s(i,{icon:"X",onClick:m=>n.$emit("remove-requested",c)},null,8,["onClick"])],512),[[Y,!u.xhr||u.xhr.status>=400]])])])]))),128))])}}},ww={class:"absolute inset-0 z-10 flex items-center justify-center rounded-md bg-neutral-200"},Cw={class:"ml-2 flex items-center space-x-2"},Sw=["disabled"],Hn={__name:"MediaUpload",props:{modelValue:{},icon:{type:[String,Boolean],default:"CursorClick"},inputId:{default:"media",type:String},actionUrl:String,drop:Boolean,wrapperClasses:{type:[Object,Array,String],default:"flex items-center"},name:{default:"file",type:String},extensions:[Array,String],accept:{type:String,default:void 0},uploadText:String,selectFileText:String,allowCancel:{type:Boolean,default:!0},showUploadButton:{type:Boolean,default:!0},showOutput:{default:!0,type:Boolean},automaticUpload:{default:!0,type:Boolean},multiple:{default:!0,type:Boolean},requestData:{type:Object,default:()=>({})},styleClasses:{type:[Object,Array,String],default:"!flex items-center rounded-full px-5 py-2 text-sm font-medium bg-primary-50 text-primary-800 hover:bg-primary-100 focus:ring-offset-primary-50 focus:ring-primary-600 focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer"}},emits:["update:modelValue","file-accepted","file-uploaded","clear"],setup(e,{emit:t}){const n=e,a=ql(()=>mo(()=>import("./vue-upload-component-3e25ed60.js").then(w=>w.v),["assets/vue-upload-component-3e25ed60.js","assets/vendor-462626fd.js"])),{t:r}=ve(),i=q(null),u=Innoclapps.csrfToken(),c=q([]),m=q([]),p=V(()=>n.uploadText||r("core::app.upload")),f=V(()=>n.selectFileText||r("core::app.select_file"));function h(w){if(w.status===413){Innoclapps.error(r("core::app.file_too_large"));return}let x=JSON.parse(w.response),A=w.status<400;return x.message&&(A?Innoclapps.success(x.message):Innoclapps.error(x.message)),w.status===422&&(m.value=x.errors),x}function g(w){c.value.splice(w,1),t("update:modelValue",c.value)}function y(){i.value.clear(),m.value=[],t("clear")}function _(w){if(!n.extensions)return!0;let x=n.extensions;Array.isArray(x)?x=x.join("|"):typeof x=="string"&&(x=x.replace(",","|"));var A=RegExp(".("+x+")","i");return A.test(w.name)?!0:(Innoclapps.error(r("validation.mimes",{attribute:r("core::app.file").toLowerCase(),values:[x]})),!1)}function I(w,x){return w&&x}function F(w,x){return w.active!==x.active}function $(w,x){I(w,x)&&(F(w,x),w.progress,x.progress,w.error!==x.error&&w.xhr.response&&h(w.xhr),w.success!==x.success&&(t("file-uploaded",h(w.xhr)),g(Xe(c.value,["name",w.name])))),n.automaticUpload&&(!!w!=!!x||x.error!==w.error)&&!i.value.active&&w&&!w.xhr&&(i.value.active=!0)}const C=function(w,x,A){if(w&&!x){if(!_(w))return A();if(w.size>=0&&w.size>Innoclapps.config("max_upload_size"))return Innoclapps.error("File too big"),A();w.blob="";let N=window.URL||window.webkitURL;N&&N.createObjectURL&&(w.blob=N.createObjectURL(w.file)),Fe(()=>t("file-accepted",w))}};return(w,x)=>{const A=v("IAlert"),N=v("Icon"),T=v("ISpinner"),E=ae("t");return d(),k("div",null,[(d(!0),k(te,null,re(m.value,(B,z)=>(d(),R(A,{key:z,show:"",variant:"danger",class:"mb-4"},{default:b(()=>[Q(S(B),1)]),_:2},1024))),128)),de(w.$slots,"default"),e.showOutput?(d(),R($w,{key:0,files:c.value,onRemoveRequested:g},null,8,["files"])):O("",!0),o("div",{class:X([e.wrapperClasses,"relative"])},[de(w.$slots,"drop-placeholder",{upload:w.$refs.uploadRef},()=>[D(o("div",ww,null,512),[[Y,w.$refs.uploadRef&&w.$refs.uploadRef.dropActive],[E,"core::app.drop_files"]])]),s(l(a),{ref_key:"uploadRef",ref:i,modelValue:c.value,"onUpdate:modelValue":[x[0]||(x[0]=B=>c.value=B),x[1]||(x[1]=B=>w.$emit("update:modelValue",B))],headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":l(u)},class:X(e.styleClasses),disabled:w.$refs.uploadRef&&w.$refs.uploadRef.active,name:e.name,multiple:e.multiple,extensions:e.extensions,accept:e.accept,data:e.requestData,drop:e.drop,"post-action":e.actionUrl,"input-id":e.inputId,onInputFile:$,onInputFilter:C},{default:b(()=>[e.icon&&!(w.$refs.uploadRef&&w.$refs.uploadRef.active)?(d(),R(N,{key:0,icon:e.icon,class:"mr-2 h-4 w-4 text-current"},null,8,["icon"])):O("",!0),w.$refs.uploadRef&&w.$refs.uploadRef.active?(d(),R(T,{key:1,class:"-mt-1 mr-2 inline-flex h-4 w-4 text-current"})):O("",!0),de(w.$slots,"upload-text",{},()=>[Q(S(f.value),1)])]),_:3},8,["modelValue","headers","class","disabled","name","multiple","extensions","accept","data","drop","post-action","input-id"]),o("div",Cw,[de(w.$slots,"upload-button",{upload:w.$refs.uploadRef},()=>[e.showUploadButton&&!e.automaticUpload?(d(),k("button",{key:0,type:"button",disabled:c.value.length===0,class:"inline-flex cursor-pointer items-center rounded-full bg-primary-50 px-5 py-2 text-sm font-medium text-primary-800 hover:bg-primary-100 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 focus:ring-offset-primary-50 disabled:pointer-events-none disabled:opacity-60",onClick:x[2]||(x[2]=B=>w.$refs.uploadRef.active=!0)},[s(N,{icon:"CloudArrowUp",class:"mr-2 h-4 w-4 text-current"}),Q(" "+S(p.value),1)],8,Sw)):O("",!0)]),D(o("button",{type:"button",class:"inline-flex items-center rounded-full bg-danger-50 px-5 py-2 text-sm font-medium text-danger-800 hover:bg-danger-100 focus:outline-none focus:ring-2 focus:ring-danger-600 focus:ring-offset-2 focus:ring-offset-danger-50",onClick:x[3]||(x[3]=B=>w.$refs.uploadRef.active=!1)},null,512),[[Y,e.allowCancel&&w.$refs.uploadRef&&w.$refs.uploadRef.active],[E,"core::app.cancel"]]),D(o("button",{type:"button",class:"inline-flex items-center rounded-full bg-neutral-50 px-5 py-2 text-sm font-medium text-neutral-800 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-neutral-600 focus:ring-offset-2 focus:ring-offset-neutral-50",onClick:y},null,512),[[Y,c.value.length>0&&(!w.$refs.uploadRef||!w.$refs.uploadRef.active)],[E,"core::app.clear"]])])],2)])}}},Rw={class:"-mt-px lg:border-b lg:border-t lg:border-neutral-200 lg:dark:border-neutral-700"},Fw={class:"mx-auto max-w-7xl lg:px-8","aria-label":"Progress"},Vw={role:"list",class:"overflow-hidden lg:flex lg:border-l lg:border-r lg:border-neutral-200 lg:dark:border-neutral-700"},Tw={key:0},Dw=o("span",{class:"absolute left-0 top-0 h-full w-1 bg-transparent lg:bottom-0 lg:top-auto lg:h-1 lg:w-full","aria-hidden":"true"},null,-1),qw={class:"shrink-0"},Ew={class:"ml-4 mt-0.5 flex min-w-0 flex-col"},Aw={class:"text-xs font-semibold uppercase tracking-wide dark:text-primary-300"},Bw={class:"truncate text-sm font-medium text-neutral-500 dark:text-neutral-200"},Nw={key:1,"aria-current":"step"},Ow=o("span",{class:"absolute left-0 top-0 h-full w-1 bg-primary-600 dark:bg-primary-300 lg:bottom-0 lg:top-auto lg:h-1 lg:w-full","aria-hidden":"true"},null,-1),zw={class:"shrink-0"},Mw={class:"flex h-10 w-10 items-center justify-center rounded-full border-2 border-primary-600 dark:border-primary-300"},Uw={class:"text-primary-600 dark:text-primary-300"},Pw={class:"ml-4 mt-0.5 flex min-w-0 flex-col"},jw={class:"text-xs font-semibold uppercase tracking-wide text-primary-600 dark:text-primary-300"},Lw={class:"truncate text-sm font-medium text-neutral-500 dark:text-neutral-200"},Hw={key:2},Gw=o("span",{class:"absolute left-0 top-0 h-full w-1 bg-transparent lg:bottom-0 lg:top-auto lg:h-1 lg:w-full","aria-hidden":"true"},null,-1),Kw={class:"shrink-0"},Yw={class:"flex h-10 w-10 items-center justify-center rounded-full border-2 border-neutral-300 dark:border-neutral-400"},Ww={class:"text-neutral-500 dark:text-neutral-300"},Qw={class:"ml-4 mt-0.5 flex min-w-0 flex-col"},Xw={class:"text-xs font-semibold uppercase tracking-wide text-neutral-500 dark:text-neutral-100"},Zw={class:"truncate text-sm font-medium text-neutral-500 dark:text-neutral-200"},Jw={key:3,class:"absolute inset-0 left-0 top-0 hidden w-3 lg:block","aria-hidden":"true"},e2=o("svg",{class:"h-full w-full text-neutral-300 dark:text-neutral-600",viewBox:"0 0 12 82",fill:"none",preserveAspectRatio:"none"},[o("path",{d:"M0.5 0V31L10.5 41L0.5 51V82",stroke:"currentcolor","vector-effect":"non-scaling-stroke"})],-1),t2=[e2],n2={__name:"ImportSteps",props:{steps:{type:Object,required:!0}},setup(e){return(t,n)=>{const a=v("Icon");return d(),k("div",Rw,[o("nav",Fw,[o("ol",Vw,[(d(!0),k(te,null,re(e.steps,(r,i)=>(d(),k("li",{key:r.id,class:"relative overflow-hidden lg:flex-1"},[o("div",{class:X([i===0?"border-b-0":"",i===e.steps.length-1?"border-t-0":"","overflow-hidden border-y border-neutral-200 dark:border-neutral-700 lg:border-0"])},[r.status==="complete"?(d(),k("div",Tw,[Dw,o("span",{class:X([i!==0?"lg:pl-9":"","flex items-start px-6 py-5 text-sm font-medium"])},[o("span",qw,[o("span",{class:X([i!==e.steps.length-1?"bg-primary-600":"bg-success-500","flex h-10 w-10 items-center justify-center rounded-full"])},[s(a,{icon:"Check",class:"h-6 w-6 text-white"})],2)]),o("span",Ew,[o("span",Aw,S(r.name),1),o("span",Bw,S(r.description),1)])],2)])):r.status==="current"?(d(),k("div",Nw,[Ow,o("span",{class:X([i!==0?"lg:pl-9":"","flex items-start px-6 py-5 text-sm font-medium"])},[o("span",zw,[o("span",Mw,[o("span",Uw,S(r.id),1)])]),o("span",Pw,[o("span",jw,S(r.name),1),o("span",Lw,S(r.description),1)])],2)])):(d(),k("div",Hw,[Gw,o("span",{class:X([i!==0?"lg:pl-9":"","flex items-start px-6 py-5 text-sm font-medium"])},[o("span",Kw,[o("span",Yw,[o("span",Ww,S(r.id),1)])]),o("span",Qw,[o("span",Xw,S(r.name),1),o("span",Zw,S(r.description),1)])],2)])),i!==0?(d(),k("div",Jw,t2)):O("",!0)],2)]))),128))])])])}}},o2={class:"-mt-0.5 flex items-center space-x-2"},l2={class:"text-base font-medium text-info-700"},a2={key:3,class:"mt-5 text-sm"},s2={class:"mb-3 text-lg font-medium text-neutral-700 dark:text-neutral-200"},r2={class:"flex"},i2={class:"w-1/2"},u2={key:0,class:"text-xs"},d2=["textContent"],c2={class:"w-1/2"},m2={key:0,value:""},p2=["disabled","value"],f2={class:"flex items-center justify-end space-x-2"},v2={class:"text-left"},b2={class:"text-left"},h2={class:"text-left"},_2={class:"text-center"},g2={class:"text-center"},y2={class:"text-center"},x2={class:"text-center"},I2={class:"text-center"},k2=o("th",null,null,-1),$2={class:"text-left"},w2={class:"text-left"},C2={class:"text-left"},S2={class:"flex items-center justify-center space-x-1"},R2=["onClick"],F2={class:"text-center"},V2={class:"text-center"},T2={key:0},D2=["onClick"],q2={class:"text-center align-middle"},E2={class:"relative h-4 rounded-full bg-neutral-200"},A2={class:"absolute inset-0 flex items-center justify-center text-xs font-medium text-neutral-900"},B2={class:"text-center"},N2={class:"inline-block"},O2={class:"flex justify-end space-x-2"},z2=["onClick"],M2={key:0},U2={colspan:"4"},P2={class:"text-lg/6 font-medium text-neutral-900 dark:text-white"},j2={class:"text-sm text-neutral-500 dark:text-neutral-300"},L2={class:"mt-3 max-w-4xl font-normal"},H2={class:"my-2 max-w-3xl font-normal"},G2={class:"mb-4 mt-8 flex items-center"},K2=["onClick"],Y2=o("td",{colspan:"4"},null,-1),W2={class:"mt-2 text-sm font-medium text-neutral-800 dark:text-white"},$s={__name:"ResourceImport",props:{header:String,resourceName:{required:!0,type:String},requestQueryString:{type:Object,default(){return{}}}},setup(e){const t=e,{t:n}=ve(),a=Pe(),{resetStoreState:r}=Le(),{localizedDateTime:i}=Ne(),u=Ye(),c=Qe(),m=q([]),p=q(!1),f=q(null),h=q(null),g=q(null),y=q(!1),_=q(!1),I=q({}),F=q(!1),$=q([{id:"01",name:n("core::import.steps.step_1.name"),description:n("core::import.steps.step_1.description"),status:"current"},{id:"02",name:n("core::import.steps.step_2.name"),description:n("core::import.steps.step_2.description"),status:"upcoming"},{id:"03",name:n("core::import.steps.step_3.name"),description:n("core::import.steps.step_3.description"),status:"upcoming"},{id:"04",name:n("core::import.steps.step_4.name"),description:n("core::import.steps.step_4.description"),status:"upcoming"}]),C=V(()=>ot(m.value,"created_at","desc")),w=V(()=>C.value.length>0),x=V(()=>{let ee=`${a.state.apiURL}/${t.resourceName}/import/upload`;return E(ee)});function A(ee){let W=`${a.state.apiURL.replace(/\/+$/,"")}${T(ee.id,"/skip-file")}`;return E(W)}function N(ee,W){(W==="complete"||W==="current")&&$.value.filter(ce=>parseInt(ce.id)<parseInt(ee)).forEach(ce=>ce.status="complete"),W==="current"&&$.value.filter(ce=>parseInt(ce.id)>parseInt(ee)).forEach(ce=>ce.status="upcoming"),$.value[Xe($.value,["id",ee])].status=W}function T(ee,W=""){return`/${t.resourceName}/import/${ee}${W}`}function E(ee,W={}){if(Object.keys(t.requestQueryString).length>0||Object.keys(W).length>0){let ce=[],fe={...t.requestQueryString,...W};for(var ne in fe)ce.push(encodeURIComponent(ne)+"="+encodeURIComponent(fe[ne]));ee+="?"+ce.join("&")}return ee}function B(ee){Innoclapps.request().get(T(ee,"/skip-file"),{responseType:"blob"}).then(W=>{so(W.data,W.headers["content-disposition"].split("filename=")[1])})}function z(ee){Innoclapps.request().get(ee).then(({data:W})=>{so(W,"sample.csv"),($.value[0].status==="current"||$.value[3].status==="complete")&&N("02","current")})}function M(ee){return!!Ee(h.value.mappings,["attribute",ee])}async function j(ee){await Innoclapps.dialog().confirm({message:n("core::import.revert_info"),confirmText:n("core::import.revert")});const W=ee.id,ne=ee.imported,ce=500,Se=Math.ceil(ne/5/100);I.value[W]=!0,(async()=>{try{for(let Ce=1;Ce<=Se;Ce++)try{const{data:le}=await Innoclapps.request().delete(T(W,"/revert?limit="+ce));m.value[Xe(m.value,["id",Number(W)])]=le}catch{break}}finally{I.value[W]=!1}})()}async function U(ee,W){if(p.value&&W!==!0){h.value=null;return}await Innoclapps.dialog().confirm(),await Innoclapps.request().delete(T(ee)),P(ee)}function P(ee){m.value.splice(Xe(m.value,["id",ee]),1),h.value&&ee==h.value.id&&(h.value=null,p.value=!1,N("01","current"))}function H(ee){L(Ee(m.value,["id",Number(ee)])),N("03","current")}function L(ee){ee.fields=new en(ee.fields),h.value=ee}async function Z(){y.value=!0;const{data:ee}=await Innoclapps.request().get(`${t.resourceName}/import`);m.value=ee,y.value=!1}function J(ee){return!ee.detected_attribute||!h.value.fields.has(ee.detected_attribute)?!1:h.value.fields.find(ee.detected_attribute).isRequired}function K(ee){L(ee),m.value.push(ee),N("03","current"),g.value=null}function G(ee){L(ee);let W=Xe(m.value,["id",Number(ee.id)]);m.value[W]=ee,N("03","current"),p.value=!0}function oe(ee){F.value=!0,Innoclapps.request().post(E(T(ee))).then(({data:W})=>{m.value[Xe(m.value,["id",Number(W.id)])]=W,W.next_batch?setTimeout(()=>window.location.href=`?import_id=${W.id}`,2e3):(c.replace({query:{}}),F.value=!1,Innoclapps.success(n("core::import.imported"))),r()}).catch(()=>{c.replace({query:{}}),F.value=!1})}function pe(){_.value=!0,Innoclapps.request().post(E(T(h.value.id)),{mappings:h.value.mappings}).then(({data:ee})=>{let W=Xe(m.value,["id",Number(ee.id)]);if(W!==-1?m.value[W]=ee:m.value.push(ee),ee.next_batch){setTimeout(()=>window.location.href=`?import_id=${ee.id}`,1e3);return}Innoclapps.success(n("core::import.imported")),h.value=null,N("04","complete"),r()}).catch(ee=>{let W=ee.response.data;W.deleted||W.rows_exceeded?(W.deleted&&P(h.value.id),W.rows_exceeded&&(g.value=ee.response.data.message)):N("04","current")}).finally(()=>{_.value=!1,p.value=!1})}async function ue(){await Z(),u.query.import_id&&(F.value=!0,oe(u.query.import_id))}return ue(),(ee,W)=>{const ne=v("ICardHeading"),ce=v("IButton"),fe=v("ISpinner"),Se=v("IAlert"),Ie=v("IFormLabel"),Ce=v("Icon"),le=v("IFormSelect"),ye=v("ICardBody"),Ge=v("ICard"),be=v("IButtonIcon"),Ve=v("ITable"),$e=ae("t"),et=ae("i-tooltip");return d(),k(te,null,[s(Ge,{"no-body":""},vt({header:b(()=>[de(ee.$slots,"header",{},()=>[s(ne,null,{default:b(()=>[Q(S(e.header||ee.$t("core::import.import_records")),1)]),_:1})])]),actions:b(()=>[F.value?O("",!0):(d(),R(ce,{key:0,variant:"white",size:"sm",text:ee.$t("core::import.download_sample"),onClick:W[0]||(W[0]=Te=>z(`/${e.resourceName}/import/sample`))},null,8,["text"]))]),default:b(()=>[F.value?O("",!0):(d(),R(n2,{key:0,steps:$.value},null,8,["steps"])),s(ye,null,{default:b(()=>[F.value?(d(),R(Se,{key:0},{default:b(()=>[o("div",o2,[D(o("h4",l2,null,512),[[$e,"core::import.import_in_progress"]]),s(fe,{class:"h-4 w-4"})]),Q(" "+S(ee.$t("core::import.records_being_imported_in_batches")),1)]),_:1})):O("",!0),g.value?(d(),R(Se,{key:1,dismissible:"",variant:"danger",class:"mb-5"},{default:b(()=>[Q(S(g.value),1)]),_:1})):O("",!0),F.value?O("",!0):(d(),R(Hn,{key:2,class:"ml-5","action-url":x.value,extensions:"csv",multiple:!1,"show-output":!1,"upload-text":ee.$t("core::import.start"),onFileUploaded:K},null,8,["action-url","upload-text"])),h.value?(d(),k("div",a2,[D(o("h3",s2,null,512),[[$e,"core::import.spreadsheet_columns"]]),o("div",r2,[o("div",i2,[(d(!0),k(te,null,re(h.value.mappings,(Te,tt)=>(d(),k("div",{key:"mapping-"+tt,class:X([{"bg-neutral-100 dark:bg-neutral-800":!Te.attribute,"bg-white dark:bg-neutral-700":Te.attribute},"mb-2 mr-3 flex h-16 flex-col justify-center rounded border border-neutral-300 px-4 dark:border-neutral-500"])},[s(Ie,{required:J(Te)},{default:b(()=>[Q(S(Te.original)+" ",1),Te.skip&&!J(Te)?(d(),k("span",u2," ("+S(ee.$t("core::import.column_will_not_import"))+") ",1)):O("",!0)]),_:2},1032,["required"]),o("p",{class:"truncate text-neutral-500 dark:text-neutral-300",textContent:S(Te.preview)},null,8,d2)],2))),128))]),o("div",c2,[(d(!0),k(te,null,re(h.value.mappings,(Te,tt)=>(d(),k("div",{key:"field-"+tt,class:"mb-2 flex h-16 items-center"},[s(Ce,{icon:"ChevronRight",class:"mr-3 h-5 w-5 text-neutral-800 dark:text-neutral-200"}),s(le,{modelValue:h.value.mappings[tt].attribute,"onUpdate:modelValue":at=>h.value.mappings[tt].attribute=at,size:!1,rounded:!1,class:"h-16 rounded px-4 py-5 hover:border-primary-500",onInput:at=>h.value.mappings[tt].skip=!at},{default:b(()=>[J(Te)?O("",!0):(d(),k("option",m2,"N/A")),(d(!0),k(te,null,re(h.value.fields.all(),at=>(d(),k("option",{key:"field-"+tt+"-"+at.attribute,disabled:M(at.attribute),value:at.attribute},S(at.label),9,p2))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]))),128))])])])):O("",!0)]),_:1})]),_:2},[h.value?{name:"footer",fn:b(()=>[o("div",f2,[s(ce,{disabled:_.value,variant:"white",text:ee.$t("core::app.cancel"),onClick:W[1]||(W[1]=Te=>U(h.value.id))},null,8,["disabled","text"]),s(ce,{loading:_.value,disabled:_.value,text:_.value?ee.$t("core::app.please_wait"):ee.$t("core::import.import"),onClick:pe},null,8,["loading","disabled","text"])])]),key:"0"}:void 0]),1024),s(Ge,{class:"mt-5",overlay:y.value,"header-class":"relative overflow-hidden",header:ee.$t("core::import.history"),"no-body":""},{default:b(()=>[w.value?(d(),R(Ve,{key:0,class:"-mt-px"},{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",v2,null,512),[[$e,"core::import.date"]]),D(o("th",b2,null,512),[[$e,"core::import.file_name"]]),D(o("th",h2,null,512),[[$e,"core::import.user"]]),D(o("th",_2,null,512),[[$e,"core::import.total_imported"]]),D(o("th",g2,null,512),[[$e,"core::import.total_duplicates"]]),D(o("th",y2,null,512),[[$e,"core::import.total_skipped"]]),D(o("th",x2,null,512),[[$e,"core::import.progress"]]),D(o("th",I2,null,512),[[$e,"core::import.status"]]),k2])]),o("tbody",null,[(d(!0),k(te,null,re(C.value,Te=>(d(),k(te,{key:Te.id},[o("tr",null,[o("td",$2,S(l(i)(Te.created_at)),1),o("td",w2,S(Te.file_name),1),o("td",C2,S(Te.user.name),1),o("td",null,[o("div",S2,[o("span",null,S(Te.imported),1),Te.revertable&&Te.authorizations.revert&&!I.value[Te.id]?D((d(),k("a",{key:0,href:"#",class:"text-xs text-danger-500 hover:text-danger-700",onClick:ie(tt=>j(Te),["prevent"])},null,8,R2)),[[$e,"core::import.revert"]]):O("",!0),I.value[Te.id]?(d(),R(fe,{key:1,class:"h-4 w-4 text-current"})):O("",!0)])]),o("td",F2,S(Te.duplicates),1),o("td",V2,[Q(S(Te.skipped)+" ",1),Te.skip_file_filename&&Te.skipped>0&&(Te.authorizations.downloadSkipFile||Te.authorizations.uploadFixedSkipFile)?(d(),k("span",T2,[D(o("a",{href:"#",class:"link text-xs",onClick:ie(tt=>f.value===Te.id?f.value=null:f.value=Te.id,["prevent"])},null,8,D2),[[$e,"core::import.why_skipped"]])])):O("",!0)]),o("td",q2,[o("div",E2,[o("div",{class:"h-4 rounded-full bg-success-500",style:st({width:Te.progress+"%"})},null,4),o("span",A2,S(Te.progress)+"% ",1)])]),o("td",B2,[D((d(),k("span",N2,[Te.status==="mapping"?(d(),R(Ce,{key:0,icon:"Bars3CenterLeft",class:"h-5 w-5 animate-pulse text-neutral-500 dark:text-neutral-400"})):Te.status==="finished"?(d(),R(Ce,{key:1,icon:"CheckCircle",class:"h-5 w-5 text-success-500 dark:text-success-400"})):Te.status==="in-progress"?(d(),R(Ce,{key:2,icon:"DotsHorizontal",class:"h-5 w-5 animate-bounce text-neutral-500 dark:text-neutral-400"})):O("",!0)])),[[et,Te.status]])]),o("td",null,[o("div",O2,[Te.status==="mapping"&&(!h.value||h.value&&h.value.id!=Te.id)?D((d(),k("a",{key:0,href:"#",class:"link",onClick:ie(tt=>H(Te.id),["prevent"])},null,8,z2)),[[$e,"core::app.continue"]]):O("",!0),!F.value&&!I.value[Te.id]&&Te.authorizations.delete?(d(),R(be,{key:1,icon:"Trash",onClick:tt=>U(Te.id,!0)},null,8,["onClick"])):O("",!0)])])]),Te.skip_file_filename&&f.value===Te.id&&(Te.authorizations.downloadSkipFile||Te.authorizations.uploadFixedSkipFile)?(d(),k("tr",M2,[o("td",U2,[o("h3",P2,[Q(S(ee.$t("core::import.skip_file"))+" ",1),o("span",j2,S(ee.$t("core::import.total_rows_skipped",{count:Te.skipped})),1)]),D(o("p",L2,null,512),[[$e,"core::import.skip_file_generation_info"]]),D(o("p",H2,null,512),[[$e,"core::import.skip_file_fix_and_continue"]]),o("div",G2,[Te.authorizations.downloadSkipFile?D((d(),k("a",{key:0,href:"#",class:"link mr-4 text-sm",onClick:ie(tt=>B(Te.id),["prevent"])},null,8,K2)),[[$e,"core::import.download_skip_file"]]):O("",!0),Te.authorizations.uploadFixedSkipFile?(d(),R(Hn,{key:1,"action-url":A(Te),extensions:"csv",name:"skip_file","input-id":"skip_file",multiple:!1,"show-output":!1,"select-file-text":ee.$t("core::import.upload_fixed_skip_file"),"upload-text":ee.$t("core::import.start"),onFileUploaded:W[2]||(W[2]=tt=>G(tt))},null,8,["action-url","select-file-text","upload-text"])):O("",!0)])]),Y2])):O("",!0)],64))),128))])]),_:1})):D((d(),R(ye,{key:1,class:"text-center"},{default:b(()=>[s(Ce,{icon:"EmojiSad",class:"mx-auto h-12 w-12 text-neutral-400"}),D(o("h3",W2,null,512),[[$e,"core::import.no_history"]])]),_:1},512)),[[Y,!y.value]])]),_:1},8,["overlay","header"])],64)}}},Q2={__name:"ImportResource",setup(e){return(t,n)=>{const a=v("ILayout");return d(),R(a,null,{default:b(()=>[s(l($s),{"resource-name":t.$route.params.resourceName},null,8,["resource-name"])]),_:1})}}};function Bt(){const e=Pe();function t(a){Innoclapps.$emit("reload-resource-table",l(a))}function n(a,r=!0){e.commit("table/SET_CUSTOMIZE_VISIBILTY",{id:l(a),value:r})}return{reloadTable:t,customizeTable:n}}function ws(e,t,n){const a=dt(null),r=q(!1);let i=null;Ho(()=>{i=l(t.resourceName)});function u(){return`${i}/actions/${a.value.uriKey}/run`}function c(){if(a.value){if(!a.value.withoutConfirmation)return p();r.value=!0,Innoclapps.request({method:"post",data:{ids:e.value,...l(t.requestParams)},url:u()}).then(({data:f})=>m(f)).finally(()=>r.value=!1)}}function m(f){if(f.openInNewTab)window.open(f.openInNewTab,"_blank");else{f.error?Innoclapps.error(f.error):f.success?Innoclapps.success(f.success):f.info?Innoclapps.info(f.info):f.confetti&&Ml();let h=Object.assign({},a.value,{ids:e.value,response:f,resourceName:i});Innoclapps.$emit("action-executed",h),n(h)}a.value=null}function p(){Innoclapps.dialog().confirm({component:a.value.component,title:a.value.name,message:a.value.message,size:a.value.size,ids:e.value,endpoint:u(),action:a.value,queryString:l(t.requestParams),resourceName:i,fields:a.value.fields?new en(a.value.fields):null}).then(f=>m(f.response)).catch(()=>a.value=null)}return{run:c,action:a,actionIsRunning:r,ids:e}}const Yl={resourceName:{type:String,required:!0},ids:{type:[Number,String,Array],required:!0},actionRequestParams:{type:Object,default:()=>({})},actions:{required:!0,type:Array,default:()=>[]},view:{default:"update",validator:function(e){return["update","index"].indexOf(e)!==-1}}},X2={__name:"ActionSelectorDropdown",props:Yl,emits:["run"],setup(e,{emit:t}){const n=e,a=V(()=>wt(n.ids)),{run:r,action:i}=ws(a,{resourceName:xe(n,"resourceName"),requestParams:xe(n,"actionRequestParams")},u=>t("run",u));return(u,c)=>{const m=v("DropdownSelectInput");return d(),R(m,{modelValue:l(i),"onUpdate:modelValue":c[0]||(c[0]=p=>xt(i)?i.value=p:null),items:u.actions,placement:"bottom-end",label:u.$t("core::actions.actions"),"label-key":"name","value-key":"uriKey",onChange:l(r)},null,8,["modelValue","items","label","onChange"])}}},Z2={__name:"ActionSelectorSelect",props:{...Yl,runWhenSelected:{type:Boolean,default:!0}},emits:["run","selected"],setup(e,{expose:t,emit:n}){const a=e,r=V(()=>wt(a.ids)),{run:i,action:u,actionIsRunning:c}=ws(r,{resourceName:xe(a,"resourceName"),requestParams:xe(a,"actionRequestParams")},m=>n("run",m));return t({run:i}),(m,p)=>{const f=v("ICustomSelect");return d(),R(f,{modelValue:l(u),"onUpdate:modelValue":p[0]||(p[0]=h=>xt(u)?u.value=h:null),searchable:!1,clearable:!1,loading:l(c),options:m.actions,placeholder:m.$t("core::actions.select"),label:"name","onOption:selected":p[1]||(p[1]=h=>e.runWhenSelected?l(i)():m.$emit("selected",h))},null,8,["modelValue","loading","options","placeholder"])}}},Qn={__name:"ActionSelector",props:{...Yl,type:{required:!0,type:String}},emits:["run"],setup(e,{emit:t}){const n=e,a=V(()=>ao(n.actions,u=>n.view==="update"&&u.hideOnUpdate===!0?!0:n.view==="index"&&u.hideOnIndex===!0)),r=V(()=>a.value.length>0);function i(u){t("run",u)}return(u,c)=>r.value?(d(),R(We(e.type==="select"?Z2:X2),{key:0,"action-request-params":u.actionRequestParams,actions:a.value,ids:u.ids,view:u.view,"resource-name":u.resourceName,onRun:i},null,40,["action-request-params","actions","ids","view","resource-name"])):O("",!0)}};function pn(e,t){const n=Pe(),a=l(t||e),r=V({set(g){n.commit("filters/SET_BUILDER_RULES",{identifier:l(e),view:a,rules:g})},get(){return n.getters["filters/getBuilderRules"](l(e),a)||{}}}),i=V(()=>r.value.children&&r.value.children.length>0),u=V({set(g){n.commit("filters/SET_RULES_ARE_VALID",{identifier:l(e),view:a,value:g})},get(){return n.getters["filters/rulesAreValid"](l(e),a)}}),c=V({set(g){n.commit("filters/SET_HAS_RULES_APPLIED",{identifier:l(e),view:a,value:g})},get(){return n.getters["filters/hasRulesApplied"](l(e),a)}}),m=V({set(g){n.commit("filters/SET_RULES_VISIBLE",{identifier:l(e),view:a,visible:g})},get(){return n.getters["filters/rulesAreVisible"](l(e),a)}});function p(){m.value=!m.value}function f(g){return n.getters["filters/findRuleInQueryBuilder"](l(e),a,g)}function h(){n.commit("filters/RESET_BUILDER_RULES",{identifier:l(e),view:a})}return{queryBuilderRules:r,rulesAreVisible:m,hasBuilderRules:i,hasRulesApplied:c,rulesAreValid:u,toggleFiltersRules:p,findRule:f,resetQueryBuilderRules:h}}function Cs(){const{t:e}=ve();return{labels:{operatorLabels:{is:e("core::filters.operators.is"),was:e("core::filters.operators.was"),equal:e("core::filters.operators.equal"),not_equal:e("core::filters.operators.not_equal"),in:e("core::filters.operators.in"),not_in:e("core::filters.operators.not_in"),less:e("core::filters.operators.less"),less_or_equal:e("core::filters.operators.less_or_equal"),greater:e("core::filters.operators.greater"),greater_or_equal:e("core::filters.operators.greater_or_equal"),between:e("core::filters.operators.between"),not_between:e("core::filters.operators.not_between"),begins_with:e("core::filters.operators.begins_with"),not_begins_with:e("core::filters.operators.not_begins_with"),contains:e("core::filters.operators.contains"),not_contains:e("core::filters.operators.not_contains"),ends_with:e("core::filters.operators.ends_with"),not_ends_with:e("core::filters.operators.not_ends_with"),is_empty:e("core::filters.operators.is_empty"),is_not_empty:e("core::filters.operators.is_not_empty"),is_null:e("core::filters.operators.is_null"),is_not_null:e("core::filters.operators.is_not_null")},matchType:e("core::filters.match_type"),matchTypeAll:e("core::filters.match_type_all"),matchTypeAny:e("core::filters.match_type_any"),addRule:e("core::filters.add_condition"),removeRule:'<span aria-hidden="true">&times;</span>',addGroup:e("core::filters.add_group"),removeGroup:'<span aria-hidden="true">&times;</span>'}}}const fn={operand:{required:!0},isNullable:{required:!0,type:Boolean},index:{required:!0,type:Number},query:{type:Object,required:!1},rule:{type:Object,required:!0},labels:{required:!0},operator:{required:!0},isBetween:Boolean,readOnly:Boolean};function In(e,t,n){const a=Pe();ge(()=>l(e).operand,(i,u)=>{u&&r(rl(l(t))?[]:"")}),ge(t,(i,u)=>{const c=rl(i);c&&!Array.isArray(l(e).value)&&r([]),(rl(u)||u=="is"||u=="was"||n)&&!c&&r("")});function r(i){a.commit("filters/UPDATE_QUERY_VALUE",{query:l(e),value:i})}return{updateValue:r}}const J2={class:"mt-1 space-y-1"},eC=Object.assign({inheritAttrs:!1},{__name:"CheckboxRule",props:fn,setup(e){const t=e,{options:n,setOptions:a,getOptions:r}=zn(),i=V({get(){return t.query.value},set(c){u(c)}}),{updateValue:u}=In(xe(t,"query"),xe(t,"operator"),t.isNullable);return t.query.value===null&&u([]),r(t.rule).then(a),(c,m)=>{const p=v("IFormCheckbox");return d(),k("div",J2,[(d(!0),k(te,null,re(l(n),f=>(d(),R(p,{id:c.rule.id+"_"+f[c.rule.valueKey]+"_"+c.index,key:f[c.rule.valueKey],checked:i.value,"onUpdate:checked":m[0]||(m[0]=h=>i.value=h),value:f[c.rule.valueKey],disabled:c.readOnly,name:c.rule.id+"_"+f[c.rule.valueKey],label:f[c.rule.labelKey]},null,8,["id","checked","value","disabled","name","label"]))),128))])}}}),tC={key:0,class:"flex items-center space-x-2"},nC=o("option",{value:""},null,-1),oC=["value"],lC=Object.assign({inheritAttrs:!1},{__name:"DateRule",props:fn,setup(e){const t=e,{updateValue:n}=In(xe(t,"query"),xe(t,"operator"),t.isNullable),a=V(()=>t.query.operator==="is"),r=V(()=>_t(t.rule.operatorsOptions.is,(m,p)=>({value:p,text:m}))),i=V(()=>_t(t.rule.operatorsOptions.was,(m,p)=>({value:p,text:m}))),u=V(()=>a.value?r.value:i.value),c=V(()=>t.query.operator==="was");return(m,p)=>{const f=v("DatePicker"),h=v("Icon"),g=v("IFormSelect");return!a.value&&!c.value?(d(),k("div",tC,[m.isBetween?O("",!0):(d(),R(f,{key:0,size:"sm",class:"flex-1",placeholder:m.$t("core::filters.placeholders.select_date"),"model-value":m.query.value,disabled:m.readOnly,onInput:p[0]||(p[0]=y=>l(n)(y))},null,8,["placeholder","model-value","disabled"])),m.isBetween?(d(),R(f,{key:1,placeholder:m.$t("core::filters.placeholders.select_date"),"model-value":m.query.value[0],size:"sm",disabled:m.readOnly,onInput:p[1]||(p[1]=y=>l(n)([y,m.query.value[1]]))},null,8,["placeholder","model-value","disabled"])):O("",!0),m.isBetween?(d(),R(h,{key:2,icon:"ArrowRight",class:"h-4 w-4 shrink-0 text-neutral-600"})):O("",!0),m.isBetween?(d(),R(f,{key:3,size:"sm",placeholder:m.$t("core::filters.placeholders.select_date"),"min-date":m.query.value[0]||null,disabled:m.readOnly||!m.query.value[0],"model-value":m.query.value[1],onInput:p[2]||(p[2]=y=>l(n)([m.query.value[0],y]))},null,8,["placeholder","min-date","disabled","model-value"])):O("",!0)])):(d(),R(g,{key:1,size:"sm","model-value":m.query.value,disabled:m.readOnly,onInput:p[3]||(p[3]=y=>l(n)(y))},{default:b(()=>[nC,(d(!0),k(te,null,re(u.value,y=>(d(),k("option",{key:y.value,value:y.value},S(y.text),9,oC))),128))]),_:1},8,["model-value","disabled"]))}}}),aC=Object.assign({inheritAttrs:!1},{__name:"MultiSelectRule",props:fn,setup(e){const t=e,{t:n}=ve(),{options:a,setOptions:r,getOptions:i}=zn(),u=q(null),c=V(()=>n("core::filters.placeholders.choose_with_multiple",{label:t.operand?t.operand.label:t.rule.label})),{updateValue:m}=In(xe(t,"query"),xe(t,"operator"),t.isNullable);ge(u,_=>{p(_)},{deep:!0});function p(_){Be(_)?y([]):y(_t(_,t.rule.valueKey))}function f(_){r(_),Be(t.query.value)||h()}function h(){Be(t.query.value)?y([]):y(t.query.value)}function g(_){if(Be(_)){u.value=[];return}_=a.value.filter(I=>_.indexOf(I[t.rule.valueKey])>-1)||[],At(_,u.value)||(u.value=_)}function y(_){m(_),At(_,u.value)||g(_)}return i(t.rule).then(f),(_,I)=>{const F=v("ICustomSelect");return d(),R(F,{modelValue:u.value,"onUpdate:modelValue":I[0]||(I[0]=$=>u.value=$),multiple:!0,disabled:_.readOnly,size:"sm","input-id":"rule-"+_.rule.id+"-"+_.index,placeholder:c.value,label:_.rule.labelKey,options:l(a)},null,8,["modelValue","disabled","input-id","placeholder","label","options"])}}}),sC={};function rC(e,t){return null}const iC=ct(sC,[["render",rC]]),uC={key:1,class:"flex items-center space-x-2"},dC=Object.assign({inheritAttrs:!1},{__name:"NumberRule",props:fn,setup(e){const t=e,{t:n}=ve(),{updateValue:a}=In(xe(t,"query"),xe(t,"operator"),t.isNullable),r=V(()=>n("core::filters.placeholders.enter",{label:t.operand?t.operand.label:t.rule.label}));return(i,u)=>{const c=v("IFormInput"),m=v("Icon");return i.isBetween?(d(),k("div",uC,[s(c,{type:"number",size:"sm",placeholder:r.value,disabled:i.readOnly,"model-value":i.query.value[0],onInput:u[1]||(u[1]=p=>l(a)([p,i.query.value[1]]))},null,8,["placeholder","disabled","model-value"]),s(m,{icon:"ArrowRight",class:"h-4 w-4 shrink-0 text-neutral-600"}),s(c,{type:"number",size:"sm",placeholder:r.value,disabled:i.readOnly,"model-value":i.query.value[1],onInput:u[2]||(u[2]=p=>l(a)([i.query.value[0],p]))},null,8,["placeholder","disabled","model-value"])])):(d(),R(c,{key:0,size:"sm",type:"number",placeholder:r.value,disabled:i.readOnly,"model-value":i.query.value,onInput:u[0]||(u[0]=p=>l(a)(p))},null,8,["placeholder","disabled","model-value"]))}}}),cC={key:1,class:"flex items-center space-x-2"},mC=Object.assign({inheritAttrs:!1},{__name:"NumericRule",props:fn,setup(e){const t=e,{t:n}=ve(),{updateValue:a}=In(xe(t,"query"),xe(t,"operator"),t.isNullable),r=V(()=>n("core::filters.placeholders.enter",{label:t.operand?t.operand.label:t.rule.label}));return t.query.value===null&&a(0),(i,u)=>{const c=v("IFormNumericInput"),m=v("Icon");return i.isBetween?(d(),k("div",cC,[s(c,{size:"sm",placeholder:r.value,"model-value":i.query.value[0],"read-only":i.readOnly,onInput:u[1]||(u[1]=p=>l(a)([p,i.query.value[1]]))},null,8,["placeholder","model-value","read-only"]),s(m,{icon:"ArrowRight",class:"h-4 w-4 shrink-0 text-neutral-600"}),s(c,{size:"sm",placeholder:r.value,"model-value":i.query.value[1],"read-only":i.readOnly,onInput:u[2]||(u[2]=p=>l(a)([i.query.value[0],p]))},null,8,["placeholder","model-value","read-only"])])):(d(),R(c,{key:0,size:"sm",placeholder:r.value,"model-value":i.query.value,"read-only":i.readOnly,onInput:u[0]||(u[0]=p=>l(a)(p))},null,8,["placeholder","model-value","read-only"]))}}}),pC={class:"mt-1 space-y-1"},fC=Object.assign({inheritAttrs:!1},{__name:"RadioRule",props:fn,setup(e){const t=e,{options:n,setOptions:a,getOptions:r}=zn(),i=V({get(){return t.query.value},set(c){u(c)}}),{updateValue:u}=In(xe(t,"query"),xe(t,"operator"),t.isNullable);return r(t.rule).then(a),(c,m)=>{const p=v("IFormRadio");return d(),k("div",pC,[(d(!0),k(te,null,re(l(n),f=>(d(),R(p,{id:c.rule.id+"_"+f[c.rule.valueKey]+"_"+c.index,key:f[c.rule.valueKey],modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=h=>i.value=h),value:f[c.rule.valueKey],disabled:c.readOnly,name:c.rule.id+"_"+f[c.rule.valueKey],label:f[c.rule.labelKey]},null,8,["id","modelValue","value","disabled","name","label"]))),128))])}}}),vC=Object.assign({inheritAttrs:!1},{__name:"SelectRule",props:fn,setup(e){const t=e,{t:n}=ve(),{options:a,setOptions:r,getOptions:i}=zn(),u=q(null),c=V(()=>t.rule.type==="multi-select"),m=V(()=>n("core::filters.placeholders.choose",{label:t.operand?t.operand.label:t.rule.label})),{updateValue:p}=In(xe(t,"query"),xe(t,"operator"),t.isNullable);ge(u,I=>{f(I)},{deep:!0});function f(I){let F=null;I&&!Be(I[t.rule.valueKey])&&(F=I[t.rule.valueKey]),_(F)}function h(I){r(I),Be(t.query.value)?_(a.value[0][t.rule.valueKey]):g()}function g(){let I=Ee(a.value,[t.rule.valueKey,t.query.value]);_(I?I[t.rule.valueKey]:null)}function y(I){if(Be(I)){u.value=null;return}u.value=Ee(a.value,[t.rule.valueKey,I])||null}function _(I){p(I),At(I,u.value)||y(I)}return i(t.rule).then(h),(I,F)=>{const $=v("ICustomSelect");return d(),R($,{modelValue:u.value,"onUpdate:modelValue":F[0]||(F[0]=C=>u.value=C),multiple:c.value,disabled:I.readOnly,size:"sm","input-id":"rule-"+I.rule.id+"-"+I.index,placeholder:m.value,label:I.rule.labelKey,options:l(a)},null,8,["modelValue","multiple","disabled","input-id","placeholder","label","options"])}}}),bC=Object.assign({inheritAttrs:!1},{__name:"StaticRule",props:fn,setup(e){return(t,n)=>{const a=v("IBadge");return d(),R(a,{variant:"info",text:t.$t("core::filters.static_rule_indicator")},null,8,["text"])}}}),hC=Object.assign({inheritAttrs:!1},{__name:"TextRule",props:fn,setup(e){const t=e,{t:n}=ve(),{updateValue:a}=In(xe(t,"query"),xe(t,"operator"),t.isNullable),r=V(()=>n("core::filters.placeholders.enter",{label:t.operand?t.operand.label:t.rule.label}));return(i,u)=>{const c=v("IFormInput");return d(),R(c,{type:"text",placeholder:r.value,disabled:i.readOnly,size:"sm","model-value":i.query.value,onInput:u[0]||(u[0]=m=>l(a)(m))},null,8,["placeholder","disabled","model-value"])}}}),_C={class:"relative justify-between last:!mb-0 odd:my-4 odd:border-t odd:border-neutral-200 odd:pt-4 dark:odd:border-neutral-600 sm:flex sm:items-center"},gC={class:"mb-1 flex w-full flex-col justify-start sm:mb-0 sm:mr-3 sm:w-auto sm:flex-row sm:items-center sm:space-x-3"},yC={class:"mb-1 flex items-center sm:mb-0"},xC={key:0,class:"-ml-1 mr-1"},IC=["textContent"],kC=["value","selected"],$C={class:"grow"},wC=Object.assign({name:"Rule",inheritAttrs:!1},{__name:"QueryBuilderRule",props:["query","index","rule","labels","readOnly"],emits:["child-deletion-requested"],setup(e,{emit:t}){const n=e,a={"numeric-rule":mC,"checkbox-rule":eC,"date-rule":lC,"number-rule":dC,"radio-rule":fC,"select-rule":vC,"multi-select-rule":aC,"text-rule":hC,"static-rule":bC,"nullable-rule":iC},r=Pe(),i=q(null),u=V(()=>Ee(n.rule.operands,["value",n.query.operand])),c=V(()=>u.value&&u.value.rule),m=V(()=>c.value?u.value.rule.operators:n.rule.operators),p=V(()=>m.value.length===1),f=V(()=>n.rule.isStatic||Object.hasOwn(n.rule,"hideOperands")&&n.rule.hideOperands?!1:n.rule.operands&&n.rule.operands.length>0),h=V(()=>Kl(n.query.operator)),g=V(()=>ys(n.query.operator));function y(I){r.commit("filters/UPDATE_QUERY_OPERAND",{query:n.query,value:I[I.valueKey]}),I.rule.operators&&I.rule.operators.length>0&&r.commit("filters/UPDATE_QUERY_OPERATOR",{query:n.query,value:I.rule.operators[0]})}function _(){t("child-deletion-requested",n.index)}return De(()=>{i.value=u.value&&nt(u.value)}),(I,F)=>{const $=v("Icon"),C=v("ICustomSelect"),w=v("IFormSelect"),x=v("IButtonIcon"),A=ae("i-tooltip");return d(),k("div",_C,[o("div",gC,[o("div",yC,[e.rule.helpText?D((d(),k("div",xC,[s($,{icon:"QuestionMarkCircle",class:"h-4 w-4 text-neutral-500 hover:text-neutral-700 dark:text-white dark:hover:text-neutral-300"})])),[[A,e.rule.helpText,void 0,{bottom:!0,light:!0}]]):O("",!0),o("label",{class:"max-w-xs truncate whitespace-nowrap text-sm font-medium text-neutral-800 dark:text-neutral-200",textContent:S(e.rule.label)},null,8,IC)]),f.value?(d(),R(C,{key:0,modelValue:i.value,"onUpdate:modelValue":F[0]||(F[0]=N=>i.value=N),class:"mb-1 w-52 sm:mb-0",size:"sm",disabled:e.readOnly,clearable:!1,"option-label-provider":N=>N[N.labelKey],options:e.rule.operands,"onOption:selected":y},null,8,["modelValue","disabled","option-label-provider","options"])):O("",!0),e.rule.isStatic?O("",!0):D((d(),R(w,{key:1,size:"sm",value:e.query.operator,disabled:e.readOnly,class:"w-auto bg-none",onInput:F[1]||(F[1]=N=>I.$store.commit("filters/UPDATE_QUERY_OPERATOR",{query:e.query,value:N}))},{default:b(()=>[(d(!0),k(te,null,re(m.value,N=>(d(),k("option",{key:N,value:N,selected:N==e.query.operator},S(e.labels.operatorLabels[N]?e.labels.operatorLabels[N]:N),9,kC))),128))]),_:1},8,["value","disabled"])),[[Y,!p.value]])]),D(o("div",$C,[(d(),R(We(a[u.value?u.value.rule.component:e.rule.component]),{query:e.query,rule:u.value?u.value.rule:e.rule,index:e.index,labels:e.labels,operand:u.value,"read-only":e.readOnly,operator:e.query.operator,"is-nullable":g.value,"is-between":h.value},null,8,["query","rule","index","labels","operand","read-only","operator","is-nullable","is-between"]))],512),[[Y,!g.value]]),e.readOnly?O("",!0):(d(),R(x,{key:0,icon:"X",class:"absolute right-0 top-1 sm:relative sm:right-auto sm:top-auto sm:ml-3","icon-class":"h-4 w-4 sm:h-5 sm:w-5",onClick:_}))])}}}),CC=["value"],SC={value:"and"},RC={value:"or"},FC={class:"w-56"},VC=["textContent"],TC=Object.assign({name:"QueryBuilderGroup"},{__name:"QueryBuilderGroup",props:["index","query","rules","maxDepth","depth","labels","readOnly","previousMatchType"],emits:["child-deletion-requested"],setup(e,{emit:t}){const n=e,a={rule:wC,group:"QueryBuilderGroup"},r=Pe(),i=q(""),u=V(()=>({"border-neutral-200 dark:border-neutral-500":n.depth===1,"border-info-400 dark:border-info-500":n.depth===2,"border-primary-400 dark:primary-info-500":n.depth>2})),c=V(()=>({"bg-neutral-50 dark:bg-neutral-800":n.depth===1,"bg-neutral-100 dark:bg-neutral-900":n.depth===2,"bg-neutral-200 dark:bg-neutral-800":n.depth>2})),m=V({get(){return n.query.children},set(F){r.commit("filters/SET_QUERY_CHILDREN",{query:n.query,children:F})}}),p=V(()=>m.value.length),f=V(()=>n.depth+1);function h(F){return Ee(n.rules,["id",F])}function g(){let F=null,$=i.value.operators[0];i.value.operands&&i.value.operands.length>0&&(F=i.value.operands[0][i.value.operands[0].valueKey],i.value.operands[0].rule&&($=i.value.operands[0].rule.operators[0])),r.commit("filters/ADD_QUERY_CHILD",{query:n.query,child:{type:"rule",query:{type:i.value.type,rule:i.value.id,operator:$,operand:F,value:null}}}),i.value=""}function y(){n.depth<n.maxDepth&&r.commit("filters/ADD_QUERY_GROUP",n.query)}function _(){t("child-deletion-requested",n.index)}function I(F){r.commit("filters/REMOVE_QUERY_CHILD",{query:n.query,index:F})}return(F,$)=>{const C=v("i18n-t"),w=v("IButtonIcon"),x=v("ICustomSelect");return d(),k("div",{class:X(["border-l-4 px-4 py-3",u.value,c.value,{"mb-4 mt-5":e.depth>1}])},[o("div",{class:X(["flex items-center justify-between sm:flex-nowrap",{"mb-4":e.readOnly}])},[s(C,{scope:"global",class:"flex w-full flex-wrap items-start text-sm font-medium text-neutral-800 dark:text-neutral-100 sm:items-center",keypath:e.depth<=1?"core::filters.show_matching_records_conditions":"core::filters.or_match_any_conditions",tag:"div"},vt({match_type:b(()=>[o("select",{class:X(["border-1 mx-1 rounded-md border-neutral-300 bg-none px-2 py-0 text-sm focus:shadow-none focus:ring-primary-500 dark:border-neutral-500 dark:bg-neutral-500 dark:text-white",{"pointer-events-none":e.readOnly}]),value:e.query.condition,onInput:$[0]||($[0]=A=>F.$store.commit("filters/UPDATE_QUERY_CONDITION",{query:e.query,value:A.target.value}))},[o("option",SC,S(e.labels.matchTypeAll),1),o("option",RC,S(e.labels.matchTypeAny),1)],42,CC)]),_:2},[e.depth>1?{name:"condition",fn:b(()=>[Q(S(F.$t("core::filters.conditions."+e.previousMatchType)),1)]),key:"0"}:void 0]),1032,["keypath"]),e.depth>1?(d(),R(w,{key:0,icon:"X",class:"mt-px",onClick:ie(_,["prevent","stop"])},null,8,["onClick"])):O("",!0)],2),o("div",null,[o("div",{class:X(["mt-3 flex w-full items-center",{"mb-7":p.value>0,hidden:e.readOnly}])},[o("div",FC,[s(x,{modelValue:i.value,"onUpdate:modelValue":$[1]||($[1]=A=>i.value=A),size:"sm",placeholder:e.labels.addRule,clearable:!1,options:e.rules,"onOption:selected":g},null,8,["modelValue","placeholder","options"])]),e.depth<e.maxDepth?D((d(),k("a",{key:0,class:"link ml-3 shrink-0 text-sm",href:"#",onClick:y,textContent:S(e.labels.addGroup)},null,8,VC)),[[Y,p.value>0]]):O("",!0)],2),(d(!0),k(te,null,re(m.value,(A,N)=>(d(),R(We(a[A.type]),{key:A.query.rule+"-"+N,query:A.query,"max-depth":e.maxDepth,"read-only":e.readOnly,"previous-match-type":e.query.condition,rule:h(A.query.rule),rules:e.rules,index:N,depth:f.value,labels:e.labels,onChildDeletionRequested:I},null,40,["query","max-depth","read-only","previous-match-type","rule","rules","index","depth","labels"]))),128))])],2)}}}),DC={__name:"QueryBuilder",props:{rules:Array,identifier:{type:String,required:!0},view:{type:String,required:!0},readOnly:Boolean,labels:Object,maxDepth:{type:Number,default:3,validator:function(e){return e>=1}}},setup(e){const t=e,{labels:n}=Cs(),a=["equal","not_equal","less","less_or_equal","greater","greater_or_equal","between","not_between","is_null","is_not_null"],r={text:{operators:["equal","not_equal","begins_with","not_begins_with","contains","not_contains","ends_with","not_ends_with","is_empty","is_not_empty","is_null","is_not_null"],inputType:"text",id:"text-field"},number:{operators:a,inputType:"number",id:"number-field"},date:{operators:a.concat(["is"]),inputType:"date",id:"date-field"},numeric:{operators:a,inputType:"numeric",id:"numeric-field"},radio:{operators:["equal"],options:[],inputType:"radio",id:"radio-field"},checkbox:{operators:["in"],options:[],inputType:"checkbox",id:"checkbox-field"},select:{operators:["equal","not_equal"],options:[],inputType:"select",id:"select-field"},"multi-select":{operators:["in","not_in"],options:[],inputType:"select",id:"multi-select-field"}},i=Pe(),u=q(1),c=V(()=>i.getters["filters/getBuilderRules"](t.identifier,t.view)),m=V(()=>Object.assign({},n,t.labels)),p=V(()=>{let f=[];return t.rules&&t.rules.forEach(h=>{typeof r[h.type]<"u"?f.push(Object.assign({},r[h.type],h)):f.push(h)}),f});return Object.keys(c.value).length===0&&i.commit("filters/RESET_BUILDER_RULES",{identifier:t.identifier,view:t.view}),(f,h)=>(d(),k("div",null,[s(TC,{index:0,query:c.value,rules:p.value,"max-depth":e.maxDepth,"read-only":e.readOnly,depth:u.value,labels:m.value},null,8,["query","rules","max-depth","read-only","depth","labels"]),de(f.$slots,"default")]))}};function ho(e,t){const n=Pe(),{currentUser:a}=Le(),r=l(t||e),i=V({set(g){g===null?n.dispatch("filters/clearActive",{identifier:l(e),view:r}):n.commit("filters/SET_ACTIVE",{identifier:l(e),view:r,id:g})},get(){return n.getters["filters/getActive"](l(e),r)}}),u=V(()=>n.getters["filters/hasRules"](l(e))),c=V({set(g){n.commit("filters/SET",{identifier:l(e),filters:g})},get(){return n.getters["filters/getAll"](l(e))}}),m=V({set(g){n.commit("filters/SET_RULES",{identifier:l(e),rules:g})},get(){return n.state.filters.rules[l(e)]}}),p=V(()=>f(a.value.id));function f(g){return n.getters["filters/getDefault"](l(e),r,g)}function h(g){return n.getters["filters/getById"](l(e),g)}return{filters:c,rules:m,activeFilter:i,hasRules:u,userDefaultFilter:p,findFilter:h}}const qC={class:"mb-3 flex items-center justify-end space-x-2"},EC=["onClick"],AC=["onClick"],BC=["onClick"],NC={key:2},OC={class:"mt-5"},zC={class:"grid grid-cols-2 gap-4"},MC={class:"flex flex-col"},UC={class:"text-neutral-900 dark:text-white"},PC={class:"text-neutral-500 dark:text-neutral-300"},jC={class:"flex flex-col"},LC={class:"text-neutral-900 dark:text-white"},HC={class:"text-neutral-500 dark:text-neutral-300"},GC={class:"flex space-x-4"},Ss=Object.assign({inheritAttrs:!1},{__name:"FilterBuilder",props:{view:{required:!0,type:String},identifier:{required:!0,type:String},activeFilterId:Number,initialApply:{default:!0,type:Boolean}},emits:["apply"],setup(e,{emit:t}){const n=e,a=Pe(),{currentUser:r}=Le(),{gate:i}=On(),{form:u}=Ae(),c=q(!1),m=q(!1),p=q(!1),{queryBuilderRules:f,rulesAreValid:h,hasRulesApplied:g,findRule:y,rulesAreVisible:_,resetQueryBuilderRules:I}=pn(n.identifier,n.view),{rules:F,activeFilter:$,userDefaultFilter:C,findFilter:w}=ho(n.identifier,n.view),x=V(()=>A.value.map(be=>be.label).join(", ")),A=V(()=>F.value.filter(be=>be.has_authorization)),N=V(()=>A.value.some(be=>y(be.id))),T=V(()=>$.value&&$.value.is_system_default),E=V(()=>$.value&&C.value&&$.value.id==C.value.id),B=V(()=>!(!U.value||j.value===0)),z=V(()=>$.value&&$.value.is_readonly||H.value),M=V(()=>Ge(f.value)),j=V(()=>M.value.length),U=V(()=>{if(!P.value)return!0;let be=0;return M.value.forEach(Ve=>{Be(Ve)||be++}),j.value===be}),P=V(()=>j.value>0),H=V(()=>!$.value||$.value.is_system_default?!1:$.value.is_shared&&$.value.user_id!=r.value.id),L=V(()=>i.allows("update",$.value)),Z=V(()=>i.allows("delete",$.value)),J=(...be)=>a.commit("filters/PUSH",...be),K=(...be)=>a.commit("filters/UPDATE",...be),G=(...be)=>a.commit("filters/UNMARK_AS_DEFAULT",...be);function oe(){u.clear().set({name:null,rules:[],is_shared:!1}),m.value=!1,c.value=!1,p.value=!1}function pe(){oe(),$.value&&L.value&&ne()}async function ue(){u.fill("identifier",n.identifier);let be=await u.post("/filters");return J({filter:be,identifier:n.identifier}),le(be.id),be}async function ee(){const be=await u.put(`/filters/${$.value.id}`);return Ie(be),be}async function W(){if(!m.value){Ce(),_.value=!1;return}u.fill("rules",f.value),await(c.value?ee():ue()),await Fe(),c.value?E.value&&!p.value?Se():!E.value&&p.value&&fe():p.value&&fe(),Ce(),_.value=!1}function ne(){u.is_shared=$.value.is_shared,u.name=$.value.name,p.value=E.value,c.value=!0,m.value=!0}async function ce(){await Innoclapps.dialog().confirm(),a.dispatch("filters/destroy",{identifier:n.identifier,view:n.view,id:$.value.id}).then(()=>{_.value=!1,ye()})}function fe(){Innoclapps.request().put(`filters/${$.value.id}/${n.view}/default`).then(({data:be})=>{C.value&&C.value.id!=be.id&&G({id:C.value.id,identifier:n.identifier,view:n.view,userId:r.value.id}),Ie(be)})}function Se(){Innoclapps.request().delete(`/filters/${$.value.id}/${n.view}/default`).then(({data:be})=>{Ie(be)})}function Ie(be){K({identifier:n.identifier,filter:be})}function Ce(){t("apply",f.value)}function le(be,Ve=!0){let $e=w(be);f.value=nt($e.rules),$.value=$e.id,Ve&&Ce()}function ye(){I(),Ce()}function Ge(be){let Ve=[];return Sn(be.children,$e=>{if($e.query.children)Ve=Ve.concat(Ge($e.query));else{let et=Ee(F.value,["id",$e.query.rule]);et&&et.isStatic||ys($e.query.operator)?Ve.push(!0):Kl($e.query.operator)?$e.query.value&&!Be($e.query.value[0])&&!Be($e.query.value[1])?Ve.push(nt($e.query.value)):Ve.push(null):Ve.push(nt($e.query.value))}}),Ve}return ge(U,be=>{h.value=be},{immediate:!0}),ge(P,be=>{g.value=be},{immediate:!0}),ge(N,(be,Ve)=>{!Ve&&be&&(u.is_shared=!1)}),rt(`${n.identifier}-${n.view}-filter-selected`,le),n.activeFilterId?le(n.activeFilterId,n.initialApply):$.value?(h.value||(f.value=$.value.rules),n.initialApply&&Ce()):C.value?le(C.value.id,n.initialApply):n.initialApply&&Ce(),(be,Ve)=>{const $e=v("IAlert"),et=v("IButtonMinimal"),Te=v("IFormInput"),tt=v("IFormError"),at=v("IFormGroup"),lt=v("IDropdownItem"),_e=v("IDropdown"),me=v("IFormCheckbox"),we=v("IFormToggle"),Ue=v("IButton"),Oe=v("IModal"),se=ae("t"),ke=ae("i-tooltip");return d(),R(Oe,{visible:l(_),size:"lg","static-backdrop":"",title:l($)?be.$t("core::filters.edit_filter"):be.$t("core::filters.create"),"ok-title":m.value?be.$t("core::filters.save_and_apply"):be.$t("core::filters.apply"),"ok-disabled":!B.value||l(u).busy,"cancel-title":be.$t("core::app.hide"),"hide-footer":z.value,onOk:W,onShown:pe,onHidden:Ve[5]||(Ve[5]=He=>_.value=!1)},{"modal-cancel":b(({cancel:He,title:yt})=>[o("div",GC,[D(s(we,{modelValue:m.value,"onUpdate:modelValue":Ve[4]||(Ve[4]=Ke=>m.value=Ke),"label-class":"font-semibold",label:be.$t("core::filters.save_as_new")},null,8,["modelValue","label"]),[[Y,!c.value&&!l($)&&P.value]]),s(Ue,{variant:"white",class:"hidden sm:inline-flex",disabled:l(u).busy,text:yt,onClick:He},null,8,["disabled","text","onClick"])])]),default:b(()=>[z.value?(d(),R($e,{key:0,class:"mb-3 border border-info-200"},{default:b(()=>[Q(S(be.$t("core::filters.is_readonly")),1)]),_:1})):O("",!0),o("div",qC,[!E.value&&z.value?D((d(),k("a",{key:0,href:"#",class:"rounded-md px-2 py-1.5 text-sm font-medium text-primary-700 hover:bg-primary-50 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 focus:ring-offset-primary-50",onClick:ie(fe,["prevent"])},null,8,EC)),[[se,"core::filters.mark_as_default"]]):O("",!0),E.value&&z.value?D((d(),k("a",{key:1,href:"#",class:"rounded-md px-2 py-1.5 text-sm font-medium text-primary-700 hover:bg-primary-50 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 focus:ring-offset-primary-50",onClick:ie(Se,["prevent"])},null,8,AC)),[[se,"core::filters.unmark_as_default"]]):O("",!0),D(o("a",{class:"rounded-md px-2 py-1.5 text-sm font-medium text-primary-700 hover:bg-primary-50 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:ring-offset-2 focus:ring-offset-primary-50",href:"#",onClick:ie(ye,["prevent"])},null,8,BC),[[Y,!z.value&&P.value],[se,"core::filters.clear_rules"]]),l($)&&Z.value?D((d(),k("span",NC,[s(et,{variant:"danger",disabled:T.value||z.value,text:be.$t("core::app.delete"),onClick:ce},null,8,["disabled","text"])])),[[ke,T.value?be.$t("core::filters.system_default_delete_info"):null]]):O("",!0)]),s(l(DC),Re(be.$attrs,{ref:"queryBuilder",rules:l(F),"read-only":z.value,identifier:e.identifier,view:e.view}),null,16,["rules","read-only","identifier","view"]),D(o("div",OC,[o("div",zC,[o("div",null,[s(at,{label:be.$t("core::filters.name"),"label-for":"filter_name",required:""},{default:b(()=>[s(Te,{id:"filter_name",modelValue:l(u).name,"onUpdate:modelValue":Ve[0]||(Ve[0]=He=>l(u).name=He),size:"sm",placeholder:be.$t("core::filters.name"),name:"name",type:"text"},null,8,["modelValue","placeholder"]),s(tt,{textContent:S(l(u).getError("name"))},null,8,["textContent"])]),_:1},8,["label"])]),o("div",null,[s(at,{required:"",label:be.$t("core::filters.share.with")},{default:b(()=>[s(_e,{"adaptive-width":"",size:"sm",text:l(u).is_shared?be.$t("core::filters.share.everyone"):be.$t("core::filters.share.private")},{default:b(()=>[s(lt,{onClick:Ve[1]||(Ve[1]=He=>l(u).is_shared=!1)},{default:b(()=>[o("div",MC,[D(o("p",UC,null,512),[[se,"core::filters.share.private"]]),D(o("p",PC,null,512),[[se,"core::filters.share.private_info"]])])]),_:1}),N.value?O("",!0):(d(),R(lt,{key:0,onClick:Ve[2]||(Ve[2]=He=>l(u).is_shared=!0)},{default:b(()=>[o("div",jC,[D(o("p",LC,null,512),[[se,"core::filters.share.everyone"]]),D(o("p",HC,null,512),[[se,"core::filters.share.everyone_info"]])])]),_:1}))]),_:1},8,["text"]),s(tt,{textContent:S(l(u).getError("is_shared"))},null,8,["textContent"])]),_:1},8,["label"])])]),N.value?(d(),R($e,{key:0,show:"",class:"mb-3"},{default:b(()=>[Q(S(be.$t("core::filters.cannot_be_shared",{rules:x.value})),1)]),_:1})):O("",!0)],512),[[Y,m.value&&!z.value]]),D(s(at,null,{default:b(()=>[s(me,{checked:p.value,"onUpdate:checked":Ve[3]||(Ve[3]=He=>p.value=He),label:be.$t("core::filters.is_default")},null,8,["checked","label"])]),_:1},512),[[Y,m.value&&!z.value]])]),_:1},8,["visible","title","ok-title","ok-disabled","cancel-title","hide-footer"])}}}),KC={__name:"FilterDropdownItem",props:{identifier:{required:!0,type:String},view:{required:!0,type:String},filterId:{type:Number,required:!0},name:{type:String,required:!0}},emits:["click"],setup(e){const t=e,{activeFilter:n,userDefaultFilter:a}=ho(t.identifier,t.view),r=V(()=>n.value&&n.value.id==t.filterId),i=V(()=>a.value?t.filterId==a.value.id:!1);return(u,c)=>{const m=v("IDropdownItem");return d(),R(m,{active:r.value,text:e.name,icon:i.value?"Star":null,"prepend-icon":"",onClick:c[0]||(c[0]=p=>u.$emit("click",e.filterId))},null,8,["active","text","icon"])}}},YC={class:"truncate"},WC={class:"w-[19rem]"},QC={class:"border-b border-neutral-200 px-4 py-3 dark:border-neutral-700"},XC=["onClick"],ZC=["onClick"],JC=["onClick"],e8={class:"mt-1 inline-flex items-center truncate px-4 py-2 text-sm font-medium text-neutral-900 dark:text-neutral-200"},t8={class:"block px-4 py-2 text-sm text-neutral-500 dark:text-neutral-300"},n8={class:"inline-block max-h-80 w-full overflow-auto"},Rs=Object.assign({inheritAttrs:!1},{__name:"FilterDropdown",props:{placement:{default:"bottom-end",type:String},identifier:{required:!0,type:String},view:{required:!0,type:String}},emits:["apply"],setup(e,{emit:t}){const n=e,{queryBuilderRules:a,rulesAreVisible:r,toggleFiltersRules:i}=pn(n.identifier,n.view),{filters:u,activeFilter:c}=ho(n.identifier,n.view),m=q(null),p=q(null),f=V(()=>p.value&&g.value.length===0),h=V(()=>u.value.length>0),g=V(()=>p.value?u.value.filter(C=>C.name.toLowerCase().includes(p.value.toLowerCase())):u.value);function y(){m.value.hide()}function _(){c.value=null,t("apply",a.value)}function I(){i(),y()}function F(){c.value&&_(),r.value=!0,y()}function $(C){Innoclapps.$emit(`${n.identifier}-${n.view}-filter-selected`,C)}return(C,w)=>{const x=v("SearchInput"),A=v("Icon"),N=v("IDropdown"),T=ae("t");return d(),R(N,Re({ref_key:"dropdownRef",ref:m,placement:e.placement,"wrapper-class":"w-full flex-1",class:"min-w-0 max-w-full sm:max-w-xs",icon:"Filter","no-caret":""},C.$attrs),{"toggle-content":b(()=>[o("span",YC,S(l(c)?l(c).name:C.$t("core::filters.filters")),1)]),default:b(()=>[o("div",WC,[o("div",QC,[D(o("a",{href:"#",class:X(["link mr-2 text-sm",{"border-r border-neutral-300 pr-2 dark:border-neutral-700":l(c)}]),onClick:ie(F,["prevent"])},null,10,XC),[[T,"core::filters.new"]]),D(o("a",{href:"#",class:"link border-r border-neutral-300 pr-2 text-sm dark:border-neutral-700",onClick:ie(I,["prevent"])},null,8,ZC),[[Y,l(c)],[T,"core::filters.edit"]]),D(o("a",{href:"#",class:"link pl-2 text-sm",onClick:ie(_,["prevent"])},null,8,JC),[[Y,l(c)],[T,"core::filters.clear_applied"]]),s(x,{modelValue:p.value,"onUpdate:modelValue":w[0]||(w[0]=E=>p.value=E),size:"sm",class:"mt-3",placeholder:C.$t("core::filters.search")},null,8,["modelValue","placeholder"])]),D(o("p",e8,[s(A,{icon:"Bars3",class:"mr-2 h-5 w-5 text-current"}),Q(" "+S(C.$t("core::filters.available")),1)],512),[[Y,h.value&&!f.value]]),D(o("p",t8,null,512),[[Y,!h.value||f.value],[T,"core::filters.not_available"]]),D(o("div",n8,[(d(!0),k(te,null,re(g.value,E=>(d(),R(KC,{key:E.id,identifier:e.identifier,view:e.view,"filter-id":E.id,name:E.name,onClick:$},null,8,["identifier","view","filter-id","name"]))),128))],512),[[Y,h.value&&!f.value]])])]),_:1},16,["placement"])}}}),o8={key:0,class:"rounded-md border border-neutral-300 px-3 py-[0.4rem] text-neutral-700 dark:border-neutral-500 dark:text-neutral-100"},l8={key:1,class:"shrink-0 snap-end rounded-md border border-neutral-300 px-3 py-[0.4rem] text-neutral-700 dark:border-neutral-500 dark:text-neutral-100"},a8={key:0},s8={class:"text-info-500 dark:text-info-400"},r8={class:"font-medium"},i8={key:1},u8={key:2,class:"flex shrink-0 space-x-1"},d8=Object.assign({name:"RuleDisplay"},{__name:"RuleDisplay",props:{rule:{type:Object,required:!0},identifier:{type:String,required:!0},index:{},view:{},condition:{}},setup(e){const t=e,{formatMoney:n,formatNumber:a}=Mt(),{labels:r}=Cs(),i=q(""),u=Pe(),{localizedDate:c}=Ne(),m=V(()=>t.rule.type==="group"),p=V(()=>{const T=_("displayAs"),E=B=>B.replace(":value:",i.value).replace(":operator:",r.operatorLabels[f.value.operator]);return typeof T=="string"?E(T):T[0]&&Object.keys(T).indexOf(f.value.value)===-1?E(T[0]):E(T[f.value.value])}),f=V(()=>t.rule.query),h=V(()=>{const T=Ee(u.state.filters.rules[t.identifier],["id",f.value.rule]);return f.value.operand?Ee(T.operands,E=>E.rule.id==f.value.operand):T}),g=V(()=>Kl(f.value.operator)),y=V(()=>m.value?!1:!!_("displayAs"));ge(()=>t.condition,()=>{m.value||(i.value=I())}),ge(f,()=>{m.value||Fe(()=>i.value=I())},{immediate:!0,deep:!0});function _(T){return f.value.operand?h.value.rule[T]:h.value[T]}function I(){let T=_("type");return["multi-select","checkbox"].indexOf(T)>-1?$():["radio","select"].indexOf(T)>-1?F():T==="date"?N():T==="numeric"?A():T==="number"?x():g.value?C():f.value.value}function F(){let T=_("options").filter(E=>E[_("valueKey")]==f.value.value)[0]||null;return T?T[_("labelKey")]:""}function $(){let T=f.value.value?_("options").filter(E=>f.value.value.indexOf(E[_("valueKey")])>-1):[];return _t(T,_("labelKey")).join(", ")}function C(){return f.value.value?f.value.value.join(" - "):""}function w(T){return g.value?Be(f.value.value)?"":[f.value.value[0]?T(f.value.value[0]):"",f.value.value[1]?T(f.value.value[1]):""].join(" - "):f.value.value?T(f.value.value):""}function x(){return w(a)}function A(){return w(n)}function N(){if(f.value.operator==="is"||f.value.operator==="was"){let T=h.value.operatorsOptions[f.value.operator];return ns(T,(E,B)=>B==f.value.value)[f.value.value]}return w(c)}return(T,E)=>{const B=v("rule-display",!0);return d(),k(te,null,[e.index>0?(d(),k("span",o8,S(T.$t("core::filters.conditions."+e.condition)),1)):O("",!0),e.rule.type==="rule"?(d(),k("div",l8,[y.value?(d(),k("span",i8,S(p.value),1)):(d(),k("span",a8,[Q(S(h.value.label)+" ",1),o("span",s8,S(l(r).operatorLabels[f.value.operator]),1),Q(""),o("span",r8,S(i.value),1)]))])):O("",!0),m.value?(d(),k("div",u8,[(d(!0),k(te,null,re(f.value.children,(z,M)=>(d(),R(B,{key:z.query.rule,index:M,condition:f.value.condition,identifier:e.identifier,view:e.view,rule:z},null,8,["index","condition","identifier","view","rule"]))),128))])):O("",!0)],64)}}}),c8={__name:"RulesDisplay",props:{view:{required:!0,type:String},identifier:{required:!0,type:String}},setup(e){const t=e,{queryBuilderRules:n}=pn(t.identifier,t.view);return(a,r)=>(d(),k("div",{class:X(["flex snap-x space-x-1 overflow-x-auto scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-300 scrollbar-thumb-rounded-md",{"pb-2":l(n).children}]),style:{"font-size":"0.96rem"}},[(d(!0),k(te,null,re(l(n).children,(i,u)=>(d(),R(d8,{key:i.query.rule,index:u,condition:l(n).condition,identifier:e.identifier,view:e.view,rule:i},null,8,["index","condition","identifier","view","rule"]))),128))],2))}},m8={order:[{attribute:"id",direction:"desc"}]};class p8 extends ss{constructor(t={}){super(Object.assign({},m8,t))}append(t,n=!1){return(!this.first(t)||n)&&this.state.data.push(t),this.state.total++,this}prepend(t,n=!1){return(!this.first(t)||n)&&this.state.data.unshift(t),this.state.total++,this}has(t){return this.state.data.indexOf(t)>=0}find(t,n="id"){return this.state.data.filter(a=>t[n]===a[n])}first(t,n="id"){return t?this.find(t,n)[0]:this.items[0]?this.items[0]:null}update(t,n="id"){const a=this.find(t,n);return a&&a.forEach(r=>this.replace(r,Object.assign({},r,t))),this}remove(t,n="id"){const a=this.find(t,n);return a&&a.forEach(r=>{this.state.data.splice(this.state.data.indexOf(r),1),this.state.total--}),this}replace(t,n){return this.state.data.splice(this.state.data.indexOf(t),1,n),this}toggleSortable(t){if(this.isOrderedBy(t)){this.set("order",[{attribute:t,direction:this.isSorted("desc",t)?"asc":"desc"}]);return}this.set("order",[{attribute:t,direction:"desc"}])}isOrderedBy(t){return!!this.get("order").filter(a=>a.attribute==t).length}isSorted(t,n){return!!this.get("order").filter(a=>a.attribute===n&&a.direction==t).length}get urlParams(){return{per_page:this.perPage,page:this.currentPage,order:this.get("order")}}get(t){return this.state[t]}set(t,n){return this.state[t]=n,this}}const f8={key:0,class:"absolute -left-px top-0 h-full w-px bg-neutral-200 dark:bg-neutral-700/70"},v8={key:1,style:{"box-shadow":"0 1px 15px rgba(0, 0, 0, 0.25)"},class:"absolute -right-px top-0 h-full w-px bg-neutral-200 dark:bg-neutral-800"},b8={__name:"TableDataCell",props:{column:{required:!0,type:Object},row:{required:!0,type:Object},condensed:Boolean,isCentered:Boolean,isSortable:Boolean,isSelected:Boolean,isSelectable:Boolean},emits:["selected"],setup(e){const t=e;function n(i){return Object.keys(t.row).forEach(u=>{i=i.replace("{"+u+"}",cn(t.row,u))}),i}const a=V(()=>{if(!t.column.route&&!t.column.link)return{};let i={class:"link"};const u=function(c){Sn(c,(m,p)=>c[p]=oo(m)?n(m):m)};if(t.column.route){let c=nt(t.column.route);Wt(c)?(u(c.params||{}),u(c.query||{})):c=n(c),i.to=c}else i.href=n(t.column.link);return i}),r=V(()=>({style:{width:t.column.width,"min-width":t.column.minWidth},class:[t.column.tdClass,"whitespace-normal group/td relative",t.column.field&&t.column.field.isRequired&&Be(t.row[t.column.attribute])?"!bg-danger-100 hover:!bg-danger-200":t.isSelected?"!bg-neutral-50 dark:!bg-neutral-800":t.isSelectable?"group-hover/tr:bg-neutral-100 group-hover/tr:dark:bg-neutral-700":"group-hover/tr:bg-neutral-50 group-hover/tr:dark:bg-neutral-800",{"text-center":t.isCentered,"table-primary-column":t.column.primary===!0,"table-actions-column":t.column.attribute==="actions"}]}));return(i,u)=>{const c=v("IFormCheckbox");return d(),k("td",pt(ft(r.value)),[o("div",{class:X({flex:e.isSelectable,"mr-5":e.isCentered&&e.isSortable,"whitespace-pre-line":e.column.newlineable})},[u[0]||(he(-1),u[0]=e.column.attribute==="actions"?(d(),k("div",f8)):e.column.primary?(d(),k("div",v8)):O("",!0),he(1),u[0]),e.isSelectable?(d(),R(c,{key:2,class:X({"-ml-2":!e.condensed}),checked:e.isSelected,onClick:m=>i.$emit("selected",e.row)},null,8,["class","checked","onClick"])):O("",!0),e.isSelectable?(d(),k("div",{key:3,class:X([{"left-12":!e.condensed,"left-8":e.condensed},"absolute top-0 h-full w-px bg-neutral-200 dark:bg-neutral-800"])},null,2)):O("",!0),(d(),R(We(e.column.link?"a":e.column.route?"router-link":"div"),Re({class:{"ml-6":e.isSelectable&&!e.condensed,"ml-2":e.isSelectable&&e.condensed}},a.value),{default:b(()=>[de(i.$slots,"default")]),_:3},16,["class"]))],2)],16)}}},h8={key:0,class:"absolute -left-px top-0 h-full w-px bg-neutral-200 dark:bg-neutral-800/40"},_8={key:1,style:{"box-shadow":"0 1px 15px rgba(0, 0, 0, 0.25)"},class:"absolute -right-px top-0 h-full w-px bg-neutral-200 dark:bg-neutral-800/40"},g8={class:"flex items-center"},y8=["onClick"],x8={class:"ml-2 flex-none rounded bg-neutral-200 text-sm text-neutral-900 group-hover:bg-neutral-300"},I8={class:"invisible ml-2 flex-none rounded text-neutral-400 group-hover:visible group-focus:visible"},k8={key:1},$8={__name:"TableHeaderCell",props:{column:{type:Object,required:!0},isOrdered:Boolean,condensed:Boolean,isSortedAscending:Boolean,resourceName:String,isSelectable:Boolean,allRowsSelected:Boolean},emits:["toggle-select-all","sort-requested"],setup(e){const t=e,n=V(()=>t.column.width||"auto"),a=V(()=>!t.column.thClass||!["text-center","text-left","text-right"].some(r=>t.column.thClass.includes(r)));return(r,i)=>{const u=v("IFormCheckbox"),c=v("Icon");return d(),k("th",{scope:"col",class:X(["relative whitespace-nowrap",e.column.thClass,{"table-primary-column":e.column.primary,"table-actions-column":e.column.attribute==="actions","text-left":a.value,"text-center":e.column.centered}]),style:st({width:n.value,"min-width":e.column.minWidth})},[i[0]||(he(-1),i[0]=e.column.attribute==="actions"?(d(),k("div",h8)):e.column.primary?(d(),k("div",_8)):O("",!0),he(1),i[0]),e.isSelectable?(d(),k("div",{key:2,class:X([{"left-12":!e.condensed,"left-8":e.condensed},"absolute top-0 h-full w-px bg-neutral-200 dark:bg-neutral-800"])},null,2)):O("",!0),o("div",g8,[e.isSelectable?(d(),R(u,{key:0,class:X({"-ml-2":!e.condensed}),checked:e.allRowsSelected,onChange:m=>r.$emit("toggle-select-all")},null,8,["class","checked","onChange"])):O("",!0),o("div",{class:X(["grow",{"ml-6":e.isSelectable&&!e.condensed,"ml-2":e.isSelectable&&e.condensed}])},[e.column.sortable?(d(),k("a",{key:0,class:"group inline-flex hover:text-neutral-700 focus:outline-none dark:hover:text-neutral-400",href:"#",onClick:ie(m=>r.$emit("sort-requested",e.column.attribute),["prevent"])},[de(r.$slots,"default",{},()=>[Q(S(e.column.label),1)]),D(o("span",x8,[s(c,{icon:e.isSortedAscending?"ChevronUp":"ChevronDown",class:"h-4 w-4"},null,8,["icon"])],512),[[Y,e.isOrdered]]),D(o("span",I8,[s(c,{icon:"ChevronDown",class:"invisible h-4 w-4 flex-none rounded text-neutral-400 group-hover:visible group-focus:visible"})],512),[[Y,!e.isOrdered]])],8,y8)):(d(),k("span",k8,[de(r.$slots,"default",{},()=>[Q(S(e.column.label),1)])]))],2)])],6)}}},w8={key:0,class:"mb-4 mt-10"},C8={class:"mb-1.5 font-medium text-neutral-700 dark:text-neutral-100"},S8={class:"mb-1 flex items-center rounded border border-neutral-200 px-2 py-1 dark:border-neutral-600"},R8={class:"grow p-1"},F8={key:0,value:""},V8=["value"],T8={class:"p-1"},D8={value:"asc"},q8={value:"desc"},E8={class:"p-1"},A8={class:"p-1"},B8={class:"mb-1.5 font-medium text-neutral-700 dark:text-neutral-100"},N8={class:"mt-4 max-h-[400px] overflow-auto"},O8={class:"mb-2 mr-2 flex rounded-md border border-neutral-200 px-3 py-2 hover:bg-neutral-50 dark:border-neutral-600 dark:hover:bg-neutral-800"},z8={class:"grow"},M8=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-600"},null,-1),U8=["value"],P8={class:"relative mt-1 rounded-md shadow-sm"},j8=o("datalist",{id:"maxHeight"},[o("option",{value:"200"}),o("option",{value:"250"}),o("option",{value:"300"}),o("option",{value:"350"}),o("option",{value:"400"}),o("option",{value:"500"})],-1),L8=o("div",{class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3"},[o("span",{class:"-mt-1 text-neutral-400"},"px")],-1),H8={class:"space-x-2 text-right"},G8={__name:"TableSettingsCustomization",props:{config:{required:!0,type:Object},tableId:{required:!0,type:String},urlPath:{required:!0,type:String}},setup(e,{expose:t}){const n=e,{draggableOptions:a,scrollableDraggableOptions:r}=Xt(),{reloadTable:i,customizeTable:u}=Bt(),c=Pe(),m=q([]),p=q([]),f=q([]),h=q(null),g=q(null),y=q(!1),_=q(null),{form:I}=Ae(),F=V(()=>c.state.table.customize[n.tableId]),$=V(()=>Lt(n.config.columns,K=>K.customizeable)),C=V(()=>Lt($.value,K=>K.sortable)),w=V(()=>m.value.length===C.value.length?!0:Lt(m.value,G=>G.attribute=="").length>0);ge(F,K=>{K?H():L()});function x(K){if(K.dragged.classList.contains("actions")||f.value[K.draggedContext.index].primary||K.draggedContext.futureIndex===0&&f.value[K.draggedContext.futureIndex].primary||K.draggedContext.futureIndex===C.value.length-1&&f.value[K.draggedContext.futureIndex].primary)return!1}function A(K){return!!Ee(m.value,["attribute",K])}function N(){m.value.push({attribute:"",direction:"asc"})}function T(K){m.value.splice(K,1)}function E(){Z(),B(),z()}function B(){f.value=Lt($.value,K=>h.value?K.label.toLowerCase().includes(h.value.toLowerCase()):!0)}function z(){p.value=[],f.value.forEach(K=>K.hidden!==!0&&p.value.push(K.attribute))}function M(K){return K.map((G,oe)=>({attribute:G.attribute,order:oe+1,hidden:!p.value.includes(G.attribute)}))}function j(){P(I.clear()).then(J)}function U(K){return P(I.clear().set({order:Lt(m.value,G=>G.attribute!=""),columns:M(K||ot($.value,G=>f.value.findIndex(oe=>oe.attribute===G.attribute))),maxHeight:g.value,condensed:y.value,perPage:_.value}))}async function P(K){const G=await K.post(`${n.urlPath}/settings`);c.commit("table/UPDATE_SETTINGS",{id:n.tableId,settings:G}),h.value="",Fe(E),Fe(()=>i(n.tableId)),L()}function H(){Innoclapps.modal().show(n.tableId+"listSettings")}function L(){Innoclapps.modal().hide(n.tableId+"listSettings")}function Z(){g.value=n.config.maxHeight,y.value=n.config.condensed,_.value=n.config.perPage}function J(){E(),m.value=nt(n.config.order)}return J(),t({showModal:H,save:U,onColumnMove:x}),(K,G)=>{const oe=v("IFormSelect"),pe=v("Icon"),ue=v("IButton"),ee=v("IButtonIcon"),W=v("SearchInput"),ne=v("IFormCheckbox"),ce=v("IFormGroup"),fe=v("IFormInput"),Se=v("IModal"),Ie=ae("t"),Ce=ae("i-tooltip");return d(),R(Se,{id:e.tableId+"listSettings",size:"sm",description:K.$t("core::table.customize_list_view"),title:K.$t("core::table.list_settings"),onHidden:G[8]||(G[8]=le=>(l(u)(e.tableId,!1),h.value=null,B())),onShown:G[9]||(G[9]=le=>l(u)(e.tableId,!0))},{"modal-footer":b(()=>[o("div",H8,[s(ue,{variant:"white",size:"sm",text:K.$t("core::app.cancel"),onClick:L},null,8,["text"]),s(ue,{variant:"white",size:"sm",text:K.$t("core::app.reset"),onClick:j},null,8,["text"]),s(ue,{variant:"primary",size:"sm",text:K.$t("core::app.save"),onClick:G[7]||(G[7]=le=>U())},null,8,["text"])])]),default:b(()=>[e.config.allowDefaultSortChange?(d(),k("div",w8,[D(o("p",C8,null,512),[[Ie,"core::table.default_sort"]]),s(l(Et),Re({modelValue:m.value,"onUpdate:modelValue":G[0]||(G[0]=le=>m.value=le),"item-key":le=>le.attribute+"-"+le.direction,handle:".sort-draggable-handle"},l(a)),{item:b(({index:le})=>[o("div",S8,[o("div",R8,[s(oe,{id:"column_"+le,modelValue:m.value[le].attribute,"onUpdate:modelValue":ye=>m.value[le].attribute=ye},{default:b(()=>[m.value[le].attribute?O("",!0):(d(),k("option",F8)),(d(!0),k(te,null,re(C.value,ye=>D((d(),k("option",{key:ye.attribute,value:ye.attribute},S(ye.label),9,V8)),[[Y,!A(ye.attribute)]])),128))]),_:2},1032,["id","modelValue","onUpdate:modelValue"])]),o("div",T8,[s(oe,{id:"column_type_"+le,modelValue:m.value[le].direction,"onUpdate:modelValue":ye=>m.value[le].direction=ye},{default:b(()=>[o("option",D8,[Q(" Asc ("),D(o("span",null,null,512),[[Ie,"core::app.ascending"]]),Q(") ")]),o("option",q8,[Q(" Desc ("),D(o("span",null,null,512),[[Ie,"core::app.descending"]]),Q(") ")])]),_:2},1032,["id","modelValue","onUpdate:modelValue"])]),o("div",E8,[s(ue,{variant:le===0?"secondary":"danger",disabled:le===0&&w.value,size:"sm",onClick:ye=>le===0?N():T(le)},{default:b(()=>[le===0?(d(),R(pe,{key:0,icon:"Plus",class:"h-4 w-4"})):le>0?(d(),R(pe,{key:1,icon:"Minus",class:"h-4 w-4"})):O("",!0)]),_:2},1032,["variant","disabled","onClick"])]),o("div",A8,[s(ee,{icon:"Selector",class:"sort-draggable-handle cursor-move"})])])]),_:1},16,["modelValue","item-key"])])):O("",!0),D(o("p",B8,null,512),[[Ie,"core::table.columns"]]),s(W,{modelValue:h.value,"onUpdate:modelValue":G[1]||(G[1]=le=>h.value=le),onInput:B},null,8,["modelValue"]),o("div",N8,[s(l(Et),Re({modelValue:f.value,"onUpdate:modelValue":G[3]||(G[3]=le=>f.value=le),handle:".column-draggable-handle",move:x,"item-key":"attribute"},l(r)),{item:b(({element:le})=>[o("div",O8,[o("div",z8,[D((d(),R(ne,{id:"col-"+le.attribute,checked:p.value,"onUpdate:checked":G[2]||(G[2]=ye=>p.value=ye),name:"col-"+le.attribute,disabled:le.primary===!0,value:le.attribute},{default:b(()=>[le.helpText?D((d(),R(pe,{key:0,icon:"QuestionCircle",class:"h-4 w-4 text-neutral-600"},null,512)),[[Ce,le.helpText]]):O("",!0),Q(" "+S(le.label),1)]),_:2},1032,["id","checked","name","disabled","value"])),[[Ce,le.primary===!0?K.$t("core::table.primary_column"):""]])]),o("div",null,[le.primary?O("",!0):(d(),R(ee,{key:0,icon:"Selector",class:"column-draggable-handle cursor-move"}))])])]),_:1},16,["modelValue"])]),M8,s(ce,{label:K.$t("core::table.per_page"),"label-for":"tableSettingsPerPage"},{default:b(()=>[s(oe,{id:"tableSettingsPerPage",modelValue:_.value,"onUpdate:modelValue":G[4]||(G[4]=le=>_.value=le)},{default:b(()=>[(d(),k(te,null,re([25,50,100],le=>o("option",{key:le,value:le},S(_.value),9,U8)),64))]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(ce,{label:K.$t("core::table.max_height"),description:K.$t("core::table.max_height_info"),"label-for":"tableSettingsMaxHeight"},{default:b(()=>[o("div",P8,[s(fe,{id:"tableSettingsMaxHeight",modelValue:g.value,"onUpdate:modelValue":G[5]||(G[5]=le=>g.value=le),type:"number",min:"200",step:"50",class:"pr-10",list:"maxHeight"},null,8,["modelValue"]),j8,L8])]),_:1},8,["label","description"]),s(ce,{class:"mt-5"},{default:b(()=>[s(ne,{checked:y.value,"onUpdate:checked":G[6]||(G[6]=le=>y.value=le)},{default:b(()=>[Q(S(K.$t("core::table.condensed")),1)]),_:1},8,["checked"])]),_:1})]),_:1},8,["id","description","title"])}}},K8={class:"mb-2 md:mb-0 md:w-auto"},Y8={__name:"TableSettings",props:{config:{required:!0,type:Object},tableId:{required:!0,type:String},urlPath:{required:!0,type:String},withCustomizeButton:Boolean,resourceName:{type:String,required:!0}},setup(e,{expose:t}){const n=q(null);return t({customizationRef:n}),(a,r)=>{const i=v("IButton");return d(),k(te,null,[o("div",K8,[e.config.customizeable&&e.withCustomizeButton?(d(),R(i,{key:0,variant:"white",icon:"Cog",onClick:r[0]||(r[0]=()=>a.$refs.customizationRef.showModal())})):O("",!0)]),s(G8,{ref_key:"customizationRef",ref:n,config:e.config,"table-id":e.tableId,"url-path":e.urlPath},null,8,["config","table-id","url-path"])],64)}}};const W8={key:0,class:"m-auto mt-8 max-w-5xl"},Q8={class:"mb-2 flex flex-wrap items-center md:mb-4 md:flex-nowrap"},X8={class:"order-last w-full shrink-0 md:order-first md:mb-0 md:w-auto"},Z8={class:"flex grow"},J8={key:0,class:"mb-2 flex flex-col items-start md:mb-4 md:flex-row"},eS={class:"mb-2 flex w-full shrink-0 content-center space-x-1 sm:w-auto md:mb-0"},tS={class:"mb-2 ml-0 md:mb-0 md:ml-4"},nS={class:"flex flex-col md:flex-row md:items-center"},oS={class:"mr-8 flex shrink-0 items-center"},lS=["for","textContent"],aS={class:"md:w-68 mt-3 w-full md:mt-0"},sS=["onClick"],rS={key:0},iS=["colspan","textContent"],tn={__name:"Table",props:{tableId:{type:String,required:!0},resourceName:{type:String,required:!0},actionRequestParams:{type:Object,default(){return{}}},dataRequestQueryString:{type:Object,default(){return{}}},withCustomizeButton:Boolean,emptyState:Object,rowClass:Function,urlPath:String,filterId:Number},emits:["loaded"],setup(e,{expose:t,emit:n}){const a=e,{t:r}=ve(),i=Pe(),{scrollableDraggableOptions:u}=Xt(),c=V(()=>({...u,delay:50})),{setLoading:m,isLoading:p}=Ct(),f=_n(new p8),h=q(""),g=q(!1),y=q(!1),_=q(!1),I=q(null);let F=null;const $=V(()=>f.hasItems?"":p.value?"...":h.value?r("core::app.no_search_results"):r("core::table.empty")),C=V(()=>i.state.table.settings[a.tableId]||{}),w=V(()=>C.value.identifier),x=V(()=>a.tableId),A=V(()=>f.state.meta.pre_total===0),N=V(()=>typeof f.state.meta.pre_total>"u"?!1:A.value&&a.emptyState!=null),T=V(()=>({...f.urlParams,...C.value.requestQueryString,...a.dataRequestQueryString})),E=V(()=>En(C.value.columns||[],"order")),B=V({get(){return E.value.filter(_e=>(!_e.hidden||_e.hidden==!1)&&_e.attribute)},set(_e){let me=nt(C.value.columns);_e.forEach((we,Ue)=>{let Oe=me.findIndex(se=>se.attribute===we.attribute);Oe!==-1&&(me[Oe]=Object.assign({},we,C.value.columns[Oe],{order:Ue+1}))}),i.commit("table/UPDATE_SETTINGS",{id:a.tableId,settings:{columns:me}}),I.value.customizationRef.save(_e)}}),z=V(()=>B.value.length),M=V(()=>a.urlPath?a.urlPath:"/"+a.resourceName+"/table"),j=V(()=>f.items.filter(_e=>_e.tSelected)),U=V(()=>j.value.length),P=V(()=>j.value.map(_e=>_e.id)),H=V(()=>U.value>0),L=V(()=>U.value===f.items.length),Z=V(()=>f.items.length===0?!1:C.value.hasCustomActions!==null&&C.value.hasCustomActions?!0:C.value.actions.length>0),{queryBuilderRules:J,rulesAreValid:K,hasRulesApplied:G,rulesAreVisible:oe,toggleFiltersRules:pe,resetQueryBuilderRules:ue}=pn(w,x),{hasRules:ee,activeFilter:W}=ho(w,x);function ne(_e=!1){if(p.value)return;Ge(),m(!0),_e===!0&&f.currentPage!==1&&Ie(1);let me=T.value;K.value&&(me.rules=J.value),h.value&&(me.q=h.value),Innoclapps.request().get(M.value,{params:me,cancelToken:new Nn(we=>F=we)}).then(({data:we})=>{f.setState(we),at(),n("loaded",{empty:A.value})}).finally(()=>{m(!1),_.value||setTimeout(()=>_.value=!0,150)})}function ce(_e){f.perPage=Number(_e.perPage),f.set("order",_e.order),Fe(()=>{ee.value?at():ne(),g.value=!0})}async function fe(_e=!1){return await i.dispatch("table/getSettings",{resourceName:a.resourceName,params:a.dataRequestQueryString,id:a.tableId,force:_e})}async function Se(){return await i.dispatch("table/fetchActions",{resourceName:a.resourceName,params:a.dataRequestQueryString,id:a.tableId})}function Ie(_e){f.currentPage=_e}function Ce(){rt("floating-resource-updated",ne),rt("action-executed",le),rt("reload-resource-table",ye)}function le(_e){_e.resourceName===a.resourceName&&ne()}function ye(_e){_e===a.tableId&&ne()}function Ge(){F&&F()}function be(_e){Fe(ne)}function Ve(_e,me){Z.value&&U.value!==0&&(_e.target.tagName=="INPUT"||_e.target.tagName=="SELECT"||_e.target.tagName=="TEXTAREA"||_e.target.isContentEditable||_e.target.tagName=="A"||_e.target.tagName=="BUTTON"||$e(me))}function $e(_e){_e.tSelected=!_e.tSelected}function et(){L.value?Te():tt()}function Te(){f.items.forEach(_e=>_e.tSelected=!1)}function tt(){f.items.forEach(_e=>_e.tSelected=!0)}function at(){y.value!==!0&&(y.value=!0,ge(T,(_e,me)=>{At(_e,me)||ne()},{deep:!0}),ge(()=>C.value.perPage,function(_e){f.perPage=Number(_e)}),ge(()=>C.value.order,_e=>{_e&&f.set("order",_e)},{deep:!0}))}function lt(){Ce(),fe().then(_e=>ce(_e))}return De(lt),bt(()=>{Ge()}),on(()=>{W.value||ue(),oe.value=!1,f.flush(),m(!1)}),t({refetchActions:Se,setPage:Ie}),(_e,me)=>{const we=v("IEmptyState"),Ue=v("SearchInput"),Oe=v("IButton"),se=v("IFormCheckbox"),ke=v("ITable"),He=v("ICard"),yt=v("IOverlay");return d(),k(te,null,[N.value?(d(),k("div",W8,[s(we,pt(ft(e.emptyState)),null,16)])):O("",!0),s(yt,{show:!_.value&&!N.value},{default:b(()=>[D(o("div",null,[o("div",Q8,[o("div",X8,[s(Ue,{modelValue:h.value,"onUpdate:modelValue":me[0]||(me[0]=Ke=>h.value=Ke),onInput:me[1]||(me[1]=Ke=>ne(!0))},null,8,["modelValue"])]),o("div",Z8,[de(_e.$slots,"after-search",{collection:f})]),o("div",null,[g.value?(d(),R(Y8,{key:0,ref_key:"settingsRef",ref:I,config:C.value,"with-customize-button":e.withCustomizeButton,"url-path":M.value,"table-id":e.tableId,"resource-name":e.resourceName},null,8,["config","with-customize-button","url-path","table-id","resource-name"])):O("",!0)])]),g.value&&l(ee)?(d(),k("div",J8,[o("div",eS,[s(Rs,{view:x.value,identifier:w.value,class:"flex-1",placement:"bottom-start",onApply:be},null,8,["view","identifier"]),D(s(Oe,{variant:"white",icon:"PencilAlt",onClick:l(pe)},null,8,["onClick"]),[[Y,l(G)&&!l(oe)]]),D(s(Oe,{variant:"white",icon:"Plus",text:_e.$t("core::filters.add_filter"),onClick:l(pe)},null,8,["text","onClick"]),[[Y,!l(G)&&!l(oe)]])]),o("div",tS,[s(c8,{identifier:w.value,view:x.value},null,8,["identifier","view"])])])):O("",!0),g.value?(d(),R(l(Ss),{key:1,view:x.value,identifier:w.value,"active-filter-id":e.filterId,onApply:be},null,8,["view","identifier","active-filter-id"])):O("",!0),s(He,{"no-body":"",overlay:l(p)},{default:b(()=>[Z.value&&H.value?(d(),k("div",{key:0,class:X(["fixed left-auto right-1 z-50 w-full max-w-xs rounded-md border border-neutral-600 bg-neutral-800 px-6 py-5 shadow-lg shadow-primary-400/40 dark:shadow-primary-900/40 md:left-80 md:right-auto md:max-w-md",f.total<=5?"bottom-20":"bottom-[3.3rem]"])},[o("div",nS,[o("div",oS,[s(se,{id:`${e.tableId}ToggleAll`,checked:H.value,onChange:Te},null,8,["id","checked"]),o("label",{class:"ml-1 text-sm text-neutral-100",for:`${e.tableId}ToggleAll`,textContent:S(_e.$t("core::actions.records_count",{count:U.value}))},null,8,lS)]),o("div",aS,[s(Qn,{type:"select",size:"sm",view:"index",ids:P.value,"action-request-params":e.actionRequestParams,actions:C.value.actions||[],"resource-name":e.resourceName},null,8,["ids","action-request-params","actions","resource-name"])])])],2)):O("",!0),D(s(ke,{id:"table-"+e.tableId,sticky:C.value.maxHeight!==null,condensed:C.value.condensed,class:"rounded-lg","wrapper-class":"-mt-px","max-height":C.value.maxHeight!==null?C.value.maxHeight+"px":"10000px"},{default:b(()=>[o("thead",null,[s(l(Et),Re({modelValue:B.value,"onUpdate:modelValue":me[3]||(me[3]=Ke=>B.value=Ke),disabled:!C.value.customizeable,move:Ke=>_e.$refs.settingsRef.customizationRef.onColumnMove(Ke),tag:"tr","item-key":Ke=>"th"+Ke.attribute},c.value),{item:b(({element:Ke,index:Ze})=>[s($8,{column:Ke,condensed:C.value.condensed,"is-selectable":Z.value&&Ze===0,"all-rows-selected":Z.value&&Ze===0?L.value:void 0,"resource-name":e.resourceName,"is-ordered":f.isOrderedBy(Ke.attribute),"is-sorted-ascending":f.isSorted("asc",Ke.attribute),onSortRequested:me[2]||(me[2]=ze=>f.toggleSortable(ze)),onToggleSelectAll:et},null,8,["column","condensed","is-selectable","all-rows-selected","resource-name","is-ordered","is-sorted-ascending"])]),_:1},16,["modelValue","disabled","move","item-key"])]),o("tbody",null,[(d(!0),k(te,null,re(f.items,(Ke,Ze)=>(d(),k("tr",{key:Ze,class:X(["group/tr",e.rowClass?e.rowClass(Ke):void 0,Ke.tSelected&&"!bg-neutral-50 dark:!bg-neutral-800"]),onClick:ze=>Ve(ze,Ke)},[(d(!0),k(te,null,re(B.value,(ze,Vt)=>(d(),R(b8,{key:"td-"+ze.attribute,condensed:C.value.condensed,"is-selected":Ke.tSelected||!1,"is-centered":ze.centered||!1,"is-sortable":ze.sortable||!1,"is-selectable":Z.value&&Vt===0,"resource-name":e.resourceName,column:ze,row:Ke,onSelected:$e},{default:b(()=>[de(_e.$slots,ze.attribute,pt(ft({column:ze,row:Ke,resourceName:e.resourceName,resourceId:Ke.id})),()=>{var Nt;return[(d(),R(We(ze.component||((Nt=ze.field)==null?void 0:Nt.indexComponent)||"span"),Re({field:ze.field?{...ze.field,value:Ke[ze.attribute]}:void 0},{column:ze,row:Ke,resourceName:e.resourceName,resourceId:Ke.id},{onReload:ne}),{default:b(()=>[Q(S(Ke[ze.attribute]),1)]),_:2},1040,["field"]))]})]),_:2},1032,["condensed","is-selected","is-centered","is-sortable","is-selectable","resource-name","column","row"]))),128))],10,sS))),128)),f.hasItems?O("",!0):(d(),k("tr",rS,[D(o("td",{class:"is-empty",colspan:z.value,textContent:S($.value)},null,8,iS),[[Y,!l(p)&&_.value]])]))])]),_:3},8,["id","sticky","condensed","max-height"]),[[Y,g.value]])]),_:3},8,["overlay"]),f.hasPagination?(d(),R(rs,{key:2,class:"mt-4 sm:mt-6","is-current-page-check":Ke=>f.isCurrentPage(Ke),"has-next-page":f.hasNextPage,"has-previous-page":f.hasPreviousPage,links:f.pagination,"render-links":f.shouldRenderLinks,from:f.from,to:f.to,total:f.total,loading:l(p),size:"sm",onGoToNext:me[4]||(me[4]=Ke=>f.nextPage()),onGoToPrevious:me[5]||(me[5]=Ke=>f.previousPage()),onGoToPage:me[6]||(me[6]=Ke=>f.page(Ke))},null,8,["is-current-page-check","has-next-page","has-previous-page","links","render-links","from","to","total","loading"])):O("",!0)],512),[[Y,!N.value&&_.value]])]),_:3},8,["show"])],64)}}},uS=["onSubmit"],dS={__name:"TrashedTable",props:{resourceName:{required:!0,type:String}},setup(e){const t=e,n=q(`${t.resourceName}-trashed`),a=q(!1),r=q(!0),{reloadTable:i}=Bt();async function u(){await Innoclapps.dialog().confirm();try{a.value=!0,await Innoclapps.request().delete(`/trashed/${t.resourceName}`),i(n)}finally{a.value=!1}}const c=Innoclapps.config("soft_deletes.prune_after");return(m,p)=>{const f=v("IAlert"),h=v("IButtonMinimal");return d(),k(te,null,[s(f,{class:"mb-6 border border-info-200"},{default:b(()=>[Q(S(m.$t("core::app.soft_deletes.trashed_pruning_info",{total:l(c)})),1)]),_:1}),s(tn,{"url-path":`/${e.resourceName}/table`,"table-id":n.value,"data-request-query-string":{trashed:1},"action-request-params":{trashed:1},"resource-name":e.resourceName,onLoaded:p[0]||(p[0]=g=>r.value=g.empty)},vt({_:2},[r.value?void 0:{name:"after-search",fn:b(()=>[o("form",{class:"ml-auto",onSubmit:ie(u,["prevent"])},[s(h,{type:"submit",variant:"danger",icon:"Trash",disabled:a.value,loading:a.value,text:m.$t("core::app.soft_deletes.empty_trash")},null,8,["disabled","loading","text"])],40,uS)]),key:"0"}]),1032,["url-path","table-id","resource-name"])],64)}}},cS={__name:"TrashedResourceRecords",setup(e){return(t,n)=>{const a=v("ILayout");return d(),R(a,null,{default:b(()=>[s(dS,{"resource-name":t.$route.params.resourceName},null,8,["resource-name"])]),_:1})}}},mS=["onSubmit"],pS={class:"flex items-center"},fS={href:"https://console.developers.google.com/",class:"link inline-flex items-center text-sm",target:"_blank",rel:"noopener noreferrer"},vS={class:"mb-6 flex justify-between rounded-md border border-neutral-200 bg-neutral-50 px-3 py-2 dark:border-neutral-600 dark:bg-neutral-800"},bS=o("span",{class:"mr-2 font-medium text-neutral-700 dark:text-neutral-200"}," Redirect Url: ",-1),hS={class:"sm:flex sm:space-x-4"},_S={__name:"SettingsGoogle",setup(e){const{form:t,submit:n,isReady:a,originalSettings:r}=Gt(),i=Innoclapps.config("url")+"/google/callback",u=V(()=>r.value.google_client_secret&&r.value.google_client_id);function c(){n(()=>window.location.reload())}return(m,p)=>{const f=v("Icon"),h=v("ICardHeading"),g=v("IButtonCopy"),y=v("IFormInput"),_=v("IFormGroup"),I=v("IButton"),F=v("ICard"),$=ae("i-tooltip");return d(),k("form",{onSubmit:ie(c,["prevent"]),onInput:p[2]||(p[2]=C=>l(t).errors.clear(C.target.name))},[s(F,{overlay:!l(a)},{header:b(()=>[o("div",pS,[u.value&&l(a)?(d(),R(f,{key:0,icon:"CheckCircleSolid",class:"mr-1 h-5 w-5 text-success-600"})):O("",!0),s(h,null,{default:b(()=>[Q("Google")]),_:1})])]),actions:b(()=>[o("a",fS,[Q(" Console "),s(f,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})])]),footer:b(()=>[s(I,{type:"submit",disabled:l(t).busy,variant:"primary",text:m.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[o("div",vS,[o("div",{class:"text-sm"},[bS,o("span",{class:"select-all text-neutral-600 dark:text-white",textContent:i})]),D(s(g,{class:"ml-3",text:i,"success-message":m.$t("core::app.copied")},null,8,["success-message"]),[[$,m.$t("core::app.copy")]])]),o("div",hS,[s(_,{label:"Client ID","label-for":"google_client_id",class:"w-full"},{default:b(()=>[s(y,{id:"google_client_id",modelValue:l(t).google_client_id,"onUpdate:modelValue":p[0]||(p[0]=C=>l(t).google_client_id=C),autocomplete:"off",name:"google_client_id"},null,8,["modelValue"])]),_:1}),s(_,{label:"Client Secret","label-for":"google_client_secret",class:"w-full"},{default:b(()=>[s(y,{id:"google_client_secret",modelValue:l(t).google_client_secret,"onUpdate:modelValue":p[1]||(p[1]=C=>l(t).google_client_secret=C),type:"password",autocomplete:"off",name:"google_client_secret"},null,8,["modelValue"])]),_:1})])]),_:1},8,["overlay"])],40,mS)}}},gS=["onSubmit"],yS={class:"flex items-center"},xS={href:"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade",class:"link inline-flex items-center text-sm",target:"_blank",rel:"noopener noreferrer"},IS={class:"mb-6 flex justify-between rounded-md border border-neutral-200 bg-neutral-50 px-3 py-2 dark:border-neutral-600 dark:bg-neutral-800"},kS=o("span",{class:"mr-2 font-medium text-neutral-700 dark:text-neutral-200"}," Redirect Url: ",-1),$S={class:"sm:flex sm:space-x-4"},wS={class:"font-bold"},CS={class:"mt-4"},SS={class:"-mx-2 -my-1.5 flex"},RS={class:"mt-4"},FS={class:"-mx-2 -my-1.5 flex"},VS={__name:"SettingsMicrosoft",setup(e){const{localizedDate:t,appMoment:n,appDate:a}=Ne(),{form:r,submit:i,isReady:u,originalSettings:c}=Gt(),m=Innoclapps.config("url")+"/microsoft/callback",p=V(()=>c.value.msgraph_client_secret&&c.value.msgraph_client_id),f=V(()=>!c.value.msgraph_client_secret||!c.value.msgraph_client_secret_configured_at?!1:h().isBefore(n()));function h(){return n(c.value.msgraph_client_secret_configured_at).add(24,"months").subtract(1,"day")}function g(){r.msgraph_client_secret&&c.value.msgraph_client_secret!=r.msgraph_client_secret?r.fill("msgraph_client_secret_configured_at",a()):r.msgraph_client_secret||r.fill("msgraph_client_secret_configured_at",null),Fe(()=>i(()=>window.location.reload()))}return(y,_)=>{const I=v("Icon"),F=v("ICardHeading"),$=v("IButtonCopy"),C=v("IFormInput"),w=v("IFormGroup"),x=v("IButtonMinimal"),A=v("IAlert"),N=v("IButton"),T=v("ICard"),E=ae("i-tooltip");return d(),k("form",{onSubmit:ie(g,["prevent"]),onInput:_[2]||(_[2]=B=>l(r).errors.clear(B.target.name))},[s(T,{header:"Microsoft",overlay:!l(u)},{header:b(()=>[o("div",yS,[p.value&&l(u)?(d(),R(I,{key:0,icon:f.value?"XCircleSolid":"CheckCircleSolid",class:X(["mr-1 h-5 w-5",{"text-success-600":!f.value&&p.value&&l(u),"text-danger-500":f.value&&p.value&&l(u)}])},null,8,["icon","class"])):O("",!0),s(F,null,{default:b(()=>[Q("Microsoft")]),_:1})])]),actions:b(()=>[o("a",xS,[Q(" App Registrations "),s(I,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})])]),footer:b(()=>[s(N,{type:"submit",disabled:l(r).busy,text:y.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[o("div",IS,[o("div",{class:"text-sm"},[kS,o("span",{class:"select-all text-neutral-600 dark:text-white",textContent:m})]),D(s($,{class:"ml-3",text:m,"success-message":y.$t("core::app.copied")},null,8,["success-message"]),[[E,y.$t("core::app.copy")]])]),o("div",$S,[s(w,{class:"w-full",label:"App (client) ID","label-for":"msgraph_client_id"},{default:b(()=>[s(C,{id:"msgraph_client_id",modelValue:l(r).msgraph_client_id,"onUpdate:modelValue":_[0]||(_[0]=B=>l(r).msgraph_client_id=B),autocomplete:"off",name:"msgraph_client_id"},null,8,["modelValue"])]),_:1}),s(w,{class:"w-full",label:"Client Secret","label-for":"msgraph_client_secret"},{default:b(()=>[s(C,{id:"msgraph_client_secret",modelValue:l(r).msgraph_client_secret,"onUpdate:modelValue":_[1]||(_[1]=B=>l(r).msgraph_client_secret=B),autocomplete:"off",type:"password",name:"msgraph_client_secret"},null,8,["modelValue"])]),_:1})]),l(c).msgraph_client_secret&&l(c).msgraph_client_secret_configured_at&&!f.value?(d(),R(A,{key:0,class:"mt-4",variant:"info"},{default:b(()=>[Q(" The client secret was configured at "+S(l(t)(l(c).msgraph_client_secret_configured_at))+". If you followed the documentation and configured the client secret to expire in 24 months, ",1),o("span",wS," you must re-generate a new client secret at: "+S(h().format("YYYY-MM-DD")),1),Q(" in order the integration to continue working. "),o("div",CS,[o("div",SS,[s(x,{variant:"info",target:"_blank",rel:"noopener noreferrer",tag:"a",href:"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/Credentials/appId/"+l(r).msgraph_client_id+"/isMSAApp/true"},{default:b(()=>[Q(" Re-Generate ")]),_:1},8,["href"])])])]),_:1})):O("",!0),s(A,{class:"mt-4",show:f.value,variant:"danger"},{default:b(()=>[Q(" The client secret is probably expired, click the button below to re-generate new secret if it's needed, don't forget to update the secret here in the integration as well. "),o("div",RS,[o("div",FS,[s(x,{variant:"danger",tag:"a",target:"_blank",rel:"noopener noreferrer",href:"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/Credentials/appId/"+l(r).msgraph_client_id+"/isMSAApp/true"},{default:b(()=>[Q(" Re-Generate ")]),_:1},8,["href"])])])]),_:1},8,["show"])]),_:1},8,["overlay"])],40,gS)}}},TS=["onSubmit"],DS={class:"flex items-center"},qS={href:"https://dashboard.pusher.com",class:"link inline-flex items-center text-sm",target:"_blank",rel:"noopener noreferrer"},ES={class:"sm:flex sm:space-x-4"},AS={class:"sm:flex sm:space-x-4"},BS={class:"flex"},NS={class:"grow"},OS={href:"https://pusher.com/docs/clusters",class:"link mb-1 inline-flex items-center",target:"_blank",rel:"noopener noreferrer"},zS={__name:"SettingsPusher",setup(e){const{form:t,submit:n,isReady:a,originalSettings:r}=Gt(),i=V(()=>r.value.pusher_app_id&&r.value.pusher_app_key&&r.value.pusher_app_secret);function u(){n(()=>window.location.reload())}return(c,m)=>{const p=v("Icon"),f=v("ICardHeading"),h=v("IAlert"),g=v("IFormInput"),y=v("IFormGroup"),_=v("IFormLabel"),I=v("IButton"),F=v("ICard");return d(),k("form",{onSubmit:ie(u,["prevent"]),onInput:m[4]||(m[4]=$=>l(t).errors.clear($.target.name))},[s(F,{overlay:!l(a)},{header:b(()=>[o("div",DS,[i.value&&l(a)?(d(),R(p,{key:0,icon:"CheckCircleSolid",class:"mr-1 h-5 w-5 text-success-600"})):O("",!0),s(f,null,{default:b(()=>[Q("Pusher")]),_:1})])]),actions:b(()=>[o("a",qS,[Q(" Pusher.com "),s(p,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})])]),footer:b(()=>[s(I,{type:"submit",disabled:l(t).busy,text:c.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[s(h,{show:!i.value&&l(a),variant:"info",class:"mb-6"},{default:b(()=>[Q(" Receive notifications in real time without the need to manually refresh the page, after synchronization, automatically updates the calendar, total unread emails and new emails. ")]),_:1},8,["show"]),o("div",ES,[s(y,{class:"w-full",label:"App ID","label-for":"pusher_app_id"},{default:b(()=>[s(g,{id:"pusher_app_id",modelValue:l(t).pusher_app_id,"onUpdate:modelValue":m[0]||(m[0]=$=>l(t).pusher_app_id=$)},null,8,["modelValue"])]),_:1}),s(y,{class:"w-full",label:"App Key","label-for":"pusher_app_key"},{default:b(()=>[s(g,{id:"pusher_app_key",modelValue:l(t).pusher_app_key,"onUpdate:modelValue":m[1]||(m[1]=$=>l(t).pusher_app_key=$)},null,8,["modelValue"])]),_:1})]),o("div",AS,[s(y,{class:"w-full",label:"App Secret","label-for":"pusher_app_secret"},{default:b(()=>[s(g,{id:"pusher_app_secret",modelValue:l(t).pusher_app_secret,"onUpdate:modelValue":m[2]||(m[2]=$=>l(t).pusher_app_secret=$),type:"password"},null,8,["modelValue"])]),_:1}),s(y,{class:"w-full"},{label:b(()=>[o("div",BS,[o("div",NS,[s(_,{for:"pusher_app_cluster"},{default:b(()=>[Q("App Cluster")]),_:1})]),o("div",null,[o("small",null,[o("a",OS,[Q(" https://pusher.com/docs/clusters "),s(p,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})])])])])]),default:b(()=>[s(g,{id:"pusher_app_cluster",modelValue:l(t).pusher_app_cluster,"onUpdate:modelValue":m[3]||(m[3]=$=>l(t).pusher_app_cluster=$)},null,8,["modelValue"])]),_:1})])]),_:1},8,["overlay"])],40,TS)}}},MS=o("div",{class:"p-3 text-center"},[o("img",{src:"https://cdn.zapier.com/zapier/images/logos/zapier-logo.png",class:"mx-auto h-16 w-auto"}),o("p",{class:"mt-5 text-sm text-neutral-700 dark:text-white"},[Q(" Zapier integration is at "),o("b",null,'"Invite Only"'),Q(" and "),o("b",null,'"Testing"'),Q(" stage, we are inviting you to test the integration before it's available for everyone. ")]),o("p",{class:"mt-1 text-sm text-neutral-700 dark:text-white"},[Q(" Before this, "),o("b",null,"we need to verify your purchase key"),Q(" and after that we will share the Zapier invite link with you can try it! ")])],-1),US={class:"m-auto max-w-2xl"},PS={class:"mt-5 flex justify-center rounded-md shadow-sm"},jS={class:"flex grow items-stretch focus-within:z-10"},LS={key:0,class:"mt-6 flex items-center justify-center text-neutral-800 dark:text-neutral-300"},HS={class:"select-all font-medium"},GS={__name:"SettingsZapier",setup(e){const t=q(Innoclapps.config("purchase_key")),n=q(null);function a(){lo.get(`https://www.concordcrm.com/zapier-link/${t.value}`,{withCredentials:!0}).then(({data:r})=>{n.value=r.link}).catch(r=>{Innoclapps.error(r.response.data.error)})}return(r,i)=>{const u=v("IBadge"),c=v("ICardHeading"),m=v("IFormInput"),p=v("IButton"),f=v("IButtonCopy"),h=v("ICard"),g=ae("i-tooltip");return d(),R(h,null,{header:b(()=>[s(c,null,{default:b(()=>[Q(" Zapier "),s(u,{variant:"info","wrapper-class":"ml-2"},{default:b(()=>[Q("Beta")]),_:1})]),_:1})]),default:b(()=>[MS,o("div",US,[o("div",PS,[o("div",jS,[s(m,{id:"purchase-key",modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=y=>t.value=y),rounded:!1,class:"form-input rounded-l-md border-neutral-300",placeholder:"Enter your purchase key here"},null,8,["modelValue"])]),s(p,{class:"relative -ml-px shrink-0 rounded-r-md",variant:"white",rounded:!1,onClick:a},{default:b(()=>[Q(" Get Integration Link ")]),_:1})])]),n.value?(d(),k("div",LS,[o("span",HS,S(n.value),1),D(s(f,{class:"ml-3",text:n.value,"success-message":r.$t("core::app.copied")},null,8,["text","success-message"]),[[g,r.$t("core::app.copy")]])])):O("",!0)]),_:1})}}},KS=[{alias:"/",path:"/dashboard",component:Da,meta:{title:qe.t("core::dashboard.insights"),scrollToTop:!1}},{path:"/",name:"dashboard",component:Da,meta:{title:qe.t("core::dashboard.insights"),scrollToTop:!1}},{path:"/dashboard/:id/edit",name:"edit-dashboard",component:v$},{path:"/notifications",name:"notifications",component:ew,meta:{title:qe.t("core::notifications.your")}},{path:"/import/:resourceName",name:"import-resource",meta:{title:qe.t("core::import.import_records")},component:Q2},{path:"/oauth/accounts",name:"oauth-accounts",component:bw,meta:{title:qe.t("core::oauth.connected_accounts")}},{path:"/trashed/:resourceName",name:"trashed-resource-records",component:cS,meta:{title:qe.t("core::app.soft_deletes.trashed_records")}},{name:"404",path:"/404",meta:{title:"404"},component:qa},{name:"403",path:"/403",meta:{title:"403"},component:D$},{name:"not-found",path:"/:pathMatch(.*)*",component:qa},{path:"/settings",name:"settings",component:dI,meta:{title:qe.t("core::settings.settings"),gate:"is-super-admin"},children:[{path:"general",component:DI,name:"settings-general",meta:{title:qe.t("core::settings.general_settings")},alias:"/settings"},{path:"fields/:resourceName",name:"resource-fields",component:Ux},{path:"integrations/microsoft",component:VS,name:"settings-integrations-microsoft",meta:{title:"Microsoft"}},{path:"integrations/google",component:_S,name:"settings-integrations-google",meta:{title:"Google"}},{path:"integrations/pusher",component:zS,name:"settings-integrations-pusher",meta:{title:"Pusher"}},{path:"integrations/zapier",component:GS,name:"settings-integrations-zapier",meta:{title:"Zapier"}},{path:"/settings/workflows",component:d$,meta:{title:qe.t("core::workflow.workflows")}},{path:"/settings/mailables",component:WI,meta:{title:qe.t("core::mail_template.mail_templates")}},{path:"/settings/update",component:Mk,name:"update",meta:{title:qe.t("core::update.system")}},{path:"/settings/tools",component:fk,meta:{title:qe.t("core::settings.tools.tools")}},{path:"/settings/info",component:ZI,meta:{title:qe.t("core::app.system_info")}},{path:"/settings/logs",component:rk,meta:{title:"Logs"}},{path:"/settings/security",component:lI,meta:{title:qe.t("core::settings.security.security")}},{path:"/settings/recaptcha",component:Qx,meta:{title:qe.t("core::settings.recaptcha.recaptcha")}}]}],{setTags:YS}=bs();window.Innoclapps&&Innoclapps.booting(function(e,t,n){n.registerModule("fields",H1),n.registerModule("table",ex),n.registerModule("filters",Q1),YS(Innoclapps.config("tags")||[]),KS.forEach(a=>t.addRoute(a))});function WS(e,t){var a;(a=Innoclapps.broadcaster)!=null&&a.hasDriver()&&window.Echo.private("Modules.Users.Models.User."+e).notification(t)}function Fs(e,t,n){var c;const a=((c=Innoclapps.broadcaster)==null?void 0:c.hasDriver())||!1,r=q(null);Ho(()=>{r.value=xt(e)?l(e):e}),ge(r,(m,p)=>{p&&u(p),m&&i()},{immediate:!0});function i(){!a||!r.value||window.Echo.private(r.value).listen(t,n)}function u(m){!a||!m&&!r.value||window.Echo.private(m||r.value).stopListening(t,n)}return gd(u),{start:i,stop:u}}class QS{constructor(t,n="authorizations"){this.user=t,this.authorizationProperty=n}isSuperAdmin(){return!!this.user.gate["is-super-admin"]}isRegularUser(){return!this.isSuperAdmin()}userCan(t){return this.before()?!0:Object.hasOwn(this.user.gate,t)?this.user.gate[t]:this.user.permissions.indexOf(t)>-1}userCant(t){return!this.userCan(t)}before(){return this.isSuperAdmin()?!0:null}allows(t,n){return this.before()?!0:this.user&&Object.hasOwn(n,this.authorizationProperty)?n[this.authorizationProperty][t]:!1}denies(t,n){return!this.allows(t,n)}}const XS={install(e,t){e.config.globalProperties.$gate=new QS(t)}},ZS=["onSubmit"],JS={__name:"UserInvitationAcceptForm",props:{invitation:{type:Object,required:!0},timezones:{type:Array,required:!0},dateFormat:String,timeFormat:String,firstDayOfWeek:String},setup(e){const t=e,{t:n}=ve(),a=Pe(),r=q(!1),{form:i}=Ae({name:null,password:null,timezone:moment.tz.guess(),locale:"en",date_format:t.dateFormat,time_format:t.timeFormat,first_day_of_week:t.firstDayOfWeek,password_confirmation:null,email:t.invitation.email});function u(){r.value=!0,i.post(t.invitation.link).then(()=>window.location.href=Innoclapps.config("url")).catch(c=>{c.isValidationError()&&Innoclapps.error(n("core::app.form_validation_failed_with_sections"),3e3)}).finally(()=>r.value=!1)}return a.commit("SET_TIMEZONES",t.timezones),(c,m)=>{const p=v("ITab"),f=v("ITabList"),h=v("IFormInput"),g=v("IFormError"),y=v("IFormGroup"),_=v("ITabPanel"),I=v("IButton"),F=v("ITabPanels"),$=v("ITabGroup");return d(),k("form",{onKeydown:m[9]||(m[9]=C=>l(i).onKeydown(C)),onSubmit:ie(u,["prevent"])},[s($,null,{default:b(()=>[s(f,{class:"-mt-5"},{default:b(()=>[s(p,{title:c.$t("users::profile.profile")},null,8,["title"]),s(p,{title:c.$t("auth.password")},null,8,["title"]),s(p,{title:c.$t("users::user.localization")},null,8,["title"])]),_:1}),s(F,null,{default:b(()=>[s(_,null,{default:b(()=>[s(y,{label:c.$t("users::user.name"),"label-for":"name",required:""},{default:b(()=>[s(h,{id:"name",ref:"name",modelValue:l(i).name,"onUpdate:modelValue":m[0]||(m[0]=C=>l(i).name=C),type:"text"},null,8,["modelValue"]),s(g,{textContent:S(l(i).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(y,{label:c.$t("users::user.email"),"label-for":"email"},{default:b(()=>[s(h,{id:"email",modelValue:l(i).email,"onUpdate:modelValue":m[1]||(m[1]=C=>l(i).email=C),name:"email",disabled:"",type:"email"},null,8,["modelValue"]),s(g,{textContent:S(l(i).getError("email"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1}),s(_,null,{default:b(()=>[s(y,{label:c.$t("auth.password"),"label-for":"password",required:""},{default:b(()=>[s(h,{id:"password",modelValue:l(i).password,"onUpdate:modelValue":m[2]||(m[2]=C=>l(i).password=C),name:"password",type:"password"},null,8,["modelValue"]),s(g,{textContent:S(l(i).getError("password"))},null,8,["textContent"])]),_:1},8,["label"]),s(y,{label:c.$t("auth.confirm_password"),"label-for":"password_confirmation",required:""},{default:b(()=>[s(h,{id:"password_confirmation",modelValue:l(i).password_confirmation,"onUpdate:modelValue":m[3]||(m[3]=C=>l(i).password_confirmation=C),name:"password_confirmation",type:"password"},null,8,["modelValue"]),s(g,{textContent:S(l(i).getError("password_confirmation"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1}),s(_,null,{default:b(()=>[s(Zo,{form:l(i),"onUpdate:firstDayOfWeek":m[4]||(m[4]=C=>l(i).first_day_of_week=C),"onUpdate:timeFormat":m[5]||(m[5]=C=>l(i).time_format=C),"onUpdate:dateFormat":m[6]||(m[6]=C=>l(i).date_format=C),"onUpdate:locale":m[7]||(m[7]=C=>l(i).locale=C),"onUpdate:timezone":m[8]||(m[8]=C=>l(i).timezone=C)},null,8,["form"])]),_:1}),s(I,{type:"submit",class:"mt-2",disabled:r.value,loading:r.value,text:c.$t("users::user.accept_invitation")},null,8,["disabled","loading","text"])]),_:1})]),_:1})],40,ZS)}}},to={async fetch({state:e},t={}){let{data:n}=await Innoclapps.request().get(t.endpoint?t.endpoint:e.endpoint,t);return n},async get({state:e},t){const n=typeof t=="object"?t.id:t,a=typeof t=="object"?t.queryString:{};let{data:r}=await Innoclapps.request().get(`${e.endpoint}/${n}`,{params:a});return r},async store({state:e},t){return await t.post(e.endpoint)},async update({state:e},t){return await t.form.put(`${e.endpoint}/${t.id}`,{params:t.queryString||{}})},async destroy({state:e},t){await Innoclapps.dialog().confirm();let{data:n}=await Innoclapps.request().delete(`${e.endpoint}/${t}`);return n}},Vs={async fetch(e,t={}){if(e.state.dataFetched&&!t.force)return e.state.collection;let n=await to.fetch(e,t);return e.commit("SET",n),n},async get(e,t){return to.get(e,t)},async store(e,t){let n=await to.store(e,t);return e.commit("ADD",n),n},async update(e,t){let n=await to.update(e,t);return e.commit("UPDATE",{id:t.id,item:n}),n},async destroy(e,t){let n=await to.destroy(e,t);return e.commit("REMOVE",t),n}},Ts={getById:e=>t=>Ee(e.collection,["id",Number(t)])},Ds={SET(e,t){e.collection=t,e.dataFetched=!0},RESET(e){e.collection=[],e.dataFetched=!1},ADD(e,t){e.collection.push(t)},UPDATE(e,t){const n=Xe(e.collection,["id",Number(t.id)]);n!==-1&&(e.collection[n]=t.item)},REMOVE(e,t){const n=Xe(e.collection,["id",Number(t)]);n!=-1&&e.collection.splice(n,1)}};function nn(e){return Xe(e.collection,["id",Number(Innoclapps.config("user_id"))])}const e5={collection:[],dataFetched:!1,endpoint:"/users",notificationsEndpoint:"/notifications"},t5={...Ds,NEW_NOTIFICATION(e,t){const n=nn(e);e.collection[n].notifications.latest.unshift(t),e.collection[n].notifications.unread_count=e.collection[n].notifications.unread_count+1,Innoclapps.$emit("new-notification-added",t)},REMOVE_NOTIFICATION(e,t){const n=nn(e);!t.read_at&&e.collection[n].notifications.unread_count>0&&(e.collection[n].notifications.unread_count=e.collection[n].notifications.unread_count-1);const a=Xe(e.collection[n].notifications.latest,["id",t.id]);a!==-1&&e.collection[n].notifications.latest.splice(a,1)},SET_TOTAL_UNREAD_NOTIFICATIONS(e,t){const n=nn(e);e.collection[n].notifications.unread_count=t},SET_ALL_NOTIFICATIONS_AS_READ(e){const t=nn(e);e.collection[t].notifications.latest.forEach(n=>{n.read_at=moment().format("YYYY-MM-DD HH:mm:ss")})},ADD_DASHBOARD(e,t){const n=nn(e);e.collection[n].dashboards.push(t),t.is_default&&e.collection[n].dashboards.forEach((a,r)=>{a.id!=t.id&&(e.collection[r].dashboards[r].is_default=!1)})},UPDATE_DASHBOARD(e,t){const n=nn(e),a=Xe(e.collection[n].dashboards,["id",Number(t.id)]);e.collection[n].dashboards[a]=Object.assign({},e.collection[n].dashboards[a],t),t.is_default&&e.collection[n].dashboards.forEach((r,i)=>{r.id!=t.id&&(e.collection[n].dashboards[i].is_default=!1)})},REMOVE_DASHBOARD(e,t){const n=nn(e),a=Xe(e.collection[n].dashboards,["id",Number(t)]);e.collection[n].dashboards.splice(a,1)}},n5={...Ts,current(e){return e.collection[nn(e)]},totalNotifications(e){const t=nn(e);return e.collection[t].notifications.latest?e.collection[t].notifications.latest.length:0},hasUnreadNotifications(e){const t=nn(e);return e.collection[t].notifications.unread_count>0},localizeNotification:()=>e=>e.data.lang?qe.t(e.data.lang.key,e.data.lang.attrs):e.data.message},o5={...Vs,async updateProfile({commit:e},t){let n=await t.put("/profile");e("UPDATE",{id:n.id,item:n})},async removeAvatar({commit:e},t){let{data:n}=await Innoclapps.request().delete(`/users/${t}/avatar`);return e("UPDATE",{id:n.id,item:n}),n},async destroyNotification({commit:e,state:t},n){return await Innoclapps.dialog().confirm(),await Innoclapps.request().delete(`${t.notificationsEndpoint}/${n.id}`),e("REMOVE_NOTIFICATION",n),n},async markAllNotificationsAsRead({commit:e,state:t,getters:n}){n.hasUnreadNotifications&&(await Innoclapps.request().put(t.notificationsEndpoint),e("SET_ALL_NOTIFICATIONS_AS_READ"),e("SET_TOTAL_UNREAD_NOTIFICATIONS",0))}},l5={namespaced:!0,state:e5,getters:n5,actions:o5,mutations:t5},a5={class:"mx-auto max-w-5xl"},s5={class:"text-left"},r5={class:"text-left"},i5={class:"text-left"},u5=o("th",{class:"text-left"},null,-1),d5=["textContent"],c5={class:"align-middle"},m5={class:"align-middle"},p5={class:"align-middle"},f5={class:"mb-5 font-semibold text-warning-600"},v5=["textContent"],b5={__name:"UsersPersonalAccessTokens",setup(e){const t=q(null),n=q(!1),a=q(!1),r=q(!1),i=ts([]),{form:u}=Ae({name:""},{resetOnSuccess:!0}),{localizedDateTime:c}=Ne(),m=V(()=>i.length);function p(){f()}function f(){r.value=!0,Innoclapps.request().get("/personal-access-tokens").then(I=>{i.push(...I.data)}).finally(()=>r.value=!1)}function h(){a.value=!0}function g(){t.value=null,u.post("/personal-access-tokens").then(I=>{i.push(I.accessToken),y(I.plainTextToken)})}function y(I){a.value=!1,t.value=I,n.value=!0}async function _(I){await Innoclapps.dialog().confirm(),await Innoclapps.request().delete(`/personal-access-tokens/${I.id}`),i.splice(i.findIndex(F=>F.id===I.id),1)}return p(),(I,F)=>{const $=v("IButton"),C=v("ITable"),w=v("IEmptyState"),x=v("ICardBody"),A=v("ICard"),N=v("IFormInput"),T=v("IFormError"),E=v("IFormGroup"),B=v("IModal"),z=v("ILayout"),M=ae("t");return d(),R(z,null,{default:b(()=>[o("div",a5,[s(A,{"no-body":"",header:I.$t("core::api.personal_access_tokens"),overlay:r.value},{actions:b(()=>[D(s($,{icon:"plus",text:I.$t("core::api.create_token"),size:"sm",onClick:h},null,8,["text"]),[[Y,m.value>0]])]),default:b(()=>[m.value>0?(d(),R(C,{key:0,class:"-mt-px"},{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",s5,null,512),[[M,"core::api.token_name"]]),D(o("th",r5,null,512),[[M,"core::api.token_last_used"]]),D(o("th",i5,null,512),[[M,"core::app.created_at"]]),u5])]),o("tbody",null,[(d(!0),k(te,null,re(l(i),j=>(d(),k("tr",{key:j.id},[o("td",{class:"align-middle",textContent:S(j.name)},null,8,d5),o("td",c5,S(j.last_used_at?l(c)(j.last_used_at):"N/A"),1),o("td",m5,S(l(c)(j.created_at)),1),o("td",p5,[s($,{variant:"white",icon:"Trash",size:"sm",text:I.$t("core::api.revoke_token"),onClick:U=>_(j)},null,8,["text","onClick"])])]))),128))])]),_:1})):r.value?O("",!0):(d(),R(x,{key:1},{default:b(()=>[s(w,{title:I.$t("core::api.no_tokens"),"button-text":I.$t("core::api.create_token"),description:I.$t("core::api.empty_state.description"),onClick:h},null,8,["title","button-text","description"])]),_:1}))]),_:1},8,["header","overlay"]),s(B,{visible:a.value,"onUpdate:visible":F[1]||(F[1]=j=>a.value=j),form:"",size:"sm","ok-disabled":l(u).busy,"ok-title":I.$t("core::app.create"),"cancel-title":I.$t("core::app.cancel"),title:I.$t("core::api.create_token"),onShown:F[2]||(F[2]=()=>I.$refs.createTokenNameRef.focus()),onSubmit:g,onKeydown:F[3]||(F[3]=j=>l(u).onKeydown(j))},{default:b(()=>[s(E,{label:I.$t("core::api.token_name"),"label-for":"name",required:""},{default:b(()=>[s(N,{id:"name",ref:"createTokenNameRef",modelValue:l(u).name,"onUpdate:modelValue":F[0]||(F[0]=j=>l(u).name=j),name:"name"},null,8,["modelValue"]),s(T,{textContent:S(l(u).getError("name"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1},8,["visible","ok-disabled","ok-title","cancel-title","title"]),s(B,{visible:n.value,"onUpdate:visible":F[4]||(F[4]=j=>n.value=j),"static-backdrop":"","hide-footer":"",title:I.$t("core::api.personal_access_token")},{default:b(()=>[D(o("p",f5,null,512),[[M,"core::api.after_token_created_info"]]),o("p",{class:"select-all break-all rounded-md border border-neutral-300 p-4 text-neutral-900 dark:text-neutral-200",textContent:S(t.value)},null,8,v5)]),_:1},8,["visible","title"])])]),_:1})}}};const h5={class:"rounded-md border border-neutral-200 bg-neutral-50 px-4 py-5 shadow-sm dark:border-neutral-500 dark:bg-neutral-800"},_5={class:"mb-2 text-base font-medium text-neutral-800 dark:text-neutral-100"},g5={class:"relative mb-8 flex h-16 w-full items-center justify-center rounded-md border border-neutral-200 bg-white p-3 text-center dark:border-neutral-500 dark:bg-neutral-700"},y5={class:"mr-10 select-all text-neutral-700 dark:text-neutral-100"},x5={class:"mb-10"},I5={class:"flex justify-between"},k5={class:"text-sm font-medium text-neutral-800 dark:text-neutral-100"},$5={class:"mb-3"},w5={class:"flex justify-between"},C5=["textContent"],S5=["max"],R5={class:"mb-3"},F5={class:"flex justify-between"},V5=["textContent"],T5=["max"],D5={class:"mb-3"},q5={class:"flex justify-between"},E5=["textContent"],A5=["max"],B5={__name:"PasswordGenerator",setup(e){const t=q(""),n=q({maxLength:64,maxDigits:10,maxSymbols:10,length:12,digits:4,symbols:2,ambiguous:!0});ge(()=>n.value.length,r),ge(()=>n.value.digits,r),ge(()=>n.value.symbols,r);const a=V(()=>{let i={excess:0,upperCase:0,numbers:0,symbols:0},u={excess:3,upperCase:4,numbers:5,symbols:5,combo:0,flatLower:0,flatNumber:0},c={text:"",score:0},m=30;for(let f=0;f<t.value.length;f++)t.value.charAt(f).match(/[A-Z]/g)&&i.upperCase++,t.value.charAt(f).match(/[0-9]/g)&&i.numbers++,t.value.charAt(f).match(/(.*[!,@,#,$,%,^,&,*,?,_,~])/)&&i.symbols++;i.excess=t.value.length-6,i.upperCase&&i.numbers&&i.symbols?u.combo=25:(i.upperCase&&i.numbers||i.upperCase&&i.symbols||i.numbers&&i.symbols)&&(u.combo=15),t.value.match(/^[\sa-z]+$/)&&(u.flatLower=-30),t.value.match(/^[\s0-9]+$/)&&(u.flatNumber=-50);let p=m+i.excess*u.excess+i.upperCase*u.upperCase+i.numbers*u.numbers+i.symbols*u.symbols+u.combo+u.flatLower+u.flatNumber;return p<30?(c.text="weak",c.score=10,c):p>=30&&p<75?(c.text="average",c.score=40,c):p>=75&&p<150?(c.text="strong",c.score=75,c):(c.text="secure",c.score=100,c)});function r(){let i=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],u=["=","+","-","^","?","!","%","&","*","$","#","^","@","|"],c=[],m=[];for(let p=0;p<n.value.length;p++)m.push(p),Math.round(Math.random()*1)===0?c[p]=i[Math.floor(Math.random()*i.length)].toUpperCase():c[p]=i[Math.floor(Math.random()*i.length)];for(let p=0;p<n.value.digits;p++){let f=Math.round(Math.random()*9),h=m[Math.floor(Math.random()*m.length)];c[h]=f;let g=m.indexOf(h);p!=-1&&m.splice(g,1)}for(let p=0;p<n.value.symbols;p++){let f=u[Math.floor(Math.random()*u.length)],h=m[Math.floor(Math.random()*m.length)];c[h]=f;let g=m.indexOf(h);p!=-1&&m.splice(g,1)}t.value=c.join("")}return De(()=>{r()}),(i,u)=>{const c=v("IButtonIcon"),m=v("IButtonCopy"),p=v("IFormLabel"),f=ae("t"),h=ae("i-tooltip");return d(),k("section",h5,[D(o("h5",_5,null,512),[[f,"core::app.password_generator.heading"]]),o("div",g5,[o("div",y5,S(t.value),1),s(c,{icon:"Refresh",onClick:r}),D(s(m,{text:t.value,"success-message":i.$t("core::app.password_generator.copied"),class:"ml-3"},null,8,["text","success-message"]),[[h,i.$t("core::app.copy")]])]),o("div",x5,[o("div",I5,[D(s(p,null,null,512),[[f,"core::app.password_generator.strength"]]),D(o("p",k5,null,512),[[f,"core::app.password_generator."+a.value.text]])]),D(o("input",{"onUpdate:modelValue":u[0]||(u[0]=g=>a.value.score=g),class:X([{"bg-danger-400":a.value.text==="weak","bg-warning-300":a.value.text==="average","bg-success-400":a.value.text==="strong"||a.value.text==="secure"},"input-score pointer-events-none h-2 w-full appearance-none overflow-hidden rounded-md focus:outline-none"]),type:"range",min:"0",max:"100"},null,2),[[Zt,a.value.score]])]),o("div",$5,[o("div",w5,[D(s(p,null,null,512),[[f,"core::app.password_generator.length"]]),o("p",{class:"text-neutral-800 dark:text-neutral-100",textContent:S(n.value.length)},null,8,C5)]),D(o("input",{"onUpdate:modelValue":u[1]||(u[1]=g=>n.value.length=g),type:"range",class:"range-slider h-2 w-full appearance-none overflow-hidden rounded-md bg-primary-200 focus:outline-none",min:"6",max:n.value.maxLength},null,8,S5),[[Zt,n.value.length]])]),o("div",R5,[o("div",F5,[D(s(p,null,null,512),[[f,"core::app.password_generator.digits"]]),o("p",{class:"text-neutral-800 dark:text-neutral-100",textContent:S(n.value.digits)},null,8,V5)]),D(o("input",{"onUpdate:modelValue":u[2]||(u[2]=g=>n.value.digits=g),type:"range",class:"range-slider h-2 w-full appearance-none overflow-hidden rounded-md bg-primary-200 focus:outline-none",min:"0",max:n.value.maxDigits},null,8,T5),[[Zt,n.value.digits]])]),o("div",D5,[o("div",q5,[D(s(p,null,null,512),[[f,"core::app.password_generator.symbols"]]),o("p",{class:"text-neutral-800 dark:text-neutral-100",textContent:S(n.value.symbols)},null,8,E5)]),D(o("input",{"onUpdate:modelValue":u[3]||(u[3]=g=>n.value.symbols=g),type:"range",class:"range-slider h-2 w-full appearance-none overflow-hidden rounded-md bg-primary-200 focus:outline-none",min:"0",max:n.value.maxSymbols},null,8,A5),[[Zt,n.value.symbols]])])])}}},qs=ct(B5,[["__scopeId","data-v-bf72e5df"]]),N5=["textContent"],O5=["textContent"],z5=["textContent"],Es=Object.assign({inheritAttrs:!1},{__name:"UserNotificationSettings",props:{form:{required:!0,type:Object}},setup(e){const t=Innoclapps.config("notifications_settings"),n={mail:"Mail",database:"Bell"},a=Al(yd(_t(t,"channels")));return(r,i)=>{const u=v("Icon"),c=v("IFormCheckbox"),m=v("ITable"),p=ae("i-tooltip");return d(),R(m,pt(ft(r.$attrs)),{default:b(()=>[o("thead",null,[o("tr",null,[(d(!0),k(te,null,re(l(a),f=>D((d(),k("th",{key:"heading-"+f,class:"text-left",width:"6%",scope:"col"},[s(u,{class:"h-5 w-5",icon:n[f]},null,8,["icon"])])),[[p,r.$t("core::notifications.channels."+f)]])),128)),o("th",{class:"text-left",width:"auto",textContent:S(r.$t("core::notifications.notification"))},null,8,N5)])]),o("tbody",null,[(d(!0),k(te,null,re(l(t),f=>(d(),k("tr",{key:f.key},[(d(!0),k(te,null,re(l(a),h=>(d(),k("td",{key:h},[f.channels.indexOf(h)>-1?(d(),R(c,{key:0,id:h+"-"+f.key,checked:e.form.notifications_settings[f.key][h],"onUpdate:checked":g=>e.form.notifications_settings[f.key][h]=g},null,8,["id","checked","onUpdate:checked"])):(d(),R(u,{key:1,class:"h-5 w-5",icon:"X"}))]))),128)),o("td",null,[o("p",{class:"text-neutral-700 dark:text-neutral-300",textContent:S(f.name)},null,8,O5),D(o("p",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-300",textContent:S(f.description)},null,8,z5),[[Y,f.description]])])]))),128))])]),_:1},16)}}}),M5={class:"m-auto max-w-7xl"},U5={class:"md:grid md:grid-cols-3 md:gap-6"},P5={class:"md:col-span-1"},j5={class:"text-lg/6 font-medium text-neutral-900 dark:text-white"},L5={class:"mt-1 text-sm text-neutral-600 dark:text-neutral-300"},H5={class:"mt-5 md:col-span-2 md:mt-0"},G5=o("div",{class:"hidden sm:block","aria-hidden":"true"},[o("div",{class:"py-5"},[o("div",{class:"border-t border-neutral-200 dark:border-neutral-600"})])],-1),K5={class:"mt-10 sm:mt-0"},Y5={class:"md:grid md:grid-cols-3 md:gap-6"},W5={class:"md:col-span-1"},Q5={class:"text-lg/6 font-medium text-neutral-900 dark:text-white"},X5={class:"mt-1 text-sm text-neutral-600 dark:text-neutral-300"},Z5={class:"mt-5 md:col-span-2 md:mt-0"},J5=["onSubmit"],e3={class:"text-right"},t3=o("div",{class:"hidden sm:block","aria-hidden":"true"},[o("div",{class:"py-5"},[o("div",{class:"border-t border-neutral-200 dark:border-neutral-600"})])],-1),n3={class:"mt-10 sm:mt-0"},o3={class:"md:grid md:grid-cols-3 md:gap-6"},l3={class:"md:col-span-1"},a3={class:"text-lg/6 font-medium text-neutral-900 dark:text-white"},s3={class:"mt-1 text-sm text-neutral-600 dark:text-neutral-300"},r3={class:"mt-5 md:col-span-2 md:mt-0"},i3={class:"text-right"},u3=o("div",{class:"hidden sm:block","aria-hidden":"true"},[o("div",{class:"py-5"},[o("div",{class:"border-t border-neutral-200 dark:border-neutral-600"})])],-1),d3={class:"mt-10 sm:mt-0"},c3={class:"md:grid md:grid-cols-3 md:gap-6"},m3={class:"md:col-span-1"},p3={class:"text-lg/6 font-medium text-neutral-900 dark:text-white"},f3={class:"mt-1 text-sm text-neutral-600 dark:text-neutral-300"},v3={class:"mt-5 md:col-span-2 md:mt-0"},b3={class:"text-right"},h3=o("div",{class:"hidden sm:block","aria-hidden":"true"},[o("div",{class:"py-5"},[o("div",{class:"border-t border-neutral-200 dark:border-neutral-600"})])],-1),_3={class:"mt-10 sm:mt-0"},g3={class:"md:grid md:grid-cols-3 md:gap-6"},y3={class:"md:col-span-1"},x3={class:"text-lg/6 font-medium text-neutral-900 dark:text-white"},I3={class:"mt-1 text-sm text-neutral-600 dark:text-neutral-300"},k3={class:"mt-5 md:col-span-2 md:mt-0"},$3=["onSubmit"],w3={class:"flex"},C3={class:"link text-sm",href:"#"},S3={id:"generate-password",style:{display:"none"}},R3={class:"text-right"},F3={key:0,class:"hidden sm:block","aria-hidden":"true"},V3=o("div",{class:"py-5"},[o("div",{class:"border-t border-neutral-200 dark:border-neutral-600"})],-1),T3=[V3],D3={key:1,class:"mt-10 sm:mt-0"},q3={class:"md:grid md:grid-cols-3 md:gap-6"},E3={class:"md:col-span-1"},A3={class:"text-lg/6 font-medium text-neutral-900 dark:text-white"},B3={class:"mt-1 text-sm text-neutral-600 dark:text-neutral-300"},N3={class:"mt-5 md:col-span-2 md:mt-0"},O3={role:"list",class:"space-y-4 divide-y divide-neutral-200 dark:divide-neutral-700"},z3=["textContent"],M3={class:"mb-2 mt-2 text-sm font-medium text-neutral-500 dark:text-neutral-300"},U3=["textContent"],P3={__name:"UsersProfile",setup(e){const{t}=ve(),n=Pe(),{currentUser:a,resetStoreState:r}=Le(),i=l(a),{form:u}=Ae(),{form:c}=Ae({},{resetOnSuccess:!0}),{teams:m}=Qo(),p=V(()=>m.value.filter(F=>F.manager.id===a.value.id));let f=null;function h(F){n.commit("users/UPDATE",{id:F.id,item:F}),i.avatar=F.avatar,i.avatar_url=F.avatar_url,u.avatar=i.avatar}function g(){i.avatar&&n.dispatch("users/removeAvatar",i.id).then(F=>u.avatar=F.avatar)}function y(){n.dispatch("users/updateProfile",u).then(()=>{Innoclapps.success(t("users::profile.updated")),f!==u.locale?window.location.reload():r()})}function _(){c.put("/profile/password").then(()=>{Innoclapps.success(t("users::profile.password_updated"))})}function I(){f=i.locale,u.set({name:i.name,email:i.email,mail_signature:i.mail_signature,date_format:i.date_format,time_format:i.time_format,first_day_of_week:i.first_day_of_week,timezone:i.timezone,locale:i.locale,notifications_settings:Ko(nt(i.notifications.settings),(F,$)=>(F[$.key]=$.availability,F),{})}),c.set({old_password:null,password:null,password_confirmation:null})}return I(),(F,$)=>{const C=v("ICard"),w=v("IFormInput"),x=v("IFormError"),A=v("IFormGroup"),N=v("Editor"),T=v("IButton"),E=v("IFormLabel"),B=v("IAvatar"),z=v("ILayout"),M=ae("t"),j=ae("i-toggle");return d(),R(z,null,{default:b(()=>[o("div",M5,[o("div",U5,[o("div",P5,[D(o("h3",j5,null,512),[[M,"core::app.avatar"]]),D(o("p",L5,null,512),[[M,"users::profile.avatar_info"]])]),o("div",H5,[s(C,null,{default:b(()=>[s(ro,{name:"avatar","upload-url":`${F.$store.state.apiURL}/users/${l(a).id}/avatar`,image:l(a).uploaded_avatar_url,"cropper-options":{aspectRatio:1/1},"choose-text":l(a).uploaded_avatar_url?F.$t("core::app.change"):F.$t("core::app.upload_avatar"),onCleared:g,onSuccess:h},null,8,["upload-url","image","choose-text"])]),_:1})])]),G5,o("div",K5,[o("div",Y5,[o("div",W5,[D(o("h3",Q5,null,512),[[M,"users::profile.profile"]]),D(o("p",X5,null,512),[[M,"users::profile.profile_info"]])]),o("div",Z5,[o("form",{onSubmit:ie(y,["prevent"]),onKeydown:$[3]||($[3]=U=>l(u).onKeydown(U))},[s(C,null,{footer:b(()=>[o("div",e3,[s(T,{disabled:l(u).busy,text:F.$t("users::profile.update"),onClick:y},null,8,["disabled","text"])])]),default:b(()=>[s(A,{label:F.$t("users::user.name"),"label-for":"name"},{default:b(()=>[s(w,{id:"name",modelValue:l(u).name,"onUpdate:modelValue":$[0]||($[0]=U=>l(u).name=U),name:"name"},null,8,["modelValue"]),s(x,{textContent:S(l(u).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(A,{label:F.$t("users::user.email"),"label-for":"email"},{default:b(()=>[s(w,{id:"email",modelValue:l(u).email,"onUpdate:modelValue":$[1]||($[1]=U=>l(u).email=U),name:"email",type:"email"},null,8,["modelValue"]),s(x,{textContent:S(l(u).getError("email"))},null,8,["textContent"])]),_:1},8,["label"]),s(A,{label:F.$t("mailclient::mail.signature"),"label-for":"mail_signature",description:F.$t("mailclient::mail.signature_info")},{default:b(()=>[s(N,{modelValue:l(u).mail_signature,"onUpdate:modelValue":$[2]||($[2]=U=>l(u).mail_signature=U)},null,8,["modelValue"]),s(x,{textContent:S(l(u).getError("mail_signature"))},null,8,["textContent"])]),_:1},8,["label","description"])]),_:1})],40,J5)])])]),t3,o("div",n3,[o("div",o3,[o("div",l3,[D(o("h3",a3,null,512),[[M,"users::user.localization"]]),D(o("p",s3,null,512),[[M,"users::profile.localization_info"]])]),o("div",r3,[s(C,null,{footer:b(()=>[o("div",i3,[s(T,{disabled:l(u).busy,text:F.$t("core::app.save"),onClick:y},null,8,["disabled","text"])])]),default:b(()=>[s(Zo,{form:l(u),"onUpdate:firstDayOfWeek":$[4]||($[4]=U=>l(u).first_day_of_week=U),"onUpdate:timeFormat":$[5]||($[5]=U=>l(u).time_format=U),"onUpdate:dateFormat":$[6]||($[6]=U=>l(u).date_format=U),"onUpdate:locale":$[7]||($[7]=U=>l(u).locale=U),"onUpdate:timezone":$[8]||($[8]=U=>l(u).timezone=U)},null,8,["form"])]),_:1})])])]),u3,o("div",d3,[o("div",c3,[o("div",m3,[D(o("h3",p3,null,512),[[M,"core::notifications.notifications"]]),D(o("p",f3,null,512),[[M,"users::profile.notifications_info"]])]),o("div",v3,[s(C,{"no-body":""},{footer:b(()=>[o("div",b3,[s(T,{disabled:l(u).busy,text:F.$t("core::app.save"),onClick:y},null,8,["disabled","text"])])]),default:b(()=>[s(Es,{form:l(u),class:"-mt-px"},null,8,["form"])]),_:1})])])]),h3,o("div",_3,[o("div",g3,[o("div",y3,[D(o("h3",x3,null,512),[[M,"auth.password"]]),D(o("p",I3,null,512),[[M,"users::profile.password_info"]])]),o("div",k3,[o("form",{onSubmit:ie(_,["prevent"]),onKeydown:$[12]||($[12]=U=>l(c).onKeydown(U))},[s(C,null,{footer:b(()=>[o("div",R3,[s(T,{type:"submit",disabled:l(c).busy,text:F.$t("auth.change_password")},null,8,["disabled","text"])])]),default:b(()=>[s(A,{label:F.$t("auth.current_password"),"label-for":"old_password"},{default:b(()=>[s(w,{id:"old_password",modelValue:l(c).old_password,"onUpdate:modelValue":$[9]||($[9]=U=>l(c).old_password=U),name:"old_password",type:"password",autocomplete:"current-password"},null,8,["modelValue"]),s(x,{textContent:S(l(c).getError("old_password"))},null,8,["textContent"])]),_:1},8,["label"]),s(A,null,{label:b(()=>[o("div",w3,[s(E,{class:"mb-1 grow",for:"password",label:F.$t("auth.new_password")},null,8,["label"]),D(o("a",C3,null,512),[[j,"generate-password"],[M,"core::app.password_generator.heading"]])])]),default:b(()=>[s(w,{id:"password",modelValue:l(c).password,"onUpdate:modelValue":$[10]||($[10]=U=>l(c).password=U),name:"password",type:"password",autocomplete:"new-password"},null,8,["modelValue"]),s(x,{textContent:S(l(c).getError("password"))},null,8,["textContent"])]),_:1}),s(A,{label:F.$t("auth.confirm_password"),"label-for":"password_confirmation"},{default:b(()=>[s(w,{id:"password_confirmation",modelValue:l(c).password_confirmation,"onUpdate:modelValue":$[11]||($[11]=U=>l(c).password_confirmation=U),name:"password_confirmation",type:"password",autocomplete:"new-password"},null,8,["modelValue"]),s(x,{textContent:S(l(c).getError("password_confirmation"))},null,8,["textContent"])]),_:1},8,["label"]),o("div",S3,[s(qs)])]),_:1})],40,$3)])])]),p.value.length>0?(d(),k("div",F3,T3)):O("",!0),p.value.length>0?(d(),k("div",D3,[o("div",q3,[o("div",E3,[o("h3",A3,S(F.$t("users::team.your_teams",p.value.length)),1),D(o("p",B3,null,512),[[M,"users::team.managing_teams"]])]),o("div",N3,[s(C,null,{default:b(()=>[o("ul",O3,[(d(!0),k(te,null,re(p.value,U=>(d(),k("li",{key:U.id,class:"pt-4 first:pt-0"},[o("p",{class:"truncate text-base font-medium text-neutral-800 dark:text-neutral-100",textContent:S(U.name)},null,8,z3),D(o("p",M3,null,512),[[M,"users::team.members"]]),(d(!0),k(te,null,re(U.members,P=>(d(),k("div",{key:"info-"+P.email,class:"mb-1 flex items-center space-x-1.5 last:mb-0"},[s(B,{alt:P.name,size:"xs",src:P.avatar_url},null,8,["alt","src"]),o("p",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300",textContent:S(P.name)},null,8,U3)]))),128))]))),128))])]),_:1})])])])):O("",!0)])]),_:1})}}},_o=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name")),r=V(()=>a.value.map(g=>g.name));h();function i(g){return n.value.findIndex(y=>y.id==g)}function u(g){n.value.splice(i(g),1)}function c(g){n.value.push(g)}function m(g,y){n.value[i(g)]=y}async function p(g,y={}){const{data:_}=await Innoclapps.request().get(`/roles/${g}`,y);return _}async function f(g){await Innoclapps.request().delete(`/roles/${g}`),u(g)}function h(){e(!0),Innoclapps.request().get("/roles").then(({data:g})=>n.value=g).finally(()=>e(!1))}return{roles:n,rolesByName:a,rolesNames:r,rolesAreBeingFetched:t,addRole:c,removeRole:u,setRole:m,fetchRoles:h,fetchRole:p,deleteRole:f}}),j3={class:"my-4 whitespace-nowrap text-lg/6 font-medium text-neutral-800 dark:text-neutral-200"},L3=["textContent"],H3={class:"flex justify-between"},G3={class:"text-sm text-neutral-600 dark:text-neutral-300"},K3=["onClick"],Y3={class:"py-1"},As={__name:"RolesFormFields",props:{create:Boolean,form:{required:!0,type:Object}},setup(e,{expose:t}){const n=e,{t:a}=ve(),{setLoading:r,isLoading:i}=Ct(),u=q([]),c=q({all:[],grouped:{}}),m=q(null);function p(_){if(_.single)return u.value.indexOf(_.keys[0])>-1?a("core::role.granted"):a("core::role.revoked");for(let I in _.keys)if(u.value.indexOf(_.keys[I])>-1)return _.permissions[_.keys[I]];return a("core::role.revoked")}function f(_,I){h(_),u.value.push(I),Fe(()=>{n.form.permissions=u.value})}function h(_){for(let I in _.keys){let F=u.value.indexOf(_.keys[I]);F!=-1&&u.value.splice(F,1)}}function g(_){for(let I in _.grouped)_.grouped[I].views.forEach(F=>{F.single||f(F,Object.keys(F.permissions)[0])})}function y(){r(!0),Innoclapps.request().get("/permissions").then(({data:_})=>{if(c.value=_,!n.create){u.value=n.form.permissions;return}g(_)}).finally(()=>r(!1))}return y(),t({nameRef:m}),(_,I)=>{const F=v("IFormInput"),$=v("IFormError"),C=v("IFormGroup"),w=v("Icon"),x=v("IDropdownItem"),A=v("IDropdown"),N=v("IOverlay"),T=ae("t");return d(),k(te,null,[s(C,{"label-for":"name",label:_.$t("core::role.name"),required:""},{default:b(()=>[s(F,{id:"name",ref_key:"nameRef",ref:m,modelValue:e.form.name,"onUpdate:modelValue":I[0]||(I[0]=E=>e.form.name=E),name:"name",type:"text"},null,8,["modelValue"]),s($,{textContent:S(e.form.getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(N,{show:l(i),class:"mt-5"},{default:b(()=>[D(o("div",null,[D(o("h3",j3,null,512),[[T,"core::role.permissions"]]),(d(!0),k(te,null,re(c.value.grouped,(E,B)=>(d(),k("div",{key:B,class:"mb-4"},[o("p",{class:"mb-1 font-medium text-neutral-700 dark:text-neutral-200",textContent:S(E.as)},null,8,L3),(d(!0),k(te,null,re(E.views,z=>(d(),k("div",{key:z.group},[o("div",H3,[o("p",G3,S(z.as?z.as:z.single?z.permissions[z.keys[0]]:""),1),s(A,{placement:"bottom-end"},{toggle:b(({toggle:M})=>[o("button",{type:"button",class:"link inline-flex items-center text-sm",onClick:M},[Q(S(p(z))+" ",1),s(w,{icon:"ChevronDown",class:"ml-1 h-5 w-5"})],8,K3)]),default:b(()=>[o("div",Y3,[D(s(x,{text:_.$t("core::role.revoked"),onClick:M=>h(z)},null,8,["text","onClick"]),[[Y,z.revokeable]]),z.single?(d(),R(x,{key:0,text:_.$t("core::role.granted"),onClick:M=>f(z,z.keys[0])},null,8,["text","onClick"])):(d(!0),k(te,{key:1},re(z.permissions,(M,j)=>(d(),R(x,{key:j,disabled:u.value.indexOf(j)>-1,text:M,onClick:U=>f(z,j)},null,8,["disabled","text","onClick"]))),128))])]),_:2},1024)])]))),128))]))),128))],512),[[Y,c.value.all.length>0]])]),_:1},8,["show"])],64)}}},W3={__name:"RolesCreate",setup(e){const{t}=ve(),n=q(null),a=Qe(),{addRole:r}=_o(),{form:i}=Ae({name:null,permissions:[]});function u(){n.value.nameRef.focus()}function c(){i.post("/roles").then(m=>{r(m),Innoclapps.success(t("core::role.created")),a.back()})}return(m,p)=>{const f=v("ISlideover");return d(),R(f,{"ok-disabled":l(i).busy,"ok-title":m.$t("core::app.create"),title:m.$t("core::role.create"),visible:"",form:"","static-backdrop":"",onSubmit:c,onKeydown:p[0]||(p[0]=h=>l(i).onKeydown(h)),onHidden:m.$router.back,onShown:u},{default:b(()=>[s(As,{ref_key:"formRef",ref:n,form:l(i),create:!0},null,8,["form"])]),_:1},8,["ok-disabled","ok-title","title","onHidden"])}}},Q3={__name:"RolesEdit",setup(e){const{t}=ve(),n=Ye(),a=Qe(),{fetchRole:r,setRole:i}=_o(),u=q(!1),{form:c}=Ae(),m=V(()=>t("core::role.edit")+" "+c.name);function p(){c.put(`/roles/${n.params.id}`).then(h=>{i(h.id,h),Innoclapps.success(t("core::role.updated")),a.back()})}async function f(h){const g=await r(h);c.set({...g,permissions:g.permissions.map(y=>y.name)}),Fe(()=>u.value=!0)}return f(n.params.id),(h,g)=>{const y=v("FieldsPlaceholder"),_=v("ISlideover");return d(),R(_,{"ok-title":h.$t("core::app.save"),"ok-disabled":l(c).busy,title:m.value,visible:"",form:"","static-backdrop":"",onSubmit:p,onKeydown:g[0]||(g[0]=I=>l(c).onKeydown(I)),onHidden:h.$router.back},{default:b(()=>[u.value?(d(),R(As,{key:1,form:l(c)},null,8,["form"])):(d(),R(y,{key:0}))]),_:1},8,["ok-title","ok-disabled","title","onHidden"])}}},X3={class:"text-left",width:"5%"},Z3={class:"text-left"},J3=o("th",{class:"text-left"},null,-1),e4=["textContent"],t4={class:"flex justify-end"},n4={__name:"RolesIndex",setup(e){const{t}=ve(),{rolesByName:n,rolesAreBeingFetched:a,deleteRole:r}=_o(),i=V(()=>n.value.length>0);async function u(c){await Innoclapps.dialog().confirm(),await r(c),Innoclapps.success(t("core::role.deleted"))}return(c,m)=>{const p=v("IButton"),f=v("router-link"),h=v("IDropdownItem"),g=v("IMinimalDropdown"),y=v("ITable"),_=v("IEmptyState"),I=v("ICardBody"),F=v("ICard"),$=v("router-view"),C=ae("t");return d(),k(te,null,[s(F,{header:c.$t("core::role.roles"),"no-body":"",overlay:l(a)},{actions:b(()=>[D(s(p,{icon:"Plus",to:{name:"create-role"},size:"sm",text:c.$t("core::role.create")},null,8,["text"]),[[Y,i.value]])]),default:b(()=>[i.value?(d(),R(y,{key:0,class:"-mt-px"},{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",X3,null,512),[[C,"core::app.id"]]),D(o("th",Z3,null,512),[[C,"core::role.name"]]),J3])]),o("tbody",null,[(d(!0),k(te,null,re(l(n),w=>(d(),k("tr",{key:w.id},[o("td",{textContent:S(w.id)},null,8,e4),o("td",null,[s(f,{class:"link",to:{name:"edit-role",params:{id:w.id}}},{default:b(()=>[Q(S(w.name),1)]),_:2},1032,["to"])]),o("td",t4,[s(g,null,{default:b(()=>[s(h,{to:{name:"edit-role",params:{id:w.id}},text:c.$t("core::app.edit")},null,8,["to","text"]),s(h,{text:c.$t("core::app.delete"),onClick:x=>u(w.id)},null,8,["text","onClick"])]),_:2},1024)])]))),128))])]),_:1})):l(a)?O("",!0):(d(),R(I,{key:1},{default:b(()=>[s(_,{to:{name:"create-role"},"button-text":c.$t("core::role.create"),title:c.$t("core::role.empty_state.title"),description:c.$t("core::role.empty_state.description")},null,8,["button-text","title","description"])]),_:1}))]),_:1},8,["header","overlay"]),s($)],64)}}},o4={class:"mb-5 flex items-center justify-between"},l4={class:"whitespace-nowrap text-lg/6 font-medium text-neutral-800 dark:text-white"},a4={class:"space-x-3"},ul="users",s4={__name:"UsersIndex",setup(e){const t=Innoclapps.resourceName("users"),n=Pe(),{resetStoreState:a}=Le(),{reloadTable:r}=Bt(),i=q(!1),u=q(null);function c(m){m.destroyable&&(m.ids.forEach(p=>n.commit("users/REMOVE",p)),u.value.refetchActions())}return rt("action-executed",c),on(()=>{a()}),(m,p)=>{const f=v("IButton"),h=v("router-view"),g=ae("t");return d(),k(te,null,[o("div",o4,[D(o("h3",l4,null,512),[[g,"users::user.users"]]),o("div",a4,[s(f,{variant:"secondary",size:"sm",icon:"Mail",disabled:!i.value,to:{name:"invite-user"},text:m.$t("users::user.invite")},null,8,["disabled","text"]),s(f,{variant:"primary",size:"sm",icon:"Plus",disabled:!i.value,to:{name:"create-user"},text:m.$t("users::user.create")},null,8,["disabled","text"])])]),s(l(tn),{ref_key:"tableRef",ref:u,"resource-name":l(t),"table-id":ul,"with-customize-button":!0,onLoaded:p[0]||(p[0]=y=>i.value=!0)},null,8,["resource-name"]),s(h,{name:"createEdit",onCreated:p[1]||(p[1]=y=>l(r)(ul)),onUpdated:p[2]||(p[2]=y=>l(r)(ul)),onHidden:p[3]||(p[3]=y=>m.$router.push({name:"users-index"}))}),s(h,{name:"invite"})],64)}}},r4={__name:"SettingsManageUsers",setup(e){const t=Ye(),n=Qe(),a=q(0);function r(){a.value===0&&!["create-user","edit-user","invite-user"].includes(t.name)?n.push({name:"users-index"}):a.value===1&&!["create-role","edit-role"].includes(t.name)?n.push({name:"role-index"}):a.value===2&&n.push({name:"manage-teams"})}return yn((i,u,c)=>{i.name==="users-index"&&(a.value=0),c()}),["role-index","create-role","edit-role"].includes(t.name)?a.value=1:t.name==="manage-teams"&&(a.value=2),(i,u)=>{const c=v("ITab"),m=v("ITabList"),p=v("ITabPanel"),f=v("router-view"),h=v("ITabPanels"),g=v("ITabGroup");return d(),R(g,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=y=>a.value=y)},{default:b(()=>[s(m,null,{default:b(()=>[s(c,{title:i.$t("users::user.users"),icon:"User",onActivated:r},null,8,["title"]),s(c,{title:i.$t("core::role.roles"),icon:"ShieldExclamation",onActivated:r},null,8,["title"]),s(c,{title:i.$t("users::team.teams"),icon:"UserGroup",onActivated:r},null,8,["title"])]),_:1}),s(h,null,{default:b(()=>[s(p,{lazy:""},{default:b(()=>[s(s4)]),_:1}),s(p,null,{default:b(()=>[s(f,{name:"roles"})]),_:1}),s(p,null,{default:b(()=>[s(f,{name:"teams"})]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},i4={class:"grow"},u4={class:"text-sm text-neutral-900 dark:text-neutral-200"},d4={class:"text-neutral-700 dark:text-neutral-400"},c4={class:"ms-3"},m4={class:"grow"},p4={class:"text-sm text-neutral-900 dark:text-neutral-200"},f4={class:"text-neutral-700 dark:text-neutral-400"},v4={class:"ms-3"},Bs={__name:"UserFormFields",props:{isEdit:Boolean,form:{required:!0,type:Object}},setup(e){const t=e,{currentUser:n}=Le(),{rolesNames:a}=_o(),r=V(()=>n.value.id===t.form.id);function i(u){u&&(t.form.access_api=!0)}return(u,c)=>{const m=v("ITab"),p=v("ITabList"),f=v("IFormInput"),h=v("IFormError"),g=v("IFormGroup"),y=v("ICustomSelect"),_=v("ITabPanel"),I=v("ITabPanels"),F=v("IFormToggle"),$=v("ITabGroup"),C=ae("t");return d(),R($,null,{default:b(()=>[s(p,{fill:""},{default:b(()=>[s(m,{title:u.$t("users::user.user")},null,8,["title"]),s(m,{title:u.$t("auth.password")},null,8,["title"]),s(m,{title:u.$t("users::user.localization")},null,8,["title"]),s(m,{title:u.$t("core::notifications.notifications")},null,8,["title"]),s(m,{title:u.$t("core::app.advanced")},null,8,["title"])]),_:1}),s(I,null,{default:b(()=>[s(_,null,{default:b(()=>[s(g,{label:u.$t("users::user.name"),"label-for":"name",required:""},{default:b(()=>[s(f,{id:"name",ref:"name",modelValue:e.form.name,"onUpdate:modelValue":c[0]||(c[0]=w=>e.form.name=w),type:"text",autocomplete:"off"},null,8,["modelValue"]),s(h,{textContent:S(e.form.getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(g,{label:u.$t("users::user.email"),"label-for":"email",required:""},{default:b(()=>[s(f,{id:"email",modelValue:e.form.email,"onUpdate:modelValue":c[1]||(c[1]=w=>e.form.email=w),name:"email",type:"email",autocomplete:"off"},null,8,["modelValue"]),s(h,{textContent:S(e.form.getError("email"))},null,8,["textContent"])]),_:1},8,["label"]),s(g,{label:u.$t("core::role.roles"),"label-for":"roles"},{default:b(()=>[s(y,{modelValue:e.form.roles,"onUpdate:modelValue":c[2]||(c[2]=w=>e.form.roles=w),"input-id":"roles",placeholder:u.$t("users::user.roles"),options:l(a),multiple:!0},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"])]),_:1}),s(_,null,{default:b(()=>[s(g,{label:u.$t("auth.password"),"label-for":"password",required:!e.isEdit},{default:b(()=>[s(f,{id:"password",modelValue:e.form.password,"onUpdate:modelValue":c[3]||(c[3]=w=>e.form.password=w),name:"password",type:"password",autocomplete:"new-password"},null,8,["modelValue"]),s(h,{textContent:S(e.form.getError("password"))},null,8,["textContent"])]),_:1},8,["label","required"]),s(g,{label:u.$t("auth.confirm_password"),"label-for":"password_confirmation",required:!e.isEdit||!!e.form.password},{default:b(()=>[s(f,{id:"password_confirmation",modelValue:e.form.password_confirmation,"onUpdate:modelValue":c[4]||(c[4]=w=>e.form.password_confirmation=w),name:"password_confirmation",autocomplete:"new-password",type:"password"},null,8,["modelValue"]),s(h,{textContent:S(e.form.getError("password_confirmation"))},null,8,["textContent"])]),_:1},8,["label","required"]),s(qs)]),_:1}),s(_,null,{default:b(()=>[s(Zo,{form:e.form,"onUpdate:firstDayOfWeek":c[5]||(c[5]=w=>e.form.first_day_of_week=w),"onUpdate:timeFormat":c[6]||(c[6]=w=>e.form.time_format=w),"onUpdate:dateFormat":c[7]||(c[7]=w=>e.form.date_format=w),"onUpdate:locale":c[8]||(c[8]=w=>e.form.locale=w),"onUpdate:timezone":c[9]||(c[9]=w=>e.form.timezone=w)},null,8,["form"])]),_:1})]),_:1}),s(_,null,{default:b(()=>[e.form.notifications_settings?(d(),R(Es,{key:0,class:"overflow-hidden rounded-md border-x border-b border-neutral-200 dark:border-neutral-800",form:e.form},null,8,["form"])):O("",!0)]),_:1}),s(_,null,{default:b(()=>[o("div",{class:X(["flex items-center rounded-md border-2 px-5 py-4 shadow-sm",e.form.super_admin?"border-primary-400":"border-neutral-200 dark:border-neutral-400"])},[o("div",i4,[D(o("p",u4,null,512),[[C,"users::user.super_admin"]]),D(o("small",d4,null,512),[[C,"users::user.as_super_admin_info"]])]),o("div",c4,[s(F,{modelValue:e.form.super_admin,"onUpdate:modelValue":c[10]||(c[10]=w=>e.form.super_admin=w),disabled:r.value,onChange:i},null,8,["modelValue","disabled"])])],2),o("div",{class:X(["mt-3 flex items-center rounded-md border-2 px-5 py-4 shadow-sm",e.form.access_api?"border-primary-400":"border-neutral-200 dark:border-neutral-400"])},[o("div",m4,[D(o("p",p4,null,512),[[C,"users::user.enable_api"]]),D(o("small",f4,null,512),[[C,"users::user.allow_api_info"]])]),o("div",v4,[s(F,{modelValue:e.form.access_api,"onUpdate:modelValue":c[11]||(c[11]=w=>e.form.access_api=w),disabled:r.value||e.form.super_admin},null,8,["modelValue","disabled"])])],2)]),_:1})]),_:1})}}},b4={__name:"UsersCreate",emits:["created","hidden"],setup(e,{emit:t}){const{t:n}=ve(),a=Qe(),r=Pe(),{form:i}=Ae({name:null,email:null,roles:[],password:null,password_confirmation:null,timezone:moment.tz.guess(),locale:"en",date_format:r.state.settings.date_format,time_format:r.state.settings.time_format,first_day_of_week:r.state.settings.first_day_of_week,notifications_settings:Ko(Innoclapps.config("notifications_settings"),function(c,m){let p={};return m.channels.forEach(f=>p[f]=!0),c[m.key]=p,c},{}),super_admin:!1,access_api:!1,avatar:null});async function u(){const c=await r.dispatch("users/store",i).catch(m=>(m.isValidationError()&&Innoclapps.error(n("core::app.form_validation_failed_with_sections"),3e3),Promise.reject(m)));t("created",c),Innoclapps.success(n("core::resource.created")),a.back()}return(c,m)=>{const p=v("ISlideover");return d(),R(p,{"ok-disabled":l(i).busy,"ok-loading":l(i).busy,"ok-title":c.$t("core::app.create"),title:c.$t("users::user.create"),form:"",visible:"","static-backdrop":"",onHidden:m[0]||(m[0]=f=>c.$emit("hidden")),onShown:m[1]||(m[1]=()=>c.$refs.formRef.$refs.name.focus()),onKeydown:m[2]||(m[2]=f=>l(i).onKeydown(f)),onSubmit:u},{default:b(()=>[s(Bs,{ref:"formRef",form:l(i)},null,8,["form"])]),_:1},8,["ok-disabled","ok-loading","ok-title","title"])}}},h4={__name:"UsersEdit",emits:["updated","hidden"],setup(e,{emit:t}){const{t:n}=ve(),a=Qe(),r=Ye(),i=Pe(),{currentUser:u}=Le(),{form:c}=Ae(),m=q(!1),p=q(null);function f(){i.dispatch("users/update",{form:c,id:r.params.id}).then(g=>{Innoclapps.success(n("core::resource.updated")),g.locale!==p.value&&g.id==u.value.id?window.location.reload(!0):(t("updated",g),a.back())}).catch(g=>(g.isValidationError()&&Innoclapps.error(n("core::app.form_validation_failed_with_sections"),3e3),Promise.reject(g)))}function h(){i.dispatch("users/get",r.params.id).then(g=>{p.value=g.locale,c.set({name:g.name,email:g.email,roles:g.roles.map(y=>y.name),password:null,password_confirmation:null,timezone:g.timezone,locale:g.locale,date_format:g.date_format,time_format:g.time_format,first_day_of_week:g.first_day_of_week,notifications_settings:Ko(g.notifications.settings,function(y,_){return y[_.key]=_.availability,y},{}),super_admin:g.super_admin,access_api:g.access_api}),m.value=!0})}return h(),(g,y)=>{const _=v("FieldsPlaceholder"),I=v("ISlideover");return d(),R(I,{"ok-title":g.$t("core::app.save"),"ok-disabled":l(c).busy,"ok-loading":l(c).busy,title:g.$t("users::user.edit"),form:"",visible:"","static-backdrop":"",onHidden:y[0]||(y[0]=F=>g.$emit("hidden")),onSubmit:f},{default:b(()=>[m.value?O("",!0):(d(),R(_,{key:0})),D(o("div",null,[s(Bs,{form:l(c),"is-edit":""},null,8,["form"])],512),[[Y,m.value]])]),_:1},8,["ok-title","ok-disabled","ok-loading","title"])}}},_4={class:"text-sm text-neutral-700 dark:text-white"},g4=o("div",{class:"mb-4 border-b border-neutral-200 pt-4 dark:border-neutral-700"},null,-1),y4={class:"mb-3 flex"},x4={class:"relative mb-3"},I4={class:"grow"},k4={class:"text-sm text-neutral-900 dark:text-neutral-200"},$4={class:"text-neutral-700 dark:text-neutral-300"},w4={class:"ml-3"},C4={class:"grow"},S4={class:"text-sm text-neutral-900 dark:text-neutral-200"},R4={class:"text-neutral-700 dark:text-neutral-300"},F4={class:"ml-3"},V4={__name:"UsersInvite",setup(e){const t=Innoclapps.config("invitation.expires_after"),{t:n}=ve(),a=Qe(),r=q([]),{rolesNames:i}=_o(),{teamsByName:u}=Qo(),{form:c}=Ae({emails:[""],access_api:!1,super_admin:!1,roles:[]}),m=V(()=>c.emails.length);function p(){c.emails.push(""),Fe(()=>{r.value[m.value-1].focus()})}function f(_){c.emails.splice(_,1),Fe(()=>{c.emails[m.value-1]===""&&r.value[m.value-1].focus()})}function h(){Fe(()=>{r.value[0].focus()})}function g(_){_&&(c.access_api=!0)}function y(){c.post("/users/invite").then(()=>{Innoclapps.success(n("users::user.invited")),a.back()})}return(_,I)=>{const F=v("IFormLabel"),$=v("IButtonIcon"),C=v("IFormInput"),w=v("IFormError"),x=v("ICustomSelect"),A=v("IFormGroup"),N=v("IFormToggle"),T=v("IModal"),E=ae("i-tooltip"),B=ae("t");return d(),R(T,{"ok-title":_.$t("users::user.send_invitation"),"ok-disabled":l(c).busy,title:_.$t("users::user.invite"),size:"sm",form:"","static-backdrop":"",visible:"",onSubmit:y,onKeydown:I[4]||(I[4]=z=>l(c).onKeydown(z)),onHidden:_.$router.back,onShown:h},{default:b(()=>[o("p",_4,S(_.$t("users::user.invitation_expires_after_info",{total:l(t)})),1),g4,o("div",y4,[s(F,{class:"grow text-neutral-900 dark:text-neutral-100",label:_.$t("users::user.email"),for:"email0",required:""},null,8,["label"]),D(s($,{icon:"Plus",onClick:p},null,512),[[E,_.$t("core::app.add_another")]])]),(d(!0),k(te,null,re(l(c).emails,(z,M)=>(d(),k("div",x4,[s(C,{id:"email"+M,ref_for:!0,ref_key:"emailsRef",ref:r,modelValue:l(c).emails[M],"onUpdate:modelValue":j=>l(c).emails[M]=j,type:"email",placeholder:_.$t("users::user.email"),onKeydown:[Tt(ie(p,["prevent","stop"]),["enter"]),j=>l(c).errors.clear("emails."+M)]},null,8,["id","modelValue","onUpdate:modelValue","placeholder","onKeydown"]),D(s($,{icon:"X",class:"absolute right-3 top-2.5",onClick:j=>f(M)},null,8,["onClick"]),[[Y,M>0]]),s(w,{textContent:S(l(c).getError("emails."+M))},null,8,["textContent"])]))),256)),s(A,{label:_.$t("core::role.roles"),"label-for":"roles",class:"mt-3"},{default:b(()=>[s(x,{modelValue:l(c).roles,"onUpdate:modelValue":I[0]||(I[0]=z=>l(c).roles=z),"input-id":"roles",placeholder:_.$t("users::user.roles"),options:l(i),label:"name",multiple:!0},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"]),s(A,{label:_.$t("users::team.teams"),"label-for":"teams"},{default:b(()=>[s(x,{modelValue:l(c).teams,"onUpdate:modelValue":I[1]||(I[1]=z=>l(c).teams=z),"input-id":"teams",placeholder:_.$t("users::team.teams"),options:l(u),label:"name",reduce:z=>z.id,multiple:!0},null,8,["modelValue","placeholder","options","reduce"])]),_:1},8,["label"]),o("div",{class:X(["flex items-center rounded-md border-2 px-5 py-4 shadow-sm",l(c).super_admin?"border-primary-400":"border-neutral-200 dark:border-neutral-400"])},[o("div",I4,[D(o("p",k4,null,512),[[B,"users::user.super_admin"]]),D(o("small",$4,null,512),[[B,"users::user.as_super_admin_info"]])]),o("div",w4,[s(N,{modelValue:l(c).super_admin,"onUpdate:modelValue":I[2]||(I[2]=z=>l(c).super_admin=z),onChange:g},null,8,["modelValue"])])],2),o("div",{class:X(["mt-3 flex items-center rounded-md border-2 px-5 py-4 shadow-sm",l(c).access_api?"border-primary-400":"border-neutral-200 dark:border-neutral-400"])},[o("div",C4,[D(o("p",S4,null,512),[[B,"users::user.enable_api"]]),D(o("small",R4,null,512),[[B,"users::user.allow_api_info"]])]),o("div",F4,[s(N,{modelValue:l(c).access_api,"onUpdate:modelValue":I[3]||(I[3]=z=>l(c).access_api=z),disabled:l(c).super_admin},null,8,["modelValue","disabled"])])],2)]),_:1},8,["ok-title","ok-disabled","title","onHidden"])}}},T4={key:0,role:"list",class:"divide-y divide-neutral-200 dark:divide-neutral-700"},D4=["onClick"],q4={class:"flex items-center px-4 py-4 sm:px-6"},E4={class:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between"},A4={class:"truncate"},B4={class:"flex items-center text-sm"},N4=["textContent"],O4=["onClick"],z4=["onClick"],M4={class:"mt-2 flex"},U4={class:"flex items-center text-sm text-neutral-500 dark:text-neutral-400"},P4=["datetime"],j4={class:"mt-4 shrink-0 sm:ml-5 sm:mt-0"},L4={class:"flex -space-x-1 overflow-hidden"},H4={class:"ml-5 shrink-0"},G4={class:"px-4 py-4 sm:px-6"},K4={class:"mb-1 text-sm font-medium text-neutral-800 dark:text-neutral-200"},Y4=["textContent"],W4={class:"my-2 text-sm font-medium text-neutral-800 dark:text-neutral-200"},Q4=["textContent"],X4={class:"mb-1 mt-3 text-sm font-medium text-neutral-800 dark:text-neutral-200"},Z4=["textContent"],J4={__name:"UsersManageTeams",setup(e){const t=Pe(),{users:n}=Le(),{localizedDateTime:a}=Ne(),{teamsByName:r,teamsAreBeingFetched:i,addTeam:u,deleteTeam:c,setTeam:m}=Qo(),p=q(!1),f=q(null),h=q(!1),g=q({}),{form:y}=Ae({name:null,description:null,user_id:null,members:[]},{resetOnSuccess:!0}),{form:_}=Ae({name:null,description:null,user_id:null,members:[]},{resetOnSuccess:!0}),I=V(()=>r.value.length>0);function F(){y.post("/teams").then(x=>{u(x),p.value=!1,h.value=!0})}function $(){_.put(`/teams/${f.value}`).then(x=>{m(x.id,x),f.value=null,h.value=!0})}async function C(x){await Innoclapps.dialog().confirm(),await c(x),h.value=!0}function w(x){f.value=x.id,_.fill("name",x.name),_.fill("user_id",x.user_id),_.fill("members",x.members.map(A=>A.id)),_.fill("description",x.description)}return Dn(()=>{h.value&&t.commit("table/RESET_SETTINGS")}),(x,A)=>{const N=v("IButton"),T=v("Icon"),E=v("IAvatar"),B=v("IEmptyState"),z=v("ICardBody"),M=v("ICard"),j=v("IFormInput"),U=v("IFormError"),P=v("IFormGroup"),H=v("ICustomSelect"),L=v("IFormTextarea"),Z=v("IModal"),J=ae("t"),K=ae("i-tooltip");return d(),k(te,null,[s(M,{header:x.$t("users::team.teams"),"no-body":"",overlay:l(i)},{actions:b(()=>[D(s(N,{icon:"Plus",text:x.$t("users::team.add"),size:"sm",onClick:A[0]||(A[0]=G=>p.value=!0)},null,8,["text"]),[[Y,I.value]])]),default:b(()=>[I.value?(d(),k("ul",T4,[(d(!0),k(te,null,re(l(r),G=>(d(),k("li",{key:G.id},[o("a",{href:"#",class:"group block hover:bg-neutral-50 dark:hover:bg-neutral-800/60",onClick:ie(oe=>g.value[G.id]=!g.value[G.id],["prevent"])},[o("div",q4,[o("div",E4,[o("div",A4,[o("div",B4,[o("p",{class:"truncate font-medium text-primary-600 dark:text-primary-100",textContent:S(G.name)},null,8,N4),D(o("a",{href:"#",class:"link ml-2 text-sm md:hidden md:group-hover:block",onClick:ie(oe=>w(G),["prevent","stop"])},null,8,O4),[[J,"core::app.edit"]]),D(o("a",{href:"#",class:"ml-2 text-sm text-danger-500 hover:text-danger-600 focus:outline-none md:hidden md:group-hover:block",onClick:ie(oe=>C(G.id),["prevent","stop"])},null,8,z4),[[J,"core::app.delete"]])]),o("div",M4,[o("div",U4,[s(T,{icon:"Calendar",class:"mr-1.5 h-5 w-5 shrink-0 text-neutral-400 dark:text-neutral-300"}),o("p",null,[Q(S(x.$t("core::app.created_at"))+" "+S(" ")+" ",1),o("time",{datetime:G.created_at},S(l(a)(G.created_at)),9,P4)])])])]),o("div",j4,[o("div",L4,[(d(!0),k(te,null,re(G.members,oe=>D((d(),R(E,{key:oe.email,alt:oe.name,size:"xs",src:oe.avatar_url,class:"ring-2 ring-white dark:ring-neutral-900"},null,8,["alt","src"])),[[K,oe.name]])),128))])])]),o("div",H4,[s(T,{icon:"ChevronRight",class:"h-5 w-5 text-neutral-400"})])])],8,D4),D(o("div",G4,[D(o("p",K4,null,512),[[J,"users::team.manager"]]),o("p",{class:"mb-3 text-sm text-neutral-700 dark:text-neutral-300",textContent:S(G.manager.name)},null,8,Y4),D(o("p",W4,null,512),[[J,"users::team.members"]]),(d(!0),k(te,null,re(G.members,oe=>(d(),k("div",{key:"info-"+oe.email,class:"mb-1 flex items-center space-x-1.5 last:mb-0"},[s(E,{alt:oe.name,size:"xs",src:oe.avatar_url},null,8,["alt","src"]),o("p",{class:"text-sm font-medium text-neutral-700 dark:text-neutral-300",textContent:S(oe.name)},null,8,Q4)]))),128)),D(o("p",X4,null,512),[[Y,G.description],[J,"users::team.description"]]),o("p",{class:"text-sm text-neutral-700 dark:text-neutral-300",textContent:S(G.description)},null,8,Z4)],512),[[Y,g.value[G.id]]])]))),128))])):l(i)?O("",!0):(d(),R(z,{key:1},{default:b(()=>[s(B,{"button-text":x.$t("users::team.add"),title:x.$t("users::team.empty_state.title"),description:x.$t("users::team.empty_state.description"),onClick:A[1]||(A[1]=G=>p.value=!0)},null,8,["button-text","title","description"])]),_:1}))]),_:1},8,["header","overlay"]),s(Z,{title:x.$t("users::team.create"),form:"",visible:p.value,"ok-title":x.$t("core::app.create"),"ok-disabled":l(y).busy,onHidden:A[9]||(A[9]=G=>p.value=!1),onSubmit:F,onShown:A[10]||(A[10]=()=>x.$refs.nameInputCreateRef.focus())},{default:b(()=>[s(P,{for:"nameInputCreate",label:x.$t("users::team.name"),required:""},{default:b(()=>[s(j,{id:"nameInputCreate",ref:"nameInputCreateRef",modelValue:l(y).name,"onUpdate:modelValue":A[2]||(A[2]=G=>l(y).name=G),onKeydown:A[3]||(A[3]=G=>l(y).errors.clear("name"))},null,8,["modelValue"]),s(U,{textContent:S(l(y).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(P,{"label-for":"user_id",label:x.$t("users::team.manager"),required:""},{default:b(()=>[s(H,{modelValue:l(y).user_id,"onUpdate:modelValue":A[4]||(A[4]=G=>l(y).user_id=G),options:l(n),clearable:!1,label:"name",reduce:G=>G.id,"input-id":"user_id"},null,8,["modelValue","options","reduce"]),s(U,{textContent:S(l(y).getError("user_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(P,{for:"membersInputCreate",label:x.$t("users::team.members")},{default:b(()=>[s(H,{id:"membersInputCreate",modelValue:l(y).members,"onUpdate:modelValue":[A[5]||(A[5]=G=>l(y).members=G),A[6]||(A[6]=G=>l(y).errors.clear("members"))],options:l(n),label:"name",multiple:"",reduce:G=>G.id},null,8,["modelValue","options","reduce"])]),_:1},8,["label"]),s(P,{for:"descriptionInputCreate",label:x.$t("users::team.description")},{default:b(()=>[s(L,{id:"descriptionInputCreate",modelValue:l(y).description,"onUpdate:modelValue":A[7]||(A[7]=G=>l(y).description=G),onKeydown:A[8]||(A[8]=G=>l(y).errors.clear("description"))},null,8,["modelValue"]),s(U,{textContent:S(l(y).getError("description"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1},8,["title","visible","ok-title","ok-disabled"]),s(Z,{form:"",visible:f.value!==null,"ok-title":x.$t("core::app.save"),"ok-disabled":l(_).busy,title:x.$t("users::team.edit"),onHidden:A[18]||(A[18]=G=>{f.value=null,l(_).reset()}),onSubmit:$},{default:b(()=>[s(P,{for:"nameInputEdit",label:x.$t("users::team.name"),required:""},{default:b(()=>[s(j,{id:"nameInputEdit",ref:"nameInputEdit",modelValue:l(_).name,"onUpdate:modelValue":A[11]||(A[11]=G=>l(_).name=G),onKeydown:A[12]||(A[12]=G=>l(_).errors.clear("name"))},null,8,["modelValue"]),s(U,{textContent:S(l(_).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(P,{"label-for":"user_id",label:x.$t("users::team.manager"),required:""},{default:b(()=>[s(H,{modelValue:l(_).user_id,"onUpdate:modelValue":A[13]||(A[13]=G=>l(_).user_id=G),options:l(n),clearable:!1,label:"name",reduce:G=>G.id,"input-id":"user_id"},null,8,["modelValue","options","reduce"]),s(U,{textContent:S(l(_).getError("user_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(P,{for:"membersInputEdit",label:x.$t("users::team.members")},{default:b(()=>[s(H,{id:"membersInputEdit",modelValue:l(_).members,"onUpdate:modelValue":[A[14]||(A[14]=G=>l(_).members=G),A[15]||(A[15]=G=>l(_).errors.clear("members"))],options:l(n),label:"name",multiple:"",reduce:G=>G.id},null,8,["modelValue","options","reduce"])]),_:1},8,["label"]),s(P,{for:"descriptionInputEdit",label:x.$t("users::team.description")},{default:b(()=>[s(L,{id:"descriptionInputEdit",modelValue:l(_).description,"onUpdate:modelValue":A[16]||(A[16]=G=>l(_).description=G),onKeydown:A[17]||(A[17]=G=>l(_).errors.clear("description"))},null,8,["modelValue"]),s(U,{textContent:S(l(_).getError("description"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1},8,["visible","ok-title","ok-disabled","title"])],64)}}},eR=[{path:"users",component:r4,name:"users-index",meta:{title:qe.t("users::user.users")},children:[{path:"create",name:"create-user",components:{createEdit:b4},meta:{title:qe.t("users::user.create")}},{path:":id/edit",name:"edit-user",components:{createEdit:h4},meta:{title:qe.t("users::user.edit")}},{path:"invite",name:"invite-user",components:{invite:V4},meta:{title:qe.t("users::user.invite")}},{path:"roles",name:"role-index",components:{roles:n4},meta:{title:qe.t("core::role.roles")},children:[{path:"create",name:"create-role",component:W3,meta:{title:qe.t("core::role.create")}},{path:":id/edit",name:"edit-role",component:Q3,meta:{title:qe.t("core::role.edit")}}]},{path:"teams",name:"manage-teams",components:{teams:J4},meta:{title:qe.t("users::team.teams")}}]}];window.Innoclapps&&Innoclapps.booting((e,t,n)=>{e.component("UserInvitationAcceptForm",JS),n.registerModule("users",l5),n.commit("users/SET",Innoclapps.config("users")||[]),e.use(XS,n.getters["users/current"]),config.user_id&&WS(config.user_id,a=>{Innoclapps.request().get(`/notifications/${a.id}`).then(({data:r})=>{n.commit("users/NEW_NOTIFICATION",r)})}),eR.forEach(a=>t.addRoute("settings",a)),t.addRoute({path:"/profile",name:"profile",component:P3,meta:{title:qe.t("users::profile.profile")}}),t.addRoute({path:"/personal-access-tokens",name:"personal-access-tokens",component:b5,meta:{title:qe.t("core::api.personal_access_tokens"),gate:"access-api"}})});const tR={class:"-mt-2 block text-right"},nR={class:"-mt-2 block text-right"},oR={class:"-mt-2 block text-right"},lR={__name:"CreateActivityModal",props:{visible:{type:Boolean,default:!0},goToList:{type:Boolean,default:!0},redirectToView:Boolean,withExtendedSubmitButtons:Boolean,title:String,note:{},description:{},activityTypeId:{},contacts:{},companies:{},deals:{},dueDate:{},endDate:{},reminderMinutesBefore:{}},emits:["created","modal-hidden","modal-shown","update:visible"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("activities"),{t:r}=ve(),i=Qe(),{fields:u,getCreateFields:c}=gt(),{form:m}=It(u),{createResource:p}=Je(a),f=q(!1),h=q(!1),g=q(!1),y=Kn(()=>null,()=>document.querySelector("#modalClose-createActivityModal"));mn(()=>n.visible,A,{immediate:!0});function _(){$().then(x)}function I(){$("create-another").then(N=>{m.reset(),x(N)})}function F(){$("go-to-list").then(x)}async function $(N=null){try{let E={activity:await p(m),isRegularAction:N===null,action:N};return t("created",E),Innoclapps.success(r("activities::activity.created")),E}catch(T){return T.isValidationError()&&Innoclapps.error(r("core::app.form_validation_failed"),3e3),Promise.reject(T)}}function C(){t("modal-shown"),y.trigger()}function w(){t("modal-hidden"),u.value.set([])}function x(N){if(N.indexRoute={name:"activity-index"},N.action==="go-to-list")return i.push(N.indexRoute);if(N.action!=="create-another"&&n.redirectToView){let T=N.activity;i.activity=T,i.push({name:"view-activity",params:{id:T.id}})}}async function A(){u.value.set(_t(nt(await c(a)),N=>(["contacts","companies","deals","title","note","description"].indexOf(N.attribute)>-1?N.value=n[N.attribute]:N.attribute==="activity_type_id"&&n.activityTypeId?N.value=n.activityTypeId:N.attribute==="due_date"&&n.dueDate?N.value=n.dueDate:N.attribute==="end_date"&&n.endDate?N.value=n.endDate:N.attribute==="reminder_minutes_before"&&n.reminderMinutesBefore&&(N.value=n.reminderMinutesBefore),N)))}return(N,T)=>{const E=v("FieldsPlaceholder"),B=v("FormFields"),z=v("IDropdownItem"),M=v("IDropdownButtonGroup"),j=v("CreateDealModal"),U=v("CreateContactModal"),P=v("CreateCompanyModal"),H=v("ISlideover");return d(),R(H,{id:"createActivityModal",visible:e.visible,title:e.title||N.$t("activities::activity.create"),"ok-title":N.$t("core::app.create"),"ok-disabled":l(m).busy,"cancel-title":N.$t("core::app.cancel"),"initial-focus":l(y),"static-backdrop":"",form:"",onHidden:w,onShown:C,"onUpdate:visible":T[11]||(T[11]=L=>N.$emit("update:visible",L)),onSubmit:_},vt({default:b(()=>[l(u).isEmpty()?(d(),R(E,{key:0})):O("",!0),s(B,{fields:l(u),"form-id":l(m).formId,"resource-name":l(a),"is-floating":"","focus-first":""},{"after-deals-field":b(()=>[o("span",tR,[o("a",{href:"#",class:"link text-sm",onClick:T[0]||(T[0]=ie(L=>f.value=!0,["prevent"]))}," + "+S(N.$t("deals::deal.create")),1)])]),"after-companies-field":b(()=>[o("span",nR,[o("a",{href:"#",class:"link text-sm",onClick:T[1]||(T[1]=ie(L=>g.value=!0,["prevent"]))}," + "+S(N.$t("contacts::company.create")),1)])]),"after-contacts-field":b(()=>[o("span",oR,[o("a",{href:"#",class:"link text-sm",onClick:T[2]||(T[2]=ie(L=>h.value=!0,["prevent"]))}," + "+S(N.$t("contacts::contact.create")),1)])]),_:1},8,["fields","form-id","resource-name"]),s(j,{visible:f.value,"onUpdate:visible":T[3]||(T[3]=L=>f.value=L),overlay:!1,onCreated:T[4]||(T[4]=L=>(l(u).mergeValue("deals",L.deal),f.value=!1))},null,8,["visible"]),s(U,{visible:h.value,"onUpdate:visible":T[5]||(T[5]=L=>h.value=L),overlay:!1,onCreated:T[6]||(T[6]=L=>(l(u).mergeValue("contacts",L.contact),h.value=!1)),onRestored:T[7]||(T[7]=L=>(l(u).mergeValue("contacts",L),h.value=!1))},null,8,["visible"]),s(P,{visible:g.value,"onUpdate:visible":T[8]||(T[8]=L=>g.value=L),overlay:!1,onCreated:T[9]||(T[9]=L=>(l(u).mergeValue("companies",L.company),g.value=!1)),onRestored:T[10]||(T[10]=L=>(l(u).mergeValue("companies",L),g.value=!1))},null,8,["visible"])]),_:2},[e.withExtendedSubmitButtons?{name:"modal-ok",fn:b(()=>[s(M,{type:"submit",placement:"top-end",disabled:l(m).busy,loading:l(m).busy,text:N.$t("core::app.create")},{default:b(()=>[s(z,{text:N.$t("core::app.create_and_add_another"),onClick:I},null,8,["text"]),e.goToList?(d(),R(z,{key:0,text:N.$t("core::app.create_and_go_to_list"),onClick:F},null,8,["text"])):O("",!0)]),_:1},8,["disabled","loading","text"])]),key:"0"}:void 0]),1032,["visible","title","ok-title","ok-disabled","cancel-title","initial-focus"])}}},aR=["v-tooltip-placement"],sR=["onClick"],rR={key:1,class:"flex h-4 w-4 items-center justify-center rounded-full border"},Jo={__name:"ActivityStateChange",props:{activityId:{required:!0,type:Number},isCompleted:{required:!0,type:Boolean},tooltipPlacement:{type:String,default:"top"},disabled:Boolean},emits:["state-changed"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{updateResource:r,resourceBeingUpdated:i}=Je(Innoclapps.resourceName("activities")),u=V(()=>{let p=["inline-block mr-0.5 focus:outline-none"];return n.isCompleted?p.push("text-success-500 hover:text-neutral-500 dark:text-success-400 dark:hover:text-neutral-300"):p.push("text-neutral-500 hover:text-success-600 dark:text-neutral-300 dark:hover:text-success-400"),(n.disabled||i.value)&&p.push("pointer-events-none opacity-60"),p}),c=V(()=>n.disabled?a("users::user.not_authorized"):n.isCompleted?a("activities::activity.mark_as_incomplete"):a("activities::activity.mark_as_completed"));function m(){r({is_completed:!n.isCompleted},n.activityId).then(p=>t("state-changed",p))}return(p,f)=>{const h=v("ISpinner"),g=v("Icon"),y=ae("i-tooltip");return D((d(),k("span",{class:"inline-block","v-tooltip-placement":e.tooltipPlacement},[o("a",{href:"#",class:X(u.value),onClick:ie(m,["prevent"])},[l(i)?(d(),R(h,{key:0,class:X(["h-4 w-4",{"text-success-500 dark:text-success-400":!e.isCompleted,"text-neutral-500 dark:text-neutral-300":e.isCompleted}])},null,8,["class"])):(d(),k("span",rR,[e.isCompleted?(d(),R(g,{key:0,icon:"Check"})):O("",!0)]))],10,sR)],8,aR)),[[y,c.value]])}}};const iR=["textContent"],uR={class:"flex items-center"},dR={class:"mr-1.5 mt-1"},cR={class:"flex items-center px-2.5 text-sm"},mR={__name:"MyActivitiesCard",props:{card:Object},setup(e){const t=q(null),n=q(!1);function a(){r(),n.value=!1}function r(){t.value.reload()}return(i,u)=>{const c=v("CreateActivityModal"),m=v("IButtonMinimal"),p=v("Icon"),f=v("router-link"),h=v("CardTableAsync");return d(),k(te,null,[s(c,{visible:n.value,onCreated:a,onModalHidden:u[0]||(u[0]=g=>n.value=!1)},null,8,["visible"]),s(h,{ref_key:"tableRef",ref:t,card:e.card},{actions:b(()=>[s(m,{variant:"primary",icon:"Plus",text:i.$t("activities::activity.create"),class:"hide-when-editing mt-2 text-[0.8rem] sm:mt-0",onClick:u[1]||(u[1]=g=>n.value=!0)},null,8,["text"])]),empty:b(g=>[o("div",{class:X(["flex flex-col justify-center",{"items-center py-4":!g.search&&!g.loading}])},[D(s(p,{icon:"Check",class:"h-9 w-9 text-success-500"},null,512),[[Y,!g.search&&!g.loading]]),o("p",{class:X(["text-neutral-500 dark:text-neutral-300",{"mt-2 text-lg":!g.search&&!g.loading}])},[D(o("span",{textContent:S(g.text)},null,8,iR),[[Y,g.loading]]),D(o("span",null,S(g.search?g.text:i.$t("core::app.all_caught_up")),513),[[Y,!g.loading]])],2)],2)]),title:b(({row:g,formatted:y})=>[o("div",uR,[o("div",dR,[s(Jo,{"activity-id":g.id,"is-completed":g.is_completed,disabled:!g.authorizations.changeState,onStateChanged:r},null,8,["activity-id","is-completed","disabled"])]),s(f,{class:"link",to:{name:"view-activity",params:{id:g.id}}},{default:b(()=>[Q(S(y),1)]),_:2},1032,["to"])])]),"type.name":b(({row:g,formatted:y})=>[s(zt,{color:g.type.swatch_color,class:"inline-flex items-center self-start rounded-full font-normal leading-5 dark:!text-white"},{default:b(()=>[o("span",cR,[s(p,{icon:g.type.icon,class:"mr-1.5 h-4 w-4"},null,8,["icon"]),Q(" "+S(y),1)])]),_:2},1032,["color"])]),_:1},8,["card"])],64)}}},pR=ct(mR,[["__scopeId","data-v-db457656"]]),fR={__name:"RecordTabActivity",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=e,n=V(()=>{const a=(t.resource.activities||[]).filter(i=>!i.is_completed);let r=t.resource.incomplete_activities_for_user_count;return r===0&&a.length>0?a.length:r});return(a,r)=>{const i=v("ITab");return St([n.value],()=>s(i,{badge:n.value,"badge-variant":"danger",title:a.$t("activities::activity.activities"),icon:"Calendar"},null,8,["badge","title"]),r,0)}}};function Xn(e){const t=q(1),n=q(null),a=q(null),r=q(!1),i=q(e.perPage||15),{gate:u}=On(),c=V(()=>n.value!==null),m=V(()=>a.value&&a.value.length>0);function p(F){if(e.infinityRef.value.state.reset(),t.value=1,!F){f(),n.value=null,a.value=null;return}a.value=[],n.value=F,f(!0)}function f(F=!1){e.infinityRef.value.attemptLoad(F)}function h(F){e.handleInfinityResult?e.handleInfinityResult(F):e.synchronizeResource({[e.timelineRelation]:F.data})}function g(F,$){return $=$||i.value,e.makeRequestForData?e.makeRequestForData(F,$):Innoclapps.request().get(`${e.resource.value.path}/${e.timelineRelation}`,{params:{page:F,q:n.value,per_page:$,timeline:1}})}async function y(F){if(u.denies("view",e.resource.value)){F.complete();return}let $=null;if({data:$}=await g(t.value),$.data.length===0){c.value&&t.value===1&&(a.value=[]),F.complete(),r.value=!0;return}t.value+=1,c.value?a.value=m.value?a.value.concat(...$.data):$.data:(h($),Fe(()=>r.value=!0)),F.loaded()}function _(){g(1,i.value*t.value).then(({data:F})=>{F.data.length===0?e.synchronizeResource({[e.timelineRelation]:{_reset:[]}}):h(F)})}async function I(F,$){let{data:C}=await Innoclapps.request().get(`/${e.timelineRelation}/${F}`,{params:{via_resource:e.resource.valueName,via_resource_id:e.resource.value.id}});e.synchronizeResource({[e.timelineRelation]:[C]}),await Fe();const x=document.getElementById("tabPanel-"+e.timelineRelation).querySelector(`.${$}-${C.id}`),A=e.scrollElement?document.querySelector(e.scrollElement):window;x&&A.scrollTo({top:x.getBoundingClientRect().top,behavior:"smooth"})}return{focusToAssociateableElement:I,dataLoadedFirstTime:r,searchResults:a,hasSearchResults:m,infiniteHandler:y,search:n,loadData:f,performSearch:p,isSearching:c,defaultPerPage:i,refresh:_}}function ln(e,t){const n=Pe(),a=V(()=>n.state.comments.requestInProgress),r=V({set(p){n.commit("comments/SET_LOADED",{commentableId:e,commentableType:t,value:p})},get(){return n.getters["comments/areLoadedFor"](e,t)}}),i=V({set(p){n.commit("comments/SET_VISIBILITY",{commentableId:e,commentableType:t,visible:p})},get(){return n.getters["comments/areVisibleFor"](e,t)}}),u=V({set(p){n.commit("comments/SET_ADD_COMMENT_VISIBILITY",{commentableId:e,commentableType:t,value:p})},get(){return n.getters["comments/isCommentBeingCreatedFor"](e,t)}});function c(){i.value=!i.value}function m(p,f){return n.dispatch("comments/getAll",{resourceName:t,resourceId:e,viaResource:p,viaResourceId:f})}return{requestInProgress:a,commengIsBeingCreated:u,commentsAreLoaded:r,commentsAreVisible:i,getAllComments:m,toggleCommentsVisibility:c}}const vR=["textContent"],bR={class:"p-4"},hR=["onClick"],_R={class:"text-center text-sm text-neutral-600 dark:text-neutral-300"},gR=["textContent"],yR=["textContent"],xR=["href"],Ea=2,IR=5,vn={__name:"AssociationsPopover",props:{widthClass:{type:String,default:"w-72"},modelValue:Object,primaryResourceName:String,primaryRecordDisabled:Boolean,primaryRecord:Object,initialAssociateables:Object,associateables:[Object,Array],limitInitialAssociateables:{type:Number,default:3},disabled:Boolean,placement:{type:String,default:"bottom"},excludedResources:[String,Array]},emits:["update:modelValue","change"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{setLoading:r,isLoading:i}=Ct(),u=q(0),c=q(!1),m=q(""),p=q({}),f=q({}),h=q({}),g={},y={contacts:{title:a("contacts::contact.contacts"),resource:"contacts"},companies:{title:a("contacts::company.companies"),resource:"companies"},deals:{title:a("deals::deal.deals"),resource:"deals"}};n.excludedResources&&wt(n.excludedResources).forEach(P=>{delete y[P]});const _=V(()=>Ea-u.value),I=V(()=>a("core::app.search_records")),F=V(()=>!!n.primaryRecord),$=V(()=>En(Object.keys(y),P=>[P!==n.primaryResourceName,P])),C=V(()=>{let P=!1;return $.value.every(H=>(P=h.value[H]?h.value[H].records.length>0:!1,!P)),P}),w=V(()=>{if(C.value)return h.value;let P={},H=(L,Z)=>{Xe(P[L].records,["id",Number(Z.id)])===-1&&P[L].records.push(Z)};return $.value.forEach(L=>{P[L]=Object.assign({},y[L],{records:[]}),L===n.primaryResourceName&&F.value&&H(L,n.primaryRecord),n.initialAssociateables&&N(L).forEach(Z=>H(L,Z)),Array.isArray(n.associateables)?n.associateables.forEach((Z,J)=>{Object.keys(Z).forEach(K=>{K===L&&n.associateables[J][K].forEach(G=>H(L,G))})}):n.associateables&&typeof(n.associateables==="object")&&Object.hasOwn(n.associateables,L)&&n.associateables[L].forEach(Z=>H(L,Z)),f.value[L]&&f.value[L].records.forEach(Z=>H(L,Z))}),P}),x=V(()=>m.value!=""),A=V(()=>{let P=0;return $.value.forEach(H=>{P+=p.value[H]?p.value[H].length:0}),P===0?a("core::app.no_associations"):a("core::app.associated_with_total_records",{count:P})});function N(P){return ot((n.initialAssociateables[P]||[]).slice(0,n.limitInitialAssociateables),"created_at","desc")}function T(P){let H=[];return $.value.forEach(L=>{H.push(Innoclapps.request().get(`/${L}/search`,{params:{q:P,take:IR},cancelToken:new Nn(Z=>g[L]=Z)}))}),H}function E(){Object.keys(g).forEach(P=>{g[P]&&g[P]()})}function B(P,H,L){!f.value[H]&&L&&(f.value[H]={records:[],is_search:L}),Fe(()=>{if(p.value[H].includes(P.id)&&L)f.value[H].records.push(P);else if(f.value[H]){let Z=Xe(f.value[H].records,["id",Number(P.id)]);Z!=-1&&f.value[H].records.splice(Z,1)}t("change",p.value)})}function z(){m.value="",M(""),E()}const M=Dt(function(P){const H=P.length;if(H===0){h.value={};return}if(u.value=H,H<Ea)return c.value=!0,P;c.value=!1,E(),r(!0),Promise.all(T(P)).then(L=>{$.value.forEach((Z,J)=>{h.value[Z]=Object.assign({},y[Z],{records:_t(L[J].data,K=>(K.from_search=!0,K)),is_search:!0})}),r(!1)})},650);function j(P){return!n.modelValue||!n.modelValue[P]?[]:Wt(n.modelValue[P][0])?n.modelValue[P].map(H=>H.id):n.modelValue[P]}function U(){let P={};$.value.forEach(H=>{let L=nt(j(H));H===n.primaryResourceName&&n.primaryRecordDisabled===!0&&F.value&&L.push(n.primaryRecord.id),P[H]=Al(L)}),p.value=P,t("update:modelValue",P)}return ge(()=>{let P=[];return $.value.forEach(H=>{P=P.concat(j(H))}),P.join(",")},()=>{U()}),De(U),(P,H)=>{const L=v("IFormInput"),Z=v("Icon"),J=v("IFormGroup"),K=v("IFormCheckbox"),G=v("IOverlay"),oe=v("IPopover"),pe=ae("t");return d(),R(oe,{flip:"",busy:e.disabled,class:X(e.widthClass),title:P.$t("core::app.associate_with_record"),placement:e.placement,onHide:z},{popper:b(()=>[o("div",bR,[s(J,{class:"relative"},{default:b(()=>[s(L,{modelValue:m.value,"onUpdate:modelValue":H[0]||(H[0]=ue=>m.value=ue),class:"pr-8",placeholder:I.value,onInput:l(M)},null,8,["modelValue","placeholder","onInput"]),D(o("a",{href:"#",class:"absolute right-3 top-2.5 focus:outline-none",onClick:ie(z,["prevent"])},[s(Z,{icon:"X",class:"h-5 w-5 text-neutral-400"})],8,hR),[[Y,m.value]])]),_:1}),s(G,{show:l(i)},{default:b(()=>[D(o("p",_R,null,512),[[Y,x.value&&!C.value&&!l(i)&&!c.value],[pe,"core::app.no_search_results"]]),D(o("p",{class:"text-center text-sm text-neutral-600 dark:text-neutral-300",textContent:S(P.$t("core::app.type_more_to_search",{characters:_.value}))},null,8,gR),[[Y,x.value&&c.value]]),(d(!0),k(te,null,re(w.value,ue=>(d(),k("div",{key:ue.resource},[D(o("p",{class:"mb-2 mt-3 text-sm font-medium text-neutral-700 dark:text-neutral-100",textContent:S(ue.title)},null,8,yR),[[Y,ue.records.length>0]]),(d(!0),k(te,null,re(ue.records,(ee,W)=>(d(),k("div",{key:ue.resource+"-"+ee.id,class:"flex items-center"},[s(K,{id:ue.resource+"-"+ee.id,checked:p.value[ue.resource],"onUpdate:checked":ne=>p.value[ue.resource]=ne,class:"grow",value:ee.id,disabled:ee.disabled||e.primaryRecordDisabled===!0&&e.primaryResourceName===ue.resource&&F.value&&Number(e.primaryRecord.id)===Number(ee.id),onChange:ne=>B(ee,ue.resource,ue.is_search)},{default:b(()=>[Q(S(ee.display_name),1)]),_:2},1032,["id","checked","onUpdate:checked","value","disabled","onChange"]),o("a",{href:ee.path,class:"mt-0.5 self-start text-neutral-500 dark:text-neutral-400"},[s(Z,{icon:"Eye",class:"ml-2 h-4 w-4"})],8,xR),de(P.$slots,"after-record",{index:W,title:ue.title,resource:ue.resource,record:ee,isSearching:x.value,isSelected:p.value[ue.resource].includes(ee.id),selectedRecords:p.value[ue.resource]})]))),128))]))),128))]),_:3},8,["show"])])]),default:b(()=>[o("button",{type:"button",class:"link text-sm focus:outline-none",textContent:S(A.value)},null,8,vR)]),_:3},8,["busy","class","title","placement"])}}};const kR={class:"vel-toolbar"},$R=["onClick"],wR=o("svg",{class:"vel-icon icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-zoomin"})],-1),CR=[wR],SR=["onClick"],RR=o("svg",{class:"vel-icon icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-zoomout"})],-1),FR=[RR],VR=["onClick"],TR=o("svg",{class:"vel-icon icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-rotate-left"})],-1),DR=[TR],qR=["onClick"],ER=o("svg",{class:"vel-icon icon","aria-hidden":"true"},[o("use",{"xlink:href":"#icon-rotate-right"})],-1),AR=[ER],Wl={__name:"Lightbox",props:{modelValue:{validator:e=>typeof e=="number"||typeof e=="string"||e===null},urls:Array},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,{show:a,visibleRef:r,indexRef:i,imgsRef:u}=xd({imgs:n.urls,initIndex:0}),c=V(()=>n.urls.length),m=()=>{r.value=!1,n.modelValue!==null&&t("update:modelValue",null)};return ge(()=>n.modelValue,p=>{p>=0&&p!==null?a(p):r.value=!1},{immediate:!0}),ge(c,()=>u.value=n.urls),(p,f)=>(d(),R(l(Id),{visible:l(r),imgs:l(u),index:l(i),onHide:m,onOnIndexChange:f[0]||(f[0]=(h,g)=>p.$emit("update:modelValue",g))},{toolbar:b(({toolbarMethods:h})=>[o("div",kR,[o("div",{role:"button","aria-label":"zoom in button",class:"toolbar-btn toolbar-btn__zoomin",onClick:h.zoomIn},CR,8,$R),o("div",{role:"button","aria-label":"zoom out button",class:"toolbar-btn toolbar-btn__zoomout",onClick:h.zoomOut},FR,8,SR),o("div",{role:"button","aria-label":"image rotate left button",class:"toolbar-btn toolbar-btn__rotate",onClick:h.rotateLeft},DR,8,VR),o("div",{role:"button","aria-label":"image rotate right button",class:"toolbar-btn toolbar-btn__rotate",onClick:h.rotateRight},AR,8,qR),de(p.$slots,"toolbar")])]),_:3},8,["visible","imgs","index"]))}},BR=["href","target"],NR={class:"shrink-0"},OR=["textContent"],zR={class:"min-w-0 flex-1 truncate"},MR=["href","textContent"],UR=["href","onClick","textContent"],PR=["textContent"],jR=["textContent"],LR={class:"block shrink-0 md:hidden md:group-hover:block"},HR={class:"flex items-center space-x-2"},GR=["href"],KR={key:0},Mo=Object.assign({inheritAttrs:!1},{__name:"MediaItemsList",props:{items:Array,authorizeDelete:Boolean},emits:["delete-requested"],setup(e,{emit:t}){const n=e,a=q(null),{localizedDateTime:r}=Ne(),i=V(()=>n.items.filter(f=>f.aggregate_type==="image")),u=V(()=>i.value.map(f=>f.preview_url)),c=V(()=>i.value[a.value]);function m(f){return n.items.findIndex(h=>h.preview_url===f)}function p(f){t("delete-requested",f)}return(f,h)=>{const g=v("Icon"),y=v("IButtonIcon");return d(),k(te,null,[s(Wl,{modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=_=>a.value=_),urls:u.value},{toolbar:b(()=>[(d(),k(te,null,re(["preview_url","download_url"],_=>o("a",{key:_,href:c.value[_],target:_==="preview_url"?"_blank":void 0,tabindex:"-1",rel:"noopener noreferrer",class:"toolbar-btn"},[s(g,{icon:_=="preview_url"?"Eye":"Download",class:"h-5 w-5"},null,8,["icon"])],8,BR)),64))]),_:1},8,["modelValue","urls"]),o("ul",Re({class:"divide-y divide-neutral-200 dark:divide-neutral-700"},f.$attrs),[(d(!0),k(te,null,re(e.items,_=>(d(),k("li",{key:_.id,class:"group flex items-center space-x-3 py-4"},[o("div",NR,[o("span",{class:X([[_.was_recently_created?"bg-success-500 text-white":"bg-neutral-200 text-neutral-400 dark:bg-neutral-700 dark:text-neutral-300"],"inline-flex h-10 w-10 items-center justify-center rounded-full text-sm"])},[_.was_recently_created?(d(),R(g,{key:0,icon:"Check",class:"h-5 w-5"})):(d(),k("span",{key:1,textContent:S(_.extension)},null,8,OR))],2)]),o("div",zR,[_.aggregate_type!=="image"?(d(),k("a",{key:0,href:_.view_url,class:"text-sm font-medium text-neutral-800 hover:text-neutral-500 focus:outline-none dark:text-white dark:hover:text-neutral-300",target:"_blank",rel:"noopener noreferrer",tabindex:"0",textContent:S(_.file_name)},null,8,MR)):(d(),k("a",{key:1,href:_.view_url,class:"text-sm font-medium text-neutral-800 hover:text-neutral-500 focus:outline-none dark:text-white dark:hover:text-neutral-300",target:"_blank",rel:"noopener noreferrer",tabindex:"0",onClick:ie(I=>a.value=m(_.preview_url),["prevent"]),textContent:S(_.file_name)},null,8,UR)),o("span",{class:"ml-2 text-sm text-neutral-500 dark:text-neutral-300",textContent:S(l(ls)(_.size))},null,8,PR),o("p",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(l(r)(_.created_at))},null,8,jR)]),o("div",LR,[o("div",HR,[o("a",{href:_.download_url,class:"text-neutral-500 hover:text-neutral-700 focus:outline-none dark:text-white dark:hover:text-neutral-300"},[s(g,{icon:"Download",class:"h-5 w-5"})],8,GR),e.authorizeDelete?(d(),k("div",KR,[s(y,{icon:"X",onClick:I=>p(_)},null,8,["onClick"])])):O("",!0)])])]))),128))],16)],64)}}}),YR={class:"font-medium text-neutral-800 dark:text-white"},WR=["textContent"],QR={class:"text-sm text-neutral-500 dark:text-neutral-300"},XR={class:"mt-3"},kn={__name:"ResourceRecordMediaCard",props:{show:{default:!0,type:Boolean},resourceName:{type:String,required:!0},resourceId:{type:Number,required:!0},media:{type:Array,required:!0},authorizeDelete:{required:!0,type:Boolean},isFloating:{type:Boolean,required:!1},automaticUpload:{default:!0,type:Boolean},card:{default:!0,type:Boolean},wrapperClass:[String,Array,Object]},emits:["deleted","uploaded"],setup(e,{emit:t}){const n=e,a=V(()=>ot(n.media,m=>new Date(m.created_at),["desc"])),r=V(()=>n.media.length),i=V(()=>r.value>0);function u(m){t("uploaded",m)}async function c(m){await Innoclapps.dialog().confirm(),await Innoclapps.request().delete(`/${n.resourceName}/${n.resourceId}/media/${m.id}`),t("deleted",m)}return(m,p)=>{const f=ae("t");return d(),k("div",{class:X({"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900":e.card})},[o("div",{class:X({"px-4 py-5 sm:px-6":e.card})},[de(m.$slots,"heading",{},()=>[o("h2",YR,[Q(S(m.$t("core::app.attachments"))+" ",1),r.value>0?(d(),k("span",{key:0,class:"text-sm font-normal text-neutral-400",textContent:S("("+r.value+")")},null,8,WR)):O("",!0)])]),e.show?(d(),k("div",{key:0,class:X(e.wrapperClass)},[s(Mo,{items:a.value,"authorize-delete":e.authorizeDelete,onDeleteRequested:c},null,8,["items","authorize-delete"]),D(o("p",QR,null,512),[[Y,!i.value],[f,"core::app.no_attachments"]]),o("div",XR,[s(Hn,{"input-id":"media-"+e.resourceName+"-"+e.resourceId+(e.isFloating?"-floating":""),"action-url":`${m.$store.state.apiURL}/${e.resourceName}/${e.resourceId}/media`,onFileUploaded:u},null,8,["input-id","action-url"])])],2)):O("",!0)],2)],2)}}},$n=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name")),r=V(()=>c(a.value));function i(f){return a.value.find(h=>h.id==f)}function u(f){return a.value.find(h=>h.flag==f)}function c(f){return f.map(h=>({id:h.id,icon:h.icon,tooltip:h.name}))}function m(f){n.value=f}function p(){e(!0),Innoclapps.request().get("/activity-types",{params:{per_page:100}}).then(({data:f})=>n.value=f.data).finally(()=>e(!1))}return{activityTypes:n,typesByName:a,typesAreBeingFetched:t,typesForIconPicker:r,findTypeById:i,findTypeByFlag:u,formatTypesForIcons:c,setActivityTypes:m,fetchActivityTypes:p}}),ZR={key:1,class:"ml-1"},JR={key:2,class:"ml-1"},eF={__name:"ActivityDateDisplay",props:{dueDate:{required:!0},endDate:{required:!0},isDue:{required:!0,type:Boolean},withIcon:{type:Boolean,default:!0}},setup(e){const t=e,{localizedDate:n,localizedDateTime:a,currentTimeFormat:r}=Ne(),i=V(()=>t.endDate.date&&t.endDate.time&&a(t.endDate.date+" "+t.endDate.time,"YYYY-MM-DD")>a(t.dueDate.date+" "+t.dueDate.time,"YYYY-MM-DD")),u=V(()=>t.endDate.date&&t.endDate.time&&a(t.endDate.date+" "+t.endDate.time,"YYYY-MM-DD")==a(t.dueDate.date+" "+t.dueDate.time,"YYYY-MM-DD")),c=V(()=>moment().PHPconvertFormat(r.value));return(m,p)=>{const f=v("Icon");return d(),k("p",{class:X(["flex items-center text-sm",{"text-danger-500 dark:text-danger-400":e.isDue,"text-neutral-800 dark:text-neutral-200":!e.isDue}])},[e.withIcon?(d(),R(f,{key:0,icon:"Calendar",class:X(["mr-2 h-5 w-5",{"text-neutral-800 dark:text-white":!e.isDue,"text-danger-400":e.isDue}])},null,8,["class"])):O("",!0),Q(" "+S(e.dueDate.time?l(a)(e.dueDate.date+" "+e.dueDate.time):l(n)(e.dueDate.date))+" ",1),i.value?(d(),k("span",ZR," - "+S(l(a)(e.endDate.date+" "+e.endDate.time)),1)):u.value?(d(),k("span",JR," - "+S(l(a)(e.endDate.date+" "+e.endDate.time,c.value)),1)):O("",!0)],2)}}},tF=["onSubmit"],nF={class:"flex w-full flex-col sm:w-auto sm:flex-row sm:items-center sm:justify-end"},oF={__name:"RelatedActivityEdit",props:{activityId:{type:Number,required:!0},relatedResource:{required:!0,type:Object},viaResource:{type:String,required:!0},viaResourceId:{type:[String,Number],required:!0}},emits:["cancelled","updated"],setup(e,{emit:t}){const n=e,a=Me("synchronizeResource"),r=Me("incrementResourceCount"),i=Me("decrementResourceCount"),u=Innoclapps.resourceName("activities"),{t:c}=ve(),{fields:m,getUpdateFields:p}=gt(),{form:f}=It(m),{updateResource:h,retrieveResource:g}=Je(u);let y=!1;const _=V(()=>m.value.isNotEmpty()),I=V(()=>n.viaResource==="contacts"?[n.relatedResource]:n.relatedResource.contacts||[]);function F(){h(f.withQueryString({via_resource:n.viaResource,via_resource_id:n.viaResourceId}),n.activityId).then($)}function $(C){C.is_completed!==y&&(C.is_completed?i("incomplete_activities_for_user_count"):r("incomplete_activities_for_user_count"),y=C.is_completed),a({activities:C}),t("updated",C),Innoclapps.success(c("core::resource.updated"))}return Dn(async()=>{const C=await g(n.activityId);y=C.is_completed,m.value.set(await p(u,n.activityId,{viaResource:n.viaResource,viaResourceId:n.viaResourceId})).update("guests",{contacts:I}).populate(C),f.set("is_completed",C.is_completed)}),(C,w)=>{const x=v("FormFields"),A=v("IFormToggle"),N=v("IButton"),T=v("ICard");return d(),k("form",{method:"POST",onSubmit:ie(F,["prevent"])},[s(T,{overlay:!_.value},{footer:b(()=>[o("div",nF,[s(A,{modelValue:l(f).is_completed,"onUpdate:modelValue":w[0]||(w[0]=E=>l(f).is_completed=E),class:"mb-4 mr-4 pr-4 sm:mb-0 sm:border-r sm:border-neutral-200 sm:dark:border-neutral-700",label:C.$t("activities::activity.mark_as_completed")},null,8,["modelValue","label"]),s(N,{class:"mb-2 ml-0 sm:mb-0 sm:mr-2",variant:"white",size:"sm",text:C.$t("core::app.cancel"),onClick:w[1]||(w[1]=E=>C.$emit("cancelled",E))},null,8,["text"]),s(N,{type:"submit",variant:"primary",size:"sm",disabled:l(f).busy,text:C.$t("core::app.save"),onClick:F},null,8,["disabled","text"])])]),default:b(()=>[s(x,{fields:l(m),"form-id":l(f).formId,"resource-id":e.activityId,"resource-name":l(u)},null,8,["fields","form-id","resource-id","resource-name"])]),_:1},8,["overlay"])],40,tF)}}},lF={class:"flex"},aF={class:"mr-2 mt-px flex shrink-0 self-start"},sF={class:"flex grow flex-col space-y-1 md:flex-row md:space-x-3 md:space-y-0"},rF={class:"flex grow flex-col items-start"},iF=["textContent"],uF=["onClick"],dF={class:"flex items-center"},cF={key:1,class:"flex items-center px-1 text-xs"},mF={class:"ml-2 mt-px inline-flex self-start md:ml-5"},pF={key:0,class:"-mt-px border border-warning-100 bg-warning-50"},fF=["onClick"],vF=["onClick"],bF={class:"space-y-4 sm:space-y-6"},hF={key:0,class:"mb-8"},_F={class:"mb-2 inline-flex text-sm font-medium text-neutral-800 dark:text-white"},gF={class:"flex flex-col flex-wrap space-x-0 space-y-2 align-baseline lg:flex-row lg:space-x-4 lg:space-y-0"},yF={key:0,class:"self-start sm:self-auto"},xF=["textContent"],IF={key:1,class:"flex items-center text-sm font-medium text-neutral-800 dark:text-neutral-200"},kF={key:0,class:"mt-2 flex items-center text-sm text-neutral-800 dark:text-neutral-200 sm:mt-3"},$F={class:"border-y border-neutral-100 px-4 py-2.5 dark:border-neutral-800 sm:px-6"},wF={class:"inline-flex items-center text-sm font-medium text-neutral-800 dark:text-white"},CF={class:"border-b border-neutral-100 px-4 py-2.5 dark:border-neutral-800 sm:px-6"},Ns=Object.assign({inheritAttrs:!1},{__name:"RelatedActivity",props:{activityId:{required:!0,type:Number},title:{required:!0,type:String},commentsCount:{required:!0,type:Number},isCompleted:{required:!0,type:Boolean},isReminded:{required:!0,type:Boolean},isDue:{required:!0,type:Boolean},typeId:{required:!0,type:Number},userId:{required:!0,type:Number},note:{required:!0},description:{required:!0},reminderMinutesBefore:{required:!0},dueDate:{required:!0},endDate:{required:!0},attachmentsCount:{required:!0,type:Number},media:{required:!0,type:Array},authorizations:{required:!0,type:Object},comments:{required:!0,type:Array},associations:{required:!0,type:Object},viaResource:{required:!0,type:String},viaResourceId:{required:!0,type:[String,Number]},relatedResource:{required:!0,type:Object}},setup(e){const t=e,n=Innoclapps.resourceName("activities"),a=Me("synchronizeResource"),r=Me("incrementResourceCount"),i=Me("decrementResourceCount"),{t:u}=ve(),{localizedDateTime:c,localizedDate:m}=Ne(),{syncAssociations:p,associationsBeingSaved:f,updateResource:h,deleteResource:g}=Je(n),{users:y,findUserById:_}=Le(),I=V(()=>y.value.map(L=>({id:L.id,name:L.name}))),{commentsAreVisible:F}=ln(t.activityId,"activities"),$=q(!1),C=q(!1),{typesByName:w,findTypeById:x}=$n(),A=V(()=>w.value.map(L=>({id:L.id,name:L.name,icon:L.icon}))),N=V(()=>x(t.typeId)),T=V(()=>_(t.userId)),E=V(()=>u("core::app.reminder_set_for",{value:gl(t.reminderMinutesBefore),type:u("core::dates."+No(t.reminderMinutesBefore))}));function B(){Innoclapps.request().get(`/activities/${t.activityId}/ics`,{responseType:"blob"}).then(L=>{so(L.data,L.headers["content-disposition"].split("filename=")[1])})}function z(L={}){h({via_resource:t.viaResource,via_resource_id:t.viaResourceId,...L},t.activityId).then(Z=>a({activities:Z}))}async function M(L){await Innoclapps.dialog().confirm(),await g(L),a({activities:{id:L,_delete:!0}}),i("incomplete_activities_for_user_count"),Innoclapps.success(u("activities::activity.deleted"))}function j(L){a({activities:L}),L.is_completed?i("incomplete_activities_for_user_count"):r("incomplete_activities_for_user_count")}function U(L){L.type=="dblclick"&&$.value||t.authorizations.update&&($.value=!$.value)}function P(L){a({activities:{id:t.activityId,media:[L]}})}function H(L){a({activities:{id:t.activityId,media:{id:L.id,_delete:!0}}})}return(L,Z)=>{const J=v("Icon"),K=v("DropdownSelectInput"),G=v("IDropdownItem"),oe=v("IMinimalDropdown"),pe=v("IAlert"),ue=v("TextCollapse"),ee=v("IAvatar"),W=v("ICardBody"),ne=v("CommentsCollapse"),ce=v("CommentsAdd"),fe=v("ICard"),Se=ae("t"),Ie=ae("i-tooltip");return d(),k(te,null,[D(s(fe,Re(L.$attrs,{condensed:"",class:"activity-"+e.activityId,"footer-class":"inline-flex flex-col w-full","no-body":""}),{header:b(()=>[o("div",lF,[o("div",aF,[St([e.isCompleted],()=>s(Jo,{class:"ml-px md:mt-px","activity-id":e.activityId,"is-completed":e.isCompleted,disabled:!e.authorizations.changeState,onStateChanged:j},null,8,["activity-id","is-completed","disabled"]),Z,0)]),o("div",sF,[o("div",rF,[o("h3",{class:X(["-mb-1 truncate whitespace-normal text-base/6 font-medium text-neutral-700 dark:text-white",{"line-through":e.isCompleted}]),textContent:S(e.title)},null,10,iF),s(vn,{disabled:l(f),"model-value":e.associations,"initial-associateables":e.relatedResource,associateables:e.associations,"primary-record":e.relatedResource,"primary-resource-name":e.viaResource,onChange:Z[1]||(Z[1]=Ce=>l(p)(e.activityId,Ce).then(le=>l(a)({activities:le})))},null,8,["disabled","model-value","initial-associateables","associateables","primary-record","primary-resource-name"])]),s(zt,{color:N.value.swatch_color,class:"inline-flex shrink-0 items-center self-start rounded-md py-0.5 dark:!text-white sm:rounded-full"},{default:b(()=>[e.authorizations.update?(d(),R(K,{key:0,items:A.value,"model-value":e.typeId,"label-key":"name","value-key":"id",onChange:Z[2]||(Z[2]=Ce=>z({activity_type_id:Ce.id}))},{default:b(({toggle:Ce})=>[o("button",{type:"button",class:"flex w-full items-center justify-between rounded-md px-2.5 text-xs leading-5 focus:outline-none",onClick:Ce},[o("div",dF,[s(J,{icon:N.value.icon,class:"mr-1.5 h-4 w-4"},null,8,["icon"]),Q(" "+S(N.value.name)+" ",1),s(J,{icon:"ChevronDown",class:"ml-1 h-4 w-4"})])],8,uF)]),_:1},8,["items","model-value"])):(d(),k("span",cF,[s(J,{icon:N.value.icon,class:"mr-1.5 h-4 w-4"},null,8,["icon"]),Q(" "+S(N.value.name),1)]))]),_:1},8,["color"])]),o("div",mF,[s(oe,{class:"mt-1 md:mt-0.5"},{default:b(()=>[e.authorizations.update?(d(),R(G,{key:0,text:L.$t("core::app.edit"),onClick:U},null,8,["text"])):O("",!0),s(G,{text:L.$t("activities::activity.download_ics"),onClick:B},null,8,["text"]),e.authorizations.delete?(d(),R(G,{key:1,text:L.$t("core::app.delete"),onClick:Z[3]||(Z[3]=Ce=>M(e.activityId))},null,8,["text"])):O("",!0)]),_:1})])])]),footer:b(()=>[s(ce,{class:"self-end","via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"commentable-id":e.activityId,"commentable-type":"activities",onCreated:Z[10]||(Z[10]=Ce=>(F.value=!0,l(a)({activities:{id:e.activityId,comments:[Ce]}})))},null,8,["via-resource","via-resource-id","commentable-id"])]),default:b(()=>[e.isDue?(d(),R(pe,{key:0,variant:"warning",icon:"Clock",rounded:!1,class:X(["-mt-px border-warning-100",e.note?"border-t":"border-y"]),"wrapper-class":"-ml-px sm:ml-1.5"},{default:b(()=>[Q(S(L.$t("activities::activity.activity_was_due",{date:e.dueDate.time?l(c)(e.dueDate.date+" "+e.dueDate.time):l(m)(e.dueDate.date)})),1)]),_:1},8,["class"])):O("",!0),o("div",{onDblclick:U},[e.note?(d(),k("div",pF,[s(ue,{text:e.note,length:100,class:"wysiwyg-text px-4 py-2.5 text-warning-700 sm:px-6"},{action:b(({collapsed:Ce,toggle:le})=>[D(o("div",{class:"absolute bottom-1 h-1/2 w-full cursor-pointer bg-gradient-to-t from-warning-50 to-transparent dark:from-warning-100",onClick:le},null,8,fF),[[Y,Ce]]),D(o("a",{href:"#",class:"my-2.5 inline-block px-4 text-sm font-medium text-warning-800 hover:text-warning-900 sm:px-6",onClick:ie(le,["prevent"])},null,8,vF),[[Y,!Ce],[Se,"core::app.show_less"]])]),_:1},8,["text"])])):O("",!0),s(W,{condensed:""},{default:b(()=>[o("div",bF,[e.description?(d(),k("div",hF,[o("p",_F,[s(J,{icon:"Bars3BottomLeft",class:"mr-3 h-5 w-5 text-current"}),D(o("span",null,null,512),[[Se,"activities::activity.description"]])]),s(ue,{text:e.description,length:200,class:"wysiwyg-text ml-8 dark:text-neutral-300 sm:mb-0"},null,8,["text"])])):O("",!0),o("div",gF,[T.value?D((d(),k("div",yF,[e.authorizations.update?(d(),R(K,{key:0,items:I.value,"model-value":e.userId,"value-key":"id","label-key":"name",onChange:Z[4]||(Z[4]=Ce=>z({user_id:Ce.id}))},{label:b(({label:Ce})=>[s(ee,{size:"xs",class:"-ml-1 mr-3",src:T.value.avatar_url},null,8,["src"]),o("span",{class:"text-neutral-800 hover:text-neutral-500 dark:text-neutral-200 dark:hover:text-neutral-400",textContent:S(Ce)},null,8,xF)]),_:1},8,["items","model-value"])):(d(),k("p",IF,[s(ee,{size:"xs",class:"mr-3",src:T.value.avatar_url},null,8,["src"]),Q(" "+S(T.value.name),1)]))])),[[Ie,L.$t("activities::activity.owner"),void 0,{top:!0}]]):O("",!0),s(eF,{class:"font-medium","due-date":e.dueDate,"end-date":e.endDate,"is-due":e.isDue},null,8,["due-date","end-date","is-due"])])]),e.reminderMinutesBefore&&!e.isReminded?(d(),k("p",kF,[s(J,{icon:"Bell",class:"mr-3 h-5 w-5 text-neutral-800 dark:text-white"}),o("span",null,S(E.value),1)])):O("",!0)]),_:1})],32),o("div",$F,[s(kn,{card:!1,show:C.value,"wrapper-class":["ml-8",{"py-4":e.attachmentsCount===0,"mb-4":e.attachmentsCount>0}],class:"mt-1","resource-name":l(n),"resource-id":e.activityId,media:e.media,"authorize-delete":e.authorizations.update,onDeleted:H,onUploaded:P},{heading:b(()=>[o("p",wF,[s(J,{icon:"PaperClip",class:"mr-3 h-5 w-5 text-current"}),o("a",{href:"#",class:"inline-flex items-center focus:outline-none",onClick:Z[5]||(Z[5]=ie(Ce=>C.value=!C.value,["prevent"]))},[o("span",null,S(L.$t("core::app.attachments"))+" ("+S(e.attachmentsCount)+") ",1),s(J,{icon:C.value?"ChevronDown":"ChevronRight",class:"ml-3 h-4 w-4"},null,8,["icon"])])])]),_:1},8,["show","wrapper-class","resource-name","resource-id","media","authorize-delete"])]),D(o("div",CF,[s(ne,{"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"commentable-id":e.activityId,"commentable-type":"activities",count:e.commentsCount,comments:e.comments,"list-wrapper-class":"ml-8",class:"mt-1",onUpdated:Z[6]||(Z[6]=Ce=>l(a)({activities:{id:e.activityId,comments:Ce}})),onDeleted:Z[7]||(Z[7]=Ce=>l(a)({activities:{id:e.activityId,comments:{id:Ce,_delete:!0}}})),"onUpdate:comments":Z[8]||(Z[8]=Ce=>l(a)({activities:{id:e.activityId,comments:Ce}})),"onUpdate:count":Z[9]||(Z[9]=Ce=>l(a)({activities:{id:e.activityId,comments_count:Ce}}))},null,8,["via-resource","via-resource-id","commentable-id","count","comments"])],512),[[Y,e.commentsCount]])]),_:1},16,["class"]),[[Y,!$.value]]),$.value?(d(),R(oF,{key:0,"activity-id":e.activityId,"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"related-resource":e.relatedResource,onCancelled:Z[11]||(Z[11]=Ce=>$.value=!1),onUpdated:Z[12]||(Z[12]=Ce=>$.value=!1)},null,8,["activity-id","via-resource","via-resource-id","related-resource"])):O("",!0)],64)}}}),SF={class:"flex w-full flex-wrap items-center justify-between sm:w-auto"},RF={class:"mt-sm-0 mt-2 flex w-full flex-col sm:w-auto sm:flex-row sm:items-center sm:justify-end sm:space-x-2"},FF={__name:"RelatedActivityCreate",props:{viaResource:{type:String,required:!0},viaResourceId:{type:[String,Number],required:!0},relatedResource:{required:!0,type:Object}},emits:["cancel"],setup(e){const t=e,n=Me("synchronizeResource"),a=Me("incrementResourceCount"),r=Innoclapps.resourceName("activities"),{t:i}=ve(),{fields:u,getCreateFields:c}=gt(),{form:m}=It(u,{is_completed:!1,associations:{[t.viaResource]:[t.viaResourceId]}},{resetOnSuccess:!0}),{createResource:p}=Je(r),f=V(()=>t.viaResource==="contacts"?[t.relatedResource]:t.relatedResource.contacts||[]);async function h(){u.value.set(await c(r,{viaResource:t.viaResource,viaResourceId:t.viaResourceId})).update("guests",{contacts:f})}async function g(){let y=await p(m.withQueryString({via_resource:t.viaResource,via_resource_id:t.viaResourceId}));Innoclapps.success(i("activities::activity.created")),y.is_completed||a("incomplete_activities_for_user_count"),n({activities:[y]})}return h(),(y,_)=>{const I=v("FormFields"),F=v("IFormToggle"),$=v("IButton"),C=v("IAlert"),w=v("ICard");return d(),R(w,{tag:"form",method:"POST",overlay:l(u).isEmpty(),onSubmit:ie(g,["prevent"])},{footer:b(()=>[o("div",SF,[o("div",null,[s(vn,{modelValue:l(m).associations,"onUpdate:modelValue":_[0]||(_[0]=x=>l(m).associations=x),"primary-record":e.relatedResource,"primary-resource-name":e.viaResource,"primary-record-disabled":!0,"initial-associateables":e.relatedResource},null,8,["modelValue","primary-record","primary-resource-name","initial-associateables"])]),o("div",RF,[s(F,{modelValue:l(m).is_completed,"onUpdate:modelValue":_[1]||(_[1]=x=>l(m).is_completed=x),class:"mb-4 mr-4 pr-4 sm:mb-0 sm:border-r sm:border-neutral-200 sm:dark:border-neutral-700",label:y.$t("activities::activity.mark_as_completed")},null,8,["modelValue","label"]),s($,{class:"mb-2 sm:mb-0",variant:"white",size:"sm",text:y.$t("core::app.cancel"),onClick:_[2]||(_[2]=x=>y.$emit("cancel"))},null,8,["text"]),s($,{type:"submit",size:"sm",disabled:l(m).busy,text:y.$t("activities::activity.add")},null,8,["disabled","text"])])])]),default:b(()=>[s(I,{fields:l(u),"form-id":l(m).formId,"resource-name":l(r),"focus-first":""},null,8,["fields","form-id","resource-name"]),s(C,{show:l(m).recentlySuccessful,class:"mt-4 border border-success-300",variant:"success"},{default:b(()=>[Q(S(y.$t("activities::activity.created")),1)]),_:1},8,["show"])]),_:1},8,["overlay","onSubmit"])}}},VF={class:"-mt-[20px] mb-3 overflow-hidden rounded-b-md border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-900 sm:mb-7"},TF={class:"px-4 py-5 sm:p-6"},DF={class:"sm:flex sm:items-start sm:justify-between"},qF={class:"text-base/6 font-medium text-neutral-900 dark:text-white"},EF={class:"mt-2 max-w-xl text-sm text-neutral-500 dark:text-neutral-200"},AF={class:"mt-5 sm:ml-6 sm:mt-0 sm:flex sm:shrink-0 sm:items-center"},BF={class:"sm:block"},NF={class:"border-b border-neutral-200 dark:border-neutral-600"},OF={class:"flex items-center justify-center"},zF={class:"overlow-y-hidden -mb-px flex grow snap-x snap-mandatory overflow-x-auto sm:grow-0 sm:space-x-4 lg:space-x-6"},MF=["onClick"],UF={class:"ml-2"},PF={class:"py-2 sm:py-4"},jF={key:0,class:"mt-6 flex items-center justify-center font-medium text-neutral-800 dark:text-neutral-200"},LF={class:"space-y-4"},HF={class:"mt-6 text-center text-neutral-800 dark:text-neutral-200"},dl="activities",GF={__name:"RecordTabActivityPanel",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object},scrollElement:{type:String}},setup(e){const t=e,n=Me("synchronizeResource"),a=q("all"),r=q(null),i=q(!1),{appMoment:u,userTimezone:c}=Ne(),{currentUser:m}=Le(),{t:p}=ve(),f=Ye(),{commentsAreVisible:h}=ln(f.query.resourceId,dl),{dataLoadedFirstTime:g,focusToAssociateableElement:y,searchResults:_,isSearching:I,hasSearchResults:F,performSearch:$,search:C,loadData:w,infiniteHandler:x}=Xn({resourceName:t.resourceName,resource:xe(t,"resource"),scrollElement:t.scrollElement,perPage:100,infinityRef:r,synchronizeResource:n,timelineRelation:dl}),A=V(()=>Z.value.find(J=>J.id===a.value)),N=V(()=>M.value.filter(J=>L(J.due_date).isSame(u().clone().tz(c.value),"day"))),T=V(()=>M.value.filter(J=>L(J.due_date).isSame(u().clone().tz(c.value).add(1,"day"),"day"))),E=V(()=>M.value.filter(J=>L(J.due_date).isoWeekday(Number(m.value.first_day_of_week)).isSame(u().clone().tz(c.value).isoWeekday(Number(m.value.first_day_of_week)),"week"))),B=V(()=>M.value.filter(J=>L(J.due_date).isoWeekday(Number(m.value.first_day_of_week)).isSame(u().clone().tz(c.value).isoWeekday(Number(m.value.first_day_of_week)).add(1,"week"),"week"))),z=V(()=>ot(_.value||t.resource.activities,["is_completed",J=>L(J.due_date).toDate()],["asc","asc"])),M=V(()=>z.value.filter(J=>!J.is_completed)),j=V(()=>z.value.filter(J=>J.is_completed)),U=V(()=>z.value.length>0),P=V(()=>A.value.total===0&&g.value&&!(I.value&&!F.value));function H(J){a.value=J.id,w()}function L(J){return J.time?u(J.date+" "+J.time+":00").clone().tz(c.value):u(J.date)}const Z=V(()=>[{id:"all",title:p("activities::activity.filters.all"),data:z.value,total:z.value.length,empty:{text:p("core::app.all_caught_up"),icon:"Check",iconClass:"text-success-500"}},{id:"today",title:p("activities::activity.filters.today"),data:N.value,total:N.value.length,empty:{text:p("core::app.all_caught_up"),icon:"Check",iconClass:"text-success-500"}},{id:"tomorrow",title:p("activities::activity.filters.tomorrow"),data:T.value,total:T.value.length,empty:{text:p("core::app.all_caught_up"),icon:"Check",iconClass:"text-success-500"}},{id:"this_week",title:p("activities::activity.filters.this_week"),data:E.value,total:E.value.length,empty:{text:p("core::app.all_caught_up"),icon:"Check",iconClass:"text-success-500"}},{id:"next_week",title:p("activities::activity.filters.next_week"),data:B.value,total:B.value.length,empty:{text:p("core::app.all_caught_up"),icon:"Check",iconClass:"text-success-500"}},{id:"done",title:p("activities::activity.filters.done"),data:j.value,total:j.value.length,empty:{text:p("activities::activity.filters.done_empty_state"),icon:"CheckCircle",iconClass:"text-neutral-500 dark:text-neutral-300"}}]);return f.query.resourceId&&f.query.section===dl&&An(g,()=>{y(f.query.resourceId,"activity").then(()=>{f.query.comment_id&&(h.value=!0)})}),(J,K)=>{const G=v("IButton"),oe=v("SearchInput"),pe=v("Icon"),ue=v("ITabPanel"),ee=ae("t");return d(),R(ue,{lazy:!l(g),onActivatedOnce:l(w)},{default:b(()=>[o("div",VF,[D(o("div",TF,[o("div",DF,[o("div",null,[D(o("h3",qF,null,512),[[ee,"activities::activity.manage_activities"]]),o("div",EF,[D(o("p",null,null,512),[[ee,"activities::activity.info"]])])]),o("div",AF,[s(G,{size:"sm",icon:"Plus",text:J.$t("activities::activity.add"),onClick:K[0]||(K[0]=W=>i.value=!0)},null,8,["text"])])]),D(s(oe,{modelValue:l(C),"onUpdate:modelValue":K[1]||(K[1]=W=>xt(C)?C.value=W:null),class:"mt-2",onInput:l($)},null,8,["modelValue","onInput"]),[[Y,U.value||l(C)]])],512),[[Y,!i.value]]),i.value?(d(),R(FF,{key:0,shadow:!1,ring:!1,rounded:!1,"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource":e.resource,onCancel:K[2]||(K[2]=W=>i.value=!1)},null,8,["via-resource","via-resource-id","related-resource"])):O("",!0)]),o("div",BF,[D(o("div",NF,[o("div",OF,[o("nav",zF,[(d(!0),k(te,null,re(Z.value,W=>(d(),k("a",{key:W.id,href:"#",class:X([a.value===W.id?"border-neutral-700 text-neutral-700 dark:border-neutral-400 dark:text-neutral-200":"border-transparent text-neutral-500 hover:border-neutral-300 hover:text-neutral-700 dark:text-neutral-100 dark:hover:border-neutral-500 dark:hover:text-neutral-300","group inline-flex min-w-full shrink-0 snap-start snap-always items-center justify-center whitespace-nowrap border-b-2 px-1 py-4 text-sm font-medium sm:min-w-0"]),onClick:ie(ne=>H(W),["prevent"])},[Q(S(W.title)+" ",1),o("span",UF,"("+S(W.total)+")",1)],10,MF))),128))])])],512),[[Y,U.value]])]),o("div",PF,[P.value?(d(),k("p",jF,[s(pe,{icon:A.value.empty.icon,class:X(["mr-2 h-5 w-5",A.value.empty.iconClass])},null,8,["icon","class"]),Q(" "+S(A.value.empty.text),1)])):O("",!0),o("div",LF,[(d(!0),k(te,null,re(A.value.data,W=>(d(),k("div",{key:W.id},[s(Ns,{"activity-id":W.id,title:W.title,"comments-count":W.comments_count,"is-completed":W.is_completed,"is-reminded":W.is_reminded,"is-due":W.is_due,"type-id":W.activity_type_id,"user-id":W.user_id,note:W.note,description:W.description,"reminder-minutes-before":W.reminder_minutes_before,"due-date":W.due_date,"end-date":W.end_date,"attachments-count":W.media.length,media:W.media,associations:W.associations,authorizations:W.authorizations,comments:W.comments||[],"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource":e.resource},null,8,["activity-id","title","comments-count","is-completed","is-reminded","is-due","type-id","user-id","note","description","reminder-minutes-before","due-date","end-date","attachments-count","media","associations","authorizations","comments","via-resource","via-resource-id","related-resource"])]))),128))])]),D(o("div",HF,null,512),[[Y,l(I)&&!l(F)],[ee,"core::app.no_search_results"]]),s(xn,{ref_key:"infinityRef",ref:r,"scroll-element":e.scrollElement,onHandle:K[3]||(K[3]=W=>l(x)(W))},null,8,["scroll-element"])]),_:1},8,["lazy","onActivatedOnce"])}}},Pt={log:{type:Object,required:!0},resourceName:{type:String,required:!0},resourceId:{type:[String,Number],required:!0},resource:{type:Object,required:!0}},KF=["onClick"],YF=["onClick"],WF={__name:"RecordTabTimelineEntryPin",props:{resourceName:{type:String,required:!0},resourceId:{type:[String,Number],required:!0},isPinned:{type:Boolean,required:!0},timelineSubjectKey:{type:String,required:!0},timelineRelationship:{type:String,required:!0},timelineableKey:{type:String,required:!0},timelineableId:{type:[Number,String],required:!0}},setup(e){const t=e,n=Me("synchronizeResource"),{appMoment:a}=Ne();function r(){Innoclapps.request().post("timeline/pin",{subject_id:Number(t.resourceId),subject_type:t.timelineSubjectKey,timelineable_id:Number(t.timelineableId),timelineable_type:t.timelineableKey}).then(()=>{n({[t.timelineRelationship]:{id:t.timelineableId,is_pinned:!0,pinned_date:a().toISOString()}})})}function i(){Innoclapps.request().post("timeline/unpin",{subject_id:Number(t.resourceId),subject_type:t.timelineSubjectKey,timelineable_id:Number(t.timelineableId),timelineable_type:t.timelineableKey}).then(()=>{n({[t.timelineRelationship]:{id:t.timelineableId,is_pinned:!1,pinned_date:null}})})}return(u,c)=>{const m=ae("t");return e.isPinned?D((d(),k("a",{key:1,href:"#",class:"text-xs text-neutral-800 hover:text-neutral-500 focus:outline-none dark:text-neutral-200 dark:hover:text-neutral-400",onClick:ie(i,["prevent"])},null,8,YF)),[[m,"core::timeline.unpin"]]):D((d(),k("a",{key:0,href:"#",class:"text-xs text-neutral-800 hover:text-neutral-500 focus:outline-none dark:text-neutral-200 dark:hover:text-neutral-400",onClick:ie(r,["prevent"])},null,8,KF)),[[m,"core::timeline.pin"]])}}},QF={class:"hidden sm:relative sm:block sm:px-1"},XF={class:"min-w-0 flex-1 sm:py-1.5"},ZF={class:"flex justify-between space-x-4 text-sm"},JF={class:"flex-1 md:flex md:items-center"},eV=o("span",{class:"hidden md:inline-block"},"-",-1),jt={__name:"RecordTabTimelineTemplate",props:{heading:String,headingClass:[String,Object,Array],resourceName:{type:String,required:!0},resourceId:{type:[String,Number],required:!0},isPinned:{type:Boolean,required:!0},createdAt:{type:String,required:!0},timelineRelationship:{type:String,required:!0},timelineSubjectKey:{type:String,required:!0},timelineableKey:{type:String,required:!0},timelineableId:{type:[Number,String],required:!0},icon:{type:String,required:!0}},setup(e){const{localizedDateTime:t}=Ne();return(n,a)=>{const r=v("Icon");return d(),k(te,null,[o("div",QF,[o("div",{class:X([e.isPinned?"bg-warning-300":"bg-neutral-200 dark:bg-neutral-700","flex h-8 w-8 items-center justify-center rounded-full ring-8 ring-neutral-100 dark:ring-neutral-800"])},[s(r,{icon:e.icon,class:X(["h-5 w-5",e.isPinned?"text-neutral-900":"text-neutral-600 dark:text-neutral-100"])},null,8,["icon","class"])],2)]),o("div",XF,[o("div",ZF,[o("div",JF,[o("p",{class:X(["mr-2 text-neutral-800 dark:text-white",e.headingClass])},[de(n.$slots,"heading",{},()=>[Q(S(e.heading),1)])],2),a[0]||(he(-1),a[0]=o("span",{class:"whitespace-nowrap text-xs text-neutral-500 dark:text-neutral-300"},[de(n.$slots,"date",{},()=>[eV,Q(" "+S(l(t)(e.createdAt)),1)])]),he(1),a[0])]),s(WF,{"resource-name":e.resourceName,"resource-id":e.resourceId,"timeline-subject-key":e.timelineSubjectKey,"timeline-relationship":e.timelineRelationship,"timelineable-key":e.timelineableKey,"timelineable-id":e.timelineableId,"is-pinned":e.isPinned},null,8,["resource-name","resource-id","timeline-subject-key","timeline-relationship","timelineable-key","timelineable-id","is-pinned"])]),de(n.$slots,"default")])],64)}}},tV={class:"mt-3"},nV={__name:"RecordTabTimelineActivity",props:Pt,setup(e){return(t,n)=>(d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned||!1,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:t.log.type.icon,heading:t.$t("activities::activity.timeline.heading"),"heading-class":"font-medium"},{default:b(()=>[o("div",tV,[s(Ns,{"activity-id":t.log.id,title:t.log.title,"comments-count":t.log.comments_count,"is-completed":t.log.is_completed,"is-reminded":t.log.is_reminded,"is-due":t.log.is_due,"type-id":t.log.activity_type_id,"user-id":t.log.user_id,note:t.log.note,description:t.log.description,"reminder-minutes-before":t.log.reminder_minutes_before,"due-date":t.log.due_date,"end-date":t.log.end_date,"attachments-count":t.log.media.length,media:t.log.media,authorizations:t.log.authorizations,comments:t.log.comments||[],associations:t.log.associations,"via-resource":t.resourceName,"via-resource-id":t.resourceId,"related-resource":t.resource},null,8,["activity-id","title","comments-count","is-completed","is-reminded","is-due","type-id","user-id","note","description","reminder-minutes-before","due-date","end-date","attachments-count","media","authorizations","comments","associations","via-resource","via-resource-id","related-resource"])])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key","icon","heading"]))}},oV={__name:"ActivitiesTypesIndex",setup(e){const t=Innoclapps.resourceName("activity-types"),{fetchActivityTypes:n}=$n();return(a,r)=>{const i=v("ICardHeading");return d(),R(vo,{"resource-name":l(t),"with-cancel":!1,onCreated:l(n),onUpdated:l(n),onDeleted:l(n)},{header:b(()=>[s(i,null,{default:b(()=>[Q(S(a.$t("activities::activity.type.types")),1)]),_:1})]),_:1},8,["resource-name","onCreated","onUpdated","onDeleted"])}}},lV={class:"border-y border-neutral-200 px-4 py-4 dark:border-neutral-700 sm:px-6"},aV={__name:"SettingsActivities",setup(e){const{resetStoreState:t}=Le(),{form:n,submit:a,isReady:r}=Gt(),i=q(null),{typesByName:u}=$n();function c(m){n.default_activity_type=m.id,a(t)}return An(r,()=>{i.value=u.value.find(m=>m.id==n.default_activity_type)}),(m,p)=>{const f=v("ICustomSelect"),h=v("IFormGroup"),g=v("ICard");return d(),k("div",null,[s(g,{"no-body":"",header:m.$t("activities::activity.activities"),class:"mb-3",overlay:!l(r)},{default:b(()=>[s(bo,null,{default:b(()=>[s(Tn,{modelValue:l(n).send_contact_attends_to_activity_mail,"onUpdate:modelValue":p[0]||(p[0]=y=>l(n).send_contact_attends_to_activity_mail=y),heading:m.$t("activities::activity.settings.send_contact_email"),description:m.$t("activities::activity.settings.send_contact_email_info"),onChange:l(a)},null,8,["modelValue","heading","description","onChange"])]),_:1}),o("div",lV,[s(h,{label:m.$t("activities::activity.type.default_type"),class:"mb-0","label-for":"default_activity_type"},{default:b(()=>[s(f,{modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=y=>i.value=y),"input-id":"default_activity_type",class:"xl:w-1/3",clearable:!1,label:"name",options:l(u),"onOption:selected":c},null,8,["modelValue","options"])]),_:1},8,["label"])])]),_:1},8,["header","overlay"]),s(oV)])}}};const sV={class:"flex items-center space-x-1"},rV=o("div",{class:"absolute -right-3 hidden text-neutral-900 dark:text-neutral-300 md:block"}," - ",-1),iV={__name:"ActivityDueDateField",props:ut,setup(e){const t=e,{appMoment:n,currentTimeFormat:a,dateFromAppTimezone:r,dateToAppTimezone:i}=Ne(),u=q(n().format("YYYY-MM-DD")),c=q(""),m=q(""),p=q(""),f=q(!1),h=q("");ge(m,(U,P)=>{Innoclapps.$emit("due-date-changed",{newVal:U,oldVal:P,isInitialValue:f.value})}),ge(p,(U,P)=>{if(Innoclapps.$emit("due-time-changed",{newVal:U,oldVal:P}),!c.value||c.value===m.value)return;let H=F(m.value,U),L=F(u.value,c.value),Z=F(m.value,P);$(r(H.add(L.diff(Z,"minutes"),"minutes").format("YYYY-MM-DD HH:mm:ss"),_.value))});const g=V(()=>!At(M.value,w())),y=V(()=>c.value&&!p.value),_=V(()=>moment().PHPconvertFormat(a.value)),I=V(()=>yl("00:00",15,"m",_.value));function F(U,P){return moment.utc(i(moment(U+" "+moment(U+" "+P,"YYYY-MM-DD "+_.value).format("HH:mm")).format("YYYY-MM-DD HH:mm:ss")))}function $(U){Innoclapps.$emit("update-end-time",U)}function C(U){const P=w();U.fill("due_date",P.date),U.fill("due_time",P.time||null)}function w(){if(p.value){const U=F(m.value,p.value);return{date:U.format("YYYY-MM-DD"),time:U.format("HH:mm")}}return{date:m.value,time:""}}function x(U){U&&(U.time?(m.value=r(U.date+" "+U.time,"YYYY-MM-DD"),p.value=r(U.date+" "+U.time,_.value)):(m.value=U.date,u.value=""))}function A(U){h.value=U,M.value=U,x(U)}function N(){if(f.value=!0,!t.field.value){const P=n().add(1,"hour").startOf("hour");p.value=r(P.format("YYYY-MM-DD HH:mm:ss"),_.value),m.value=r(P.format("YYYY-MM-DD HH:mm:ss"),"YYYY-MM-DD"),h.value={date:m.value,time:P.format("HH:mm")},Fe(()=>f.value=!1);return}let U=t.field.value;if(typeof U=="string"){let P=U.split(" ");U={date:P[0],time:P[1]||null}}h.value=U,x(h.value),Fe(()=>f.value=!1)}async function T(){await Fe(),!p.value&&c.value&&$("")}const{field:E,fieldId:B,isReadonly:z,realInitialValue:M,initialize:j}=ht(h,xe(t,"field"),t.formId,xe(t,"isFloating"),{isDirty:g,setInitialValue:N,handleChange:A,fill:C});return De(j),rt("end-time-changed",U=>c.value=U.newVal),rt("end-date-changed",U=>u.value=U.newVal),(U,P)=>{const H=v("IFormLabel"),L=v("DatePicker"),Z=v("IFormInputDropdown");return d(),R(it,{field:l(E),"form-id":U.formId,"field-id":l(B),class:"relative"},{default:b(()=>[s(H,{for:l(B)+"-due-date",class:X(["mb-1 block",l(E).hideLabel?"sm:hidden":""]),label:U.$t("activities::activity.due_date"),required:l(E).isRequired},null,8,["for","class","label","required"]),o("div",sV,[s(L,Re({id:l(B)+"-due-date",modelValue:m.value,"onUpdate:modelValue":P[0]||(P[0]=J=>m.value=J),name:l(E).attribute,disabled:l(z),"with-icon":!1,required:l(E).isRequired},l(E).attributes),null,16,["id","modelValue","name","disabled","required"]),s(Z,{modelValue:p.value,"onUpdate:modelValue":P[1]||(P[1]=J=>p.value=J),items:I.value,full:!1,placeholder:_.value,"input-id":l(B)+"-due-time","max-height":"300px",class:X({"border-danger-500 ring-danger-500 focus:border-danger-500 focus:ring-danger-500":y.value}),onBlur:T,onCleared:T},null,8,["modelValue","items","placeholder","input-id","class"]),rV])]),_:1},8,["field","form-id","field-id"])}}};const uV={class:"flex items-center space-x-1"},dV={__name:"ActivityEndDateField",props:ut,setup(e){const t=e,{appMoment:n,currentTimeFormat:a,dateFromAppTimezone:r,dateToAppTimezone:i}=Ne(),u=q(n().format("YYYY-MM-DD")),c=q(""),m=q(""),p=q(""),f=q("");ge(c,(M,j)=>{Innoclapps.$emit("end-time-changed",{newVal:M,oldVal:j})}),ge(u,(M,j)=>{Innoclapps.$emit("end-date-changed",{newVal:M,oldVal:j})});const h=V(()=>!At(B.value,A())),g=V(()=>moment().PHPconvertFormat(a.value)),y=V(()=>!!(!c.value&&p.value&&u.value>m.value)),_=V(()=>{if(!p.value||u.value>m.value)return yl("00:00",15,"m",g.value,23);const M=moment(m.value+" "+p.value,"YYYY-MM-DD "+g.value).format("HH:mm");return yl(M,15,"m",g.value,23)});function I(M,j){return moment.utc(i(moment(M+" "+moment(M+" "+j,"YYYY-MM-DD "+g.value).format("HH:mm")).format("YYYY-MM-DD HH:mm:ss")))}function F(M){const j=A();M.fill("end_date",j.date),M.fill("end_time",j.time||null)}function $(M){M&&(M.time?(u.value=r(M.date+" "+M.time,"YYYY-MM-DD"),c.value=r(M.date+" "+M.time,g.value),Fe(()=>{c.value===p.value&&u.value===m.value&&(c.value="")})):Fe(()=>{if(p.value){const j=I(m.value,p.value);u.value=r(M.date+" "+j.format("HH:mm"),"YYYY-MM-DD")}else u.value=M.date;c.value=""}))}function C(){c.value||(c.value=p.value)}function w(M){f.value=M,B.value=f.value,$(M)}function x(){if(!t.field.value){f.value={date:u.value,time:c.value};return}let M=t.field.value;if(typeof M=="string"){let j=M.split(" ");M={date:j[0],time:j[1]||null}}f.value=M,$(f.value)}function A(){if(c.value){const M=I(u.value,c.value);return{date:M.format("YYYY-MM-DD"),time:M.format("HH:mm")}}return{date:u.value,time:""}}const{field:N,fieldId:T,isReadonly:E,realInitialValue:B,initialize:z}=ht(f,xe(t,"field"),t.formId,xe(t,"isFloating"),{isDirty:h,setInitialValue:x,handleChange:w,fill:F});return De(z),rt("update-end-time",M=>c.value=M),rt("due-time-changed",M=>p.value=M.newVal),rt("due-date-changed",M=>{if(m.value=M.newVal,M.newVal!=u.value&&!M.isInitialValue)u.value=n(M.newVal).format("YYYY-MM-DD");else if(M.isInitialValue&&M.dueTime){const j=I(m.value,p.value),U=I(u.value,c.value||p.value);U.isSame(j,"day")||(U.add(j.diff(U,"day"),"day"),u.value=r(U.format("YYYY-MM-DD"),"YYYY-MM-DD"))}}),(M,j)=>{const U=v("IFormLabel"),P=v("IFormInputDropdown"),H=v("DatePicker");return d(),R(it,{field:l(N),"form-id":M.formId,"field-id":l(T)},{default:b(()=>[s(U,{for:l(T)+"-end-date",class:X(["mb-1 block",l(N).hideLabel?"sm:hidden":""]),label:M.$t("activities::activity.end_date"),required:l(N).isRequired},null,8,["for","class","label","required"]),o("div",uV,[s(P,{modelValue:c.value,"onUpdate:modelValue":j[0]||(j[0]=L=>c.value=L),items:_.value,"input-id":l(T)+"-end-time",full:!1,placeholder:g.value,disabled:!p.value,"max-height":"300px",class:X({"border-danger-500 ring-danger-500 focus:border-danger-500 focus:ring-danger-500":y.value}),onShown:C},null,8,["modelValue","items","input-id","placeholder","disabled","class"]),s(H,Re({id:l(T)+"-end-date",modelValue:u.value,"onUpdate:modelValue":j[1]||(j[1]=L=>u.value=L),required:l(N).isRequired,"min-date":m.value,"with-icon":!1,name:l(N).attribute,disabled:l(E)},l(N).attributes),null,16,["id","modelValue","required","min-date","name","disabled"])])]),_:1},8,["field","form-id","field-id"])}}},cV={__name:"ActivityTypeField",props:ut,setup(e){const t=e,{typesForIconPicker:n}=$n(),a=q("");function r(){a.value=qn(t.field.value)?null:typeof t.field.value=="object"?t.field.value.id:t.field.value}function i(f){let h=typeof f=="number"?f:f==null?void 0:f.id;a.value=h,m.value=h}const{field:u,fieldId:c,realInitialValue:m,initialize:p}=ht(a,xe(t,"field"),t.formId,xe(t,"isFloating"),{setInitialValue:r,handleChange:i});return De(p),(f,h)=>{const g=v("IFormLabel"),y=v("IIconPicker");return d(),R(it,{field:l(u),"field-id":l(c),"form-id":f.formId},{default:b(()=>[s(g,{for:l(c),class:"mb-1 block sm:hidden",label:f.$t("activities::activity.type.type")},null,8,["for","label"]),s(y,Re({modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=_=>a.value=_),icons:l(n),"value-field":"id",class:"flex-nowrap overflow-auto sm:flex-wrap sm:overflow-visible"},l(u).attributes),null,16,["modelValue","icons"])]),_:1},8,["field","field-id","form-id"])}}},mV=["textContent"],pV={class:"p-4"},fV=["onClick"],vV={class:"text-center text-sm text-neutral-600 dark:text-neutral-300"},bV={class:"text-center text-sm text-neutral-600 dark:text-neutral-300"},hV={class:"max-h-96 overflow-y-auto break-all px-1"},_V=["textContent"],Aa=2,gV=5,yV={__name:"ActivityGuestsSelect",props:{modelValue:{},contacts:{},guests:{},disabled:Boolean,placement:{type:String,default:"bottom"}},emits:["update:modelValue","change"],setup(e,{expose:t,emit:n}){const a=e,{t:r}=ve(),{setLoading:i,isLoading:u}=Ct(),c=q(0),m=q(!1),p=q(""),f=q({}),h=q({}),g=q({}),y={},_={contacts:{title:r("contacts::contact.contacts"),resource:"contacts"},users:{title:r("users::user.users"),resource:"users"}},{users:I}=Le();ge(f,U=>{n("update:modelValue",U)},{deep:!0}),ge(()=>a.guests,()=>{j()});const F=V(()=>Object.keys(_)),$=V(()=>Aa-c.value),C=V(()=>r("core::app.search_records")),w=V(()=>{let U=!1;return F.value.every(P=>(U=g.value[P]?g.value[P].records.length>0:!1,!U)),U}),x=V(()=>p.value!=""),A=V(()=>{let U=0;return F.value.forEach(P=>{U+=f.value[P]?f.value[P].length:0}),r("activities::activity.count_guests",U)}),N=V(()=>{if(w.value)return g.value;let U={},P=(H,L)=>{Xe(U[H].records,["id",Number(L.id)])===-1&&U[H].records.push(L)};return F.value.forEach(H=>{U[H]=Object.assign({},_[H],{records:[]}),a.guests&&Lt(a.guests,["resource_name",H]).forEach(L=>P(H,L)),h.value[H]&&h.value[H].records.forEach(L=>P(H,L))}),I.value.forEach(H=>P("users",H)),a.contacts.forEach(H=>P("contacts",H)),_t(U,H=>(H.records=En(H.records,"guest_display_name"),H))});function T(U){let P=[];return F.value.forEach(H=>{P.push(Innoclapps.request().get(`/${H}/search`,{params:{q:U,take:gV},cancelToken:new Nn(L=>y[H]=L)}))}),P}function E(){Object.keys(y).forEach(U=>{y[U]&&y[U]()})}function B(U,P,H){!h.value[P]&&H&&(h.value[P]={records:[],is_search:H}),Fe(()=>{if(f.value[P].includes(U.id)&&H)h.value[P].records.push(U);else if(h.value[P]){let L=Xe(h.value[P].records,["id",Number(U.id)]);L!=-1&&h.value[P].records.splice(L,1)}n("change",f.value)})}function z(){p.value="",M("")}const M=Dt(function(U){const P=U.length;if(P===0){g.value={};return}if(c.value=P,P<Aa)return m.value=!0,U;m.value=!1,E(),i(!0),Promise.all(T(U)).then(H=>{F.value.forEach((L,Z)=>{g.value[L]=Object.assign({},_[L],{records:_t(H[Z].data,J=>(J.from_search=!0,J)),is_search:!0})}),i(!1)})},650);function j(){let U={};F.value.forEach(P=>{let H=[];a.modelValue&&a.modelValue[P]&&(H=Wt(a.modelValue[P][0])?_t(a.modelValue[P],L=>L.id):a.modelValue[P]),a.guests&&(H=H.concat(Lt(a.guests,["resource_name",P]).map(L=>L.id))),U[P]=Al(H)}),f.value=U}return De(()=>{Fe(j)}),t({setSelectedGuests:j}),(U,P)=>{const H=v("IFormInput"),L=v("Icon"),Z=v("IFormGroup"),J=v("IFormCheckbox"),K=v("IOverlay"),G=v("IPopover"),oe=ae("t");return d(),R(G,{flip:"",busy:e.disabled,class:"w-72",title:U.$t("activities::activity.guests"),placement:e.placement,onHide:z},{popper:b(()=>[o("div",pV,[s(Z,{class:"relative"},{default:b(()=>[s(H,{modelValue:p.value,"onUpdate:modelValue":P[0]||(P[0]=pe=>p.value=pe),placeholder:C.value,class:"pr-8",onInput:l(M)},null,8,["modelValue","placeholder","onInput"]),D(o("a",{href:"#",class:"absolute right-3 top-2.5 focus:outline-none",onClick:ie(z,["prevent"])},[s(L,{icon:"X",class:"h-5 w-5 text-neutral-400"})],8,fV),[[Y,p.value]])]),_:1}),s(K,{show:l(u)},{default:b(()=>[D(o("p",vV,null,512),[[Y,x.value&&!w.value&&!l(u)&&!m.value],[oe,"core::app.no_search_results"]]),D(o("p",bV,null,512),[[Y,x.value&&m.value],[oe,{path:"core::app.type_more_to_search",args:{characters:$.value}}]]),o("div",hV,[(d(!0),k(te,null,re(N.value,pe=>(d(),k("div",{key:pe.resource},[D(o("p",{class:"mb-2 mt-3 text-sm font-medium text-neutral-700 dark:text-neutral-100",textContent:S(pe.title)},null,8,_V),[[Y,pe.records.length>0]]),(d(!0),k(te,null,re(pe.records,ue=>(d(),R(J,{id:pe.resource+"-"+ue.id,key:pe.resource+"-"+ue.id,checked:f.value[pe.resource],"onUpdate:checked":ee=>f.value[pe.resource]=ee,value:ue.id,onChange:ee=>B(ue,pe.resource,pe.is_search)},{default:b(()=>[Q(S(ue.guest_display_name)+" "+S(ue.guest_email?`(${ue.guest_email})`:""),1)]),_:2},1032,["id","checked","onUpdate:checked","value","onChange"]))),128))]))),128))])]),_:1},8,["show"])])]),default:b(()=>[o("button",{type:"button",class:"link text-sm focus:outline-none",textContent:S(A.value)},null,8,mV)]),_:1},8,["busy","title","placement"])}}},xV={class:"block"},IV={class:"inline-block"},kV={__name:"GuestsSelectField",props:ut,setup(e){const t=e,n=q(null),a=q(""),r=q([]),i=V(()=>t.field.contacts||[]);function u(y){a.value=y,h.value=y,r.value=y,Fe(()=>n.value&&n.value.setSelectedGuests())}function c(){r.value=t.field.value||[],a.value=qn(t.field.value)?{contacts:[],users:[]}:t.field.value}const{field:m,label:p,fieldId:f,realInitialValue:h,initialize:g}=ht(a,xe(t,"field"),t.formId,xe(t,"isFloating"),{handleChange:u,setInitialValue:c});return De(g),(y,_)=>(d(),R(it,{field:l(m),label:l(p),"form-id":y.formId,"field-id":l(f)},{default:b(()=>[o("div",xV,[o("div",IV,[s(yV,{ref_key:"guestsSelectRef",ref:n,modelValue:a.value,"onUpdate:modelValue":_[0]||(_[0]=I=>a.value=I),guests:r.value,contacts:i.value},null,8,["modelValue","guests","contacts"])])])]),_:1},8,["field","label","form-id","field-id"]))}},$V={key:0},wV={__name:"ActivityDueDateField",props:["column","row","field","resourceName","resourceId"],setup(e){const t=e,{localizedDate:n,localizedDateTime:a}=Ne(),r=V(()=>t.row[t.column.attribute]?t.row[t.column.attribute].indexOf(" ")>-1?a(t.row[t.column.attribute]):n(t.row[t.column.attribute]):"");return(i,u)=>{const c=v("IndexFieldsItem");return d(),R(c,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:m})=>[Q(S(r.value)+" ",1),m?O("",!0):(d(),k("span",$V,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},CV={key:0},SV={__name:"ActivityEndDateField",props:["column","row","field","resourceName","resourceId"],setup(e){const t=e,{localizedDate:n,localizedDateTime:a}=Ne(),r=V(()=>t.field.value?t.field.value.indexOf(" ")>-1?a(t.field.value):n(t.field.value):"");return(i,u)=>{const c=v("IndexFieldsItem");return d(),R(c,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:m})=>[Q(S(r.value)+" ",1),m?O("",!0):(d(),k("span",CV,""))]),_:1},8,["resource-name","resource-id","row","field"])}}},RV={__name:"ActivityTypeField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[s(Ht,{value:e.field.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"label-key":e.field.labelKey,"on-click-redirect-to":e.field.onOptionClickRedirectTo,"display-as-pills":!0},null,8,["value","resource-name","resource-id","label-key","on-click-redirect-to"])]),_:1},8,["resource-name","resource-id","row","field"])}}},FV={};function VV(e,t){const n=v("CreateActivityModal");return d(),R(n,{"with-extended-submit-buttons":!0})}const TV=ct(FV,[["render",VV]]),DV={class:"flex items-center"},qV={class:"absolute -top-2 right-5 sm:top-4"},EV={key:1,class:"mt-6 sm:mt-0"},AV={class:"-mt-2 block text-right"},BV={class:"-mt-2 block text-right"},NV={class:"-mt-2 block text-right"},OV={class:"my-3 text-right"},Ba={__name:"ActivitiesEdit",props:{onHidden:Function,onActionExecuted:Function,id:Number},setup(e){const t=e,n=Innoclapps.resourceName("activities"),{t:a}=ve(),r=Qe(),i=Ye(),{fields:u,getUpdateFields:c}=gt(),{form:m}=It(u),{localizedDateTime:p}=Ne(),f=q(!1),h=q(!1),g=q(!1),y=q(!1),_=Kn(()=>null,()=>document.querySelector("#modalClose-editActivityModal")),I=q(i.query.comment_id?1:0),F=V(()=>z.value?`${a("core::app.created_at")}: ${p(x.value.created_at)} - ${x.value.creator.name}`:null),$=V(()=>x.value.id||[]),C=V(()=>x.value.actions||[]),w=V(()=>Number(t.id||i.params.id)),{resource:x,fetchResource:A,synchronizeResource:N,incrementResourceCount:T,decrementResourceCount:E,updateResource:B}=fo(n,w);mt("synchronizeResource",N),mt("incrementResourceCount",T),mt("decrementResourceCount",E);const z=V(()=>u.value.isNotEmpty()),{getAllComments:M}=ln(w.value,n);function j(){M().then(J=>{N({comments:J}),f.value=!0})}function U(J){if(t.onActionExecuted){t.onActionExecuted(J);return}J.destroyable?r.push({name:"activity-index"}):Z()}function P(){_.trigger()}function H(){t.onHidden?t.onHidden():r.back()}async function L(){await B(m),Innoclapps.success(a("core::resource.updated"))}async function Z(){await A(),u.value.set(await c(n,w.value)).populate(x.value)}return Z(),(J,K)=>{var Ge;const G=v("FieldsPlaceholder"),oe=v("ITab"),pe=v("ITabList"),ue=v("FormFields"),ee=v("ITabPanel"),W=v("CommentsAdd"),ne=v("CommentsList"),ce=v("IOverlay"),fe=v("ITabPanels"),Se=v("ITabGroup"),Ie=v("CreateDealModal"),Ce=v("CreateContactModal"),le=v("CreateCompanyModal"),ye=v("ISlideover");return d(),R(ye,{id:"editActivityModal","ok-disabled":l(m).busy||!((Ge=l(x).authorizations)!=null&&Ge.update),"ok-title":J.$t("core::app.save"),"hide-footer":I.value===1,title:l(x).title,"sub-title":F.value,"initial-focus":l(_),visible:"",form:"","static-backdrop":"",onSubmit:L,onHidden:H,onShown:P},{title:b(({title:be})=>[o("div",DV,[z.value?(d(),R(Jo,{key:0,class:"mr-1 mt-0.5","tooltip-placement":"bottom","is-completed":l(x).is_completed,disabled:!l(x).authorizations.changeState,"activity-id":l(x).id,onStateChanged:l(N)},null,8,["is-completed","disabled","activity-id","onStateChanged"])):O("",!0),o("span",null,S(be),1)])]),default:b(()=>[o("div",qV,[l(u).isNotEmpty()?(d(),R(Qn,{key:0,type:"dropdown",ids:$.value,actions:C.value,"resource-name":l(n),onRun:U},null,8,["ids","actions","resource-name"])):O("",!0)]),l(u).isEmpty()?(d(),R(G,{key:0})):(d(),k("div",EV,[s(Se,{modelValue:I.value,"onUpdate:modelValue":K[8]||(K[8]=be=>I.value=be)},{default:b(()=>[s(pe,null,{default:b(()=>[s(oe,{title:J.$t("activities::activity.activity")},null,8,["title"]),s(oe,{title:J.$t("comments::comment.comments")+" ("+l(x).comments_count+")",onActivatedOnce:j},null,8,["title"])]),_:1}),s(fe,null,{default:b(()=>[s(ee,null,{default:b(()=>[s(ue,{fields:l(u),"form-id":l(m).formId,"resource-id":w.value,"resource-name":l(n)},{"after-deals-field":b(()=>[o("span",AV,[o("a",{href:"#",class:"link text-sm",onClick:K[0]||(K[0]=ie(be=>h.value=!0,["prevent"]))}," + "+S(J.$t("deals::deal.create")),1)])]),"after-companies-field":b(()=>[o("span",BV,[o("a",{href:"#",class:"link text-sm",onClick:K[1]||(K[1]=ie(be=>y.value=!0,["prevent"]))}," + "+S(J.$t("contacts::company.create")),1)])]),"after-contacts-field":b(()=>[o("span",NV,[o("a",{href:"#",class:"link text-sm",onClick:K[2]||(K[2]=ie(be=>g.value=!0,["prevent"]))}," + "+S(J.$t("contacts::contact.create")),1)])]),_:1},8,["fields","form-id","resource-id","resource-name"]),s(kn,{class:"mt-5","resource-name":l(n),"resource-id":l(x).id,media:l(x).media,"authorize-delete":l(x).authorizations.update,onDeleted:K[3]||(K[3]=be=>l(N)({media:{id:be.id,_delete:!0}})),onUploaded:K[4]||(K[4]=be=>l(N)({media:[be]}))},null,8,["resource-name","resource-id","media","authorize-delete"])]),_:1}),s(ee,{lazy:""},{default:b(()=>[o("div",OV,[s(W,{"commentable-id":l(x).id,"commentable-type":"activities",onCreated:K[5]||(K[5]=be=>(l(T)("comments_count"),l(N)({comments:[be]})))},null,8,["commentable-id"])]),s(ce,{show:!f.value},{default:b(()=>[f.value?(d(),R(ne,{key:0,comments:l(x).comments||[],"commentable-type":"activities","commentable-id":l(x).id,"auto-focus-if-required":!0,onUpdated:K[6]||(K[6]=be=>l(N)({comments:be})),onDeleted:K[7]||(K[7]=be=>(l(E)("comments_count"),l(N)({comments:{id:be,_delete:!0}})))},null,8,["comments","commentable-id"])):O("",!0)]),_:1},8,["show"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])),s(Ie,{visible:h.value,"onUpdate:visible":K[9]||(K[9]=be=>h.value=be),overlay:!1,onCreated:K[10]||(K[10]=be=>(l(u).mergeValue("deals",be.deal),h.value=!1))},null,8,["visible"]),s(Ce,{visible:g.value,"onUpdate:visible":K[11]||(K[11]=be=>g.value=be),overlay:!1,onCreated:K[12]||(K[12]=be=>(l(u).mergeValue("contacts",be.contact),g.value=!1)),onRestored:K[13]||(K[13]=be=>(l(u).mergeValue("contacts",be),g.value=!1))},null,8,["visible"]),s(le,{visible:y.value,"onUpdate:visible":K[14]||(K[14]=be=>y.value=be),overlay:!1,onCreated:K[15]||(K[15]=be=>(l(u).mergeValue("companies",be.company),y.value=!1)),onRestored:K[16]||(K[16]=be=>(l(u).mergeValue("companies",be),y.value=!1))},null,8,["visible"])]),_:1},8,["ok-disabled","ok-title","hide-footer","title","sub-title","initial-focus"])}}},zV=o("option",{value:"csv"},"CSV",-1),MV=o("option",{value:"xls"},"XLS",-1),UV=o("option",{value:"xlsx"},"XLSX",-1),PV={class:"sm:ml-6"},jV={key:1},LV={class:"grid grid-cols-3 gap-x-4 gap-y-2"},HV={class:"mt-5 rounded-md border border-neutral-200 bg-neutral-50 p-3 dark:border-neutral-500 dark:bg-neutral-700"},go={__name:"ResourceExport",props:{resourceName:String,filtersView:String,title:String,urlPath:{required:!0,type:String},modalId:{default:"export-modal",type:String}},setup(e){const t=e,{t:n}=ve(),{appMoment:a}=Ne(),{form:r}=Ae({period:"last_7_days",type:"csv",fields:[],customPeriod:{start:a().startOf("month").format("YYYY-MM-DD"),end:a().format("YYYY-MM-DD")}}),i=q([]),u=q(!1),c=[{text:n("core::dates.today"),value:"today"},{text:n("core::dates.periods.7_days"),value:"last_7_days"},{text:n("core::dates.this_month"),value:"this_month"},{text:n("core::dates.last_month"),value:"last_month"},{text:n("core::app.all"),value:"all",id:"all"},{text:n("core::dates.custom"),value:"custom",id:"custom"}],{queryBuilderRules:m,hasRulesApplied:p,rulesAreValid:f}=pn(t.resourceName,t.filtersView),h=q(!0),g=q(!1),y=V(()=>t.title||n("core::app.export.export")),_=V(()=>r.period==="custom"),I=V(()=>p.value&&f.value);function F(w){return w.headers["content-disposition"].split("filename=")[1]}mn(u,async()=>{i.value=await $(),r.fields.length===0&&i.value.forEach(w=>{r.fields.push(w.attribute)})});async function $(){const{data:w}=await Innoclapps.request().get(`${t.resourceName}/export-fields`);return w}function C(){g.value=!0,Innoclapps.request().post(t.urlPath,{fields:u.value?r.fields:null,period:_.value?r.customPeriod:r.period==="all"?null:r.period,type:r.type,filters:h.value&&I.value?m.value:null},{responseType:"blob"}).then(w=>{so(w.data,F(w))}).finally(()=>g.value=!1)}return(w,x)=>{const A=v("IFormSelect"),N=v("IFormGroup"),T=v("IFormRadio"),E=v("IFormLabel"),B=v("DateRangePicker"),z=v("IFormCheckbox"),M=v("IModal");return d(),R(M,{id:e.modalId,title:y.value,"ok-loading":g.value,"ok-disabled":g.value,"ok-title":w.$t("core::app.export.export"),onOk:C},{default:b(()=>[s(N,{label:w.$t("core::app.export.type")},{default:b(()=>[s(A,{modelValue:l(r).type,"onUpdate:modelValue":x[0]||(x[0]=j=>l(r).type=j)},{default:b(()=>[zV,MV,UV]),_:1},8,["modelValue"])]),_:1},8,["label"]),s(N,{class:"space-y-1",label:w.$t("core::dates.range")+" ("+w.$t("core::app.creation_date")+")"},{default:b(()=>[(d(),k(te,null,re(c,j=>s(T,{id:j.id,key:j.text,modelValue:l(r).period,"onUpdate:modelValue":U=>l(r).period=U,value:j.value,name:"period",label:j.text},null,8,["id","modelValue","onUpdate:modelValue","value","label"])),64))]),_:1},8,["label"]),_.value?(d(),R(N,{key:0},{default:b(()=>[o("div",PV,[s(E,{label:"Select Range",for:"custom-period-start",class:"mb-1"}),s(B,{id:"custom-period",modelValue:l(r).customPeriod,"onUpdate:modelValue":x[1]||(x[1]=j=>l(r).customPeriod=j),name:"custom-period"},null,8,["modelValue"])])]),_:1})):O("",!0),s(N,{class:"mt-6 space-y-1"},{default:b(()=>[s(T,{modelValue:u.value,"onUpdate:modelValue":x[2]||(x[2]=j=>u.value=j),label:w.$t("core::fields.all"),name:"select_fields",value:!1},null,8,["modelValue","label"]),s(T,{modelValue:u.value,"onUpdate:modelValue":x[3]||(x[3]=j=>u.value=j),label:w.$t("core::fields.select"),name:"select_fields",value:!0},null,8,["modelValue","label"])]),_:1}),u.value?(d(),k("div",jV,[o("div",LV,[(d(!0),k(te,null,re(i.value,j=>(d(),k("div",{key:j.attribute,class:"flex items-center rounded border border-neutral-200 px-2 py-1.5 dark:border-neutral-700"},[s(z,{id:j.attribute,checked:l(r).fields,"onUpdate:checked":x[4]||(x[4]=U=>l(r).fields=U),label:j.label,value:j.attribute,disabled:j.primary},null,8,["id","checked","label","value","disabled"])]))),128))])])):O("",!0),D(o("div",HV,[s(z,{checked:h.value,"onUpdate:checked":x[5]||(x[5]=j=>h.value=j),label:w.$t("core::app.export.apply_filters")},null,8,["checked","label"])],512),[[Y,I.value]])]),_:1},8,["id","title","ok-loading","ok-disabled","ok-title"])}}},Ft={__name:"TableRowAction",props:["icon","tooltip","to"],emits:["click"],setup(e){return(t,n)=>{const a=v("Icon"),r=ae("i-tooltip");return D((d(),R(We(e.to?"router-link":"a"),{href:"#",to:e.to,class:"text-neutral-400 hover:text-neutral-600",onClick:n[0]||(n[0]=ie(i=>t.$emit("click",i),["prevent"]))},{default:b(()=>[de(t.$slots,"default",{},()=>[s(a,{icon:e.icon,class:"h-4 w-4 text-current"},null,8,["icon"])])]),_:3},8,["to"])),[[r,e.tooltip]])}}},GV={},KV={class:"flex items-center justify-center space-x-2 text-neutral-400"};function YV(e,t){return d(),k("div",KV,[de(e.$slots,"default")])}const Mn=ct(GV,[["render",YV]]),WV={class:"mt-1 flex w-full items-center overflow-x-auto py-1"},Na={__name:"ActivitiesTableTypePicker",props:["modelValue"],emits:["update:modelValue"],setup(e,{emit:t}){const n=e,{hasBuilderRules:a,rulesAreValid:r,findRule:i}=pn("activities"),{typesForIconPicker:u}=$n(),c=q(n.modelValue),m=V(()=>!!i("activity_type_id")),p=V(()=>m.value||!r.value);return ge(c,f=>{t("update:modelValue",f)}),ge(a,f=>{f&&r.value&&(c.value=void 0)}),ge(r,f=>{a.value&&f&&(c.value=void 0)}),(f,h)=>{const g=v("IIconPicker"),y=ae("t"),_=ae("i-tooltip");return d(),k("div",WV,[D(o("a",{href:"#",class:"link mr-3 border-r-2 border-neutral-200 pr-3 dark:border-neutral-600",onClick:h[0]||(h[0]=ie(I=>c.value=null,["prevent"]))},null,512),[[Y,c.value&&!p.value],[y,"core::app.all"]]),D(s(g,{modelValue:c.value,"onUpdate:modelValue":h[1]||(h[1]=I=>c.value=I),class:"min-w-max",icons:l(u),"value-field":"id",disabled:p.value},null,8,["modelValue","icons","disabled"]),[[_,m.value?f.$t("activities::activity.filters.activity_type_disabled"):""]])])}}},QV={class:"mb-2 block lg:hidden"},XV={class:"hidden lg:ml-6 lg:block"},ZV={class:"ml-auto flex items-center text-sm"},JV={class:"font-medium text-neutral-800 dark:text-neutral-300"},eT=Object.assign({inheritAttrs:!1},{__name:"ActivitiesTable",props:{tableId:{required:!0,type:String},initialize:{default:!0,type:Boolean}},emits:["deleted"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("activities"),{t:r}=ve(),{reloadTable:i}=Bt(),{deleteResource:u}=Je(a),c=q(void 0),m=V(()=>({activity_type_id:c.value}));function p(h){return{"has-warning":!0,"warning-confirmed":h.is_due,"has-success":!0,"success-confirmed":h.is_completed}}async function f(h){await Innoclapps.dialog().confirm(),await u(h),t("deleted",h),i(n.tableId),Innoclapps.success(r("core::resource.deleted"))}return(h,g)=>{const y=v("router-view"),_=ae("t");return d(),k(te,null,[o("div",QV,[s(Na,{modelValue:c.value,"onUpdate:modelValue":g[0]||(g[0]=I=>c.value=I)},null,8,["modelValue"])]),e.initialize?(d(),R(l(tn),Re({key:0,"resource-name":l(a),"row-class":p,"data-request-query-string":m.value,"table-id":e.tableId,"empty-state":{to:{name:"create-activity"},title:h.$t("activities::activity.empty_state.title"),buttonText:h.$t("activities::activity.create"),description:h.$t("activities::activity.empty_state.description"),secondButtonText:h.$t("core::import.from_file",{file_type:"CSV"}),secondButtonIcon:"DocumentAdd",secondButtonTo:{name:"import-resource",params:{resourceName:l(a)}}}},h.$attrs),{"after-search":b(({collection:I})=>[o("div",XV,[s(Na,{modelValue:c.value,"onUpdate:modelValue":g[1]||(g[1]=F=>c.value=F)},null,8,["modelValue"])]),o("div",ZV,[D(o("span",JV,null,512),[[_,{path:"activities::activity.count",args:{count:I.state.meta.total}}]])])]),actions:b(({row:I})=>[s(Mn,null,{default:b(()=>[I.authorizations.changeState?(d(),R(Jo,{key:0,class:"mt-1.5","is-completed":I.is_completed,"activity-id":I.id,onStateChanged:g[2]||(g[2]=F=>l(i)(e.tableId))},null,8,["is-completed","activity-id"])):O("",!0),I.authorizations.delete?(d(),R(Ft,{key:1,tooltip:h.$t("core::app.delete"),icon:"Trash",onClick:F=>f(I.id)},null,8,["tooltip","onClick"])):O("",!0)]),_:2},1024)]),_:1},16,["resource-name","data-request-query-string","table-id","empty-state"])):O("",!0),s(y,{name:"edit"})],64)}}}),tT={class:"inline-flex items-center"},nT={class:"mr-3 lg:mr-6"},Co="activities",oT={__name:"ActivitiesIndex",setup(e){const t=Innoclapps.resourceName("activities"),n=Ye(),{reloadTable:a,customizeTable:r}=Bt(),i=q(n.meta.initialize);function u(){i.value&&a(Co)}return yn((c,m,p)=>{i.value=!0,p()}),(c,m)=>{const p=v("NavbarSeparator"),f=v("IDropdownItem"),h=v("IMinimalDropdown"),g=v("IButton"),y=v("IButtonGroup"),_=v("router-view"),I=v("ILayout"),F=ae("i-tooltip");return d(),R(I,null,{actions:b(()=>[s(p,{class:"hidden lg:block"}),o("div",tT,[o("div",nT,[s(h,{type:"horizontal"},{default:b(()=>[s(f,{icon:"DocumentAdd",to:{name:"import-resource",params:{resourceName:l(t)}},text:c.$t("core::import.import")},null,8,["to","text"]),c.$gate.userCan("export activities")?(d(),R(f,{key:0,icon:"DocumentDownload",text:c.$t("core::app.export.export"),onClick:m[0]||(m[0]=$=>c.$iModal.show("export-modal"))},null,8,["text"])):O("",!0),s(f,{icon:"Trash",to:{name:"trashed-resource-records",params:{resourceName:l(t)}},text:c.$t("core::app.soft_deletes.trashed")},null,8,["to","text"]),s(f,{icon:"Cog",text:c.$t("core::table.list_settings"),onClick:m[1]||(m[1]=$=>l(r)(Co))},null,8,["text"])]),_:1})]),s(y,{class:"mr-5"},{default:b(()=>[D(s(g,{size:"sm",class:"relative bg-neutral-100 focus:z-10",to:{name:"activity-index"},icon:"Bars3","icon-class":"w-4 h-4 text-neutral-700 dark:text-neutral-100",variant:"white"},null,512),[[F,c.$t("core::app.list_view"),void 0,{bottom:!0}]]),D(s(g,{size:"sm",class:"relative focus:z-10",to:{name:"activity-calendar"},variant:"white",icon:"Calendar","icon-class":"w-4 h-4 text-neutral-500 dark:text-neutral-400"},null,512),[[F,c.$t("activities::calendar.calendar"),void 0,{bottom:!0}]])]),_:1}),s(g,{to:{name:"create-activity"},icon:"Plus",size:"sm",text:c.$t("activities::activity.create")},null,8,["text"])])]),default:b(()=>[s(eT,{"table-id":Co,initialize:i.value,"filter-id":c.$route.query.filter_id?Number(c.$route.query.filter_id):void 0},null,8,["initialize","filter-id"]),s(l(go),{"url-path":"/activities/export","resource-name":l(t),"filters-view":Co,title:c.$t("activities::activity.export")},null,8,["resource-name","title"]),s(_,{name:"create",onCreated:m[2]||(m[2]=({isRegularAction:$,action:C})=>(u(),$||C==="go-to-list"?c.$router.back():void 0)),onModalHidden:c.$router.back},null,8,["onModalHidden"])]),_:1})}}},lT={},aT={id:"Layer_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"40px",viewBox:"0 0 512 512",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve"},sT=o("path",{style:{fill:"#fbbb00"},d:`M113.47,309.408L95.648,375.94l-65.139,1.378C11.042,341.211,0,299.9,0,256
    c0-42.451,10.324-82.483,28.624-117.732h0.014l57.992,10.632l25.404,57.644c-5.317,15.501-8.215,32.141-8.215,49.456
    C103.821,274.792,107.225,292.797,113.47,309.408z`},null,-1),rT=o("path",{style:{fill:"#518ef8"},d:`M507.527,208.176C510.467,223.662,512,239.655,512,256c0,18.328-1.927,36.206-5.598,53.451
    c-12.462,58.683-45.025,109.925-90.134,146.187l-0.014-0.014l-73.044-3.727l-10.338-64.535
    c29.932-17.554,53.324-45.025,65.646-77.911h-136.89V208.176h138.887L507.527,208.176L507.527,208.176z`},null,-1),iT=o("path",{style:{fill:"#28b446"},d:`M416.253,455.624l0.014,0.014C372.396,490.901,316.666,512,256,512
    c-97.491,0-182.252-54.491-225.491-134.681l82.961-67.91c21.619,57.698,77.278,98.771,142.53,98.771
    c28.047,0,54.323-7.582,76.87-20.818L416.253,455.624z`},null,-1),uT=o("path",{style:{fill:"#f14336"},d:`M419.404,58.936l-82.933,67.896c-23.335-14.586-50.919-23.012-80.471-23.012
    c-66.729,0-123.429,42.957-143.965,102.724l-83.397-68.276h-0.014C71.23,56.123,157.06,0,256,0
    C318.115,0,375.068,22.126,419.404,58.936z`},null,-1),dT=[sT,rT,iT,uT];function cT(e,t){return d(),k("svg",aT,dT)}const Os=ct(lT,[["render",cT]]),mT={},pT={id:"Capa_1",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"40px",viewBox:"0 0 512 512",style:{"enable-background":"new 0 0 512 512"},"xml:space":"preserve"},fT=o("path",{style:{fill:"#1976d2"},d:`M496,112.011H272c-8.832,0-16,7.168-16,16s7.168,16,16,16h177.376l-98.304,76.448l-70.496-44.832
    l-17.152,27.008l80,50.88c2.592,1.664,5.6,2.496,8.576,2.496c3.456,0,6.944-1.12,9.824-3.36L480,160.715v207.296H272
    c-8.832,0-16,7.168-16,16s7.168,16,16,16h224c8.832,0,16-7.168,16-16v-256C512,119.179,504.832,112.011,496,112.011z`},null,-1),vT=o("path",{style:{fill:"#2196f3"},d:`M282.208,19.691c-3.648-3.04-8.544-4.352-13.152-3.392l-256,48C5.472,65.707,0,72.299,0,80.011v352
    c0,7.68,5.472,14.304,13.056,15.712l256,48c0.96,0.192,1.952,0.288,2.944,0.288c3.712,0,7.328-1.28,10.208-3.68
    c3.68-3.04,5.792-7.584,5.792-12.32v-448C288,27.243,285.888,22.731,282.208,19.691z`},null,-1),bT=o("path",{style:{fill:"#fafafa"},d:`M144,368.011c-44.096,0-80-43.072-80-96s35.904-96,80-96s80,43.072,80,96
    S188.096,368.011,144,368.011z M144,208.011c-26.464,0-48,28.704-48,64s21.536,64,48,64s48-28.704,48-64
    S170.464,208.011,144,208.011z`},null,-1),hT=[fT,vT,bT];function _T(e,t){return d(),k("svg",pT,hT)}const zs=ct(mT,[["render",_T]]),gT={class:"py-4"},yT={class:"mb-5 text-center text-neutral-800 dark:text-neutral-200"},xT={class:"flex justify-center space-x-2"},IT={class:"p-4 text-sm"},kT={class:"whitespace-pre-wrap"},$T=o("span",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-300"}," Google Calendar ",-1),wT={class:"p-4 text-sm"},CT={class:"whitespace-pre-wrap"},ST=o("span",{class:"text-sm font-medium text-neutral-600 dark:text-neutral-300"}," Outlook Calendar ",-1),RT={__name:"CalendarSyncConnectAccount",setup(e){const{isGoogleApiConfigured:t,isMicrosoftGraphConfigured:n}=Le(),a=q(null),r=q(null);function i(u){if(u==="google"&&!t()){a.value.show();return}else if(u==="microsoft"&&!n()){r.value.show();return}window.location.href=`${Innoclapps.config("url")}/calendar/sync/${u}/connect`}return(u,c)=>{const m=v("RouterLink"),p=v("IPopover"),f=v("IModal"),h=ae("t");return d(),R(f,{id:"calendarConnectNewAccount",size:"sm","hide-footer":"",title:u.$t("core::oauth.connect_new_account")},{default:b(()=>[o("div",gT,[D(o("p",yT,null,512),[[h,"activities::calendar.choose_oauth_account"]]),o("div",xT,[o("div",{class:"flex cursor-pointer flex-col items-center space-y-1 rounded-lg border border-neutral-200 px-5 py-3 shadow-sm hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-800",onClick:c[1]||(c[1]=g=>i("google"))},[s(p,{ref_key:"googlePopoverRef",ref:a,class:"max-w-xs sm:max-w-sm",disabled:l(t)(),placement:"top"},{popper:b(()=>[o("div",IT,[o("p",kT,S(u.$t("activities::calendar.missing_google_integration")),1),u.$gate.isSuperAdmin()?D((d(),R(m,{key:0,href:"/settings/integrations/google",class:"link mt-2 block text-right",to:{name:"settings-integrations-google"}},null,512)),[[h,"core::settings.go_to_settings"]]):O("",!0)])]),default:b(()=>[s(Os,{onClick:c[0]||(c[0]=g=>l(t)()?i("google"):void 0)})]),_:1},8,["disabled"]),$T]),o("div",{class:"flex cursor-pointer flex-col items-center space-y-1 rounded-lg border border-neutral-200 px-5 py-3 shadow-sm hover:bg-neutral-100 dark:border-neutral-500 dark:hover:bg-neutral-800",onClick:c[3]||(c[3]=g=>i("microsoft"))},[s(p,{ref_key:"microsoftPopoverRef",ref:r,placement:"top",class:"max-w-xs sm:max-w-sm",disabled:l(n)()},{popper:b(()=>[o("div",wT,[o("p",CT,S(u.$t("activities::calendar.missing_outlook_integration")),1),u.$gate.isSuperAdmin()?D((d(),R(m,{key:0,href:"/settings/integrations/google",class:"link mt-2 block text-right",to:{name:"settings-integrations-microsoft"}},null,512)),[[h,"core::settings.go_to_settings"]]):O("",!0)])]),default:b(()=>[s(zs,{onClick:c[2]||(c[2]=g=>l(n)()?i("microsoft"):void 0)})]),_:1},8,["disabled"]),ST])])])]),_:1},8,["title"])}}},FT={class:"mx-auto max-w-5xl"},VT={key:1},TT={key:0,class:"mb-4"},DT={class:"mt-3 block text-neutral-800 dark:text-neutral-300 sm:mt-0 sm:inline"},qT={key:1},ET={key:2,class:"mt-4"},AT=["textContent"],BT={class:"mb-3"},NT={key:0,class:"mb-6 text-neutral-800 dark:text-neutral-100"},OT={class:"grid grid-cols-12 gap-1 lg:gap-6"},zT={class:"col-span-12 self-start lg:col-span-3 lg:flex lg:items-center lg:justify-end"},MT={class:"font-medium text-neutral-800 dark:text-neutral-100 lg:text-sm"},UT={class:"col-span-12 lg:col-span-4"},PT={class:"mb-3"},jT={class:"grid grid-cols-12 gap-1 lg:gap-6"},LT={class:"col-span-12 lg:col-span-3 lg:flex lg:items-center lg:justify-end"},HT={class:"font-medium text-neutral-800 dark:text-neutral-100 lg:text-sm"},GT={class:"col-span-12 lg:col-span-4"},KT={class:"grid grid-cols-12 gap-1 lg:gap-6"},YT={class:"col-span-12 lg:col-span-3 lg:text-right"},WT={class:"font-medium text-neutral-800 dark:text-neutral-100 lg:text-sm"},QT={class:"col-span-12 lg:col-span-4"},XT={class:"flex flex-col lg:flex-row lg:items-center"},ZT={class:"mb-2 grow lg:mb-0"},JT={key:0,class:"text-sm text-neutral-800 dark:text-neutral-100"},eD={class:"space-x-2"},tD={__name:"CalendarSync",setup(e){const{t}=ve(),n=Ye(),{localizedDateTime:a}=Ne(),r=q(!1),i=q(!1),u=q(null),c=q(null),m=q(null),p=q(!1),f=q([]),h=q([]),{form:g}=Ae(),{typesByName:y}=$n(),_=V(()=>f.value.length>0),I=V(()=>y.value.find(z=>z.id==g.activity_type_id)),F=V(()=>h.value.find(z=>z.id==g.calendar_id)),$=V(()=>!m.value||!m.value.account?!1:m.value.account.requires_auth),C=V(()=>{if(!c.value&&!m.value||m.value&&m.value.is_sync_stopped)return"";if(!m.value)return t("activities::calendar.only_future_events_will_be_synced");const z=Lt(m.value.previously_used,["calendar_id",g.calendar_id]);return m.value.calendar_id===g.calendar_id&&!c.value?t("activities::calendar.events_being_synced_from",{date:a(m.value.start_sync_from)}):c.value||m.value.calendar_id!==g.calendar_id?z.length>0?t("activities::calendar.events_will_sync_from",{date:a(z[0].start_sync_from)}):m.value.calendar_id===g.calendar_id?t("activities::calendar.events_will_sync_from",{date:a(m.value.start_sync_from)}):t("activities::calendar.only_future_events_will_be_synced"):""});function w(){return ot(f.value,z=>new Date(z.created_at),["desc"])[0]}function x(){g.clear().set({access_token_id:null,activity_type_id:Innoclapps.config("activities.default_activity_type_id"),activity_types:y.value.map(z=>z.id),calendar_id:null})}function A(z){c.value=z,g.fill("access_token_id",z.id),E(z.id).then(M=>{g.set("calendar_id",M[0].id)})}function N(){g.post("/calendar/account").then(z=>{m.value=z,c.value=null})}function T(){p.value=!0,Innoclapps.request().delete("/calendar/account").then(({data:z})=>{m.value=z,c.value=null,x()}).finally(()=>p.value=!1)}async function E(z){i.value=!0,u.value=null;try{let{data:M}=await Innoclapps.request().get(`/calendars/${z}`);return h.value=M,M}catch(M){throw u.value=M.response.data.message,M}finally{i.value=!1}}function B(z){g.set({activity_type_id:z.activity_type_id,activity_types:z.activity_types,access_token_id:z.account?z.account.id:null})}return x(),Promise.all([Innoclapps.request().get("oauth/accounts"),Innoclapps.request().get("calendar/account")]).then(z=>{f.value=z[0].data,m.value=z[1].data,m.value&&B(m.value),n.query.viaOAuth?A(w()):m.value.account&&!$.value&&E(m.value.account.id).then(()=>{g.set("calendar_id",m.value.calendar_id)}),r.value=!0}),(z,M)=>{const j=v("Icon"),U=v("IBadge"),P=v("ICardHeading"),H=v("IAlert"),L=v("IButton"),Z=v("ICustomSelect"),J=v("IFormText"),K=v("IFormError"),G=v("IFormCheckbox"),oe=v("ICard"),pe=v("ILayout"),ue=ae("i-modal"),ee=ae("t");return d(),R(pe,null,{default:b(()=>[o("div",FT,[s(oe,{overlay:!r.value},vt({header:b(()=>[s(P,{class:"flex items-center"},{default:b(()=>[Q(S(z.$t("activities::calendar.calendar_sync"))+" ",1),m.value&&!m.value.is_sync_disabled&&!m.value.is_sync_stopped?(d(),R(U,{key:0,variant:"success","wrapper-class":"ml-2"},{default:b(()=>[s(j,{icon:"Refresh",class:"mr-1 h-3 w-3"}),Q(" "+S(m.value.is_synchronizing_via_webhook?"Webhook":"Polling"),1)]),_:1})):O("",!0)]),_:1})]),default:b(()=>[u.value?(d(),R(H,{key:0,variant:"warning",dismissible:"",class:"mb-4",onDismissed:M[0]||(M[0]=W=>u.value=null)},{default:b(()=>[Q(S(u.value),1)]),_:1})):O("",!0),(!m.value||m.value&&m.value.is_sync_disabled||!m.value.account)&&!c.value?(d(),k("div",VT,[s(RT),!m.value||m.value&&m.value.is_sync_disabled?(d(),k("div",TT,[D(s(L,{variant:"secondary",text:z.$t("core::oauth.add"),class:X({"mr-1":_.value})},null,8,["text","class"]),[[ue,"calendarConnectNewAccount"]]),D(o("span",DT,null,512),[[Y,_.value],[ee,"core::oauth.or_choose_existing"]])])):O("",!0),_.value&&!c.value?(d(),k("div",qT,[(d(!0),k(te,null,re(f.value,W=>(d(),R(zo,{key:W.id,class:"mb-3",account:W},{default:b(()=>[s(L,{size:"sm",variant:"secondary",class:"ml-2",disabled:W.requires_auth,text:z.$t("core::oauth.connect"),onClick:ne=>A(W)},null,8,["disabled","text","onClick"])]),_:2},1032,["account"]))),128))])):O("",!0)])):O("",!0),c.value||m.value&&!m.value.is_sync_disabled?(d(),k("div",ET,[m.value&&!m.value.is_sync_disabled&&m.value.account?(d(),R(zo,{key:0,class:"mb-5",account:m.value.account},vt({default:b(()=>[s(L,{size:"sm",variant:"danger",class:"ml-2",disabled:p.value,loading:p.value,onClick:T},{default:b(()=>[Q(S(m.value.is_sync_stopped?z.$t("core::app.cancel"):z.$t("core::oauth.stop_syncing")),1)]),_:1},8,["disabled","loading"])]),_:2},[m.value.sync_state_comment?{name:"after-name",fn:b(()=>[o("span",{class:"text-sm text-danger-500",textContent:S(m.value.sync_state_comment)},null,8,AT)]),key:"0"}:void 0]),1032,["account"])):O("",!0),o("div",BT,[!m.value||m.value&&m.value.is_sync_disabled?(d(),k("p",NT,S(z.$t("activities::calendar.account_being_connected",{email:c.value.email})),1)):O("",!0),o("div",OT,[o("div",zT,[D(o("p",MT,null,512),[[ee,"activities::calendar.calendar"]])]),o("div",UT,[s(Z,{options:h.value,"model-value":F.value,label:"title",disabled:$.value,placeholder:i.value?z.$t("core::app.loading"):"",clearable:!1,"onOption:selected":M[1]||(M[1]=W=>l(g).calendar_id=W.id)},null,8,["options","model-value","disabled","placeholder"]),D(s(J,{class:"mt-2"},null,512),[[ee,"activities::calendar.sync_support_only_primary"]]),s(K,{textContent:S(l(g).getError("calendar_id"))},null,8,["textContent"])])])]),o("div",PT,[o("div",jT,[o("div",LT,[D(o("p",HT,null,512),[[ee,"activities::calendar.save_events_as"]])]),o("div",GT,[s(Z,{options:l(y),"model-value":I.value,label:"name",clearable:!1,"onOption:selected":M[2]||(M[2]=W=>l(g).activity_type_id=W.id)},null,8,["options","model-value"]),s(K,{textContent:S(l(g).getError("activity_type_id"))},null,8,["textContent"])])])]),o("div",KT,[o("div",YT,[D(o("p",WT,null,512),[[ee,"activities::calendar.sync_activity_types"]])]),o("div",QT,[(d(!0),k(te,null,re(l(y),W=>(d(),R(G,{key:W.id,checked:l(g).activity_types,"onUpdate:checked":M[3]||(M[3]=ne=>l(g).activity_types=ne),value:W.id,label:W.name,name:"activity_types"},null,8,["checked","value","label"]))),128)),s(K,{textContent:S(l(g).getError("activity_types"))},null,8,["textContent"])])])])):O("",!0)]),_:2},[c.value||m.value&&!m.value.is_sync_disabled?{name:"footer",fn:b(()=>[o("div",null,[o("div",XT,[o("div",ZT,[C.value?(d(),k("span",JT,[s(j,{icon:"ExclamationTriangle",class:"-mt-1 mr-1 inline-flex h-5 w-5"}),Q(" "+S(C.value),1)])):O("",!0)]),o("div",eD,[!m.value||m.value&&m.value.is_sync_disabled||m.value.is_sync_stopped?(d(),R(L,{key:0,disabled:l(g).busy,text:z.$t("core::app.cancel"),onClick:M[4]||(M[4]=W=>c.value=null)},null,8,["disabled","text"])):O("",!0),D(s(L,{variant:"secondary",disabled:l(g).busy,loading:l(g).busy,onClick:N},{default:b(()=>[Q(S(!m.value||m.value&&m.value.is_sync_disabled||m.value.is_sync_stopped?z.$t("core::oauth.start_syncing"):z.$t("core::app.save")),1)]),_:1},8,["disabled","loading"]),[[Y,!m.value||m.value&&!m.value.is_sync_stopped]]),D(s(L,{variant:"secondary",disabled:l(g).busy||$.value,loading:l(g).busy,text:z.$t("activities::calendar.reconfigure"),onClick:N},null,8,["disabled","loading","text"]),[[Y,m.value&&m.value.is_sync_stopped]])])])])]),key:"0"}:void 0]),1032,["overlay"])])]),_:1})}}},cl=Bl("activity-calendar-view-default",!1),nD=[{path:"/calendar/sync",name:"calendar-sync",component:tD,meta:{title:qe.t("activities::calendar.calendar_sync")}},{path:"/activities/calendar",name:"activity-calendar",component:()=>mo(()=>import("./ActivitiesCalendar-a9342957.js"),["assets/ActivitiesCalendar-a9342957.js","assets/vendor-462626fd.js","assets/ActivitiesCalendar-3d57a825.css"]),meta:{title:qe.t("activities::calendar.calendar")},beforeEnter:()=>{cl.value=!0}},{path:"/activities",name:"activity-index",component:oT,meta:{title:qe.t("activities::activity.activities"),subRoutes:["create-activity","edit-activity","view-activity"],calendarRoute:"activity-calendar",initialize:!1},beforeEnter:async(e,t)=>{if(cl.value&&t.name!=e.meta.calendarRoute&&e.meta.subRoutes.indexOf(e.name)===-1&&!e.query.filter_id)return{name:e.meta.calendarRoute};e.meta.initialize=e.name==="activity-index",e.meta.subRoutes.indexOf(e.name)===-1&&!e.query.filter_id&&(cl.value=!1)},children:[{path:"create",name:"create-activity",components:{create:TV},meta:{title:qe.t("activities::activity.create")}},{path:":id",name:"view-activity",meta:{scrollToTop:!1},components:{edit:Ba}},{path:":id/edit",name:"edit-activity",meta:{scrollToTop:!1},components:{edit:Ba}}]}],{setActivityTypes:oD}=$n();window.Innoclapps&&Innoclapps.booting(function(e,t){e.component("MyActivitiesCard",pR),e.component("RecordTabTimelineActivity",nV),e.component("CreateActivityModal",lR),e.component("FormActivityDueDateField",iV),e.component("FormActivityEndDateField",dV),e.component("FormGuestsSelectField",kV),e.component("FormActivityTypeField",cV),e.component("IndexActivityTypeField",RV),e.component("IndexActivityDueDateField",wV),e.component("IndexActivityEndDateField",SV),e.component("ActivitiesTab",fR),e.component("ActivitiesTabPanel",GF),oD(Innoclapps.config("activities.types")||[]),nD.forEach(n=>t.addRoute(n)),t.addRoute("settings",{path:"activities",name:"activity-settings",component:aV,meta:{title:qe.t("activities::activity.activities")}})});const lD={class:"grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-6"},aD={class:"sm:col-span-2"},sD={class:"sm:col-span-2"},rD={__name:"SettingsProducts",setup(e){const{form:t,isReady:n,submit:a}=Gt(),r=Innoclapps.config("taxes.types"),i=[{label:Innoclapps.config("currency.iso_code"),value:"fixed"},{label:"%",value:"percent"}];return(u,c)=>{const m=v("IFormInput"),p=v("IFormGroup"),f=v("IFormNumericInput"),h=v("IFormRadio"),g=v("IButton"),y=v("ICard");return d(),k("form",{onSubmit:c[4]||(c[4]=ie((..._)=>l(a)&&l(a)(..._),["prevent"])),onKeydown:c[5]||(c[5]=_=>l(t).onKeydown(_))},[s(y,{header:u.$t("billable::product.products"),overlay:!l(n)},{footer:b(()=>[s(g,{type:"submit",disabled:l(t).busy,text:u.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[o("div",lD,[o("div",aD,[s(p,{label:u.$t("billable::product.tax_label"),"label-for":"tax_label",required:""},{default:b(()=>[s(m,{id:"tax_label",modelValue:l(t).tax_label,"onUpdate:modelValue":c[0]||(c[0]=_=>l(t).tax_label=_)},null,8,["modelValue"])]),_:1},8,["label"])]),o("div",sD,[s(p,{label:u.$t("billable::product.tax_rate"),"label-for":"tax_rate"},{default:b(()=>[s(f,{modelValue:l(t).tax_rate,"onUpdate:modelValue":c[1]||(c[1]=_=>l(t).tax_rate=_),placeholder:u.$t("billable::product.tax_percent"),precision:3,minus:!0},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),s(p,{class:"mt-3 space-y-1",label:u.$t("billable::product.settings.default_tax_type"),"label-for":"tax_type"},{default:b(()=>[(d(!0),k(te,null,re(l(r),_=>(d(),R(h,{id:_,key:_,modelValue:l(t).tax_type,"onUpdate:modelValue":c[2]||(c[2]=I=>l(t).tax_type=I),label:u.$t("billable::billable.tax_types."+_),value:_,name:"tax_type"},null,8,["id","modelValue","label","value"]))),128))]),_:1},8,["label"]),s(p,{label:u.$t("billable::product.settings.default_discount_type"),"label-for":"tax_type",class:"mt-3 space-y-1"},{default:b(()=>[(d(),k(te,null,re(i,_=>s(h,{id:_.value,key:_.value,modelValue:l(t).discount_type,"onUpdate:modelValue":c[3]||(c[3]=I=>l(t).discount_type=I),label:_.label,value:_.value,name:"discount_type"},null,8,["id","modelValue","label","value"])),64))]),_:1},8,["label"])]),_:1},8,["header","overlay"])],32)}}},Ql=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=q(!1);async function r(m,p={}){const{data:f}=await Innoclapps.request().get(`/products/${m}`,p);return f}async function i(m){const{data:p}=await Innoclapps.request().get("/products/search",{params:{q:m,search_fields:"name"}});return p.length>0?p[0]:null}async function u(m=100){if(a.value)return n.value;e(!0);try{const{data:p}=await c({take:m});return n.value=p,p}finally{e(!1),a.value=!0}}function c(m={}){return Innoclapps.request().get("/products/active",{params:m})}return{limitedNumberOfActiveProducts:n,limitedNumberOfActiveProductsRetrieved:a,limitedNumberOfProductsLoading:t,fetchProduct:r,fetchProductByName:i,retrieveLimitedNumberOfActiveProducts:u,fetchActiveProducts:c}});function Ms(e={}){return Object.assign({product_id:null,name:null,description:null,tax_rate:Innoclapps.config("options.tax_rate"),tax_label:Innoclapps.config("options.tax_label"),unit_price:0,qty:1,discount_type:Innoclapps.config("options.discount_type"),discount_total:0,unit:null,note:null,display_order:-1},e)}function iD(e,t,n){return n?parseFloat(parseFloat(e))-parseFloat(parseFloat(e))/(1+parseFloat(t)/100):parseFloat(e)*(parseFloat(t)/100)}function Us(e,t){if(e.discount_type==="fixed")return parseFloat(e.discount_total);const n=parseFloat(e.discount_total),a=parseFloat(e.unit_price),r=parseFloat(e.qty);return t?n/100*a*r:n/100*(a*r)}function kl(e,t){const n=parseFloat(e.unit_price),a=parseFloat(e.qty);return n*a-Us(e,t)}const uD={width:"30%",class:"bg-white px-3 py-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},dD={class:"relative w-60 sm:w-auto"},cD={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},mD={class:"w-32 sm:w-auto"},pD={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},fD={class:"w-40 sm:w-auto"},vD={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},bD={class:"w-44 sm:w-auto"},hD={class:"flex rounded-md shadow-sm"},_D={class:"relative flex grow items-stretch focus-within:z-10"},gD=o("div",{class:"-ml-px flex items-center border border-neutral-300 bg-white px-1.5 dark:border-neutral-500 dark:bg-neutral-700",textContent:"%"},null,-1),yD={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},xD={class:"relative w-44 rounded-md shadow-sm sm:w-auto"},ID={class:"absolute inset-y-0 right-0 flex items-center"},kD=["value","textContent"],$D={class:"bg-white px-2 py-4 text-right align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},wD={__name:"BillableFormTableProductRow",props:{modelValue:{type:Object,default:()=>({})},taxType:{required:!0,type:String},index:{required:!0,type:Number}},emits:["update:modelValue","productSelected"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{formatMoney:r}=Mt(),{limitedNumberOfActiveProducts:i,retrieveLimitedNumberOfActiveProducts:u,limitedNumberOfActiveProductsRetrieved:c,fetchActiveProducts:m,fetchProductByName:p}=Ql(),f=dt(null),h=q(!1),g=q(n.modelValue||[]);let y=q(null);const _=V(()=>f.value||i.value);function I(){c.value||(h.value=!0,u().then(()=>h.value=!1))}const F=Dt((T,E)=>{if(T==""){E(!1),f.value=null;return}E(!0),m({q:T}).then(({data:B})=>{f.value=B}).finally(()=>E(!1))},500);De(()=>{y.value=n.modelValue||[]});const $=[{label:Innoclapps.config("currency.iso_code"),value:"fixed"},{label:"%",value:"percent"}],C=V(()=>kl(n.modelValue,n.taxType==="inclusive"));function w(T){return Ms({name:T})}function x(T){return T.sku?T.sku+": "+T.name:T.name}async function A(T){if(!T){N({name:null,product_id:null});return}const E={product_id:T.id,name:T.name,description:T.description,unit_price:T.unit_price||0,unit:T.unit,tax_rate:T.tax_rate||0,tax_label:T.tax_label},B=await p(T.name);B?(E.product_id=B.id,i.value.find(z=>z.id==B.id)||i.value.unshift(B)):Innoclapps.info(a("billable::product.will_be_added_as_new",{name:T.name})),N(E),t("productSelected",{product:T.value,index:n.index})}function N(T,E=null){let B=Object.assign(n.modelValue,typeof T=="object"?T:{[T]:E});t("update:modelValue",B),g.value=B}return(T,E)=>{const B=v("ICustomSelect"),z=v("IFormTextarea"),M=v("IFormNumericInput"),j=v("IFormInput"),U=v("IButton"),P=v("IPopover"),H=v("IFormSelect");return d(),k("tr",null,[o("td",uD,[o("div",dD,[s(B,{modelValue:l(y),"onUpdate:modelValue":E[0]||(E[0]=L=>xt(y)?y.value=L:y=L),"create-option-provider":w,"option-label-provider":x,placeholder:T.$t("billable::product.choose_or_enter"),label:"name",taggable:!0,filterable:!1,options:_.value,loading:h.value,"onOption:selected":A,onCleared:E[1]||(E[1]=L=>A(null)),onSearch:l(F),onOpen:I},null,8,["modelValue","placeholder","options","loading","onSearch"]),de(T.$slots,"after-product-select",{product:g.value,index:e.index}),D(s(z,{"model-value":g.value.description,class:"mt-1",name:"products."+e.index+".description",placeholder:T.$t("billable::product.description")+" ("+T.$t("core::app.optional")+")",rows:3,"onUpdate:modelValue":E[2]||(E[2]=L=>N({description:L}))},null,8,["model-value","name","placeholder"]),[[Y,l(y)]])])]),o("td",cD,[o("div",mD,[s(M,{class:"text-right",size:"sm","decimal-separator":".",precision:2,"empty-value":1,placeholder:T.$t("billable::product.quantity"),pattern:".*","model-value":g.value.qty,"onUpdate:modelValue":E[3]||(E[3]=L=>N({qty:L}))},null,8,["placeholder","model-value"]),s(j,{size:"sm",placeholder:T.$t("billable::product.unit"),class:"mt-1 text-right","model-value":g.value.unit,"onUpdate:modelValue":E[4]||(E[4]=L=>N({unit:L}))},null,8,["placeholder","model-value"])])]),o("td",pD,[o("div",fD,[s(M,{class:"text-right",size:"sm",placeholder:T.$t("billable::product.unit_price"),minus:!0,"model-value":g.value.unit_price,"onUpdate:modelValue":E[5]||(E[5]=L=>N({unit_price:L}))},null,8,["placeholder","model-value"])])]),D(o("td",vD,[o("div",bD,[o("div",hD,[o("div",_D,[s(M,{placeholder:T.$t("billable::product.tax_percent"),precision:3,size:"sm",rounded:!1,class:"rounded-l-md",minus:!0,max:100,"model-value":g.value.tax_rate,"onUpdate:modelValue":E[6]||(E[6]=L=>N({tax_rate:L}))},null,8,["placeholder","model-value"])]),gD,s(P,{placement:"bottom",class:"max-w-sm",shadow:!1,arrow:!1,bordered:!1},{popper:b(()=>[s(j,{"model-value":g.value.tax_label,"onUpdate:modelValue":E[7]||(E[7]=L=>N({tax_label:L}))},null,8,["model-value"])]),default:b(()=>[s(U,{rounded:!1,size:"sm",variant:"white",class:"-ml-px rounded-r-md",text:e.modelValue.tax_label},null,8,["text"])]),_:1})])])],512),[[Y,e.taxType!=="no_tax"]]),o("td",yD,[o("div",xD,[e.modelValue.discount_type=="fixed"?(d(),R(M,{key:0,class:"pr-12",size:"sm",placeholder:T.$t("billable::product.discount_amount"),"model-value":g.value.discount_total,"onUpdate:modelValue":E[8]||(E[8]=L=>N({discount_total:L}))},null,8,["placeholder","model-value"])):(d(),R(M,{key:1,class:"pr-12",placeholder:T.$t("billable::product.discount_percent"),max:100,size:"sm",precision:2,"model-value":g.value.discount_total,"onUpdate:modelValue":E[9]||(E[9]=L=>N({discount_total:L}))},null,8,["placeholder","model-value"])),o("div",ID,[s(H,{"model-value":g.value.discount_type,bordered:!1,size:"sm",class:"bg-transparent bg-none text-right dark:bg-transparent","onUpdate:modelValue":E[10]||(E[10]=L=>N({discount_type:L}))},{default:b(()=>[(d(),k(te,null,re($,L=>o("option",{key:L.value,value:L.value,textContent:S(L.label)},null,8,kD)),64))]),_:1},8,["model-value"])])])]),o("td",$D,S(l(r)(C.value)),1),de(T.$slots,"default")])}}},CD={class:"mb-2 mt-4 grid grid-cols-12 gap-2"},SD={class:"col-span-8 text-sm text-neutral-600 dark:text-neutral-100 sm:col-span-5 sm:col-start-5 sm:text-right"},RD=["textContent"],FD={class:"col-span-8 text-sm text-neutral-600 dark:text-neutral-100 sm:col-span-5 sm:col-start-5 sm:text-right"},VD={class:"col-span-4 text-right text-sm text-neutral-600 dark:text-neutral-100 sm:col-span-3"},TD={class:"grid grid-cols-12 gap-2"},DD={class:"col-span-8 text-sm font-semibold text-neutral-900 dark:text-neutral-100 sm:col-span-5 sm:col-start-5 sm:text-right"},qD=["textContent"],ED={__name:"BillableTotalSection",props:{taxType:{required:!0},total:{required:!0},totalDiscount:{required:!0},subtotal:{required:!0},taxes:{default:()=>[]}},setup(e){const t=e,{formatMoney:n}=Mt(),a=V(()=>t.totalDiscount>0),r=V(()=>t.taxType!=="no_tax"),i=V(()=>t.taxType==="inclusive");return(u,c)=>{const m=ae("t");return d(),k("div",null,[o("div",CD,[o("div",SD,[Q(S(u.$t("billable::billable.sub_total"))+" ",1),D(o("p",{class:"italic text-neutral-500 dark:text-neutral-300"}," ("+S(u.$t("billable::billable.includes_discount",{amount:l(n)(e.totalDiscount)}))+") ",513),[[Y,a.value]])]),o("div",{class:"col-span-4 text-right text-sm text-neutral-600 dark:text-neutral-100 sm:col-span-3",textContent:S(l(n)(e.subtotal))},null,8,RD)]),(d(!0),k(te,null,re(e.taxes,p=>D((d(),k("div",{key:p.key,class:"mb-2 grid grid-cols-12 gap-2"},[o("div",FD,S(p.label)+" ("+S(p.rate)+"%) ",1),o("div",VD,[o("span",null,[D(o("span",null,null,512),[[Y,i.value],[m,"billable::billable.tax_amount_is_inclusive"]]),Q(" "+S(l(n)(p.raw_total)),1)])])])),[[Y,r.value]])),128)),o("div",TD,[D(o("div",DD,null,512),[[m,"billable::billable.total"]]),o("div",{class:"col-span-4 text-right text-sm font-medium text-neutral-900 dark:text-neutral-100 sm:col-span-3",textContent:S(l(n)(e.total))},null,8,qD)])])}}},AD={class:"table-responsive"},BD={class:"border border-neutral-200 dark:border-neutral-800 sm:rounded-md"},ND={class:"bg-neutral-50 dark:bg-neutral-800"},OD={class:"bg-neutral-50 py-3 pl-4 pr-2 text-left text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},zD={class:"bg-neutral-50 p-2 text-right text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},MD={class:"bg-neutral-50 px-2 py-3 text-right text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},UD={class:"bg-neutral-50 px-2 py-3 text-right text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},PD={class:"bg-neutral-50 px-2 py-3 text-right text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},jD={class:"bg-neutral-50 px-2 py-3 text-right text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},LD=o("th",null,null,-1),HD=["colspan"],GD={class:"bg-white dark:bg-neutral-800"},KD={class:"bg-white p-2 text-right align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},YD={class:"flex items-center justify-between space-x-2"},WD={class:"mt-2"},QD={key:0},XD=["colspan"],ZD={class:"relative z-auto -mt-2 mb-1 rounded-sm bg-white p-2 dark:bg-neutral-800"},JD=["onClick"],Xl={__name:"BillableFormTableProducts",props:{products:{type:Array,default(){return[]}},removedProducts:{type:Array,default(){return[]}},taxType:{required:!0,type:String}},emits:["update:products","update:removedProducts","productSelected","productRemoved"],setup(e,{expose:t,emit:n}){const a=e,{toFixed:r}=Mt(),{draggableOptions:i}=Xt(),{limitedNumberOfActiveProductsRetrieved:u,limitedNumberOfActiveProducts:c}=Ql(),m=q(null),p=Innoclapps.config("currency.precision"),f=q(null),h=q([]);on(()=>{u.value=!1,c.value=[]}),ge(h,E=>{n("update:products",E),w()},{deep:!0}),ge(()=>a.products,E=>{h.value=E},{immediate:!0});const g=V(()=>a.taxType!=="no_tax"),y=V(()=>a.taxType==="inclusive"),_=V(()=>{let E=parseFloat(F.value)+parseFloat(y.value?0:C.value);return parseFloat(r(E,p))}),I=V(()=>parseFloat(r(h.value.reduce((E,B)=>E+Us(B,y.value),0),p))),F=V(()=>parseFloat(r(h.value.reduce((E,B)=>E+kl(B,y.value),0),p))),$=V(()=>g.value?En(kd(h.value,E=>E.tax_label+E.tax_rate),"tax_rate").filter(E=>E.tax_rate>0).reduce((E,B)=>{let z={key:B.tax_label+B.tax_rate,rate:B.tax_rate,label:B.tax_label,raw_total:Lt(h.value,{tax_label:B.tax_label,tax_rate:B.tax_rate}).reduce((M,j)=>(M+=iD(kl(j,y.value),j.tax_rate,y.value),M),0)};return E.push(z),E},[]):[]),C=V(()=>parseFloat(r($.value.reduce((E,B)=>E+parseFloat(r(B.raw_total,p)),0),p)));function w(){h.value.forEach(E=>{E.draggable_key||(E.draggable_key=qt())})}function x(E){f.value=E,Fe(()=>{m.value.focus()})}function A(E){let B=h.value[E];h.value.splice(E,1),f.value===E&&(f.value=null),n("productRemoved",{product:B,index:E}),B.id&&n("update:removedProducts",[...a.removedProducts,B.id])}function N(){h.value.push(Ms()),T()}function T(){h.value.forEach((E,B)=>E.display_order=B+1)}return t({insertNewLine:N}),(E,B)=>{const z=v("IDropdownItem"),M=v("IMinimalDropdown"),j=v("IButtonIcon"),U=v("IFormLabel"),P=v("IFormTextarea"),H=ae("t");return d(),k(te,null,[o("div",AD,[o("div",BD,[s(l(Et),Re({modelValue:h.value,"onUpdate:modelValue":B[1]||(B[1]=L=>h.value=L),tag:"table",class:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-700","item-key":L=>L.draggable_key,handle:".product-draggable-handle"},l(i),{onEnd:T,onStart:B[2]||(B[2]=L=>f.value=null)}),{header:b(()=>[o("thead",ND,[o("tr",null,[D(o("th",OD,null,512),[[H,"billable::product.table_heading"]]),D(o("th",zD,null,512),[[H,"billable::product.qty"]]),D(o("th",MD,null,512),[[H,"billable::product.unit_price"]]),D(o("th",UD,null,512),[[Y,g.value],[H,"billable::product.tax"]]),D(o("th",PD,null,512),[[H,"billable::product.discount"]]),D(o("th",jD,null,512),[[H,"billable::product.amount"]]),LD])]),D(o("tbody",null,[o("tr",null,[D(o("td",{colspan:g.value?6:5,class:"bg-white p-3 text-center text-sm text-neutral-900 dark:bg-neutral-700 dark:text-neutral-100"},null,8,HD),[[H,"billable::product.resource_has_no_products"]])])],512),[[Y,!h.value.length]])]),item:b(({element:L,index:Z})=>[o("tbody",GD,[s(wD,{modelValue:h.value[Z],"onUpdate:modelValue":J=>h.value[Z]=J,"tax-type":e.taxType,index:Z,onProductSelected:B[0]||(B[0]=J=>E.$emit("productSelected",J))},{"after-product-select":b(J=>[de(E.$slots,"after-product-select",pt(ft(J)))]),default:b(()=>[o("td",KD,[o("div",YD,[o("div",WD,[s(M,{type:"horizontal"},{default:b(()=>[D(s(z,{text:E.$t("core::app.add_note"),onClick:J=>x(Z)},null,8,["text","onClick"]),[[Y,(f.value===null||f.value!==Z)&&!h.value[Z].note]]),s(z,{text:E.$t("core::app.remove"),onClick:J=>A(Z)},null,8,["text","onClick"])]),_:2},1024)]),s(j,{icon:"Selector",class:"product-draggable-handle mt-2 cursor-move"})])])]),_:2},1032,["modelValue","onUpdate:modelValue","tax-type","index"]),f.value===Z||L.note||h.value[Z].note?(d(),k("tr",QD,[o("td",{colspan:g.value?7:6,class:"px-1"},[o("div",ZD,[s(U,{for:"product-note-"+Z,class:"mb-1"},{default:b(()=>[Q(S(E.$t("core::app.note_is_private")),1)]),_:2},1032,["for"]),s(P,{ref_key:"productNoteRef",ref:m,modelValue:h.value[Z].note,"onUpdate:modelValue":J=>h.value[Z].note=J,rows:"2",class:"rounded border border-warning-300 bg-warning-100 focus:border-warning-400 focus:ring-warning-400 dark:bg-warning-200 dark:text-neutral-800",bordered:!1,rounded:!1},null,8,["modelValue","onUpdate:modelValue"])])],8,XD)])):O("",!0)])]),_:3},16,["modelValue","item-key"])])]),o("a",{class:"link mt-3 inline-block text-sm font-medium",href:"#",onClick:ie(N,["prevent"])}," + "+S(E.$t("core::app.insert_new_line")),9,JD),o("div",null,[s(ED,{"tax-type":e.taxType,total:_.value,"total-discount":I.value,subtotal:F.value,taxes:$.value},null,8,["tax-type","total","total-discount","subtotal","taxes"])])],64)}}},Zl={__name:"BillableFormTaxTypes",props:["modelValue"],emits:["update:modelValue"],setup(e){const{t}=ve(),n=Innoclapps.config("taxes.types"),a=qt(),r=V(()=>n.map(i=>({value:i,text:t("billable::billable.tax_types."+i)})));return(i,u)=>{const c=v("IFormRadio");return d(),k("div",null,[(d(!0),k(te,null,re(r.value,m=>(d(),R(c,{id:l(a)+"-"+m.value,key:m.value,value:m.value,"model-value":e.modelValue,name:"tax_type",label:m.text,onChange:u[0]||(u[0]=p=>i.$emit("update:modelValue",p))},null,8,["id","value","model-value","label"]))),128))])}}},el={__name:"BillableFormProductsModal",props:{billable:Object,visible:Boolean,prefetch:Boolean,resourceName:{required:!0,type:String},resourceId:{required:!0,type:Number}},emits:["saved","hidden"],setup(e,{emit:t}){const n=e,{form:a}=Ae({products:[],removed_products:[]}),r=q(null),i=q(!1);function u(h){a.errors.has("products."+h.index+".name")&&a.errors.clear("products."+h.index+".name")}function c(){t("hidden"),i.value=!1}async function m(){let h=await a.post(`${n.resourceName}/${n.resourceId}/billable`);t("saved",h),Innoclapps.modal().hide("productsModal")}async function p(){let h=nt(n.prefetch?await f():n.billable||{});a.set("tax_type",h.tax_type||"exclusive"),a.set("products",h.products||[]),i.value=!0}mn(i,()=>{a.products.length===0&&Fe(r.value.insertNewLine)},{flush:"post"});async function f(){let{data:h}=await Innoclapps.request().get(`/${n.resourceName}/${n.resourceId}/billable`);return h}return(h,g)=>{const y=v("IFormError"),_=v("IOverlay"),I=v("IModal");return d(),R(I,{id:"productsModal","cancel-title":h.$t("core::app.cancel"),"ok-title":h.$t("core::app.save"),"ok-disabled":l(a).busy,title:h.$t("billable::product.manage"),visible:e.visible,size:"xxl","static-backdrop":"",onOk:m,onHidden:c,onShow:p},{default:b(()=>[s(_,{show:!i.value},{default:b(()=>[s(Zl,{modelValue:l(a).tax_type,"onUpdate:modelValue":g[0]||(g[0]=F=>l(a).tax_type=F),class:"mb-4 mt-6 flex flex-col space-y-1 sm:flex-row sm:space-x-2 sm:space-y-0"},null,8,["modelValue"]),i.value?(d(),R(Xl,{key:0,ref_key:"productsRef",ref:r,products:l(a).products,"onUpdate:products":g[1]||(g[1]=F=>l(a).products=F),"removed-products":l(a).removed_products,"onUpdate:removedProducts":g[2]||(g[2]=F=>l(a).removed_products=F),"tax-type":l(a).tax_type,onProductSelected:g[3]||(g[3]=F=>l(a).errors.clear("products."+F.index+".name")),onProductRemoved:u},{"after-product-select":b(({index:F})=>[s(y,{textContent:S(l(a).getError("products."+F+".name"))},null,8,["textContent"])]),_:1},8,["products","removed-products","tax-type"])):O("",!0)]),_:1},8,["show"])]),_:1},8,["cancel-title","ok-title","ok-disabled","title","visible"])}}},eq={key:0,class:"ml-1 text-xs text-neutral-500 dark:text-neutral-400"},tq=["onClick"],nq=Object.assign({inheritAttrs:!1},{__name:"BillableAmountField",props:["resource","resourceName","resourceId","field","isFloating"],emits:["updated"],setup(e,{emit:t}){const n=e,a=V(()=>n.resource.products_count>0),r=q(!1);function i(){setTimeout(()=>r.value=!1,200)}function u(m){t("updated",Object.assign({},n.resource,{billable:m,[n.field.attribute]:m.total,products_count:m.products.length}))}function c(){r.value=!0}return(m,p)=>{const f=v("Icon"),h=v("DetailNumericField"),g=ae("t");return d(),k(te,null,[r.value?(d(),R(el,{key:0,"resource-name":e.resourceName,"resource-id":e.resourceId,visible:"",prefetch:"",onSaved:u,onHidden:i},null,8,["resource-name","resource-id"])):O("",!0),s(h,Re(m.$attrs,{"resource-name":e.resourceName,"resource-id":e.resourceId,"is-floating":e.isFloating,field:{...e.field,readonly:a.value},resource:e.resource,"edit-action":e.field.onlyProducts||a.value?c:void 0,onUpdated:p[0]||(p[0]=y=>m.$emit("updated",y))}),{"numeric-field":b(({formattedValue:y})=>[Q(S(y)+" ",1),a.value?(d(),k("span",eq," ("+S(m.$t("billable::product.count",{count:e.resource.products_count}))+") ",1)):O("",!0)]),"after-inline-edit-form-fields":b(({hidePopover:y})=>[o("a",{href:"#",class:"link flex items-center text-sm",onClick:ie(_=>(c(),y()),["prevent"])},[D(o("span",null,null,512),[[g,"billable::product.manage"]]),s(f,{icon:"Window",class:"ml-2 mt-px h-4 w-4"})],8,tq)]),_:1},16,["resource-name","resource-id","is-floating","field","resource","edit-action"])],64)}}}),oq={key:0,class:"ml-1 text-xs text-neutral-500 dark:text-neutral-400"},lq=["onClick"],aq=Object.assign({inheritAttrs:!1},{__name:"BillableAmountField",props:["resourceName","resourceId","row","field"],emits:["reload"],setup(e,{emit:t}){const n=e,a=q(!1),r=V(()=>n.row.products_count>0);function i(){setTimeout(()=>a.value=!1,200)}function u(){a.value=!0}function c(){t("reload")}return(m,p)=>{const f=v("Icon"),h=v("IndexNumericField"),g=ae("t");return d(),k(te,null,[a.value?(d(),R(el,{key:0,"resource-name":e.resourceName,"resource-id":e.resourceId,visible:"",prefetch:"",onSaved:c,onHidden:i},null,8,["resource-name","resource-id"])):O("",!0),s(h,Re(m.$attrs,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field,"edit-action":e.field.onlyProducts||r.value?u:void 0,onReload:p[0]||(p[0]=y=>m.$emit("reload"))}),{"numeric-field":b(({formattedValue:y})=>[Q(S(y)+" ",1),r.value?(d(),k("span",oq," ("+S(m.$t("billable::product.count",{count:e.row.products_count}))+") ",1)):O("",!0)]),"after-inline-edit-form-fields":b(({hidePopover:y})=>[o("a",{href:"#",class:"link flex items-center text-sm",onClick:ie(_=>(u(),y()),["prevent"])},[D(o("span",null,null,512),[[g,"billable::product.manage"]]),s(f,{icon:"Window",class:"ml-2 mt-px h-4 w-4"})],8,lq)]),_:1},16,["resource-name","resource-id","row","field","edit-action"])],64)}}}),sq={class:"mt-4"},rq={class:"-mx-2 -my-1.5 flex"},iq={__name:"ProductsCreate",emits:["created","restored"],setup(e,{emit:t}){const n=Innoclapps.resourceName("products"),{t:a}=ve(),r=Qe(),{fields:i,getCreateFields:u}=gt(),{form:c}=It(i),{createResource:m}=Je(n),p=q(null),f=q(null),h=q({byName:!1});dn(()=>{var C;return(C=f.value)==null?void 0:C.currentValue},C=>{if(!C){p.value=null;return}Innoclapps.request().get("/trashed/products/search",{params:{q:C,search_fields:"name:="}}).then(({data:w})=>{p.value=w.length>0?w[0]:null})},{debounce:500});function g(){I().then(()=>r.back())}function y(){I().then(()=>c.reset())}function _(){I().then(()=>r.push("/products"))}async function I(){try{let C=await m(c);return t("created",C),Innoclapps.success(a("billable::product.created")),C}catch(C){return C.isValidationError()&&Innoclapps.error(a("core::app.form_validation_failed"),3e3),Promise.reject(C)}}function F(C,w){Innoclapps.request().post(`/trashed/products/${C}`).then(()=>{h.value[w]=!0,t("restored",p)})}function $(){u(n).then(C=>i.value.set(C)).then(()=>{f.value=i.value.find("name")})}return $(),(C,w)=>{const x=v("FieldsPlaceholder"),A=v("IButtonMinimal"),N=v("IAlert"),T=v("FormFields"),E=v("IDropdownItem"),B=v("IDropdownButtonGroup"),z=v("ISlideover");return d(),R(z,{title:C.$t("billable::product.create"),visible:"","static-backdrop":"",form:"",onSubmit:g,onHidden:w[3]||(w[3]=M=>C.$router.back())},{"modal-ok":b(()=>[s(B,{type:"submit",disabled:l(c).busy,loading:l(c).busy,text:C.$t("core::app.create")},{default:b(()=>[s(E,{text:C.$t("core::app.create_and_add_another"),onClick:y},null,8,["text"]),s(E,{text:C.$t("core::app.create_and_go_to_list"),onClick:_},null,8,["text"])]),_:1},8,["disabled","loading","text"])]),default:b(()=>[l(i).isEmpty()?(d(),R(x,{key:0})):O("",!0),s(T,{fields:l(i),"form-id":l(c).formId,"resource-name":l(n),"is-floating":"","focus-first":""},vt({_:2},[p.value!==null?{name:"after-name-field",fn:b(()=>[s(N,{dismissible:"",class:"mb-3",onDismissed:w[2]||(w[2]=M=>{h.value.byName=!1,p.value=null})},{default:b(()=>[Q(S(C.$t("billable::product.exists_in_trash_by_name"))+" ",1),o("div",sq,[o("div",rq,[D(s(A,{variant:"info",text:C.$t("core::app.soft_deletes.restore"),onClick:w[0]||(w[0]=M=>F(p.value.id,"byName"))},null,8,["text"]),[[Y,!h.value.byName]]),D(s(A,{variant:"info",text:C.$t("core::app.view_record"),onClick:w[1]||(w[1]=M=>C.$router.replace({name:"view-product",params:{id:p.value.id}}))},null,8,["text"]),[[Y,h.value.byName]])])])]),_:1})]),key:"0"}:void 0]),1032,["fields","form-id","resource-name"])]),_:1},8,["title"])}}},Oa={__name:"ProductsEdit",emits:["updated"],setup(e,{emit:t}){const n=Innoclapps.resourceName("products"),{t:a}=ve(),r=Qe(),i=Ye(),{fetchProduct:u}=Ql(),{fields:c,getUpdateFields:m}=gt(),{form:p}=It(c),{updateResource:f}=Je(n),h=q(null);async function g(){let _=await f(p,i.params.id);t("updated",_),Innoclapps.success(a("billable::product.updated")),r.back()}function y(){Promise.all([u(i.params.id),m(n,i.params.id)]).then(_=>{c.value.set(_[1]).populate(_[0]),h.value=_[0]})}return y(),(_,I)=>{const F=v("FieldsPlaceholder"),$=v("FormFields"),C=v("ISlideover");return d(),R(C,{"ok-disabled":l(p).busy||l(c).isNotEmpty()&&!h.value.authorizations.update,"ok-loading":l(p).busy,"ok-title":_.$t("core::app.save"),title:_.$t("billable::product.edit"),visible:"","static-backdrop":"",form:"",onHidden:I[0]||(I[0]=w=>_.$router.back()),onSubmit:g},{default:b(()=>[l(c).isEmpty()?(d(),R(F,{key:0})):O("",!0),s($,{fields:l(c),"form-id":l(p).formId,"resource-name":l(n),"resource-id":_.$route.params.id},null,8,["fields","form-id","resource-name","resource-id"])]),_:1},8,["ok-disabled","ok-loading","ok-title","title"])}}},uq={class:"inline-flex items-center"},dq={class:"mr-3 lg:mr-6"},cq={class:"ml-auto flex items-center text-sm"},mq={class:"font-medium text-neutral-800 dark:text-neutral-300"},wn="products",pq={__name:"ProductsIndex",setup(e){const t=Innoclapps.resourceName("products"),{t:n}=ve(),{reloadTable:a,customizeTable:r}=Bt(),{deleteResource:i,cloneResource:u}=Je(t),c=Qe();async function m(f){const h=await u(f);a(wn),c.push({name:"edit-product",params:{id:h.id}})}async function p(f){await Innoclapps.dialog().confirm(),await i(f),a(wn),Innoclapps.success(n("billable::product.deleted"))}return(f,h)=>{const g=v("NavbarSeparator"),y=v("IDropdownItem"),_=v("IMinimalDropdown"),I=v("IButton"),F=v("router-view"),$=v("ILayout"),C=ae("t");return d(),R($,null,{actions:b(()=>[s(g,{class:"hidden lg:block"}),o("div",uq,[o("div",dq,[s(_,{type:"horizontal"},{default:b(()=>[s(y,{icon:"DocumentAdd",to:{name:"import-resource",params:{resourceName:l(t)}},text:f.$t("core::import.import")},null,8,["to","text"]),f.$gate.userCan("export products")?(d(),R(y,{key:0,icon:"DocumentDownload",text:f.$t("core::app.export.export"),onClick:h[0]||(h[0]=w=>f.$iModal.show("export-modal"))},null,8,["text"])):O("",!0),s(y,{icon:"Trash",to:{name:"trashed-resource-records",params:{resourceName:l(t)}},text:f.$t("core::app.soft_deletes.trashed")},null,8,["to","text"]),s(y,{icon:"Cog",text:f.$t("core::table.list_settings"),onClick:h[1]||(h[1]=w=>l(r)(wn))},null,8,["text"])]),_:1})]),s(I,{to:{name:"create-product"},icon:"Plus",size:"sm",text:f.$t("billable::product.create")},null,8,["text"])])]),default:b(()=>[s(l(tn),{"resource-name":l(t),"table-id":wn,"empty-state":{to:{name:"create-product"},title:f.$t("billable::product.empty_state.title"),buttonText:f.$t("billable::product.create"),description:f.$t("billable::product.empty_state.description"),secondButtonText:f.$t("core::import.from_file",{file_type:"CSV"}),secondButtonIcon:"DocumentAdd",secondButtonTo:{name:"import-resource",params:{resourceName:l(t)}}}},{"after-search":b(({collection:w})=>[o("div",cq,[D(o("span",mq,null,512),[[C,{path:"billable::product.count",args:{count:w.state.meta.total}}]])])]),actions:b(({row:w})=>[s(Mn,null,{default:b(()=>[s(Ft,{tooltip:f.$t("core::app.clone"),icon:"Duplicate",onClick:x=>m(w.id)},null,8,["tooltip","onClick"]),w.authorizations.delete?(d(),R(Ft,{key:0,tooltip:f.$t("core::app.delete"),icon:"Trash",onClick:x=>p(w.id)},null,8,["tooltip","onClick"])):O("",!0)]),_:2},1024)]),_:1},8,["resource-name","empty-state"]),s(l(go),{"url-path":"/products/export","resource-name":l(t),title:f.$t("billable::product.export")},null,8,["resource-name","title"]),s(F,{onCreated:h[2]||(h[2]=w=>l(a)(wn)),onRestored:h[3]||(h[3]=w=>l(a)(wn)),onUpdated:h[4]||(h[4]=w=>l(a)(wn))})]),_:1})}}},fq=[{path:"/products",name:"product-index",component:pq,meta:{title:qe.t("billable::product.products")},children:[{path:"create",name:"create-product",component:iq,meta:{title:qe.t("billable::product.create")}},{path:":id",name:"view-product",component:Oa},{path:":id/edit",name:"edit-product",component:Oa}]}];window.Innoclapps&&Innoclapps.booting(function(e,t){e.component("DetailBillableAmountField",nq),e.component("IndexBillableAmountField",aq),fq.forEach(n=>t.addRoute(n)),t.addRoute("settings",{path:"products",component:rD,name:"settings-products",meta:{title:qe.t("billable::product.products")}})});const yo=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name")),r=V(()=>ot(n.value,["is_default","name"],["desc","asc"]));y();function i(_){return n.value.findIndex(I=>I.id==_)}function u(_){n.value.splice(i(_),1)}function c(_){_.is_default&&g(),n.value.push(_)}function m(_,I){I.is_default&&g(),n.value[i(_)]=I}function p(_,I){I.is_default&&g();const F=i(_);n.value[F]=Object.assign(n.value[F],I)}async function f(_,I={}){const{data:F}=await Innoclapps.request().get(`/brands/${_}`,I);return F}async function h(_){await Innoclapps.request().delete(`/brands/${_}`),u(_)}function g(){n.value.forEach(_=>{_.is_default=!1})}function y(){e(!0),Innoclapps.request().get("/brands").then(({data:_})=>n.value=_).finally(()=>e(!1))}return{brands:n,brandsByName:a,orderedBrands:r,brandsAreBeingFetched:t,addBrand:c,removeBrand:u,setBrand:m,patchBrand:p,fetchBrands:y,fetchBrand:f,deleteBrand:h,unmarkAllAsDefault:g}}),vq={class:"text-left",width:"5%"},bq={class:"text-left"},hq=o("th",null,null,-1),_q=["textContent"],gq={class:"flex justify-end"},yq={__name:"BrandsIndex",setup(e){const{orderedBrands:t,brandsAreBeingFetched:n,deleteBrand:a}=yo();async function r(i){await Innoclapps.dialog().confirm(),a(i)}return(i,u)=>{const c=v("IButton"),m=v("router-link"),p=v("IBadge"),f=v("IDropdownItem"),h=v("IMinimalDropdown"),g=v("ITable"),y=v("ICard"),_=ae("t");return d(),R(y,{header:i.$t("brands::brand.brands"),overlay:l(n),"no-body":""},{actions:b(()=>[s(c,{to:{name:"create-brand"},icon:"plus",size:"sm",text:i.$t("brands::brand.create")},null,8,["text"])]),default:b(()=>[s(g,{class:"-mt-px"},{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",vq,null,512),[[_,"core::app.id"]]),D(o("th",bq,null,512),[[_,"brands::brand.brand"]]),hq])]),o("tbody",null,[(d(!0),k(te,null,re(l(t),I=>(d(),k("tr",{key:I.id},[o("td",{textContent:S(I.id)},null,8,_q),o("td",null,[s(m,{class:"link",to:{name:"edit-brand",params:{id:I.id}}},{default:b(()=>[Q(S(I.name),1)]),_:2},1032,["to"]),I.is_default?(d(),R(p,{key:0,text:i.$t("core::app.is_default"),variant:"primary",class:"ml-2"},null,8,["text"])):O("",!0)]),o("td",gq,[s(h,null,{default:b(()=>[s(f,{to:{name:"edit-brand",params:{id:I.id}},text:i.$t("core::app.edit")},null,8,["to","text"]),s(f,{text:i.$t("core::app.delete"),onClick:F=>r(I.id)},null,8,["text","onClick"])]),_:2},1024)])]))),128))])]),_:1})]),_:1},8,["header","overlay"])}}},xq={__name:"SettingsBrands",setup(e){return(t,n)=>(d(),R(yq))}},Iq={__name:"BrandsCreate",setup(e){const{t}=ve(),n=Qe(),{addBrand:a}=yo(),r=Innoclapps.config("favourite_colors"),{form:i}=Ae({name:"",display_name:"",is_default:!1,config:{primary_color:"#4f46e5"},visibility_group:{type:"all",depends_on:[]}});function u(){i.post("/brands").then(c=>{a(c),Innoclapps.success(t("brands::brand.created")),n.push({name:"edit-brand",params:{id:c.id}})})}return(c,m)=>{const p=v("IFormInput"),f=v("IFormError"),h=v("IFormGroup"),g=v("IColorSwatch"),y=v("IFormCheckbox"),_=v("IModal");return d(),R(_,{"ok-title":c.$t("core::app.create"),"ok-disabled":l(i).busy,title:c.$t("brands::brand.create"),size:"sm",visible:"","static-backdrop":"",form:"",onSubmit:u,onKeydown:m[7]||(m[7]=I=>l(i).onKeydown(I)),onHidden:c.$router.back,onShown:m[8]||(m[8]=()=>c.$refs.inputNameRef.focus())},{default:b(()=>[s(h,{"label-for":"name",label:c.$t("brands::brand.form.name"),required:""},{default:b(()=>[s(p,{id:"name",ref:"inputNameRef",modelValue:l(i).name,"onUpdate:modelValue":m[0]||(m[0]=I=>l(i).name=I),onChange:m[1]||(m[1]=I=>l(i).display_name?void 0:l(i).display_name=I)},null,8,["modelValue"]),s(f,{textContent:S(l(i).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(h,{"label-for":"display_name",label:c.$t("brands::brand.form.display_name"),required:""},{default:b(()=>[s(p,{id:"display_name",modelValue:l(i).display_name,"onUpdate:modelValue":m[2]||(m[2]=I=>l(i).display_name=I)},null,8,["modelValue"]),s(f,{textContent:S(l(i).getError("display_name"))},null,8,["textContent"])]),_:1},8,["label"]),s(h,{label:c.$t("brands::brand.form.primary_color")},{default:b(()=>[s(g,{modelValue:l(i).config.primary_color,"onUpdate:modelValue":m[3]||(m[3]=I=>l(i).config.primary_color=I),"allow-remove":!1,swatches:l(r)},null,8,["modelValue","swatches"]),s(f,{textContent:S(l(i).getError("config.primary_color"))},null,8,["textContent"])]),_:1},8,["label"]),s(h,null,{default:b(()=>[s(y,{id:"is_default",checked:l(i).is_default,"onUpdate:checked":m[4]||(m[4]=I=>l(i).is_default=I),name:"is_default",label:c.$t("brands::brand.form.is_default")},null,8,["checked","label"]),s(f,{textContent:S(l(i).getError("is_default"))},null,8,["textContent"])]),_:1}),s(h,{class:"mt-4"},{default:b(()=>[s(Xo,{type:l(i).visibility_group.type,"onUpdate:type":m[5]||(m[5]=I=>l(i).visibility_group.type=I),dependsOn:l(i).visibility_group.depends_on,"onUpdate:dependsOn":m[6]||(m[6]=I=>l(i).visibility_group.depends_on=I)},null,8,["type","dependsOn"])]),_:1})]),_:1},8,["ok-title","ok-disabled","title","onHidden"])}}},kq={key:0},$q=["src"],wq={class:"mt-4 text-sm text-neutral-500 dark:text-neutral-300"},Cq=["src"],Sq={class:"mt-4 text-sm text-neutral-500 dark:text-neutral-300"},Rq={class:"mb-4 text-lg font-medium"},Fq={class:"mb-1 flex justify-between"},Vq={class:"mb-1 flex justify-between"},Tq={class:"mb-1 flex justify-between"},Dq={class:"mb-4 mt-6 text-lg font-medium"},qq={class:"mb-1 flex justify-between"},Eq={class:"mb-1 flex justify-between"},Aq={class:"mb-1 flex justify-between"},Bq={class:"mb-1 flex justify-between"},Nq={class:"mb-1 flex justify-between"},Oq={__name:"BrandsEdit",setup(e){const{t}=ve(),n=Ye(),{currentUser:a,locales:r}=Le(),{brands:i,setBrand:u,fetchBrand:c,patchBrand:m}=yo(),p=q(!1),f=q(null),h=Innoclapps.config("favourite_colors"),g=Innoclapps.config("contentbuilder.fonts"),y=_n({documentSendMailSubject:a.value.locale,documentSendMailMessage:a.value.locale,documentSendMailButton:a.value.locale,documentSignedMailSubject:a.value.locale,documentSignedMailMessage:a.value.locale,documentSignedThankyouMessage:a.value.locale,documentAcceptedThankyouMessage:a.value.locale,signatureBoundText:a.value.locale}),{form:_}=Ae({visibility_group:{type:"all",depends_on:[]}}),I=V(()=>g.map(N=>N["font-family"])),F=V(()=>i.value.length===1&&f.value.is_default===!1?!0:i.value.length>1&&f.value.is_default===!1);function $(N){c(N,{params:{with:"visibilityGroup.users;visibilityGroup.teams"}}).then(T=>{let E=T;_.set({name:E.name,display_name:E.display_name,config:E.config,is_default:E.is_default}),E.visibility_group&&_.set("visibility_group",E.visibility_group),f.value=E}).finally(()=>p.value=!0)}function C(){_.put(`/brands/${f.value.id}`,{params:{with:"visibilityGroup.users;visibilityGroup.teams"}}).then(N=>{f.value=N,u(N.id,N),Innoclapps.success(t("brands::brand.updated"))}).catch(N=>{N.isValidationError()&&Innoclapps.error(t("core::app.form_validation_failed_with_sections"),3e3)})}function w(N){Innoclapps.request().delete(`/brands/${f.value.id}/logo/${N}`).then(()=>{A(N,null)})}function x(N,T){A(T,N.path)}function A(N,T){f.value["logo_"+N]=T,f.value["logo_"+N+"_url"]=T,m(f.value.id,{["logo_"+N]:T,["logo_"+N+"_url"]:T})}return $(n.params.id),(N,T)=>{const E=v("ITab"),B=v("ITabList"),z=v("IFormCheckbox"),M=v("IFormError"),j=v("IFormGroup"),U=v("IFormInput"),P=v("IColorSwatch"),H=v("ITabPanel"),L=v("IFormLabel"),Z=v("DropdownSelectInput"),J=v("Editor"),K=v("ICustomSelect"),G=v("IFormTextarea"),oe=v("ITabPanels"),pe=v("ITabGroup"),ue=v("IButton"),ee=v("ICard"),W=ae("t");return d(),R(ee,{tag:"form",header:N.$t("brands::brand.update"),"no-body":"",overlay:!p.value,onSubmit:ie(C,["prevent"]),onKeydown:T[30]||(T[30]=ne=>l(_).onKeydown(ne))},{footer:b(()=>[s(ue,{type:"submit",disabled:l(_).busy,text:N.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[p.value?(d(),k("div",kq,[s(pe,null,{default:b(()=>[s(B,{class:"px-4 sm:px-6"},{default:b(()=>[s(E,{title:N.$t("brands::brand.form.sections.general")},null,8,["title"]),s(E,{title:N.$t("brands::brand.form.sections.navigation")},null,8,["title"]),s(E,{title:N.$t("brands::brand.form.sections.email")},null,8,["title"]),s(E,{title:N.$t("brands::brand.form.sections.thank_you")},null,8,["title"]),s(E,{title:N.$t("brands::brand.form.sections.pdf")},null,8,["title"]),s(E,{title:N.$t("brands::brand.form.sections.signature")},null,8,["title"])]),_:1}),s(oe,{class:"px-4 sm:px-6"},{default:b(()=>[s(H,null,{default:b(()=>[F.value?(d(),R(j,{key:0,class:"mb-6"},{default:b(()=>[s(z,{id:"is_default",checked:l(_).is_default,"onUpdate:checked":T[0]||(T[0]=ne=>l(_).is_default=ne),name:"is_default",label:N.$t("brands::brand.form.is_default")},null,8,["checked","label"]),s(M,{textContent:S(l(_).getError("is_default"))},null,8,["textContent"])]),_:1})):O("",!0),s(j,{"label-for":"name",label:N.$t("brands::brand.form.name"),required:""},{default:b(()=>[s(U,{id:"name",modelValue:l(_).name,"onUpdate:modelValue":T[1]||(T[1]=ne=>l(_).name=ne)},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{"label-for":"display_name",label:N.$t("brands::brand.form.display_name"),required:""},{default:b(()=>[s(U,{id:"display_name",modelValue:l(_).display_name,"onUpdate:modelValue":T[2]||(T[2]=ne=>l(_).display_name=ne)},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("display_name"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:N.$t("brands::brand.form.primary_color")},{default:b(()=>[s(P,{modelValue:l(_).config.primary_color,"onUpdate:modelValue":T[3]||(T[3]=ne=>l(_).config.primary_color=ne),"allow-remove":!1,swatches:l(h)},null,8,["modelValue","swatches"]),s(M,{textContent:S(l(_).getError("config.primary_color"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{class:"mt-4"},{default:b(()=>[s(Xo,{type:l(_).visibility_group.type,"onUpdate:type":T[4]||(T[4]=ne=>l(_).visibility_group.type=ne),dependsOn:l(_).visibility_group.depends_on,"onUpdate:dependsOn":T[5]||(T[5]=ne=>l(_).visibility_group.depends_on=ne)},null,8,["type","dependsOn"])]),_:1})]),_:1}),s(H,null,{default:b(()=>[s(j,{label:N.$t("brands::brand.form.upload_logo"),class:"mb-5 max-w-xl"},{default:b(()=>[s(ro,{name:"logo_view","upload-url":`${N.$store.state.apiURL}/brands/${f.value.id}/logo/view`,image:f.value.logo_view_url,"show-delete":!!f.value.logo_view,"cropper-options":{aspectRatio:null},"choose-text":l(_).logo_view?N.$t("core::app.change"):N.$t("core::settings.choose_logo"),onCleared:T[6]||(T[6]=ne=>w("view")),onSuccess:T[7]||(T[7]=ne=>x(ne,"view"))},{image:b(({src:ne})=>[o("img",{src:ne,class:"h-8 w-auto"},null,8,$q)]),_:1},8,["upload-url","image","show-delete","choose-text"]),D(o("p",wq,null,512),[[W,"brands::brand.form.navigation.upload_logo_info"]])]),_:1},8,["label"]),s(j,{label:N.$t("brands::brand.form.navigation.background_color")},{default:b(()=>[s(P,{modelValue:l(_).config.navigation.background_color,"onUpdate:modelValue":T[8]||(T[8]=ne=>l(_).config.navigation.background_color=ne),"allow-remove":!1,swatches:l(h)},null,8,["modelValue","swatches"]),s(M,{textContent:S(l(_).getError("config.navigation.background_color"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1}),s(H,null,{default:b(()=>[s(j,{label:N.$t("brands::brand.form.upload_logo"),class:"mb-5 max-w-xl"},{default:b(()=>[s(ro,{name:"logo_mail","upload-url":`${N.$store.state.apiURL}/brands/${f.value.id}/logo/mail`,image:f.value.logo_mail_url,"show-delete":!!f.value.logo_mail,"cropper-options":{aspectRatio:null},"choose-text":l(_).logo_mail?N.$t("core::app.change"):N.$t("core::settings.choose_logo"),onCleared:T[9]||(T[9]=ne=>w("mail")),onSuccess:T[10]||(T[10]=ne=>x(ne,"mail"))},{image:b(({src:ne})=>[o("img",{src:ne,class:"h-8 w-auto"},null,8,Cq)]),_:1},8,["upload-url","image","show-delete","choose-text"]),D(o("p",Sq,null,512),[[W,"brands::brand.form.email.upload_logo_info"]])]),_:1},8,["label"]),D(o("h3",Rq,null,512),[[W,"brands::brand.form.document.send.info"]]),s(j,{label:N.$t("brands::brand.form.document.send.subject"),"label-for":"document_mail_subject"},{label:b(({label:ne,labelFor:ce})=>[o("div",Fq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.documentSendMailSubject,"onUpdate:modelValue":T[11]||(T[11]=fe=>y.documentSendMailSubject=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(U,{id:"document_mail_subject",modelValue:l(_).config.document.mail_subject[y.documentSendMailSubject],"onUpdate:modelValue":T[12]||(T[12]=ne=>l(_).config.document.mail_subject[y.documentSendMailSubject]=ne)},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.document.mail_subject"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:N.$t("brands::brand.form.document.send.message")},{label:b(({label:ne,labelFor:ce})=>[o("div",Vq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.documentSendMailMessage,"onUpdate:modelValue":T[13]||(T[13]=fe=>y.documentSendMailMessage=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(J,{modelValue:l(_).config.document.mail_message[y.documentSendMailMessage],"onUpdate:modelValue":T[14]||(T[14]=ne=>l(_).config.document.mail_message[y.documentSendMailMessage]=ne),"with-image":!1},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.document.mail_message"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:N.$t("brands::brand.form.document.send.button_text"),"label-for":"document_mail_button_text"},{label:b(({label:ne,labelFor:ce})=>[o("div",Tq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.documentSendMailButton,"onUpdate:modelValue":T[15]||(T[15]=fe=>y.documentSendMailButton=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(U,{id:"document_mail_button_text",modelValue:l(_).config.document.mail_button_text[y.documentSendMailButton],"onUpdate:modelValue":T[16]||(T[16]=ne=>l(_).config.document.mail_button_text[y.documentSendMailButton]=ne)},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.document.mail_button_text"))},null,8,["textContent"])]),_:1},8,["label"]),D(o("h3",Dq,null,512),[[W,"brands::brand.form.document.sign.info"]]),s(j,{label:N.$t("brands::brand.form.document.sign.subject"),"label-for":"signed_mail_subject"},{label:b(({label:ne,labelFor:ce})=>[o("div",qq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.documentSignedMailSubject,"onUpdate:modelValue":T[17]||(T[17]=fe=>y.documentSignedMailSubject=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(U,{id:"signed_mail_subject",modelValue:l(_).config.document.signed_mail_subject[y.documentSignedMailSubject],"onUpdate:modelValue":T[18]||(T[18]=ne=>l(_).config.document.signed_mail_subject[y.documentSignedMailSubject]=ne)},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.document.signed_mail_subject"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:N.$t("brands::brand.form.document.sign.message")},{label:b(({label:ne,labelFor:ce})=>[o("div",Eq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.documentSignedMailMessage,"onUpdate:modelValue":T[19]||(T[19]=fe=>y.documentSignedMailMessage=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(J,{modelValue:l(_).config.document.signed_mail_message[y.documentSignedMailMessage],"onUpdate:modelValue":T[20]||(T[20]=ne=>l(_).config.document.signed_mail_message[y.documentSignedMailMessage]=ne),"with-image":!1},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.document.signed_mail_message"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1}),s(H,null,{default:b(()=>[s(j,{label:N.$t("brands::brand.form.document.sign.after_sign_message")},{label:b(({label:ne,labelFor:ce})=>[o("div",Aq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.documentSignedThankyouMessage,"onUpdate:modelValue":T[21]||(T[21]=fe=>y.documentSignedThankyouMessage=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(J,{modelValue:l(_).config.document.signed_thankyou_message[y.documentSignedThankyouMessage],"onUpdate:modelValue":T[22]||(T[22]=ne=>l(_).config.document.signed_thankyou_message[y.documentSignedThankyouMessage]=ne),"with-image":!1},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.document.signed_thankyou_message"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:N.$t("brands::brand.form.document.accept.after_accept_message")},{label:b(({label:ne,labelFor:ce})=>[o("div",Bq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.documentAcceptedThankyouMessage,"onUpdate:modelValue":T[23]||(T[23]=fe=>y.documentAcceptedThankyouMessage=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(J,{modelValue:l(_).config.document.accepted_thankyou_message[y.documentAcceptedThankyouMessage],"onUpdate:modelValue":T[24]||(T[24]=ne=>l(_).config.document.accepted_thankyou_message[y.documentAcceptedThankyouMessage]=ne),"with-image":!1},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.document.accepted_thankyou_message"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1}),s(H,null,{default:b(()=>[s(j,{label:N.$t("brands::brand.form.pdf.default_font"),description:N.$t("brands::brand.form.pdf.default_font_info",{fontName:"DejaVu Sans"}),"label-for":"pdf-font",required:""},{default:b(()=>[s(K,{modelValue:l(_).config.pdf.font,"onUpdate:modelValue":T[25]||(T[25]=ne=>l(_).config.pdf.font=ne),clearable:!1,"input-id":"pdf-font",options:I.value},null,8,["modelValue","options"]),s(M,{textContent:S(l(_).getError("config.pdf.font"))},null,8,["textContent"])]),_:1},8,["label","description"]),s(j,{label:N.$t("brands::brand.form.pdf.size"),"label-for":"pdf-size",required:""},{default:b(()=>[s(K,{modelValue:l(_).config.pdf.size,"onUpdate:modelValue":T[26]||(T[26]=ne=>l(_).config.pdf.size=ne),clearable:!1,"input-id":"pdf-size",options:["a4","letter"]},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.pdf.size"))},null,8,["textContent"])]),_:1},8,["label"]),s(j,{label:N.$t("brands::brand.form.pdf.orientation"),"label-for":"pdf-orientation",required:""},{default:b(()=>[s(K,{modelValue:l(_).config.pdf.orientation,"onUpdate:modelValue":T[27]||(T[27]=ne=>l(_).config.pdf.orientation=ne),clearable:!1,"input-id":"pdf-orientation",options:["portrait","landscape"]},{label:b(({option:ne})=>[Q(S(N.$t("brands::brand.form.pdf.orientation_"+ne)),1)]),option:b(ne=>[Q(S(N.$t("brands::brand.form.pdf.orientation_"+ne.label)),1)]),_:1},8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.pdf.orientation"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1}),s(H,null,{default:b(()=>[s(j,{label:N.$t("brands::brand.form.signature.bound_text"),"label-for":"bound_text",required:""},{label:b(({label:ne,labelFor:ce})=>[o("div",Nq,[s(L,{for:ce,label:ne},null,8,["for","label"]),s(Z,{modelValue:y.signatureBoundText,"onUpdate:modelValue":T[28]||(T[28]=fe=>y.signatureBoundText=fe),items:l(r),placement:"bottom-end"},null,8,["modelValue","items"])])]),default:b(()=>[s(G,{id:"bound_text",modelValue:l(_).config.signature.bound_text[y.signatureBoundText],"onUpdate:modelValue":T[29]||(T[29]=ne=>l(_).config.signature.bound_text[y.signatureBoundText]=ne)},null,8,["modelValue"]),s(M,{textContent:S(l(_).getError("config.signature.bound_text"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1})])):O("",!0)]),_:1},8,["header","overlay","onSubmit"])}}};window.Innoclapps&&Innoclapps.booting(function(e,t){t.addRoute("settings",{path:"/settings/brands",component:xq,meta:{title:qe.t("brands::brand.brands")}}),t.addRoute("settings",{path:"/settings/brands/create",component:Iq,name:"create-brand"}),t.addRoute("settings",{path:"/settings/brands/:id/edit",component:Oq,name:"edit-brand"})});const zq=["innerHTML"],Mq={class:"text-neutral-600 dark:text-neutral-300"},Uq=["textContent"],Pq=["onClick"],jq={__name:"LoggedCallsCard",props:{card:Object},setup(e){const t=q(null);function n(a){t.value=a,Innoclapps.modal().show("readCallOutcomeModal")}return(a,r)=>{const i=v("IModal"),u=v("RouterLink"),c=v("Icon"),m=v("CardTableAsync"),p=ae("t");return d(),k(te,null,[s(i,{id:"readCallOutcomeModal",title:a.$t("calls.call.outcome.call_outcome"),"hide-footer":""},{default:b(()=>[o("div",{innerHTML:t.value},null,8,zq)]),_:1},8,["title"]),s(m,{card:e.card},{date:b(({formatted:f,row:h})=>[o("p",Mq,[Q(S(h.user.name)+" - ",1),o("span",{class:"font-normal",textContent:S(f)},null,8,Uq)]),(d(!0),k(te,null,re(h.associations,(g,y)=>(d(),k("div",{key:y},[(d(!0),k(te,null,re(g,_=>(d(),k("div",{key:_.id,class:"flex space-x-2"},[s(u,{to:_.path,class:"link text-sm font-normal"},{default:b(()=>[Q(S(_.display_name),1)]),_:2},1032,["to"])]))),128))]))),128)),o("a",{class:"link mt-1 inline-flex items-center text-sm",href:"#",onClick:g=>n(h.body)},[D(o("span",null,null,512),[[p,"calls::call.read_outcome"]]),s(c,{icon:"Window",class:"ml-2 mt-px h-4 w-4"})],8,Pq)]),"outcome.name":b(({row:f,formatted:h})=>[s(zt,{color:f.outcome.swatch_color,class:"inline-flex shrink-0 items-center self-start rounded px-2 py-0.5 font-normal dark:!text-white"},{default:b(()=>[Q(S(h),1)]),_:2},1032,["color"])]),_:1},8,["card"])],64)}}},Lq={__name:"RecordTabCall",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>{const a=v("ITab");return St([e.resource.calls_count],()=>s(a,{badge:e.resource.calls_count,"badge-variant":"neutral",title:t.$t("calls::call.calls"),icon:"Phone"},null,8,["badge","title"]),n,0)}}};function tl(){const e=Innoclapps.app.config.globalProperties.$voip,t=Innoclapps.config("voip.client")!==null;return{voip:e,hasVoIPClient:t}}const Hq={__name:"CallMakeButton",props:{resourceName:{required:!0,type:String},resource:{required:!0,type:Object}},emits:["call-requested"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{gate:r}=On(),{hasVoIPClient:i}=tl(),u=V(()=>{if(i){if(r.userCant("use voip"))return a("calls::call.no_voip_permissions")}else return a("core::app.integration_not_configured");return""}),c=V(()=>r.userCant("use voip")||!i),m=V(()=>{let I=[];switch(I.push(..._(n.resource)),n.resourceName){case"contacts":I.push(..._(n.resource.companies||[]));break;case"companies":I.push(..._(n.resource.contacts||[]));break;case"deals":I.push(..._(n.resource.companies||[])),I.push(..._(n.resource.contacts||[]));break}return I}),p=V(()=>m.value.map(I=>I.phoneNumber)),f=V(()=>p.value.length),h=V(()=>f.value>0),g=V(()=>f.value>1);function y(I){t("call-requested",I)}function _(I){let F=[];return wt(I).forEach($=>{F=F.concat(...($.phones||[]).map(C=>({type:C.type,phoneNumber:C.number,resourceDisplayName:$.display_name})))}),F}return(I,F)=>{const $=v("IDropdownItem"),C=v("IDropdown"),w=v("IButton"),x=ae("i-tooltip");return D((d(),k("span",null,[g.value?(d(),R(C,{key:0,disabled:c.value,size:"sm",icon:"Phone",variant:"secondary",text:I.$t("calls::call.make")},{default:b(()=>[(d(!0),k(te,null,re(m.value,(A,N)=>(d(),R($,{key:A.phoneNumber+A.type+N,icon:A.type=="mobile"?"DeviceMobile":"Phone",onClick:T=>y(A.phoneNumber)},{default:b(()=>[Q(S(A.phoneNumber)+" ("+S(A.resourceDisplayName)+") ",1)]),_:2},1032,["icon","onClick"]))),128))]),_:1},8,["disabled","text"])):(d(),R(w,{key:1,size:"sm",icon:"Phone",variant:"secondary",disabled:!h.value||c.value,text:I.$t("calls::call.make"),onClick:F[0]||(F[0]=A=>y(p.value[0]))},null,8,["disabled","text"]))])),[[x,c.value?u.value:null]])}}},Gq={class:"flex items-center"},Kq={key:0,class:"ml-2 flex"},Yq=["onClick"],Wq=["value"],Zn={__name:"CreateFollowUpTask",props:["modelValue"],emits:["update:modelValue"],setup(e,{expose:t,emit:n}){const a=e,{t:r}=ve(),{appMoment:i,dateFromAppTimezone:u}=Ne(),c=q(""),m=q(!1),p=Go(a,"modelValue",n),f=V(()=>({label:r("core::dates.today"),value:i().format("YYYY-MM-DD")})),h=V(()=>({label:r("core::dates.tomorrow"),value:T(1),default:!0})),g=V(()=>({label:r("core::dates.in_2_days")+" ("+E(2)+")",value:T(2)})),y=V(()=>({label:r("core::dates.in_3_days")+" ("+E(3)+")",value:T(3)})),_=V(()=>({label:r("core::dates.in_4_days")+" ("+E(4)+")",value:T(4)})),I=V(()=>({label:r("core::dates.in_5_days")+" ("+E(5)+")",value:T(5)})),F=V(()=>({label:r("core::dates.in_2_weeks")+" ("+E(2,"weeks","MMMM Do")+")",value:T(2,"weeks")})),$=V(()=>({label:r("core::dates.in_1_month")+" ("+E(1,"months","MMMM Do")+")",value:T(1,"months")})),C=V(()=>c.value==="custom"),w=V(()=>[l(f),l(h),l(g),l(y),l(_),l(I),l(F),l($),{label:r("core::dates.custom"),value:"custom"}]),x=V(()=>{let M=Ee(w.value,["value",c.value]);return M?M.label:""}),A=V(()=>Ee(w.value,["default",!0]).value);function N(M){c.value=M,M!=="custom"&&(p.value=M)}function T(M,j="days",U="YYYY-MM-DD"){return i().add(M,j).format(U)}function E(M,j="days",U="dddd"){return u(i().add(M,j),U)}function B(M){M&&!p.value?Fe(()=>{p.value=A.value,c.value=A.value}):M||(p.value=null)}function z(){m.value=!1}return t({reset:z}),(M,j)=>{const U=v("IFormCheckbox"),P=v("Icon"),H=v("IDropdownItem"),L=v("IDropdown"),Z=v("DatePicker");return d(),k("div",Gq,[s(U,{checked:m.value,"onUpdate:checked":j[0]||(j[0]=J=>m.value=J),label:M.$t("activities::activity.create_follow_up_task"),onChange:B},null,8,["checked","label"]),m.value?(d(),k("div",Kq,[D(o("div",null,[s(L,null,{toggle:b(({toggle:J})=>[o("a",{href:"#",class:"link inline-flex items-center text-sm",onClick:ie(J,["prevent"])},[Q(S(x.value)+" ",1),s(P,{icon:"ChevronDown",class:"ml-1 h-4 w-4"})],8,Yq)]),default:b(()=>[(d(!0),k(te,null,re(w.value,J=>(d(),R(H,{key:J.value,text:J.label,onClick:K=>N(J.value)},null,8,["text","onClick"]))),128))]),_:1})],512),[[Y,!C.value]]),C.value?(d(),R(Z,{key:0,modelValue:l(p),"onUpdate:modelValue":j[1]||(j[1]=J=>xt(p)?p.value=J:null),required:!0},{default:b(({inputValue:J,inputEvents:K})=>[o("input",Re({value:J,class:"cursor-pointer bg-transparent text-sm font-medium text-neutral-700 focus:outline-none dark:text-neutral-100"},qo(K,!0)),null,16,Wq)]),_:1},8,["modelValue"])):O("",!0)])):O("",!0)])}}};function xo(){const{t:e}=ve(),{findTypeByFlag:t}=$n(),{currentUser:n}=Le(),{userTimezone:a}=Ne();async function r(i,u,c,m,p={}){const f=moment.tz(i,a.value).hour(Innoclapps.config("activities.defaults.hour")).minute(Innoclapps.config("activities.defaults.minutes")).clone().utc(),{createResource:h}=Je(Innoclapps.resourceName("activities"));return await h(Object.assign({title:e("activities::activity.follow_up_with_title",{with:m}),activity_type_id:t("task").id,due_date:f.format("YYYY-MM-DD"),due_time:f.format("HH:mm:ss"),end_date:f.format("YYYY-MM-DD"),reminder_minutes_before:Innoclapps.config("defaults.reminder_minutes"),user_id:n.value.id,[u]:[c]},p))}return{createFollowUpActivity:r}}const Qq={class:"flex flex-col sm:flex-row sm:items-center"},Xq={class:"mt-2 space-y-2 sm:mt-0 sm:space-x-2 sm:space-y-0"},Zq={__name:"CallsCreate",props:{viaResource:{required:!0,type:String},viaResourceId:{required:!0,type:[String,Number]},relatedResourceDisplayName:{required:!0,type:String}},emits:["cancel"],setup(e){const t=e,n=Me("synchronizeResource"),a=Me("incrementResourceCount"),r=Innoclapps.resourceName("calls"),{t:i}=ve(),{fields:u,getCreateFields:c}=gt(),{createFollowUpActivity:m}=xo(),{createResource:p}=Je(r),{form:f}=It(u,{task_date:null}),h=q(null);async function g(I){if(f.task_date){let F=await m(f.task_date,t.viaResource,t.viaResourceId,t.relatedResourceDisplayName,{note:i("calls::call.follow_up_task_body",{content:I.body})});h.value.reset(),F&&(n({activities:[F]}),a("incomplete_activities_for_user_count"))}n({calls:[I]}),a("calls_count"),Innoclapps.success(i("calls::call.created")),f.reset()}function y(){p(f.set(t.viaResource,[t.viaResourceId]).withQueryString({via_resource:t.viaResource,via_resource_id:t.viaResourceId})).then(g)}async function _(){u.value.set(await c(r,{viaResource:t.viaResource,viaResourceId:t.viaResourceId}))}return _(),(I,F)=>{const $=v("FormFields"),C=v("IButton"),w=v("ICard");return d(),R(w,{tag:"form",method:"POST",overlay:l(u).isEmpty(),onSubmit:ie(y,["prevent"])},{footer:b(()=>[o("div",Qq,[s(Zn,{ref_key:"createFollowUpTaskRef",ref:h,modelValue:l(f).task_date,"onUpdate:modelValue":F[0]||(F[0]=x=>l(f).task_date=x),class:"grow"},null,8,["modelValue"]),o("div",Xq,[s(C,{class:"w-full sm:w-auto",variant:"white",size:"sm",text:I.$t("core::app.cancel"),onClick:F[1]||(F[1]=x=>I.$emit("cancel"))},null,8,["text"]),s(C,{class:"w-full sm:w-auto",size:"sm",disabled:l(f).busy,text:I.$t("calls::call.add"),onClick:y},null,8,["disabled","text"])])])]),default:b(()=>[s($,{"form-id":l(f).formId,fields:l(u),"resource-name":l(r)},null,8,["form-id","fields","resource-name"])]),_:1},8,["overlay","onSubmit"])}}},Jl=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name"));function r(u){n.value=u}function i(){e(!0),Innoclapps.request().get("/call-outcomes",{params:{per_page:100}}).then(({data:u})=>n.value=u.data).finally(()=>e(!1))}return{callOutcomes:n,outcomesByName:a,outcomesAreBeingFetched:t,setCallOutcomes:r,fetchCallOutcomes:i}}),Jq={class:"flex justify-end space-x-2"},eE={__name:"CallsEdit",props:{callId:{required:!0,type:Number},viaResource:{required:!0,type:String},viaResourceId:{required:!0,type:[String,Number]}},emits:["updated","cancelled"],setup(e,{emit:t}){const n=e,a=Me("synchronizeResource"),r=Innoclapps.resourceName("calls"),{t:i}=ve(),{fields:u,getUpdateFields:c}=gt(),{form:m}=It(u),{updateResource:p,retrieveResource:f}=Je(r);function h(){p(m.withQueryString({via_resource:n.viaResource,via_resource_id:n.viaResourceId}),n.callId).then(g)}function g(_){a({calls:_}),t("updated",_),Innoclapps.success(i("calls::call.updated"))}async function y(){const _=await f(n.callId);u.value.set(await c(r,n.callId,{viaResource:n.viaResource,viaResourceId:n.viaResourceId})).populate(_)}return y(),(_,I)=>{const F=v("FormFields"),$=v("IButton"),C=v("ICard");return d(),R(C,{overlay:l(u).isEmpty()},{footer:b(()=>[o("div",Jq,[s($,{variant:"white",size:"sm",text:_.$t("core::app.cancel"),onClick:I[0]||(I[0]=w=>_.$emit("cancelled"))},null,8,["text"]),s($,{variant:"primary",size:"sm",disabled:l(m).busy,text:_.$t("core::app.save"),onClick:h},null,8,["disabled","text"])])]),default:b(()=>[s(F,{fields:l(u),"form-id":l(m).formId,"resource-name":l(r),"resource-id":e.callId},null,8,["fields","form-id","resource-name","resource-id"])]),_:1},8,["overlay"])}}},tE={class:"flex items-center"},nE={class:"flex grow flex-col space-y-1 md:flex-row md:items-center md:space-x-3 md:space-y-0"},oE={class:"font-medium"},lE=["textContent"],aE=["onClick"],sE=["textContent"],rE={key:1,class:"ml-2 mt-px inline-flex self-start md:ml-5"},iE=["innerHTML"],Ps=Object.assign({inheritAttrs:!1},{__name:"CallsView",props:{callId:{required:!0,type:Number},commentsCount:{required:!0,type:Number},callDate:{required:!0,type:String},body:{required:!0,type:String},userId:{required:!0,type:Number},outcomeId:{required:!0,type:Number},viaResource:{required:!0,type:String},viaResourceId:{required:!0,type:[String,Number]},authorizations:{required:!0,type:Object},comments:{required:!0,type:Array},collapsable:Boolean},setup(e){const t=e,n=Me("synchronizeResource"),a=Me("decrementResourceCount"),{t:r}=ve(),{localizedDateTime:i}=Ne(),{outcomesByName:u}=Jl(),{findUserById:c}=Le(),{updateResource:m,deleteResource:p}=Je(Innoclapps.resourceName("calls")),f=V(()=>u.value.find(x=>x.id==t.outcomeId)),h=V(()=>u.value.map(x=>({id:x.id,name:x.name}))),g=V(()=>c(t.userId)),{commentsAreVisible:y}=ln(t.callId,"calls"),_=q(!1),I=q(!1),F=q(!0);async function $(x={}){let A=await m({call_outcome_id:t.outcomeId,date:t.callDate,body:t.body,via_resource:t.viaResource,via_resource_id:t.viaResourceId,...x},t.callId);n({calls:A})}async function C(x){await Innoclapps.dialog().confirm(),await p(x),n({calls:{id:x,_delete:!0}}),a("calls_count"),Innoclapps.success(r("calls::call.deleted"))}function w(x){x.type=="dblclick"&&_.value||t.authorizations.update&&(_.value=!_.value)}return(x,A)=>{const N=v("Icon"),T=v("IAvatar"),E=v("i18n-t"),B=v("DropdownSelectInput"),z=v("IDropdownItem"),M=v("IMinimalDropdown"),j=v("TextCollapse"),U=v("CommentsCollapse"),P=v("CommentsAdd"),H=v("ICard");return d(),k(te,null,[D(s(H,Re(x.$attrs,{condensed:"",class:"call-"+e.callId,"footer-class":"inline-flex flex-col w-full"}),{header:b(()=>[o("div",tE,[I.value?(d(),k("a",{key:0,href:"#",class:"mr-2 mt-0.5 shrink-0 self-start text-neutral-500 dark:text-neutral-300 md:mt-0 md:self-auto",onClick:A[0]||(A[0]=L=>F.value=!F.value)},[s(N,{icon:F.value?"ChevronRight":"ChevronDown",class:"h-4 w-4"},null,8,["icon"])])):O("",!0),A[1]||(he(-1),A[1]=s(T,{size:"xs",class:"mr-1.5 shrink-0 self-start md:self-auto",src:g.value.avatar_url},null,8,["src"]),he(1),A[1]),o("div",nE,[s(E,{scope:"global",keypath:"calls::call.info_created",tag:"span",class:"grow text-sm text-neutral-700 dark:text-white"},{user:b(()=>[o("span",oE,S(g.value.name),1)]),date:b(()=>[o("span",{class:"font-medium",textContent:S(l(i)(e.callDate))},null,8,lE)]),_:1}),s(zt,{color:f.value.swatch_color,class:"inline-flex shrink-0 items-center self-start rounded-md py-0.5 dark:!text-white sm:rounded-full"},{default:b(()=>[e.authorizations.update?St([e.outcomeId],()=>(d(),R(B,{key:0,items:h.value,"model-value":f.value,"label-key":"name","value-key":"id",onChange:A[2]||(A[2]=L=>$({call_outcome_id:L.id}))},{default:b(({label:L,toggle:Z})=>[o("button",{type:"button",class:"flex w-full items-center justify-between rounded px-2.5 text-xs/5 focus:outline-none",onClick:Z},[Q(S(L)+" ",1),s(N,{icon:"ChevronDown",class:"ml-1 h-4 w-4"})],8,aE)]),_:1},8,["items","model-value"])),A,3):(d(),k("span",{key:1,class:"px-1 text-xs",textContent:S(f.value.name)},null,8,sE))]),_:1},8,["color"])]),e.authorizations.update&&e.authorizations.delete?(d(),k("div",rE,[s(M,{class:"mt-1 md:mt-0.5"},{default:b(()=>[D(s(z,{text:x.$t("core::app.edit"),onClick:w},null,8,["text"]),[[Y,e.authorizations.update]]),D(s(z,{text:x.$t("core::app.delete"),onClick:A[4]||(A[4]=L=>C(e.callId))},null,8,["text"]),[[Y,e.authorizations.delete]])]),_:1})])):O("",!0)])]),footer:b(()=>[s(P,{class:"self-end","via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"commentable-id":e.callId,"commentable-type":"calls",onCreated:A[11]||(A[11]=L=>(y.value=!0,l(n)({calls:{id:e.callId,comments:[L]}})))},null,8,["via-resource","via-resource-id","commentable-id"])]),default:b(()=>[e.collapsable?(d(),R(j,{key:0,collapsed:F.value,"onUpdate:collapsed":A[5]||(A[5]=L=>F.value=L),text:e.body,length:250,class:"wysiwyg-text",onHasTextToCollapse:A[6]||(A[6]=L=>I.value=L),onDblclick:w},null,8,["collapsed","text"])):(d(),k("div",{key:1,class:"wysiwyg-text",onDblclick:w,innerHTML:e.body},null,40,iE)),s(U,{class:"mt-6","via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"commentable-id":e.callId,"commentable-type":"calls",count:e.commentsCount,comments:e.comments,onUpdated:A[7]||(A[7]=L=>l(n)({calls:{id:e.callId,comments:L}})),onDeleted:A[8]||(A[8]=L=>l(n)({calls:{id:e.callId,comments:{id:L,_delete:!0}}})),"onUpdate:comments":A[9]||(A[9]=L=>l(n)({calls:{id:e.callId,comments:L}})),"onUpdate:count":A[10]||(A[10]=L=>l(n)({calls:{id:e.callId,comments_count:L}}))},null,8,["via-resource","via-resource-id","commentable-id","count","comments"])]),_:1},16,["class"]),[[Y,!_.value]]),_.value?(d(),R(eE,{key:0,"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"call-id":e.callId,onCancelled:A[12]||(A[12]=L=>_.value=!1),onUpdated:A[13]||(A[13]=L=>_.value=!1)},null,8,["via-resource","via-resource-id","call-id"])):O("",!0)],64)}}}),uE={class:"-mt-[20px] mb-3 overflow-hidden rounded-b-md border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-900 sm:mb-7"},dE={class:"px-4 py-5 sm:p-6"},cE={class:"sm:flex sm:items-start sm:justify-between"},mE={class:"text-base/6 font-medium text-neutral-900 dark:text-white"},pE={class:"mt-2 max-w-xl text-sm text-neutral-500 dark:text-neutral-200"},fE={class:"mt-5 sm:ml-6 sm:mt-0 sm:flex sm:shrink-0 sm:items-center"},vE={class:"space-y-4"},bE={class:"mt-6 text-center text-neutral-800 dark:text-neutral-200"},ml="calls",hE={__name:"RecordTabCallPanel",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object},scrollElement:{type:String}},setup(e){const t=e,n=Me("synchronizeResource"),a=Ye(),r=q(null),i=q(!1),{voip:u}=tl(),{commentsAreVisible:c}=ln(a.query.resourceId,ml),{dataLoadedFirstTime:m,focusToAssociateableElement:p,searchResults:f,isSearching:h,hasSearchResults:g,performSearch:y,search:_,loadData:I,infiniteHandler:F}=Xn({resourceName:t.resourceName,resource:xe(t,"resource"),scrollElement:t.scrollElement,synchronizeResource:n,infinityRef:r,timelineRelation:ml}),$=V(()=>ot(f.value||t.resource.calls,"date","desc")),C=V(()=>$.value.length>0);async function w(x){i.value=!0,await u.makeCall(x)}return a.query.resourceId&&a.query.section===ml&&An(m,()=>{p(a.query.resourceId,"call").then(()=>{a.query.comment_id&&(c.value=!0)})}),(x,A)=>{const N=v("IButton"),T=v("SearchInput"),E=v("ITabPanel"),B=ae("t");return d(),R(E,{lazy:!l(m),onActivatedOnce:l(I)},{default:b(()=>[o("div",uE,[D(o("div",dE,[o("div",cE,[o("div",null,[D(o("h3",mE,null,512),[[B,"calls::call.manage_calls"]]),o("div",pE,[D(o("p",null,null,512),[[B,"calls::call.info"]])])]),o("div",fE,[s(N,{icon:"Plus",size:"sm",text:x.$t("calls::call.add"),onClick:A[0]||(A[0]=z=>i.value=!0)},null,8,["text"]),x.$gate.userCan("use voip")?(d(),R(Hq,{key:0,class:"ml-2","resource-name":e.resourceName,resource:e.resource,onCallRequested:w},null,8,["resource-name","resource"])):O("",!0)])]),D(s(T,{modelValue:l(_),"onUpdate:modelValue":A[1]||(A[1]=z=>xt(_)?_.value=z:null),class:"mt-2",onInput:l(y)},null,8,["modelValue","onInput"]),[[Y,C.value||l(_)]])],512),[[Y,!i.value]]),i.value?(d(),R(Zq,{key:0,shadow:!1,ring:!1,rounded:!1,"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource-display-name":e.resource.display_name,onCancel:A[2]||(A[2]=z=>i.value=!1)},null,8,["via-resource","via-resource-id","related-resource-display-name"])):O("",!0)]),o("div",vE,[(d(!0),k(te,null,re($.value,(z,M,j,U)=>{const P=[z.updated_at,z.comments_count,z.call_outcome_id];if(U&&U.key===z.id&&Tl(U,P))return U;const H=(d(),k("div",{key:z.id},[s(Ps,{"call-id":z.id,"comments-count":z.comments_count,"call-date":z.date,body:z.body,"user-id":z.user_id,"outcome-id":z.call_outcome_id,authorizations:z.authorizations,comments:z.comments||[],"via-resource":e.resourceName,"via-resource-id":e.resourceId},null,8,["call-id","comments-count","call-date","body","user-id","outcome-id","authorizations","comments","via-resource","via-resource-id"])]));return H.memo=P,H},A,3),128))]),D(o("div",bE,null,512),[[Y,l(h)&&!l(g)],[B,"core::app.no_search_results"]]),s(xn,{ref_key:"infinityRef",ref:r,"scroll-element":e.scrollElement,onHandle:A[5]||(A[5]=z=>l(F)(z))},null,8,["scroll-element"])]),_:1},8,["lazy","onActivatedOnce"])}}},_E={class:"mt-3"},gE={__name:"RecordTabTimelineCall",props:Pt,setup(e){return(t,n)=>(d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned||!1,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"Phone",heading:t.$t("calls::call.timeline.heading"),"heading-class":"font-medium"},{default:b(()=>[o("div",_E,[s(Ps,{"call-id":t.log.id,"comments-count":t.log.comments_count,"call-date":t.log.date,body:t.log.body,"user-id":t.log.user_id,"outcome-id":t.log.call_outcome_id,authorizations:t.log.authorizations,comments:t.log.comments||[],"via-resource":t.resourceName,"via-resource-id":t.resourceId,collapsable:""},null,8,["call-id","comments-count","call-date","body","user-id","outcome-id","authorizations","comments","via-resource","via-resource-id"])])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key","heading"]))}},yE={__name:"CallsOutcomesIndex",setup(e){const t=Innoclapps.resourceName("call-outcomes"),{fetchCallOutcomes:n}=Jl();return(a,r)=>{const i=v("ICardHeading");return d(),R(vo,{"resource-name":l(t),"with-cancel":!1,onCreated:l(n),onUpdated:l(n),onDeleted:l(n)},{header:b(()=>[s(i,null,{default:b(()=>[Q(S(a.$t("calls::call.outcome.outcomes")),1)]),_:1})]),_:1},8,["resource-name","onCreated","onUpdated","onDeleted"])}}},xE={__name:"SettingsCalls",setup(e){return(t,n)=>(d(),R(yE))}},IE={class:"flex items-center"},kE={class:"lg:flex lg:space-y-4"},$E={class:"w-full"},wE={class:"grid grid-cols-12 gap-2 lg:gap-4"},CE={class:"col-span-12 lg:col-span-6"},SE={class:"flex"},RE={class:"grow"},FE={href:"https://www.twilio.com/console",class:"link mb-1 inline-flex items-center",target:"_blank",rel:"noopener noreferrer"},VE={class:"col-span-12 lg:col-span-6"},TE={class:"flex"},DE={class:"grow"},qE={href:"https://www.twilio.com/console",class:"link mb-1 inline-flex items-center",target:"_blank",rel:"noopener noreferrer"},EE={class:"mt-1 flex rounded-md shadow-sm"},AE={class:"relative flex grow items-stretch focus-within:z-10"},BE={class:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3"},NE=o("option",{value:""},null,-1),OE=["value"],zE={class:"mt-1 flex rounded-md shadow-sm"},ME={class:"relative flex grow items-stretch focus-within:z-10"},UE={__name:"SettingsTwilio",setup(e){const{t}=ve(),n=q([]),a=q(!1),r=q(!1),i=q(!1),u=q(!1),{form:c}=Ae(),m=Innoclapps.config("is_secure"),p=V(()=>!Be(c.twilio_auth_token)),f=V(()=>!Be(c.twilio_account_sid)),h=V(()=>!Be(c.twilio_app_sid)),g=V(()=>p.value&&f.value),y=V(()=>!Be(c.twilio_number)),_=V(()=>p.value&&f.value&&h.value),I=V(()=>Ee(n.value,["phoneNumber",c.twilio_number])),F=V(()=>I.value?I.value.capabilities.voice===!1:!1);function $(){c.post("settings").then(()=>{Innoclapps.success(t("core::settings.updated")),window.location.reload()})}function C(){Innoclapps.request().delete("/twilio").then(()=>{window.location.reload()})}function w(){Innoclapps.request().put(`/twilio/app/${c.twilio_app_sid}`,{voiceUrl:Innoclapps.config("voip.endpoints.call")}).then(()=>{window.location.reload()})}function x(){i.value=!0,Innoclapps.request().get("/twilio/numbers",{params:{account_sid:c.twilio_account_sid,auth_token:c.twilio_auth_token}}).then(({data:z})=>{n.value=z}).finally(()=>i.value=!1)}async function A(){let{data:z}=await Innoclapps.request().get(`/twilio/app/${c.twilio_app_sid}`);return z}function N(){r.value=!0,Innoclapps.request().post("/twilio/app",{number:c.twilio_number,account_sid:c.twilio_account_sid,auth_token:c.twilio_auth_token,voiceMethod:"POST",voiceUrl:Innoclapps.config("voip.endpoints.call"),friendlyName:"Concord CRM"}).then(({data:z})=>{c.twilio_app_sid=z.app_sid}).finally(()=>r.value=!1)}function T(){Innoclapps.dialog().confirm().then(E)}function E(){Innoclapps.request().delete(`/twilio/app/${c.twilio_app_sid}`,{params:{account_sid:c.twilio_account_sid,auth_token:c.twilio_auth_token}}).then(()=>{c.twilio_app_sid=null})}function B(){Innoclapps.request().get("/settings").then(({data:z})=>{c.set({twilio_account_sid:z.twilio_account_sid,twilio_auth_token:z.twilio_auth_token,twilio_app_sid:z.twilio_app_sid,twilio_number:z.twilio_number}),a.value=!0,p.value&&f.value&&(x(),h.value&&A().then(M=>{M.voiceUrl!==Innoclapps.config("voip.endpoints.call")&&(u.value=!0)}).catch(M=>{M.response.data.message.indexOf("[HTTP 404]")>-1&&E()}))})}return B(),(z,M)=>{const j=v("Icon"),U=v("ICardHeading"),P=v("IStepCircle"),H=v("IStepsCircle"),L=v("IButton"),Z=v("IAlert"),J=v("IFormLabel"),K=v("IFormInput"),G=v("IFormGroup"),oe=v("IFormSelect"),pe=v("ICard");return d(),R(pe,{overlay:!a.value},vt({header:b(()=>[o("div",IE,[_.value&&a.value&&!i.value?(d(),R(j,{key:0,icon:n.value.length===0||F.value||!l(m)?"XCircleSolid":"CheckCircleSolid",class:X(["mr-1 h-5 w-5",n.value.length===0||F.value||!l(m)?"text-danger-500":"text-success-600"])},null,8,["icon","class"])):O("",!0),s(U,null,{default:b(()=>[Q("Twilio")]),_:1}),s(H,{class:"pointer-events-none ml-4"},{default:b(()=>[s(P,{status:g.value?"complete":"current"},null,8,["status"]),s(P,{status:l(c).twilio_number?"complete":""},null,8,["status"]),s(P,{status:_.value&&l(c).twilio_number?"complete":"","is-last":""},null,8,["status"])]),_:1})])]),actions:b(()=>[D(s(L,{variant:"danger",size:"sm",text:z.$t("calls::twilio.disconnect"),onClick:C},null,8,["text"]),[[Y,_.value]])]),default:b(()=>[o("div",kE,[o("div",$E,[D(s(Z,{class:"mb-10",variant:"warning"},{default:b(()=>[Q(" Your Twilio application URL does match your installation URL. "),o("div",{class:"mt-4"},[o("div",{class:"-mx-2 -my-1.5 flex"},[o("button",{type:"button",class:"rounded-md bg-warning-50 px-2 py-1.5 text-sm font-medium text-warning-800 hover:bg-warning-100 focus:outline-none focus:ring-2 focus:ring-warning-600 focus:ring-offset-2 focus:ring-offset-warning-50",onClick:w}," Update URL ")])])]),_:1},512),[[Y,u.value]]),s(Z,{class:"mb-10",show:!l(m),variant:"warning"},{default:b(()=>[Q(" Application must be served over HTTPS URL in order to use the Twilio integration. ")]),_:1},8,["show"]),o("div",wE,[o("div",CE,[s(G,null,{label:b(()=>[o("div",SE,[o("div",RE,[s(J,{for:"twilio_account_sid"},{default:b(()=>[Q(" Account SID ")]),_:1})]),o("div",null,[o("small",null,[o("a",FE,[Q(" https://www.twilio.com/console "),s(j,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})])])])])]),default:b(()=>[s(K,{id:"twilio_account_sid",modelValue:l(c).twilio_account_sid,"onUpdate:modelValue":M[0]||(M[0]=ue=>l(c).twilio_account_sid=ue),autocomplete:"off"},null,8,["modelValue"])]),_:1})]),o("div",VE,[s(G,null,{label:b(()=>[o("div",TE,[o("div",DE,[s(J,{for:"twilio_auth_token"},{default:b(()=>[Q("Auth Token")]),_:1})]),o("div",null,[o("small",null,[o("a",qE,[Q(" https://www.twilio.com/console "),s(j,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})])])])])]),default:b(()=>[s(K,{id:"twilio_auth_token",modelValue:l(c).twilio_auth_token,"onUpdate:modelValue":M[1]||(M[1]=ue=>l(c).twilio_auth_token=ue),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})])]),o("div",{class:X(["mt-2 border-t border-neutral-200 pt-5 dark:border-neutral-600",{"pointer-events-none opacity-50 blur-sm":!g.value}])},[s(J,{label:z.$t("calls::twilio.number")},null,8,["label"]),s(Z,{show:F.value,class:"my-3",variant:"danger"},{default:b(()=>[Q(" This phone number does not have enabled voice capabilities. ")]),_:1},8,["show"]),o("div",EE,[o("div",AE,[o("div",BE,[s(j,{icon:"Phone",class:"h-5 w-5 text-neutral-400"})]),s(oe,{modelValue:l(c).twilio_number,"onUpdate:modelValue":M[2]||(M[2]=ue=>l(c).twilio_number=ue),rounded:!1,disabled:!n.value.length,class:"rounded-l-md pl-10"},{default:b(()=>[NE,(d(!0),k(te,null,re(n.value,ue=>(d(),k("option",{key:ue.phoneNumber,value:ue.phoneNumber},S(ue.phoneNumber),9,OE))),128))]),_:1},8,["modelValue","disabled"])]),s(L,{class:"relative -ml-px rounded-r-md",variant:"white",rounded:!1,loading:i.value,disabled:i.value,onClick:x},{default:b(()=>[Q(" Retrieve Numbers ")]),_:1},8,["loading","disabled"])])],2),o("div",{class:X(["mt-5 border-t border-neutral-200 pt-5 dark:border-neutral-600",{"pointer-events-none opacity-50 blur-sm":!y.value}])},[s(J,{label:z.$t("calls::twilio.app")},null,8,["label"]),o("div",zE,[o("div",ME,[s(K,{modelValue:l(c).twilio_app_sid,"onUpdate:modelValue":M[3]||(M[3]=ue=>l(c).twilio_app_sid=ue),disabled:!0,rounded:!1,class:"rounded-l-md"},null,8,["modelValue"])]),s(L,{rounded:!1,class:X(["relative",{"rounded-r-md":!h.value}]),disabled:r.value||h.value||F.value,text:z.$t("calls::twilio.create_app"),onClick:N},null,8,["class","disabled","text"]),h.value?(d(),R(L,{key:0,variant:"danger",rounded:!1,class:"relative rounded-r-md",icon:"Trash",onClick:T})):O("",!0)])],2)])])]),_:2},[_.value?{name:"footer",fn:b(()=>[s(L,{class:"mb-2",disabled:F.value,text:z.$t("core::app.save"),onClick:$},null,8,["disabled","text"])]),key:"0"}:void 0]),1032,["overlay"])}}},PE={key:0},jE=["href","onClick","textContent"],LE={key:0},HE={key:1},GE={__name:"PhoneCallableField",props:["resource","resourceName","resourceId","field","isFloating"],emits:["updated"],setup(e){const t=e,n=Innoclapps.resourceName("calls"),a=Me("synchronizeResource",null),r=Me("incrementResourceCount",null),i=q(!1),{t:u}=ve(),{gate:c}=On(),{voip:m,hasVoIPClient:p}=tl(),{fields:f,getCreateFields:h}=gt(),{form:g}=It(f,{task_date:null}),{createResource:y}=Je(n),{createFollowUpActivity:_}=xo(),I=V(()=>!p||!c.userCan("use voip")),F=V(()=>{if(p){if(c.userCant("use voip"))return u("calls::call.no_voip_permissions")}else return u("core::app.integration_not_configured");return""}),$=V(()=>t.field.value.length);async function C(A){if(g.task_date){let N=await _(g.task_date,t.resourceName,t.resourceId,t.resource.display_name,{note:u("calls::call.follow_up_task_body",{content:A.body})});N&&(a&&a({activities:[N]}),r&&r("incomplete_activities_for_user_count"))}a&&a({calls:[A]}),r&&r("calls_count"),Innoclapps.success(u("calls::call.created")),g.reset(),i.value=!1}async function w(A){g.set("task_date",null),(await m.makeCall(A)).on("Disconnect",()=>{i.value=!0}),f.value.set(await h(n,{viaResource:t.resourceName,viaResourceId:t.resourceId}))}function x(){y(g.set(t.resourceName,[t.resourceId]).withQueryString({via_resource:t.resourceName,via_resource_id:t.resourceId})).then(C)}return(A,N)=>{const T=v("FormFields"),E=v("IOverlay"),B=v("IModal"),z=v("IDropdownItem"),M=v("IButtonCopy"),j=v("IDropdown"),U=v("DetailFieldsItem"),P=ae("i-tooltip");return d(),k(te,null,[s(B,{visible:i.value,"onUpdate:visible":N[1]||(N[1]=H=>i.value=H),title:A.$t("calls::call.add"),size:"md","ok-title":A.$t("calls::call.add"),"ok-disabled":l(g).busy,"cancel-title":A.$t("core::app.cancel"),onShown:N[2]||(N[2]=H=>i.value=!0),onHidden:N[3]||(N[3]=H=>i.value=!1),onOk:x},{default:b(()=>[i.value?(d(),k("div",PE,[s(E,{show:l(f).isEmpty()},{default:b(()=>[s(T,{fields:l(f),"form-id":l(g).formId,"resource-name":l(n)},null,8,["fields","form-id","resource-name"])]),_:1},8,["show"]),s(Zn,{modelValue:l(g).task_date,"onUpdate:modelValue":N[0]||(N[0]=H=>l(g).task_date=H),class:"mt-2"},null,8,["modelValue"])])):O("",!0)]),_:1},8,["visible","title","ok-title","ok-disabled","cancel-title"]),s(U,{field:e.field,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId,"is-floating":e.isFloating,onUpdated:N[4]||(N[4]=H=>A.$emit("updated",H))},{field:b(({hasValue:H,value:L})=>[H?(d(!0),k(te,{key:0},re(L,(Z,J)=>(d(),R(j,{key:J,"no-caret":"",text:Z.number+(J!=$.value-1?", ":"")},{toggle:b(({toggle:K})=>[D(o("a",{class:"link text-sm",href:"tel:"+Z.number,onClick:ie(K,["prevent"]),textContent:S(Z.number)},null,8,jE),[[P,A.$t("contacts::fields.phone.types."+Z.type)]])]),default:b(()=>[e.isFloating?O("",!0):D((d(),k("span",LE,[s(z,{disabled:I.value,text:A.$t("calls::call.make"),onClick:K=>w(Z.number)},null,8,["disabled","text","onClick"])])),[[P,I.value?F.value:null]]),s(M,{text:Z.number,"success-message":A.$t("contacts::fields.phone.copied"),tag:"IDropdownItem"},{default:b(()=>[Q(S(A.$t("core::app.copy")),1)]),_:2},1032,["text","success-message"]),s(z,{href:"tel:"+Z.number,text:A.$t("core::app.open_in_app")},null,8,["href","text"])]),_:2},1032,["text"]))),128)):O("",!0),H?O("",!0):(d(),k("span",HE,""))]),_:1},8,["field","resource","resource-name","resource-id","is-floating"])],64)}}},KE=["href","onClick","textContent"],YE={key:1},js={__name:"PhoneField",props:["column","row","field","resourceName","resourceId"],setup(e){const t=e,n=V(()=>t.row[t.column.attribute].length);return(a,r)=>{const i=v("IButtonCopy"),u=v("IDropdownItem"),c=v("IDropdown"),m=v("IndexFieldsItem"),p=ae("i-tooltip");return d(),R(m,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(({hasValue:f,value:h})=>[f?(d(!0),k(te,{key:0},re(h,(g,y)=>(d(),R(c,{key:y,"no-caret":"",text:g.number+(y!=n.value-1?", ":"")},{toggle:b(({toggle:_})=>[D(o("a",{class:"link",href:"tel:"+g.number,onClick:ie(_,["prevent"]),textContent:S(g.number)},null,8,KE),[[p,a.$t("contacts::fields.phone.types."+g.type)]])]),default:b(()=>[de(a.$slots,"start",{phone:g}),s(i,{text:g.number,"success-message":a.$t("contacts::fields.phone.copied"),tag:"IDropdownItem"},{default:b(()=>[Q(S(a.$t("core::app.copy")),1)]),_:2},1032,["text","success-message"]),s(u,{href:"tel:"+g.number,text:a.$t("core::app.open_in_app")},null,8,["href","text"])]),_:2},1032,["text"]))),128)):(d(),k("span",YE,""))]),_:3},8,["resource-name","resource-id","row","field"])}}},WE={key:0},QE=Object.assign({inheritAttrs:!1},{__name:"PhoneCallableField",props:["column","row","field","resourceName","resourceId"],setup(e){const t=e,n=Innoclapps.resourceName("calls"),{t:a}=ve(),{gate:r}=On(),{voip:i,hasVoIPClient:u}=tl(),{createFollowUpActivity:c}=xo(),{fields:m,getCreateFields:p}=gt(),{form:f}=It(m,{task_date:null}),{createResource:h}=Je(n),g=q(!1),y=V(()=>!u||!r.userCan("use voip")),_=V(()=>{if(u){if(r.userCant("use voip"))return a("calls::call.no_voip_permissions")}else return a("core::app.integration_not_configured");return""});async function I(C){f.set("task_date",null),(await i.makeCall(C)).on("Disconnect",()=>{g.value=!0}),m.value.set(await p(n,{viaResource:t.resourceName,viaResourceId:t.row.id}))}async function F(C){f.task_date&&c(f.task_date,t.resourceName,t.resourceId,t.row.display_name||t.row.name,{note:a("calls::call.follow_up_task_body",{content:C.body})}),f.reset(),g.value=!1}function $(){h(f.set(t.resourceName,[t.row.id]).withQueryString({via_resource:t.resourceName,via_resource_id:t.row.id})).then(F)}return(C,w)=>{const x=v("FormFields"),A=v("IOverlay"),N=v("IModal"),T=v("IDropdownItem"),E=ae("i-tooltip");return d(),k(te,null,[s(N,{visible:g.value,"onUpdate:visible":w[1]||(w[1]=B=>g.value=B),title:C.$t("calls::call.add"),size:"md","ok-title":C.$t("calls::call.add"),"ok-disabled":l(f).busy,"cancel-title":C.$t("core::app.cancel"),onShown:w[2]||(w[2]=B=>g.value=!0),onHidden:w[3]||(w[3]=B=>g.value=!1),onOk:$},{default:b(()=>[g.value?(d(),k("div",WE,[s(A,{show:l(m).isEmpty()},{default:b(()=>[s(x,{fields:l(m),"form-id":l(f).formId,"resource-name":l(n)},null,8,["fields","form-id","resource-name"])]),_:1},8,["show"]),s(Zn,{modelValue:l(f).task_date,"onUpdate:modelValue":w[0]||(w[0]=B=>l(f).task_date=B),class:"mt-2"},null,8,["modelValue"])])):O("",!0)]),_:1},8,["visible","title","ok-title","ok-disabled","cancel-title"]),s(js,pt(ft({...C.$props,...C.$attrs})),{start:b(({phone:B})=>[D((d(),k("span",null,[s(T,{disabled:y.value,text:C.$t("calls::call.make"),onClick:z=>I(B.number)},null,8,["disabled","text","onClick"])])),[[E,y.value?_.value:null]])]),_:1},16)],64)}}}),XE={data:()=>({error:null,isCallInProgress:!1,callStartedDate:null,callEndedDate:null,isIncoming:!1,duration:null,durationInterval:null,visible:!1,isMuted:!1,lastConnectedNumber:null,personDisplayName:null,askForActivationIn:1,audioDevices:{speaker:{items:[],selected:null},ringtone:{items:[],selected:null}}}),computed:{showCallComponent(){return this.visible===!0||this.isCallInProgress},cardHeader(){return this.isIncoming&&!this.isCallInProgress?this.$t("calls::call.new_from",{number:this.personDisplayName||this.lastConnectedNumber}):this.isCallInProgress?this.$t("calls::call.connected_with",{number:this.personDisplayName||this.lastConnectedNumber}):this.lastConnectedNumber?this.$t("calls::call.ended",{number:this.personDisplayName||this.lastConnectedNumber}):""}},watch:{lastConnectedNumber:function(e){e&&this.findDisplayNameForCall(e)}},created(){document.documentElement.addEventListener("mousedown",$d(this.bootVoIPDevice,500)),window.addEventListener("beforeunload",()=>{this.getDevice()&&this.getDevice().unregister()}),setTimeout(()=>{this.getDevice()||this.$iModal.show("callingActivation")},this.askForActivationIn*60*1e3)},methods:{strTruncate:Xd,findDisplayNameForCall(e){let t={search_fields:"phones.number:=",q:e};Promise.all([Innoclapps.request().get("/contacts/search",{params:t}),Innoclapps.request().get("/companies/search",{params:t})]).then(n=>{let a=n[0].data,r=n[1].data;a.length>0?this.personDisplayName=a[0].display_name:r.length>0?this.personDisplayName=r[0].display_name:this.personDisplayName=null})},hideCallHandler(){this.visible=!1,this.duration=null},callingModalHiddenEvent(){Innoclapps.success(this.$t("calls::call.voip_activated"))},updateDuration(){let e=this.callEndedDate||moment(),t=moment.duration(e.diff(this.callStartedDate)),n=t.minutes(),a=t.seconds();this.duration=(n<10?"0"+n:n)+":"+(a<10?"0"+a:a)},prepareComponent(e){try{e.on("Registering",t=>{}),e.on("Registered",t=>{t.instance.audio.on("deviceChange",this.updateAllDevices)}),e.on("Error",({error:t,Call:n})=>this.error=t.message),this.setDevice(e),this.$voip.onCall(({Call:t,isIncoming:n})=>{this.callEndedDate=null,this.callStartedDate=null,this.duration=null,this.$options.call=t,this.isIncoming=n,this.visible=!0,n?this.lastConnectedNumber=t.instance.parameters.From:this.lastConnectedNumber=t.instance.customParameters.get("To"),t.on("Mute",({isMuted:a,Call:r})=>this.isMuted=a),t.on("Error",a=>{this.visible=!0,this.call=null,this.isIncoming=!1,this.error=a.message}),t.on("Accept",a=>{this.isCallInProgress=!0,this.callStartedDate=moment(),this.bindVolumeIndicators(a.instance),this.durationInterval=setInterval(this.updateDuration,1e3)}),t.on("Cancel",()=>{this.isCallInProgress=!1,this.visibility=!0,this.isIncoming=!1,this.$options.call=null}),t.on("Reject",()=>{this.duration=null,this.callStartedDate=null,this.isIncoming=!1,this.isCallInProgress=!1,this.$options.call=null}),t.on("Disconnect",a=>{this.visible=!0,this.isCallInProgress=!1,this.$options.call=null,this.isMuted=!1,this.isIncoming=!1,this.callEndedDate=moment(),clearInterval(this.durationInterval)})})}catch(t){this.error=t.message,this.visible=!0}},setDevice(e){this.$options.device=e},getDevice(){return this.$options.device},bootVoIPDevice(){if(this.getDevice()){document.documentElement.removeEventListener("mousedown",this.bootVoIPDevice);return}this.$voip.ready(this.prepareComponent),this.$voip.ready(this.getMediaDevices),this.$voip.ready(e=>e.instance.register()),this.$voip.connect()},updateAllDevices(){this.updateDevices(this.getDevice().instance.audio.speakerDevices.get(),"speaker"),this.updateDevices(this.getDevice().instance.audio.ringtoneDevices.get(),"ringtone")},updateDevices(e,t){this.audioDevices[t].items=[],this.audioDevices[t].selected=null,this.getDevice().instance.audio.availableOutputDevices.forEach((a,r)=>{let i=e.size===0&&r==="default";e.forEach(function(c){c.deviceId===r&&(i=!0)});let u={label:a.label,id:r};this.audioDevices[t].items.push(u),i&&(this.audioDevices[t].selected=u)})},getMediaDevices(){navigator.mediaDevices.getUserMedia({audio:!0}).then(this.updateAllDevices).catch(e=>this.error=e)},bindVolumeIndicators(e){e.on("volume",(t,n)=>{let a="red";t<.5?a="green":t<.75&&(a="yellow"),this.$refs.inputVolumeBar.style.width=Math.floor(t*300)+"px",this.$refs.inputVolumeBar.style.background=a;let r="red";n<.5?r="green":n<.75&&(r="yellow"),this.$refs.outputVolumeBar.style.width=Math.floor(n*300)+"px",this.$refs.outputVolumeBar.style.background=r})}}},ZE={class:"text-neutral-800 dark:text-white"},JE={class:"sticky top-0 border-b border-neutral-300 bg-white/80 px-7 py-3 dark:border-neutral-700 dark:bg-neutral-800/80"},eA={class:"flex items-center"},tA={class:"grow"},nA={class:"flex items-center space-x-4"},oA=["textContent"],lA={class:"ml-0 mt-2 space-x-2 sm:ml-2 sm:mt-0"},aA={class:"mt-4 flex flex-col items-center md:flex-row"},sA={class:"flex flex-col items-center space-y-2 sm:flex-row md:space-x-2 md:space-y-0"},rA={class:"flex items-center"},iA={class:"flex items-center"},uA={class:"ml-5 flex space-x-3 pl-5 sm:border-l sm:border-neutral-300"},dA={class:"flex items-center"},cA={ref:"outputVolumeBar",class:"ml-1 h-4 rounded-md"},mA={class:"flex items-center"},pA={ref:"inputVolumeBar",class:"ml-1 h-4 rounded-md"};function fA(e,t,n,a,r,i){const u=v("IModal"),c=v("IAlert"),m=v("Icon"),p=v("IBadge"),f=v("IButton"),h=v("IButtonIcon"),g=v("DropdownSelectInput"),y=ae("i-tooltip"),_=ae("t");return d(),k(te,null,[s(u,{id:"callingActivation","cancel-title":e.$t("calls::call.activate_voip"),"cancel-variant":"success",title:e.$t("calls::call.activation_required"),onHidden:i.callingModalHiddenEvent},{"modal-ok":b(()=>[Q("")]),default:b(()=>[o("p",ZE,S(e.$t("calls::call.activation_gesture_required",{askForActivationIn:e.askForActivationIn})),1)]),_:1},8,["cancel-title","title","onHidden"]),D(o("div",JE,[s(c,{class:"mb-4",show:e.error!==null,variant:"danger",dismissible:"",onDismissed:t[0]||(t[0]=I=>e.error=null)},{default:b(()=>[Q(S(e.error),1)]),_:1},8,["show"]),o("div",eA,[o("div",tA,[o("div",nA,[o("p",{class:X(["text-base font-medium",e.isCallInProgress||e.isIncoming&&!e.isCallInProgress?"text-success-500":"text-neutral-800 dark:text-neutral-100"]),textContent:S(i.cardHeader)},null,10,oA),D(s(p,{variant:"info"},{default:b(()=>[s(m,{icon:"Clock",class:"mr-1 h-4 w-4 text-current"}),Q(" "+S(e.isCallInProgress||e.lastConnectedNumber?e.duration:null),1)]),_:1},512),[[Y,e.isCallInProgress||e.lastConnectedNumber&&e.duration]]),o("div",null,[o("div",lA,[e.isCallInProgress?D((d(),R(f,{key:0,rounded:!1,size:!1,class:"h-9 w-9 justify-center rounded-full",variant:"white",icon:"VolumeUp",onClick:t[1]||(t[1]=I=>e.$options.call.mute(!1))},null,512)),[[Y,e.isMuted],[y,e.$t("calls::call.unmute")]]):O("",!0),e.isCallInProgress?D((d(),R(f,{key:1,rounded:!1,size:!1,class:"h-9 w-9 justify-center rounded-full",variant:"white",icon:"VolumeOff",onClick:t[2]||(t[2]=I=>e.$options.call.mute(!0))},null,512)),[[Y,!e.isMuted],[y,e.$t("calls::call.mute")]]):O("",!0),D(s(f,{rounded:!1,size:!1,class:"h-9 w-9 justify-center rounded-full",variant:"success",icon:"Phone",onClick:t[3]||(t[3]=I=>e.$options.call.accept())},null,512),[[Y,e.isIncoming&&!e.isCallInProgress],[y,e.$t("calls::call.answer")]]),D(s(f,{rounded:!1,size:!1,class:"h-9 w-9 justify-center rounded-full",variant:"danger",icon:"X",onClick:t[4]||(t[4]=I=>e.$options.call.disconnect())},null,512),[[Y,e.isCallInProgress],[y,e.$t("calls::call.hangup")]]),D(s(f,{rounded:!1,size:!1,class:"h-9 w-9 justify-center rounded-full",icon:"PhoneXMark",variant:"danger",onClick:t[5]||(t[5]=I=>e.$options.call.reject())},null,512),[[Y,e.isIncoming&&!e.isCallInProgress],[y,e.$t("calls::call.reject")]])])])])]),o("div",null,[D(s(h,{icon:"X",class:"mt-2",onClick:i.hideCallHandler},null,8,["onClick"]),[[Y,e.visible===!0],[y,e.$t("calls::call.hide_bar"),void 0,{left:!0}]])])]),o("div",aA,[o("div",sA,[s(g,{modelValue:e.audioDevices.speaker.selected,"onUpdate:modelValue":t[6]||(t[6]=I=>e.audioDevices.speaker.selected=I),items:e.audioDevices.speaker.items,placement:"bottom-start",onChange:t[7]||(t[7]=I=>i.getDevice().instance.audio.speakerDevices.set([I.id]))},{label:b(({label:I})=>[o("div",rA,[s(m,{icon:"Speakerphone",class:"mr-1 h-5 w-5"}),Q(" "+S(i.strTruncate(I||"",25)),1)])]),_:1},8,["modelValue","items"]),s(g,{modelValue:e.audioDevices.ringtone.selected,"onUpdate:modelValue":t[8]||(t[8]=I=>e.audioDevices.ringtone.selected=I),placement:"bottom-start",items:e.audioDevices.ringtone.items,onChange:t[9]||(t[9]=I=>i.getDevice().instance.audio.ringtoneDevices.set([I.id]))},{label:b(({label:I})=>[o("div",iA,[s(m,{icon:"Microphone",class:"mr-1 h-5 w-5"}),Q(" "+S(i.strTruncate(I||"",25)),1)])]),_:1},8,["modelValue","items"]),D(o("a",{href:"#",class:"link hidden text-sm lg:block",onClick:t[10]||(t[10]=ie((...I)=>i.getMediaDevices&&i.getMediaDevices(...I),["prevent"]))},null,512),[[_,"calls::call.unknown_devices"]])]),D(o("div",uA,[o("div",dA,[D(s(m,{icon:"VolumeUp",class:"h-5 w-5 text-current dark:text-neutral-200"},null,512),[[y,e.$t("calls::call.speaker_volume"),void 0,{bottom:!0}]]),o("div",cA,null,512)]),o("div",mA,[D(s(m,{icon:"Microphone",class:"h-4 w-5 text-current dark:text-neutral-200"},null,512),[[y,e.$t("calls::call.mic_volume"),void 0,{bottom:!0}]]),o("div",pA,null,512)])],512),[[Y,e.isCallInProgress]])])],512),[[Y,i.showCallComponent]])],64)}const vA=ct(XE,[["render",fA]]);class bA{constructor(){this.instance=null,this.emitter=Nl(),this.events={Registering:"registering",Registered:"registered",Error:"error"}}async createCall(t){}async connect(){}incoming(t){}unregister(){}on(t,n){return Object.hasOwn(this.events,t)?(this.emitter.on(this.events[t],n),this):(console.error(`${t} event listener does not exists for this device.`),this)}}class hA{constructor(t){this.instance=t,this.emitter=Nl(),this.events={Accept:"accept",Disconnect:"disconnect",Reject:"reject",Cancel:"Cancel",Mute:"mute",Error:"error"}}accept(){}reject(){}disconnect(){}mute(t=!0){}get isMuted(){}on(t,n){return Object.hasOwn(this.events,t)?(this.emitter.on(this.events[t],n),this):(console.error(`${t} event listener does not exists for the call.`),this)}}class pl extends hA{constructor(t){super(t),t.on("accept",n=>this.emitter.emit(this.events.Accept,this)),t.on("disconnect",n=>this.emitter.emit(this.events.Disconnect,this)),t.on("reject",()=>this.emitter.emit(this.events.Reject)),t.on("cancel",()=>this.emitter.emit(this.events.Cancel)),t.on("mute",(n,a)=>this.emitter.emit(this.events.Mute,{isMuted:n,Call:this})),t.on("Error",n=>this.emitter.emit(this.events.Error,n))}accept(){this.instance.accept()}reject(){this.instance.reject()}disconnect(){this.instance.disconnect()}mute(t=!0){this.instance.mute(t)}get isMuted(){return this.instance.isMuted()}}let Ls;(async()=>(await mo(()=>import("./twilio.min-49e68ed9.js").then(e=>e.t),["assets/twilio.min-49e68ed9.js","assets/vendor-462626fd.js"]),Ls=window.Twilio.Device))();let _A=class extends bA{constructor(){super(),this.incomingCallbacks=[],this.instance=null}async createCall(t){let n={...oo(t)?{To:t}:t,viaApp:!0};const a=await this.instance.connect({params:n});return new pl(a)}incoming(t){this.incomingCallbacks.push(t)}unregister(){this.instance.unregister()}async getAccessToken(t){let{data:n}=await Innoclapps.request().get("/voip/token",{params:{ttl:t}});return n.token}async connect(){const a=await this.getAccessToken(6e5),r=this.createTwilioDevice(a);return this.instance=r,this.instance.on("error",(i,u)=>this.emitter.emit(this.events.Error,{Call:new pl(u),error:i})),this.instance.on("registering",i=>this.emitter.emit(this.events.Registering,this)),this.instance.on("registered",i=>this.emitter.emit(this.events.Registered,this)),this.instance.on("incoming",i=>{this.incomingCallbacks.forEach(u=>u(new pl(i)))}),setInterval(async()=>{const i=await this.getAccessToken(6e5);this.instance.updateToken(i)},6e5-3e4),this}createTwilioDevice(t){return new Ls(t,{logLevel:"silent"})}};const za={CallComponent:vA,Device:_A};class gA{constructor(t){this.client=t,this.device=null,this.readyCallbacks=[],this.callCallbacks=[]}onCall(t){this.callCallbacks.push(t)}ready(t){this.readyCallbacks.push(t)}async makeCall(t){const n=await this.device.createCall(t);return this.callCallbacks.forEach(a=>a({Call:n,isIncoming:!1})),n}connect(){if(this.client=="twilio")this.device=new za.Device;else{console.error("VoIP client not found.");return}this.device.connect().then(t=>{t.incoming(n=>{this.callCallbacks.forEach(a=>a({Call:n,isIncoming:!0}))}),this.readyCallbacks.forEach(n=>n(t)),this.readyCallbacks=[]})}get callComponent(){return this.client=="twilio"?za.CallComponent:(console.error("VoIP call component not found."),"")}}const{setCallOutcomes:yA}=Jl();window.Innoclapps&&Innoclapps.booting((e,t)=>{if(e.component("CallsTab",Lq),e.component("CallsTabPanel",hE),e.component("RecordTabTimelineCall",gE),e.component("LoggedCallsCard",jq),e.component("DetailPhoneCallableField",GE),e.component("IndexPhoneCallableField",QE),Object.hasOwn(Innoclapps.appConfig,"voip")&&Innoclapps.appConfig.voip.client&&e.config.globalProperties.$gate.userCan("use voip")){const n=new gA(Innoclapps.appConfig.voip.client);e.config.globalProperties.$voip=n,e.component("CallComponent",n.callComponent)}yA(Innoclapps.config("calls.outcomes")||[]),t.addRoute("settings",{path:"integrations/twilio",component:UE,name:"settings-integrations-twilio",meta:{title:"Twilio"}}),t.addRoute("settings",{path:"calls",name:"calls-settings",component:xE,meta:{title:qe.t("calls::call.calls")}})});const xA=["id"],IA={class:"mt-2 flex justify-end space-x-2"},kA={__name:"CommentsCreate",props:{commentableType:{required:!0,type:String},commentableId:{required:!0,type:Number},viaResource:String,viaResourceId:[String,Number]},emits:["created","cancelled"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{form:r}=Ae({body:""},{resetOnSuccess:!0});function i(c){t("created",c),Innoclapps.success(a("comments::comment.created"))}function u(){n.viaResource&&r.withQueryString({via_resource:n.viaResource,via_resource_id:n.viaResourceId}),r.post(`${n.commentableType}/${n.commentableId}/comments`).then(i)}return(c,m)=>{const p=v("Editor"),f=v("IFormError"),h=v("IButton");return d(),k("div",{id:"add-comment-"+e.commentableType+"-"+e.commentableId},[s(p,{ref:"editorRef",modelValue:l(r).body,"onUpdate:modelValue":m[0]||(m[0]=g=>l(r).body=g),placeholder:c.$t("comments::comment.add_placeholder"),"with-mention":!0,onInit:m[1]||(m[1]=()=>c.$refs.editorRef.focus()),onInput:m[2]||(m[2]=g=>l(r).errors.clear("body"))},null,8,["modelValue","placeholder"]),s(f,{textContent:S(l(r).getError("body"))},null,8,["textContent"]),o("div",IA,[s(h,{variant:"white",size:"sm",text:c.$t("core::app.cancel"),onClick:m[3]||(m[3]=g=>c.$emit("cancelled"))},null,8,["text"]),s(h,{variant:"secondary",size:"sm",disabled:l(r).busy,text:c.$t("core::app.save"),onClick:u},null,8,["disabled","text"])])],8,xA)}}},$A=Object.assign({inheritAttrs:!1},{__name:"CommentsAdd",props:{commentableType:{required:!0,type:String},commentableId:{required:!0,type:Number},viaResource:String,viaResourceId:[String,Number]},emits:["created"],setup(e,{emit:t}){const n=e,{commengIsBeingCreated:a}=ln(n.commentableId,n.commentableType);function r(i){t("created",i)}return on(()=>{a.value=!1}),(i,u)=>{const c=v("Icon");return d(),k(te,null,[D(o("a",Re({href:"#"},i.$attrs,{class:"link inline-flex items-center text-sm",onClick:u[0]||(u[0]=ie(m=>a.value=!0,["prevent"]))}),[s(c,{icon:"Plus",class:"mr-1.5 h-4 w-4"}),Q(" "+S(i.$t("comments::comment.add")),1)],16),[[Y,!l(a)]]),l(a)?(d(),R(kA,{key:0,"commentable-type":e.commentableType,"commentable-id":e.commentableId,"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,onCreated:r,onCancelled:u[1]||(u[1]=m=>a.value=!1)},null,8,["commentable-type","commentable-id","via-resource","via-resource-id"])):O("",!0)],64)}}}),wA=["innerHTML"],ea={__name:"HtmlableLightbox",props:{html:String},setup(e){const t=e,n=q(null),a=q(null),r=q([]);function i(c){var m;c.target.tagName==="IMG"&&c.target.dataset!==void 0&&c.target.dataset.lightboxIndex>=0&&((m=c.target.parents("a")[0])==null?void 0:m.tagName)!=="A"&&(n.value=parseInt(c.target.dataset.lightboxIndex))}function u(){r.value=[],a.value.getElementsByTagName("img").forEach(c=>{var m;c.src&&r.value.indexOf(c.src)===-1&&((m=c.parents("a")[0])==null?void 0:m.tagName)!=="A"&&(r.value.push(c.src),c.classList.add("cursor-pointer"),c.classList.add("hover:opacity-90"),c.dataset.lightboxIndex=r.value.length-1)})}return ge(()=>t.html,u,{flush:"post"}),De(u),(c,m)=>(d(),k("div",null,[s(Wl,{modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=p=>n.value=p),urls:r.value},null,8,["modelValue","urls"]),o("div",{ref_key:"htmlWrapperRef",ref:a,onClick:i,innerHTML:e.html},null,8,wA)]))}},CA={class:"mt-2 space-x-2 text-right"},SA={__name:"CommentsEdit",props:{commentId:{required:!0,type:Number},body:{required:!0,type:String},commentableType:{required:!0,type:String},commentableId:{required:!0,type:Number},viaResource:String,viaResourceId:[String,Number]},emits:["updated","cancelled"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{form:r}=Ae({body:n.body});async function i(){n.viaResource&&r.withQueryString({via_resource:n.viaResource,via_resource_id:n.viaResourceId});let u=await r.put(`/comments/${n.commentId}`);t("updated",u),Innoclapps.success(a("comments::comment.updated"))}return(u,c)=>{const m=v("Editor"),p=v("IFormError"),f=v("IButton");return d(),k("div",null,[s(m,{modelValue:l(r).body,"onUpdate:modelValue":c[0]||(c[0]=h=>l(r).body=h),"with-mention":!0,onInput:c[1]||(c[1]=h=>l(r).errors.clear("body"))},null,8,["modelValue"]),s(p,{textContent:S(l(r).getError("body"))},null,8,["textContent"]),o("div",CA,[s(f,{variant:"white",size:"sm",text:u.$t("core::app.cancel"),onClick:c[2]||(c[2]=h=>u.$emit("cancelled"))},null,8,["text"]),s(f,{variant:"secondary",size:"sm",disabled:l(r).busy,text:u.$t("core::app.save"),onClick:i},null,8,["disabled","text"])])])}}},RA=["id"],FA={class:"flex flex-wrap"},VA=["textContent"],TA={class:"flex justify-end space-x-2 py-2 text-sm"},DA=["onClick"],qA={__name:"CommentsListItem",props:{commentId:{required:!0,type:Number},body:{required:!0,type:String},createdBy:{required:!0,type:Number},createdAt:{required:!0,type:String},authorizations:{required:!0,type:Object},commentableType:{required:!0,type:String},commentableId:{required:!0,type:Number},highlighted:Boolean,viaResource:String,viaResourceId:[String,Number]},emits:["deleted","updated"],setup(e,{emit:t}){const n=e,{localizedDateTime:a}=Ne(),{currentUser:r,findUserById:i}=Le(),u=V(()=>i(n.createdBy)),{commengIsBeingCreated:c}=ln(n.commentableId,n.commentableType),m=q(!1);function p(){c.value=!0,Fe(()=>{document.getElementById("add-comment-"+n.commentableType+"-"+n.commentableId).scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),setTimeout(()=>{tinymce.activeEditor.setContent(""),tinymce.activeEditor.concordCommands.insertMentionUser(u.value.id,u.value.name)},650)})}async function f(h){await Innoclapps.dialog().confirm(),await Innoclapps.request().delete(`/comments/${h}`),t("deleted",n.commentId)}return(h,g)=>{const y=v("IAvatar"),_=v("i18n-t"),I=ae("t");return d(),k("div",null,[o("div",{id:"comment-"+e.commentId,class:X(["comment rounded-md ",e.highlighted?"bg-info-50 dark:bg-neutral-800":"bg-white dark:bg-neutral-700",{"border border-neutral-300 px-4 py-2.5 shadow-sm dark:border-neutral-600":!m.value}])},[D(o("div",FA,[g[0]||(he(-1),g[0]=o("div",{class:"grow"},[s(y,{size:"xs",class:"mr-1",src:u.value.avatar_url},null,8,["src"]),s(_,{scope:"global",keypath:"comments::comment.user_left_comment",tag:"span",class:"text-sm text-neutral-800 dark:text-white"},{user:b(()=>[o("b",{class:"font-medium",textContent:S(u.value.name)},null,8,VA)]),_:1},8,["keypath"])]),he(1),g[0]),g[1]||(he(-1),g[1]=o("div",{class:"mt-1 text-sm text-neutral-500 dark:text-neutral-300"},[Q(S(l(a)(e.createdAt)),1)]),he(1),g[1])],512),[[Y,!m.value]]),St([m.value],()=>D(s(ea,{class:"wysiwyg-text mt-3",html:e.body},null,8,["html"]),[[Y,!m.value]]),g,2),m.value?(d(),R(SA,{key:0,class:"mt-3","comment-id":e.commentId,body:e.body,"commentable-type":e.commentableType,"commentable-id":e.commentableId,"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,onCancelled:g[3]||(g[3]=F=>m.value=!1),onUpdated:g[4]||(g[4]=F=>(m.value=!1,h.$emit("updated",F)))},null,8,["comment-id","body","commentable-type","commentable-id","via-resource","via-resource-id"])):O("",!0)],10,RA),o("div",TA,[e.createdBy!==l(r).id&&!m.value?D((d(),k("a",{key:0,href:"#",class:"link",onClick:ie(p,["prevent"])},null,8,DA)),[[I,"comments::comment.reply"]]):O("",!0),D(o("a",{href:"#",class:"link",onClick:g[5]||(g[5]=ie(F=>m.value=!0,["prevent"]))},null,512),[[Y,e.authorizations.update&&!m.value],[I,"core::app.edit"]]),D(o("a",{href:"#",class:"text-danger-500 hover:text-danger-700",onClick:g[6]||(g[6]=ie(F=>f(e.commentId),["prevent"]))},null,512),[[Y,e.authorizations.delete&&!m.value],[I,"core::app.delete"]])])])}}},EA={key:0,class:"text-center text-sm text-neutral-500 dark:text-neutral-400"},Hs={__name:"CommentsList",props:{autoFocusIfRequired:Boolean,comments:Array,commentableType:{required:!0,type:String},commentableId:{required:!0,type:Number},viaResource:String,viaResourceId:[String,Number]},emits:["deleted","updated"],setup(e){const t=e;let n=null;const a=Ye(),r=q(null),i=q(null),u=V(()=>t.comments.length>0);function c(){!a.query.comment_id||!t.autoFocusIfRequired||Fe(()=>{const m=r.value.querySelector("#comment-"+a.query.comment_id);m&&(m.scrollIntoView({behavior:"auto",block:"center",inline:"nearest"}),i.value=Number(a.query.comment_id),n=setTimeout(()=>i.value=null,1e4))})}return De(c),bt(()=>{n&&clearTimeout(n)}),(m,p)=>{const f=ae("t");return d(),k("div",{ref_key:"commentsRef",ref:r},[u.value?O("",!0):D((d(),k("p",EA,null,512)),[[f,"comments::comment.no_comments"]]),(d(!0),k(te,null,re(e.comments,h=>(d(),R(qA,{key:h.id,class:"mb-3","commentable-type":e.commentableType,"commentable-id":e.commentableId,"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"comment-id":h.id,highlighted:h.id===i.value,body:h.body,"created-by":h.created_by,"created-at":h.created_at,authorizations:h.authorizations,onDeleted:p[0]||(p[0]=g=>m.$emit("deleted",g)),onUpdated:p[1]||(p[1]=g=>m.$emit("updated",g))},null,8,["commentable-type","commentable-id","via-resource","via-resource-id","comment-id","highlighted","body","created-by","created-at","authorizations"]))),128))],512)}}},AA={class:"mr-3 h-5 w-5"},BA=Object.assign({inheritAttrs:!1},{__name:"CommentsCollapse",props:{count:Number,listWrapperClass:[Array,Object,String],commentableType:{required:!0,type:String},commentableId:{required:!0,type:Number},comments:{required:!0,type:Array},viaResource:String,viaResourceId:[String,Number]},emits:["update:count","update:comments","deleted","updated"],setup(e,{emit:t}){const n=e,{requestInProgress:a,commentsAreVisible:r,commentsAreLoaded:i,toggleCommentsVisibility:u,getAllComments:c}=ln(n.commentableId,n.commentableType),m=V(()=>i.value?n.comments.length:n.count||0),p=V(()=>m.value>0);ge(m,y=>{t("update:count",y)}),mn(r,()=>{if(n.count===0&&n.comments.length===1&&n.comments[0].was_recently_created===!0){i.value=!0;return}i.value||f()});async function f(){let y=await c(n.viaResource,n.viaResource?n.viaResourceId:null);i.value=!0,t("update:comments",y)}async function h(y){await Fe(),p.value||(r.value=!1),t("deleted",y)}function g(y){t("updated",y)}return bt(()=>{r.value=!1,i.value=!1}),(y,_)=>{const I=v("Icon"),F=v("ISpinner"),$=ae("t");return d(),k("div",null,[D(o("p",Re({class:"inline-flex items-center text-sm font-medium text-neutral-800 dark:text-white"},y.$attrs),[o("span",AA,[D(s(I,{icon:"ChatAlt",class:"h-5 w-5 text-current"},null,512),[[Y,!l(a)]]),l(a)?(d(),R(F,{key:0,class:"mt-px h-4 w-4 text-current"})):O("",!0)]),o("a",{href:"#",class:"inline-flex items-center focus:outline-none",onClick:_[0]||(_[0]=(...C)=>l(u)&&l(u)(...C))},[D(o("span",null,null,512),[[$,{path:"comments::comment.total",args:{total:m.value}}]]),s(I,{icon:l(r)?"ChevronDown":"ChevronRight",class:"ml-3 h-4 w-4"},null,8,["icon"])])],16),[[Y,p.value]]),D(o("div",{class:X(["mt-3",e.listWrapperClass])},[l(i)?(d(),R(Hs,{key:0,comments:e.comments,"commentable-type":e.commentableType,"commentable-id":e.commentableId,"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"auto-focus-if-required":!0,onUpdated:g,onDeleted:h},null,8,["comments","commentable-type","commentable-id","via-resource","via-resource-id"])):O("",!0)],2),[[Y,l(r)&&l(i)]])])}}}),NA={visible:{},loaded:{},commentBeingCreated:{},requestInProgress:!1},OA={SET_VISIBILITY(e,t){e.visible[String(t.commentableId+t.commentableType)]=t.visible},SET_ADD_COMMENT_VISIBILITY(e,t){e.commentBeingCreated=Object.assign({},e.commentBeingCreated,{[String(t.commentableId+t.commentableType)]:t.value})},SET_LOADED(e,t){e.loaded=Object.assign({},e.loaded,{[String(t.commentableId+t.commentableType)]:t.value})},SET_REQUEST_IN_PROGRESS(e,t){e.requestInProgress=t}},zA={areVisibleFor:e=>(t,n)=>!!e.visible[String(t+n)],isCommentBeingCreatedFor:e=>(t,n)=>!!e.commentBeingCreated[String(t+n)],areLoadedFor:e=>(t,n)=>!!e.loaded[String(t+n)]},MA={async getAll({commit:e},{resourceName:t,resourceId:n,viaResource:a,viaResourceId:r}){e("SET_REQUEST_IN_PROGRESS",!0);let{data:i}=await Innoclapps.request().get(`${t}/${n}/comments`,{params:r&&r?{via_resource:a,via_resource_id:r}:{}});return e("SET_REQUEST_IN_PROGRESS",!1),i}},UA={state:NA,mutations:OA,getters:zA,actions:MA,namespaced:!0};window.Innoclapps&&Innoclapps.booting(function(e,t,n){e.component("CommentsAdd",$A),e.component("CommentsCollapse",BA),e.component("CommentsList",Hs),n.registerModule("comments",UA)});function an(){const e=Qe(),t=Ye();function n({resourceName:i,resourceId:u,mode:c}){e.push({query:{...t.query,floating_resource:i,floating_resource_id:u,mode:c}})}function a(i){n({...i,mode:"detail"})}function r(i){n({...i,mode:"edit"})}return{floatResource:n,floatResourceInEditMode:r,floatResourceInDetailMode:a}}const PA={class:"flex items-center justify-between font-medium text-neutral-800 dark:text-white"},jA=["textContent"],LA={key:2,class:"ml-1 text-xs font-normal text-neutral-400"},HA={class:"shrink-0"},GA={class:"min-w-0 flex-1 truncate"},KA=["href","onClick","textContent"],YA=["textContent"],WA={class:"block shrink-0 md:hidden md:group-hover:block"},QA={class:"flex items-center space-x-1"},XA=["textContent"],Gs={__name:"ContactsList",props:{contacts:{type:[Object,Array],required:!0},limit:{type:Number,default:3},emptyText:String,title:String,floatMode:{type:String,default:"detail"}},setup(e){const t=e,{t:n}=ve(),{floatResource:a}=an(),r=q(!1),i=V(()=>ot(wt(t.contacts),p=>new Date(p.created_at),["asc"])),u=V(()=>i.value.length),c=V(()=>u.value>0),m=V(()=>t.title||n("contacts::contact.contacts"));return(p,f)=>{const h=v("IAvatar"),g=v("IButton"),y=ae("t");return d(),k("div",null,[o("h2",PA,[o("span",null,[Q(S(m.value)+" ",1),D(o("span",{class:"text-sm font-normal text-neutral-400",textContent:S("("+u.value+")")},null,8,jA),[[Y,u.value>0]])]),o("span",null,[u.value>e.limit&&!r.value?D((d(),k("a",{key:0,href:"#",class:"link shrink-0 text-sm font-normal",onClick:f[0]||(f[0]=ie(_=>r.value=!0,["prevent"]))},null,512)),[[y,"core::app.show_all"]]):O("",!0),u.value>e.limit&&r.value?D((d(),k("a",{key:1,href:"#",class:"link shrink-0 text-sm font-normal",onClick:f[1]||(f[1]=ie(_=>r.value=!1,["prevent"]))},null,512)),[[y,"core::app.show_less"]]):O("",!0),u.value>e.limit?D((d(),k("span",LA,null,512)),[[Y,!r.value],[y,{path:"core::app.has_more",args:{count:u.value-e.limit}}]]):O("",!0)])]),o("ul",{class:X(["divide-y divide-neutral-200 dark:divide-neutral-700",{"-mb-4":u.value>0}])},[(d(!0),k(te,null,re(i.value,(_,I)=>D((d(),k("li",{key:_.id,class:"group flex items-center space-x-3 py-4"},[o("div",HA,[s(h,{src:_.avatar_url},null,8,["src"])]),o("div",GA,[o("a",{href:_.path,class:"text-sm font-medium text-neutral-800 hover:text-neutral-500 focus:outline-none dark:text-white dark:hover:text-neutral-300",onClick:ie(F=>l(a)({resourceName:"contacts",resourceId:_.id,mode:e.floatMode}),["prevent"]),textContent:S(_.display_name)},null,8,KA),o("p",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(_.job_title)},null,8,YA)]),o("div",WA,[o("div",QA,[D(s(g,{size:"sm",variant:"white",to:_.path,text:p.$t("core::app.view_record")},null,8,["to","text"]),[[Y,p.$gate.allows("view",_)]]),de(p.$slots,"actions",{contact:_})])])])),[[Y,I<=e.limit-1||r.value]])),128))],2),D(o("p",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(e.emptyText)},null,8,XA),[[Y,!c.value]]),de(p.$slots,"tail")])}}},Ks={__name:"CompanyContactsList",props:{contacts:{required:!0,type:Array},companyId:{required:!0,type:Number},authorizeDissociate:{required:!0,type:Boolean},showCreateButton:{required:!0,type:Boolean}},emits:["dissociated","create-requested"],setup(e,{emit:t}){const n=Me("detachResourceAssociations"),{t:a}=ve();async function r(i){await Innoclapps.dialog().confirm(),await n({contacts:[i]}),t("dissociated",i),Innoclapps.success(a("core::resource.dissociated"))}return(i,u)=>{const c=v("IButton"),m=ae("i-tooltip");return d(),R(Gs,{contacts:e.contacts,"empty-text":i.$t("contacts::company.no_contacts_associated")},{actions:b(({contact:p})=>[D(s(c,{size:"sm",variant:"white",icon:"X",onClick:f=>r(p.id)},null,8,["onClick"]),[[Y,e.authorizeDissociate],[m,i.$t("contacts::contact.dissociate"),void 0,{left:!0}]])]),tail:b(()=>[e.showCreateButton?(d(),R(c,{key:0,variant:"white",class:"mt-6",block:"",text:i.$t("contacts::contact.add"),onClick:u[0]||(u[0]=p=>i.$emit("create-requested"))},null,8,["text"])):O("",!0)]),_:1},8,["contacts","empty-text"])}}},ZA={class:"flex items-center justify-between font-medium text-neutral-800 dark:text-white"},JA=["textContent"],e6={key:2,class:"ml-1 text-xs font-normal text-neutral-400"},t6={class:"shrink-0"},n6={class:"min-w-0 flex-1 truncate"},o6=["href","onClick","textContent"],l6={class:"flex space-x-2"},a6=["textContent"],s6={key:0,class:"-mt-0.5"},r6=["textContent"],i6={class:"block shrink-0 md:hidden md:group-hover:block"},u6={class:"flex items-center space-x-1"},d6=["textContent"],Ys={__name:"DealsList",props:{deals:{type:[Object,Array],required:!0},limit:{type:Number,default:3},emptyText:String,title:String,floatMode:{type:String,default:"detail"}},setup(e){const t=e,{t:n}=ve(),{floatResource:a}=an(),{formatMoney:r}=Mt(),i=q(!1),u=V(()=>wt(t.deals)),c=V(()=>ot(u.value.filter(_=>_.status==="won"),_=>new Date(_.won_date),"desc")),m=V(()=>ot(u.value.filter(_=>_.status==="lost"),_=>new Date(_.lost_date),"desc")),p=V(()=>ot(u.value.filter(_=>_.status==="open"),_=>new Date(_.created_at))),f=V(()=>[...p.value,...m.value,...c.value]),h=V(()=>u.value.length),g=V(()=>h.value>0),y=V(()=>t.title||n("deals::deal.deals"));return(_,I)=>{const F=v("IBadge"),$=v("IButton"),C=ae("t");return d(),k("div",null,[o("h2",ZA,[o("span",null,[Q(S(y.value)+" ",1),D(o("span",{class:"text-sm font-normal text-neutral-400",textContent:S("("+h.value+")")},null,8,JA),[[Y,h.value>0]])]),o("span",null,[h.value>e.limit&&!i.value?D((d(),k("a",{key:0,href:"#",class:"link shrink-0 text-sm font-normal",onClick:I[0]||(I[0]=ie(w=>i.value=!0,["prevent"]))},null,512)),[[C,"core::app.show_all"]]):O("",!0),h.value>e.limit&&i.value?D((d(),k("a",{key:1,href:"#",class:"link shrink-0 text-sm font-normal",onClick:I[1]||(I[1]=ie(w=>i.value=!1,["prevent"]))},null,512)),[[C,"core::app.show_less"]]):O("",!0),h.value>e.limit?D((d(),k("span",e6,null,512)),[[Y,!i.value],[C,{path:"core::app.has_more",args:{count:h.value-e.limit}}]]):O("",!0)])]),o("ul",{class:X(["divide-y divide-neutral-200 dark:divide-neutral-700",{"-mb-4":h.value>0}])},[(d(!0),k(te,null,re(f.value,(w,x)=>D((d(),k("li",{key:w.id,class:"group flex items-center space-x-3 py-4"},[o("div",t6,[s(F,{variant:w.status==="won"?"success":w.status==="lost"?"danger":"neutral",text:_.$t("deals::deal.status."+w.status)},null,8,["variant","text"])]),o("div",n6,[o("a",{href:w.path,class:"text-sm font-medium text-neutral-800 hover:text-neutral-500 focus:outline-none dark:text-white dark:hover:text-neutral-300",onClick:ie(A=>l(a)({resourceName:"deals",resourceId:w.id,mode:e.floatMode}),["prevent"]),textContent:S(w.display_name)},null,8,o6),o("div",l6,[o("p",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(w.stage.name)},null,8,a6),Object.hasOwn(w,"amount")?(d(),k("span",s6,"  ")):O("",!0),Object.hasOwn(w,"amount")?(d(),k("p",{key:1,class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(l(r)(w.amount))},null,8,r6)):O("",!0)])]),o("div",i6,[o("div",u6,[D(s($,{size:"sm",variant:"white",to:w.path,text:_.$t("core::app.view_record")},null,8,["to","text"]),[[Y,_.$gate.allows("view",w)]]),de(_.$slots,"actions",{deal:w})])])])),[[Y,x<=e.limit-1||i.value]])),128))],2),D(o("p",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(e.emptyText)},null,8,d6),[[Y,!g.value]]),de(_.$slots,"tail")])}}},Ws={__name:"CompanyDealsList",props:{deals:{required:!0,type:Array},companyId:{required:!0,type:Number},authorizeDissociate:{required:!0,type:Boolean},showCreateButton:{required:!0,type:Boolean}},emits:["dissociated","create-requested"],setup(e,{emit:t}){const n=Me("detachResourceAssociations"),{t:a}=ve();async function r(i){await Innoclapps.dialog().confirm(),await n({deals:[i]}),t("dissociated",i),Innoclapps.success(a("core::resource.dissociated"))}return(i,u)=>{const c=v("IButton"),m=ae("i-tooltip");return d(),R(Ys,{deals:e.deals,"empty-text":i.$t("contacts::company.no_deals_associated")},{actions:b(({deal:p})=>[D(s(c,{size:"sm",variant:"white",icon:"X",onClick:f=>r(p.id)},null,8,["onClick"]),[[Y,e.authorizeDissociate],[m,i.$t("deals::deal.dissociate"),void 0,{left:!0}]])]),tail:b(()=>[e.showCreateButton?(d(),R(c,{key:0,variant:"white",class:"mt-6",block:"",text:i.$t("deals::deal.add"),onClick:u[0]||(u[0]=p=>i.$emit("create-requested"))},null,8,["text"])):O("",!0)]),_:1},8,["deals","empty-text"])}}},c6={__name:"CompanyFloatingModal",props:{resource:Object,form:Object,fields:en,mode:String},setup(e){const t=e,n=Innoclapps.resourceName("companies"),a=q(!0),r=q(!1),i=q(!1),u=Me("synchronizeAndEmitUpdatedEvent");function c(p){r.value=!1,u({contacts:p.contact}),Fe(()=>t.fields.sync({contacts:t.resource.contacts}))}function m(p){i.value=!1,u({deals:p.deal}),Fe(()=>t.fields.sync({deals:t.resource.deals}))}return(p,f)=>{const h=v("FormFields"),g=v("DetailFields"),y=v("CreateContactModal"),_=v("CreateDealModal");return d(),k(te,null,[o("div",null,[e.fields.hasCollapsable?(d(),R(Bn,{key:0,collapsed:a.value,"onUpdate:collapsed":f[0]||(f[0]=I=>a.value=I),total:e.fields.totalCollapsable,class:"mb-2 ml-auto"},null,8,["collapsed","total"])):O("",!0),e.mode==="edit"?(d(),R(h,{key:1,fields:e.fields,"form-id":e.form.formId,"resource-name":l(n),"resource-id":e.resource.id,collapsed:a.value,"is-floating":""},null,8,["fields","form-id","resource-name","resource-id","collapsed"])):(d(),R(g,{key:2,fields:e.fields,"resource-name":l(n),"resource-id":e.resource.id,resource:e.resource,collapsed:a.value,"is-floating":"",onUpdated:f[1]||(f[1]=I=>l(u)(I,!0))},null,8,["fields","resource-name","resource-id","resource","collapsed"])),o("div",{class:X(["mt-8 space-y-6 border-t border-neutral-200 pt-8 dark:border-neutral-700 sm:space-y-8",{"px-10":e.mode==="detail"}])},[s(Ks,{"float-mode":e.mode,"company-id":e.resource.id,contacts:e.resource.contacts,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onDissociated:f[2]||(f[2]=I=>(e.fields.sync({contacts:e.resource.contacts}),l(u)({contacts:{id:I,_delete:!0}}))),onCreateRequested:f[3]||(f[3]=I=>r.value=!0)},null,8,["float-mode","company-id","contacts","authorize-dissociate","show-create-button"]),s(Ws,{"float-mode":e.mode,"company-id":e.resource.id,deals:e.resource.deals,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onDissociated:f[4]||(f[4]=I=>(e.fields.sync({deals:e.resource.deals}),l(u)({deals:{id:I,_delete:!0}}))),onCreateRequested:f[5]||(f[5]=I=>i.value=!0)},null,8,["float-mode","company-id","deals","authorize-dissociate","show-create-button"]),s(kn,{card:!1,"resource-name":l(n),"resource-id":e.resource.id,media:e.resource.media,"authorize-delete":e.resource.authorizations.update,"is-floating":"",onUploaded:f[6]||(f[6]=I=>l(u)({media:[I]})),onDeleted:f[7]||(f[7]=I=>l(u)({media:{id:I.id,_delete:!0}}))},null,8,["resource-name","resource-id","media","authorize-delete"])],2)]),s(y,{visible:r.value,"onUpdate:visible":f[8]||(f[8]=I=>r.value=I),overlay:!1,companies:[e.resource],onCreated:c,onRestored:c},null,8,["visible","companies"]),s(_,{visible:i.value,"onUpdate:visible":f[9]||(f[9]=I=>i.value=I),overlay:!1,companies:[e.resource],onCreated:m,onRestored:m},null,8,["visible","companies"])],64)}}},m6={},p6={class:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-neutral-200 dark:bg-neutral-600"};function f6(e,t){const n=v("Icon");return d(),k("span",p6,[s(n,{icon:"OfficeBuilding",class:"h-6 w-6 text-neutral-400 dark:text-neutral-300"})])}const Qs=ct(m6,[["render",f6]]),v6={class:"flex items-center justify-between font-medium text-neutral-800 dark:text-white"},b6=["textContent"],h6={key:2,class:"ml-1 text-xs font-normal text-neutral-400"},_6={class:"shrink-0"},g6={class:"min-w-0 flex-1 truncate"},y6=["href","onClick","textContent"],x6=["href"],I6={class:"block shrink-0 md:hidden md:group-hover:block"},k6={class:"flex items-center space-x-1"},$6=["textContent"],ta={__name:"CompaniesList",props:{companies:{type:[Object,Array],required:!0},limit:{type:Number,default:3},emptyText:String,title:String,floatMode:{type:String,default:"detail"}},setup(e){const t=e,{t:n}=ve(),{floatResource:a}=an(),r=q(!1),i=V(()=>ot(wt(t.companies),p=>new Date(p.created_at),["asc"])),u=V(()=>i.value.length),c=V(()=>u.value>0),m=V(()=>t.title||n("contacts::company.companies"));return(p,f)=>{const h=v("Icon"),g=v("IButton"),y=ae("t");return d(),k("div",null,[o("h2",v6,[o("span",null,[Q(S(m.value)+" ",1),D(o("span",{class:"text-sm font-normal text-neutral-400",textContent:S("("+u.value+")")},null,8,b6),[[Y,u.value>0]])]),o("span",null,[u.value>e.limit&&!r.value?D((d(),k("a",{key:0,href:"#",class:"link shrink-0 text-sm font-normal",onClick:f[0]||(f[0]=ie(_=>r.value=!0,["prevent"]))},null,512)),[[y,"core::app.show_all"]]):O("",!0),u.value>e.limit&&r.value?D((d(),k("a",{key:1,href:"#",class:"link shrink-0 text-sm font-normal",onClick:f[1]||(f[1]=ie(_=>r.value=!1,["prevent"]))},null,512)),[[y,"core::app.show_less"]]):O("",!0),u.value>e.limit?D((d(),k("span",h6,null,512)),[[Y,!r.value],[y,{path:"core::app.has_more",args:{count:u.value-e.limit}}]]):O("",!0)])]),o("ul",{class:X(["divide-y divide-neutral-200 dark:divide-neutral-700",{"-mb-4":u.value>0}])},[(d(!0),k(te,null,re(i.value,(_,I)=>D((d(),k("li",{key:_.id,class:"group flex items-center space-x-3 py-4"},[o("div",_6,[s(Qs)]),o("div",g6,[o("a",{href:_.path,class:"text-sm font-medium text-neutral-800 hover:text-neutral-500 focus:outline-none dark:text-white dark:hover:text-neutral-300",onClick:ie(F=>l(a)({resourceName:"companies",resourceId:_.id,mode:e.floatMode}),["prevent"]),textContent:S(_.display_name)},null,8,y6),o("p",null,[D(o("a",{href:"http://"+_.domain,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center text-sm text-neutral-500 hover:text-neutral-400 focus:outline-none dark:text-neutral-400 dark:hover:text-neutral-500"},[Q(S(_.domain)+" ",1),s(h,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})],8,x6),[[Y,_.domain]])])]),o("div",I6,[o("div",k6,[D(s(g,{size:"sm",variant:"white",to:_.path,text:p.$t("core::app.view_record")},null,8,["to","text"]),[[Y,p.$gate.allows("view",_)]]),de(p.$slots,"actions",{company:_})])])])),[[Y,I<=e.limit-1||r.value]])),128))],2),D(o("p",{class:"text-sm text-neutral-500 dark:text-neutral-300",textContent:S(e.emptyText)},null,8,$6),[[Y,!c.value]]),de(p.$slots,"tail")])}}},Xs={__name:"ContactCompaniesList",props:{companies:{required:!0,type:Array},contactId:{required:!0,type:Number},authorizeDissociate:{required:!0,type:Boolean},showCreateButton:{required:!0,type:Boolean}},emits:["dissociated","create-requested"],setup(e,{emit:t}){const n=Me("detachResourceAssociations"),{t:a}=ve();async function r(i){await Innoclapps.dialog().confirm(),await n({companies:[i]}),t("dissociated",i),Innoclapps.success(a("core::resource.dissociated"))}return(i,u)=>{const c=v("IButton"),m=ae("i-tooltip");return d(),R(ta,{companies:e.companies,"empty-text":i.$t("contacts::contact.no_companies_associated")},{actions:b(({company:p})=>[D(s(c,{size:"sm",variant:"white",icon:"X",onClick:f=>r(p.id)},null,8,["onClick"]),[[Y,e.authorizeDissociate],[m,i.$t("contacts::company.dissociate"),void 0,{left:!0}]])]),tail:b(()=>[e.showCreateButton?(d(),R(c,{key:0,variant:"white",class:"mt-6",block:"",text:i.$t("contacts::company.add"),onClick:u[0]||(u[0]=p=>i.$emit("create-requested"))},null,8,["text"])):O("",!0)]),_:1},8,["companies","empty-text"])}}},Zs={__name:"ContactDealsList",props:{deals:{required:!0,type:Array},contactId:{required:!0,type:Number},authorizeDissociate:{required:!0,type:Boolean},showCreateButton:{required:!0,type:Boolean}},emits:["dissociated","create-requested"],setup(e,{emit:t}){const{t:n}=ve(),a=Me("detachResourceAssociations");async function r(i){await Innoclapps.dialog().confirm(),await a({deals:[i]}),t("dissociated",i),Innoclapps.success(n("core::resource.dissociated"))}return(i,u)=>{const c=v("IButton"),m=ae("i-tooltip");return d(),R(Ys,{deals:e.deals,"empty-text":i.$t("contacts::contact.no_deals_associated")},{actions:b(({deal:p})=>[D(s(c,{size:"sm",variant:"white",icon:"X",onClick:f=>r(p.id)},null,8,["onClick"]),[[Y,e.authorizeDissociate],[m,i.$t("deals::deal.dissociate"),void 0,{left:!0}]])]),tail:b(()=>[e.showCreateButton?(d(),R(c,{key:0,class:"mt-6",variant:"white",block:"",text:i.$t("deals::deal.add"),onClick:u[0]||(u[0]=p=>i.$emit("create-requested"))},null,8,["text"])):O("",!0)]),_:1},8,["deals","empty-text"])}}},w6={__name:"ContactFloatingModal",props:{resource:Object,form:Object,fields:en,mode:String},setup(e){const t=e,n=Innoclapps.resourceName("contacts"),a=q(!0),r=q(!1),i=q(!1),u=Me("synchronizeAndEmitUpdatedEvent");function c(p){r.value=!1,u({companies:p.company}),Fe(()=>t.fields.sync({companies:t.resource.companies}))}function m(p){i.value=!1,u({deals:p.deal}),Fe(()=>t.fields.sync({deals:t.resource.deals}))}return(p,f)=>{const h=v("FormFields"),g=v("DetailFields"),y=v("CreateCompanyModal"),_=v("CreateDealModal");return d(),k(te,null,[e.fields.hasCollapsable?(d(),R(Bn,{key:0,collapsed:a.value,"onUpdate:collapsed":f[0]||(f[0]=I=>a.value=I),total:e.fields.totalCollapsable,class:"mb-2 ml-auto"},null,8,["collapsed","total"])):O("",!0),e.mode==="edit"?(d(),R(h,{key:1,fields:e.fields,"form-id":e.form.formId,"resource-name":l(n),"resource-id":e.resource.id,collapsed:a.value,"is-floating":""},null,8,["fields","form-id","resource-name","resource-id","collapsed"])):(d(),R(g,{key:2,fields:e.fields,"resource-name":l(n),"resource-id":e.resource.id,resource:e.resource,collapsed:a.value,"is-floating":"",onUpdated:f[1]||(f[1]=I=>l(u)(I,!0))},null,8,["fields","resource-name","resource-id","resource","collapsed"])),o("div",{class:X(["mt-8 space-y-6 border-t border-neutral-200 pt-8 dark:border-neutral-700 sm:space-y-8",{"px-10":e.mode==="detail"}])},[s(Xs,{"float-mode":e.mode,"contact-id":e.resource.id,companies:e.resource.companies,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onDissociated:f[2]||(f[2]=I=>(e.fields.sync({companies:e.resource.companies}),l(u)({companies:{id:I,_delete:!0}}))),onCreateRequested:f[3]||(f[3]=I=>r.value=!0)},null,8,["float-mode","contact-id","companies","authorize-dissociate","show-create-button"]),s(Zs,{"float-mode":e.mode,"contact-id":e.resource.id,deals:e.resource.deals,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onDissociated:f[4]||(f[4]=I=>(e.fields.sync({deals:e.resource.deals}),l(u)({deals:{id:I,_delete:!0}}))),onCreateRequested:f[5]||(f[5]=I=>i.value=!0)},null,8,["float-mode","contact-id","deals","authorize-dissociate","show-create-button"]),s(kn,{card:!1,"resource-name":l(n),"resource-id":e.resource.id,media:e.resource.media,"authorize-delete":e.resource.authorizations.update,"is-floating":"",onUploaded:f[6]||(f[6]=I=>l(u)({media:[I]})),onDeleted:f[7]||(f[7]=I=>l(u)({media:{id:I.id,_delete:!0}}))},null,8,["resource-name","resource-id","media","authorize-delete"])],2),s(y,{visible:r.value,"onUpdate:visible":f[8]||(f[8]=I=>r.value=I),overlay:!1,contacts:[e.resource],onCreated:c,onRestored:c},null,8,["visible","contacts"]),s(_,{visible:i.value,"onUpdate:visible":f[9]||(f[9]=I=>i.value=I),overlay:!1,contacts:[e.resource],onCreated:m,onRestored:m},null,8,["visible","contacts"])],64)}}},C6={class:"-mt-2 block text-right"},S6={class:"-mt-2 block text-right"},R6={class:"mt-4"},F6={class:"-mx-2 -my-1.5 flex"},V6={class:"mt-4"},T6={class:"-mx-2 -my-1.5 flex"},D6={class:"mt-4"},q6={class:"-mx-2 -my-1.5 flex"},E6={__name:"CreateCompanyModal",props:{visible:{type:Boolean,default:!0},goToList:{type:Boolean,default:!0},redirectToView:Boolean,createUsing:Function,withExtendedSubmitButtons:Boolean,fieldsVisible:{type:Boolean,default:!0},title:String,contacts:Array,deals:Array},emits:["created","restored","modal-shown","modal-hidden","update:visible","ready"],setup(e,{emit:t}){const n=e,{t:a}=ve(),r=Qe(),i=Innoclapps.resourceName("companies"),u=q(!1),c=q(!1),m=q({}),p=q({}),f=q({}),h=dt(null),g=dt(null),y=q([]),_=q({byName:!1,byEmail:!1,byPhone:{}}),{fields:I,getCreateFields:F}=gt(),{form:$}=It(I),{createResource:C}=Je(i),w=Kn(()=>null,()=>document.querySelector("#modalClose-createCompanyModal"));mn(()=>n.visible,U,{immediate:!0}),dn(()=>{var P;return(P=m.value)==null?void 0:P.currentValue},P=>{if(!P){h.value=null;return}T(P,"email").then(({data:H})=>{h.value=H.length>0?H[0]:null})},{debounce:500}),dn(()=>p.value.currentValue,P=>{if(!P){g.value=null;return}T(P,"name").then(({data:H})=>{g.value=H.length>0?H[0]:null})},{debounce:500}),dn(()=>{var P;return(P=f.value)==null?void 0:P.currentValue},P=>{if(!P)return;const H=P.filter(L=>!L.number||!(f.value.callingPrefix&&f.value.callingPrefix.trim()===L.number)).map(L=>L.number);if(H.length===0){y.value=[];return}Innoclapps.request().get("/trashed/companies/search",{params:{q:H.join(","),search_fields:"phones.number:in"}}).then(({data:L})=>{y.value=L})},{debounce:500,deep:!0});function x(P){if(P.indexRoute={name:"company-index"},P.action==="go-to-list")return r.push(P.indexRoute);if(P.action!=="create-another"&&n.redirectToView){let H=P.company;r.company=H,r.push({name:"view-company",params:{id:H.id}})}}function A(){t("modal-shown"),w.trigger()}function N(){t("modal-hidden"),I.value.set([]),$.reset()}function T(P,H){return Innoclapps.request().get("/trashed/companies/search",{params:{q:P,search_fields:H+":="}})}function E(P,H){Innoclapps.request().post(`/trashed/companies/${P}`).then(({data:L})=>{typeof _.value[H]=="object"?_.value[H][L.id]=!0:_.value[H]=!0,t("restored",L)})}function B(){j().then(x)}function z(){j("create-another").then(P=>{$.reset(),x(P)})}function M(){j("go-to-list").then(x)}async function j(P=null){let L={company:await C($).catch(Z=>(Z.isValidationError()&&Innoclapps.error(a("core::app.form_validation_failed"),3e3),Promise.reject(Z))),isRegularAction:P===null,action:P};return t("created",L),Innoclapps.success(a("core::resource.created")),L}async function U(){I.value.set(await F(i)),["contacts","deals"].forEach(P=>{n[P]&&I.value.updateValue(P,n[P])}),m.value=I.value.find("email"),p.value=I.value.find("name"),f.value=I.value.find("phones"),t("ready",I)}return(P,H)=>{const L=v("FieldsPlaceholder"),Z=v("IButtonMinimal"),J=v("IAlert"),K=v("FormFields"),G=v("IDropdownItem"),oe=v("IDropdownButtonGroup"),pe=v("CreateDealModal"),ue=v("CreateContactModal"),ee=v("ISlideover");return d(),R(ee,{id:"createCompanyModal",visible:e.visible,title:e.title||P.$t("contacts::company.create"),"ok-title":P.$t("core::app.create"),"ok-disabled":l($).busy,"cancel-title":P.$t("core::app.cancel"),"initial-focus":l(w),"static-backdrop":"",form:"",onShown:A,onHidden:N,onSubmit:H[11]||(H[11]=W=>e.createUsing?e.createUsing(B):B()),"onUpdate:visible":H[12]||(H[12]=W=>P.$emit("update:visible",W))},vt({default:b(()=>[l(I).isEmpty()?(d(),R(L,{key:0})):O("",!0),de(P.$slots,"top",{isReady:l(I).isNotEmpty()}),D(o("div",null,[s(K,{fields:l(I),"form-id":l($).formId,"resource-name":l(i),"is-floating":"","focus-first":""},vt({"after-deals-field":b(()=>[o("span",C6,[o("a",{href:"#",class:"link text-sm",onClick:H[0]||(H[0]=ie(W=>u.value=!0,["prevent"]))}," + "+S(P.$t("deals::deal.create")),1)])]),"after-contacts-field":b(()=>[o("span",S6,[o("a",{href:"#",class:"link text-sm",onClick:H[1]||(H[1]=ie(W=>c.value=!0,["prevent"]))}," + "+S(P.$t("contacts::contact.create")),1)])]),_:2},[h.value!==null?{name:"after-email-field",fn:b(()=>[s(J,{dismissible:"",class:"mb-3",onDismissed:H[3]||(H[3]=W=>{_.value.byEmail=!1,h.value=null})},{default:b(()=>[Q(S(P.$t("contacts::company.exists_in_trash_by_email"))+" ",1),o("div",R6,[o("div",F6,[D(s(Z,{variant:"info",text:P.$t("core::app.soft_deletes.restore"),onClick:H[2]||(H[2]=W=>E(h.value.id,"byEmail"))},null,8,["text"]),[[Y,!_.value.byEmail]]),D(s(Z,{variant:"info",to:{name:"view-company",params:{id:h.value.id}},text:P.$t("core::app.view_record")},null,8,["to","text"]),[[Y,_.value.byEmail]])])])]),_:1})]),key:"0"}:void 0,g.value!==null?{name:"after-name-field",fn:b(()=>[g.value?(d(),R(J,{key:0,dismissible:"",class:"mb-3",onDismissed:H[5]||(H[5]=W=>{_.value.byName=!1,g.value=null})},{default:b(()=>[Q(S(P.$t("contacts::company.exists_in_trash_by_name"))+" ",1),o("div",V6,[o("div",T6,[D(s(Z,{variant:"info",text:P.$t("core::app.soft_deletes.restore"),onClick:H[4]||(H[4]=W=>E(g.value.id,"byName"))},null,8,["text"]),[[Y,!_.value.byName]]),D(s(Z,{variant:"info",to:{name:"view-company",params:{id:g.value.id}},text:P.$t("core::app.view_record")},null,8,["to","text"]),[[Y,_.value.byName]])])])]),_:1})):O("",!0)]),key:"1"}:void 0,y.value.length>0?{name:"after-phones-field",fn:b(()=>[(d(!0),k(te,null,re(y.value,(W,ne)=>(d(),R(J,{key:W.id,dismissible:"",class:"mb-3",onDismissed:ce=>{_.value.byPhone[W.id]=!1,y.value[ne]=null}},{default:b(()=>[Q(S(P.$t("contacts::company.exists_in_trash_by_phone",{company:W.display_name,phone_numbers:W.phones.map(ce=>ce.number).join(",")}))+" ",1),o("div",D6,[o("div",q6,[D(s(Z,{variant:"info",text:P.$t("core::app.soft_deletes.restore"),onClick:ce=>E(W.id,"byPhone")},null,8,["text","onClick"]),[[Y,!_.value.byPhone[W.id]]]),D(s(Z,{variant:"info",to:{name:"view-company",params:{id:W.id}},text:P.$t("core::app.view_record")},null,8,["to","text"]),[[Y,_.value.byPhone[W.id]]])])])]),_:2},1032,["onDismissed"]))),128))]),key:"2"}:void 0]),1032,["fields","form-id","resource-name"])],512),[[Y,e.fieldsVisible]]),s(pe,{visible:u.value,"onUpdate:visible":H[6]||(H[6]=W=>u.value=W),overlay:!1,onCreated:H[7]||(H[7]=W=>(l(I).mergeValue("deals",W.deal),u.value=!1))},null,8,["visible"]),s(ue,{visible:c.value,"onUpdate:visible":H[8]||(H[8]=W=>c.value=W),overlay:!1,onCreated:H[9]||(H[9]=W=>(l(I).mergeValue("contacts",W.contact),c.value=!1)),onRestored:H[10]||(H[10]=W=>(l(I).mergeValue("contacts",W),c.value=!1))},null,8,["visible"])]),_:2},[e.withExtendedSubmitButtons?{name:"modal-ok",fn:b(()=>[s(oe,{type:"submit",placement:"top-end",disabled:l($).busy,loading:l($).busy,text:P.$t("core::app.create")},{default:b(()=>[s(G,{text:P.$t("core::app.create_and_add_another"),onClick:z},null,8,["text"]),D(s(G,{text:P.$t("core::app.create_and_go_to_list"),onClick:M},null,8,["text"]),[[Y,e.goToList]])]),_:1},8,["disabled","loading","text"])]),key:"0"}:void 0]),1032,["visible","title","ok-title","ok-disabled","cancel-title","initial-focus"])}}},A6={class:"-mt-2 block text-right"},B6={class:"-mt-2 block text-right"},N6={class:"mt-4"},O6={class:"-mx-2 -my-1.5 flex"},z6={class:"mt-4"},M6={class:"-mx-2 -my-1.5 flex"},U6={__name:"CreateContactModal",props:{visible:{type:Boolean,default:!0},goToList:{type:Boolean,default:!0},redirectToView:Boolean,createUsing:Function,withExtendedSubmitButtons:Boolean,fieldsVisible:{type:Boolean,default:!0},title:String,firstName:String,lastName:String,email:String,associations:Object,companies:Array,deals:Array},emits:["created","restored","modal-shown","modal-hidden","update:visible","ready"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("contacts"),{t:r}=ve(),i=Qe(),u=q(!1),c=q(!1),m=q({}),p=q({}),f=dt(null),h=q([]),g=q({byEmail:!1,byPhone:{}}),{fields:y,getCreateFields:_}=gt(),{createResource:I}=Je(a),{form:F}=It(y,{avatar:null}),$=Kn(()=>null,()=>document.querySelector("#modalClose-createContactModal"));mn(()=>n.visible,z,{immediate:!0}),dn(()=>{var M;return(M=m.value)==null?void 0:M.currentValue},M=>{if(!M){f.value=null;return}Innoclapps.request().get("/trashed/contacts/search",{params:{q:M,search_fields:"email:="}}).then(({data:j})=>{f.value=j.length>0?j[0]:null})},{debounce:500}),dn(()=>{var M;return(M=p.value)==null?void 0:M.currentValue},M=>{if(!M)return;const j=M.filter(U=>!U.number||!(p.value.callingPrefix&&p.value.callingPrefix.trim()===U.number)).map(U=>U.number);if(j.length===0){h.value=[];return}Innoclapps.request().get("/trashed/contacts/search",{params:{q:j.join(","),search_fields:"phones.number:in"}}).then(({data:U})=>{h.value=U})},{debounce:500,deep:!0});function C(M){if(M.indexRoute={name:"contact-index"},M.action==="go-to-list")return i.push(M.indexRoute);if(M.action!=="create-another"&&n.redirectToView){let j=M.contact;i.contact=j,i.push({name:"view-contact",params:{id:j.id}})}}function w(){t("modal-shown"),$.trigger()}function x(){t("modal-hidden"),y.value.set([]),F.reset()}function A(M,j){Innoclapps.request().post(`/trashed/contacts/${M}`).then(({data:U})=>{typeof g.value[j]=="object"?g.value[j][U.id]=!0:g.value[j]=!0,t("restored",U)})}function N(){B().then(C)}function T(){B("create-another").then(M=>{F.reset(),C(M)})}function E(){B("go-to-list").then(C)}async function B(M=null){n.associations&&F.fill(n.associations);let U={contact:await I(F).catch(P=>(P.isValidationError()&&Innoclapps.error(r("core::app.form_validation_failed"),3e3),Promise.reject(P))),isRegularAction:M===null,action:M};return t("created",U),Innoclapps.success(r("core::resource.created")),U}async function z(){y.value.set(await _(a)),["companies","deals"].forEach(M=>{n[M]&&y.value.updateValue(M,n[M])}),m.value=y.value.find("email"),p.value=y.value.find("phones"),n.email&&y.value.updateValue("email",n.email),n.firstName&&y.value.updateValue("first_name",n.firstName),n.lastName&&y.value.updateValue("last_name",n.lastName),t("ready",y)}return(M,j)=>{const U=v("FieldsPlaceholder"),P=v("IButtonMinimal"),H=v("IAlert"),L=v("FormFields"),Z=v("IDropdownItem"),J=v("IDropdownButtonGroup"),K=v("CreateDealModal"),G=v("CreateCompanyModal"),oe=v("ISlideover");return d(),R(oe,{id:"createContactModal",visible:e.visible,title:e.title||M.$t("contacts::contact.create"),"ok-title":M.$t("core::app.create"),"ok-disabled":l(F).busy,"cancel-title":M.$t("core::app.cancel"),"static-backdrop":"","initial-focus":l($),form:"",onShown:w,onHidden:x,onSubmit:j[9]||(j[9]=pe=>e.createUsing?e.createUsing(N):N()),"onUpdate:visible":j[10]||(j[10]=pe=>M.$emit("update:visible",pe))},vt({default:b(()=>[l(y).isEmpty()?(d(),R(U,{key:0})):O("",!0),de(M.$slots,"top",{isReady:l(y).isNotEmpty()}),D(o("div",null,[s(L,{fields:l(y),"form-id":l(F).formId,"resource-name":l(a),"is-floating":"","focus-first":""},vt({"after-deals-field":b(()=>[o("span",A6,[o("a",{href:"#",class:"link text-sm",onClick:j[0]||(j[0]=ie(pe=>u.value=!0,["prevent"]))}," + "+S(M.$t("deals::deal.create")),1)])]),"after-companies-field":b(()=>[o("span",B6,[o("a",{href:"#",class:"link text-sm",onClick:j[1]||(j[1]=ie(pe=>c.value=!0,["prevent"]))}," + "+S(M.$t("contacts::company.create")),1)])]),_:2},[f.value!==null?{name:"after-email-field",fn:b(()=>[s(H,{dismissible:"",class:"mb-3",onDismissed:j[3]||(j[3]=pe=>{g.value.byEmail=!1,f.value=null})},{default:b(()=>[Q(S(M.$t("contacts::contact.exists_in_trash_by_email"))+" ",1),o("div",N6,[o("div",O6,[D(s(P,{variant:"info",text:M.$t("core::app.soft_deletes.restore"),onClick:j[2]||(j[2]=pe=>A(f.value.id,"byEmail"))},null,8,["text"]),[[Y,!g.value.byEmail]]),D(s(P,{variant:"info",to:{name:"view-contact",params:{id:f.value.id}},text:M.$t("core::app.view_record")},null,8,["to","text"]),[[Y,g.value.byEmail]])])])]),_:1})]),key:"0"}:void 0,h.value.length>0?{name:"after-phones-field",fn:b(()=>[(d(!0),k(te,null,re(h.value,(pe,ue)=>(d(),R(H,{key:pe.id,dismissible:"",class:"mb-3",onDismissed:ee=>{g.value.byPhone[pe.id]=!1,h.value[ue]=null}},{default:b(()=>[Q(S(M.$t("contacts::contact.exists_in_trash_by_phone",{contact:pe.display_name,phone_numbers:pe.phones.map(ee=>ee.number).join(",")}))+" ",1),o("div",z6,[o("div",M6,[D(s(P,{variant:"info",text:M.$t("core::app.soft_deletes.restore"),onClick:ee=>A(pe.id,"byPhone")},null,8,["text","onClick"]),[[Y,!g.value.byPhone[pe.id]]]),D(s(P,{variant:"info",to:{name:"view-contact",params:{id:pe.id}},text:M.$t("core::app.view_record")},null,8,["to","text"]),[[Y,g.value.byPhone[pe.id]]])])])]),_:2},1032,["onDismissed"]))),128))]),key:"1"}:void 0]),1032,["fields","form-id","resource-name"])],512),[[Y,e.fieldsVisible]]),s(K,{visible:u.value,"onUpdate:visible":j[4]||(j[4]=pe=>u.value=pe),overlay:!1,onCreated:j[5]||(j[5]=pe=>(l(y).mergeValue("deals",pe.deal),u.value=!1))},null,8,["visible"]),s(G,{visible:c.value,"onUpdate:visible":j[6]||(j[6]=pe=>c.value=pe),overlay:!1,onCreated:j[7]||(j[7]=pe=>(l(y).mergeValue("companies",pe.company),c.value=!1)),onRestored:j[8]||(j[8]=pe=>(l(y).mergeValue("companies",pe),c.value=!1))},null,8,["visible"])]),_:2},[e.withExtendedSubmitButtons?{name:"modal-ok",fn:b(()=>[s(J,{type:"submit",placement:"top-end",disabled:l(F).busy,loading:l(F).busy,text:M.$t("core::app.create")},{default:b(()=>[s(Z,{text:M.$t("core::app.create_and_add_another"),onClick:T},null,8,["text"]),D(s(Z,{text:M.$t("core::app.create_and_go_to_list"),onClick:E},null,8,["text"]),[[Y,e.goToList]])]),_:1},8,["disabled","loading","text"])]),key:"0"}:void 0]),1032,["visible","title","ok-title","ok-disabled","cancel-title","initial-focus"])}}},P6={__name:"SettingsCompanies",setup(e){const{form:t,submit:n,isReady:a}=Gt();return(r,i)=>{const u=v("ICard");return d(),R(u,{header:r.$t("contacts::company.companies"),"no-body":"",overlay:!l(a)},{default:b(()=>[s(bo,null,{default:b(()=>[s(Tn,{modelValue:l(t).auto_associate_company_to_contact,"onUpdate:modelValue":i[0]||(i[0]=c=>l(t).auto_associate_company_to_contact=c),heading:r.$t("contacts::company.settings.automatically_associate_with_contacts"),description:r.$t("contacts::company.settings.automatically_associate_with_contacts_info"),onChange:l(n)},null,8,["modelValue","heading","description","onChange"])]),_:1})]),_:1},8,["header","overlay"])}}},j6=["href","onClick","textContent"],L6={key:1},H6={__name:"PhoneField",props:["resource","resourceName","resourceId","field"],setup(e){const t=e,n=V(()=>t.field.value.length);return(a,r)=>{const i=v("IButtonCopy"),u=v("IDropdownItem"),c=v("IDropdown"),m=v("DetailFieldItem"),p=ae("i-tooltip");return d(),R(m,{field:e.field},{field:b(({hasValue:f,value:h})=>[f?(d(!0),k(te,{key:0},re(h,(g,y)=>(d(),R(c,{key:y,"no-caret":"",text:g.number+(y!=n.value-1?", ":"")},{toggle:b(({toggle:_})=>[D(o("a",{class:"link text-sm",href:"tel:"+g.number,onClick:ie(_,["prevent"]),textContent:S(g.number)},null,8,j6),[[p,a.$t("contacts::fields.phone.types."+g.type)]])]),default:b(()=>[s(i,{text:g.number,"success-message":a.$t("contacts::fields.phone.copied"),tag:"IDropdownItem"},{default:b(()=>[Q(S(a.$t("core::app.copy")),1)]),_:2},1032,["text","success-message"]),s(u,{href:"tel:"+g.number,text:a.$t("core::app.open_in_app")},null,8,["href","text"])]),_:2},1032,["text"]))),128)):(d(),k("span",L6,""))]),_:1},8,["field"])}}},G6={class:"flex"},K6={class:"relative flex grow items-stretch focus-within:z-10"},Y6={class:"absolute inset-y-0 left-0 flex items-center pl-3"},W6={class:"max-w-[70px] truncate"},Q6={class:"font-medium"},X6={class:"mt-4"},Z6={class:"-mx-2 -my-1.5 flex"},J6={class:"text-right"},eB=["onClick"],tB={__name:"PhoneField",props:ut,setup(e){const t=e,n=q([]),a=q({}),r=Pl(t.formId),i=V(()=>n.value?c.value>0||m.value>0?!0:!At(n.value,w.value):!1),u=V(()=>t.field.callingPrefix),c=V(()=>n.value.filter(T=>T._delete).length),m=V(()=>n.value.filter(T=>!T.id&&T.number&&(!u.value||u.value&&u.value!==T.number)).length),p=V(()=>n.value.length);ge(p,T=>{T===0&&_()});function f(T){let E=ao(nt(n.value),B=>B._delete);u.value&&(E=ao(E,B=>!B._delete&&u.value&&B.number.trim()===u.value.trim())),T.fill(t.field.attribute,E.map(B=>Rn(B,"id")).filter(B=>!!B.number))}function h(){n.value=nt(t.field.value?t.field.value:[]),n.value.length===0&&(_(),w.value=nt(n.value))}function g(T){n.value=nt(T),p.value===0&&_(),w.value=nt(n.value)}function y(T){a.value[T]=null,n.value[T].id?n.value[T]._delete=!0:n.value.splice(T,1),r.errors.clear(t.field.attribute+"."+T+".number"),(p.value-c.value===0||p.value-c.value===0&&c.value>0)&&_()}function _(){n.value.push({number:u.value||"",type:t.field.type})}const I=Dt((T,E)=>{if(!A.value||t.resourceId||!E||u.value&&u.value===E){a.value[T]=null;return}N(E).then(B=>a.value[T]=B)},700),{field:F,label:$,fieldId:C,realInitialValue:w,initialize:x,checksForDuplicates:A,makeDuplicateCheckRequest:N}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{isDirty:i,handleChange:g,setInitialValue:h,fill:f});return De(x),(T,E)=>{const B=v("Icon"),z=v("IFormInput"),M=v("IButton"),j=v("IDropdownItem"),U=v("IDropdown"),P=v("IButtonClose"),H=v("IFormError"),L=v("i18n-t"),Z=v("IButtonMinimal"),J=v("IAlert"),K=v("IFormGroup"),G=ae("t");return d(),R(it,{field:l(F),label:l($),"field-id":l(C),"form-id":T.formId,class:"multiple"},{default:b(()=>[(d(!0),k(te,null,re(n.value,(oe,pe)=>D((d(),R(K,{key:pe,class:"rounded-md"},{default:b(()=>[o("div",G6,[o("div",K6,[o("div",Y6,[s(B,{icon:oe.type=="mobile"?"DeviceMobile":"Phone",class:"h-5 w-5 text-neutral-500 dark:text-neutral-300"},null,8,["icon"])]),s(z,{modelValue:n.value[pe].number,"onUpdate:modelValue":ue=>n.value[pe].number=ue,rounded:!1,class:"rounded-l-md pl-10",name:l(F).attribute+"."+pe+".number",onInput:ue=>(l(r).errors.clear(l(F).attribute+"."+pe+".number"),l(I)(pe,n.value[pe].number))},null,8,["modelValue","onUpdate:modelValue","name","onInput"])]),s(U,{"adaptive-width":""},{toggle:b(({toggle:ue})=>[s(M,{variant:"white",class:"relative -ml-px justify-between px-4 py-2 text-sm focus:z-10",rounded:!1,size:!1,onClick:ue},{default:b(()=>[o("span",W6,S(n.value[pe].type?l(F).types[n.value[pe].type]:T.$t("contacts::fields.phone.types.type")),1),s(B,{icon:"ChevronDown",class:"link h-4 w-4"})]),_:2},1032,["onClick"])]),default:b(()=>[(d(!0),k(te,null,re(l(F).types,(ue,ee)=>(d(),R(j,{key:ee,text:ue,onClick:W=>n.value[pe].type=ee},null,8,["text","onClick"]))),128))]),_:2},1024),s(P,{rounded:!1,variant:"white",class:"relative -ml-px rounded-r-md !px-2.5",onClick:ue=>y(pe)},null,8,["onClick"])]),s(H,{textContent:S(l(r).getError(l(F).attribute+"."+pe+".number"))},null,8,["textContent"]),a.value[pe]?(d(),R(J,{key:0,dismissible:"",class:"mt-1",onDismissed:ue=>a.value[pe]=null},{default:b(()=>[s(L,{scope:"global",keypath:l(F).checkDuplicatesWith.lang_keypath},{display_name:b(()=>[o("span",Q6,S(a.value[pe].display_name),1)]),_:2},1032,["keypath"]),o("div",X6,[o("div",Z6,[s(Z,{tag:"a",href:a.value[pe].path,target:"_blank",rel:"noopener noreferrer",variant:"info",icon:"ExternalLink",text:T.$t("core::app.view_record")},null,8,["href","text"])])])]),_:2},1032,["onDismissed"])):O("",!0)]),_:2},1024)),[[Y,!oe._delete]])),128)),o("div",J6,[D(o("a",{href:"#",class:"link mr-2 text-sm",onClick:ie(_,["prevent"])},null,8,eB),[[G,"contacts::fields.phone.add"]])])]),_:1},8,["field","label","field-id","form-id"])}}},nB={key:0,class:"mb-4 rounded-md border border-success-400 px-4 py-3"},$l={__name:"DealsCreate",props:{viaResource:String,parentResource:Object},emits:["associated"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("deals"),{t:r}=ve(),{fields:i}=gt([{asyncUrl:"/deals/search",attribute:"deals",formComponent:"FormSelectField",helpText:r("deals::deal.associate_field_info"),helpTextDisplay:"text",label:r("deals::deal.deal"),labelKey:"name",valueKey:"id",lazyLoad:{url:"/deals",params:{order:"created_at|desc"}}}]),{form:u}=It(i),c=V(()=>!!i.value.find("deals").currentValue),m=V(()=>n.viaResource?c.value?r("deals::deal.associate_with",{name:n.parentResource.display_name}):r("deals::deal.create_with",{name:n.parentResource.display_name}):r("deals::deal.create"));async function p(){await u.hydrate().set({deals:[u.deals]}).put(`associations/${n.viaResource}/${n.parentResource.id}`),t("associated",u.deals[0]),Innoclapps.success(r("core::resource.associated"))}n.viaResource||Ut(r("deals::deal.create"));function f(h){n.viaResource&&h.value.updateValue(n.viaResource,[n.parentResource])}return(h,g)=>{const y=v("FormFields"),_=v("CreateDealModal");return d(),R(_,{title:m.value,"ok-title":c.value?h.$t("core::app.associate"):h.$t("core::app.create"),"fields-visible":!c.value,"with-extended-submit-buttons":!c.value,"create-using":I=>c.value?p():I(),onReady:f},{top:b(({isReady:I})=>[e.viaResource?D((d(),k("div",nB,[s(y,{fields:l(i),"form-id":l(u).formId,"resource-name":l(a)},null,8,["fields","form-id","resource-name"])],512)),[[Y,I]]):O("",!0)]),_:1},8,["title","ok-title","fields-visible","with-extended-submit-buttons","create-using"])}}},oB={key:0,class:"mb-4 rounded-md border border-success-400 px-4 py-3"},wl={__name:"CompaniesCreate",props:{viaResource:String,parentResource:Object},emits:["associated"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("companies"),{t:r}=ve(),{fields:i}=gt([{asyncUrl:"/companies/search",attribute:"companies",formComponent:"FormSelectField",helpText:r("contacts::company.associate_field_info"),helpTextDisplay:"text",label:r("contacts::company.company"),labelKey:"name",valueKey:"id",lazyLoad:{url:"/companies",params:{order:"created_at|desc"}}}]),{form:u}=It(i),c=V(()=>!!i.value.find("companies").currentValue),m=V(()=>n.viaResource?c.value?r("contacts::company.associate_with",{name:n.parentResource.display_name}):r("contacts::company.create_with",{name:n.parentResource.display_name}):r("contacts::company.create"));async function p(){await u.hydrate().set({companies:[u.companies]}).put(`associations/${n.viaResource}/${n.parentResource.id}`),t("associated",u.companies[0]),Innoclapps.success(r("core::resource.associated"))}n.viaResource||Ut(r("contacts::company.create"));function f(h){n.viaResource&&h.value.updateValue(n.viaResource,[n.parentResource])}return(h,g)=>{const y=v("FormFields"),_=v("CreateCompanyModal");return d(),R(_,{title:m.value,"ok-title":c.value?h.$t("core::app.associate"):h.$t("core::app.create"),"fields-visible":!c.value,"with-extended-submit-buttons":!c.value,"create-using":I=>c.value?p():I(),onReady:f},{top:b(({isReady:I})=>[e.viaResource?D((d(),k("div",oB,[s(y,{fields:l(i),"form-id":l(u).formId,"resource-name":l(a)},null,8,["fields","form-id","resource-name"])],512)),[[Y,I]]):O("",!0)]),_:1},8,["title","ok-title","fields-visible","with-extended-submit-buttons","create-using"])}}},lB={class:"flex flex-wrap space-x-0 lg:flex-nowrap lg:space-x-4"},nl={__name:"CardList",props:{resourceName:{required:!0,type:String},totalPlaceholders:{default:2,type:Number}},setup(e){const t=e,n=dt([]),a=q(!1);async function r(){let{data:i}=await Innoclapps.request().get(`/${t.resourceName}/cards`);n.value=i,a.value=!0}return r(),(i,u)=>(d(),k("div",lB,[a.value?O("",!0):(d(!0),k(te,{key:0},re(e.totalPlaceholders,c=>(d(),k("div",{key:c,class:"w-full lg:w-1/2"},[s(un,{pulse:"",class:"mb-4"})]))),128)),(d(!0),k(te,null,re(n.value,c=>(d(),k("div",{key:c.uriKey,class:X(c.width==="half"?"w-full lg:w-1/2":"w-full")},[(d(),R(We(c.component),{class:"mb-4",card:c},null,8,["card"]))],2))),128))]))}},aB={class:"ml-auto flex items-center text-sm"},sB={class:"font-medium text-neutral-800 dark:text-neutral-300"},rB={__name:"CompaniesTable",props:{tableId:{required:!0,type:String},initialize:{default:!0,type:Boolean}},emits:["deleted","loaded"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("companies"),{t:r}=ve(),{reloadTable:i}=Bt(),{floatResourceInEditMode:u}=an(),{deleteResource:c}=Je(a),m=q(null);async function p(f){await Innoclapps.dialog().confirm(),await c(f),t("deleted",f),i(n.tableId),Innoclapps.success(r("core::resource.deleted"))}return(f,h)=>{const g=v("CreateActivityModal"),y=ae("t");return d(),k(te,null,[e.initialize?(d(),R(l(tn),{key:0,"resource-name":l(a),"table-id":e.tableId,"empty-state":{to:{name:"create-company"},title:f.$t("contacts::company.empty_state.title"),buttonText:f.$t("contacts::company.create"),description:f.$t("contacts::company.empty_state.description"),secondButtonText:f.$t("core::import.from_file",{file_type:"CSV"}),secondButtonIcon:"DocumentAdd",secondButtonTo:{name:"import-resource",params:{resourceName:l(a)}}},onLoaded:h[0]||(h[0]=_=>f.$emit("loaded",_))},{"after-search":b(({collection:_})=>[o("div",aB,[D(o("span",sB,null,512),[[y,{path:"contacts::company.count.all",args:{count:_.state.meta.total}}]])])]),actions:b(({row:_})=>[s(Mn,null,{default:b(()=>[s(Ft,{tooltip:f.$t("activities::activity.create"),icon:"Clock",onClick:I=>m.value=_},null,8,["tooltip","onClick"]),_.authorizations.update?(d(),R(Ft,{key:0,tooltip:f.$t("core::app.edit"),icon:"PencilAlt",onClick:I=>l(u)({resourceName:l(a),resourceId:_.id})},null,8,["tooltip","onClick"])):O("",!0),_.authorizations.delete?(d(),R(Ft,{key:1,tooltip:f.$t("core::app.delete"),icon:"Trash",onClick:I=>p(_.id)},null,8,["tooltip","onClick"])):O("",!0)]),_:2},1024)]),_:1},8,["resource-name","table-id","empty-state"])):O("",!0),s(g,{visible:m.value!==null,companies:[m.value],"with-extended-submit-buttons":!0,"go-to-list":!1,onCreated:h[1]||(h[1]=({isRegularAction:_})=>(_&&(m.value=null),l(i)(e.tableId))),onModalHidden:h[2]||(h[2]=_=>m.value=null)},null,8,["visible","companies"])],64)}}},iB={class:"inline-flex items-center"},uB={class:"mr-3 lg:mr-6"},So="companies",dB={__name:"CompaniesIndex",setup(e){const t=Innoclapps.resourceName("companies"),n=Ye(),{reloadTable:a,customizeTable:r}=Bt(),i=q(n.meta.initialize),u=q(!0),c=V(()=>i.value&&!u.value);function m(){Innoclapps.$emit("refresh-cards"),a(So)}return yn((p,f,h)=>{i.value=!0,h()}),(p,f)=>{const h=v("NavbarSeparator"),g=v("IDropdownItem"),y=v("IMinimalDropdown"),_=v("IButton"),I=v("router-view"),F=v("ILayout");return d(),R(F,null,{actions:b(()=>[s(h,{class:"hidden lg:block"}),o("div",iB,[o("div",uB,[s(y,{type:"horizontal"},{default:b(()=>[s(g,{icon:"DocumentAdd",to:{name:"import-resource",params:{resourceName:l(t)}},text:p.$t("core::import.import")},null,8,["to","text"]),p.$gate.userCan("export companies")?(d(),R(g,{key:0,icon:"DocumentDownload",text:p.$t("core::app.export.export"),onClick:f[0]||(f[0]=$=>p.$iModal.show("export-modal"))},null,8,["text"])):O("",!0),s(g,{icon:"Trash",to:{name:"trashed-resource-records",params:{resourceName:l(t)}},text:p.$t("core::app.soft_deletes.trashed")},null,8,["to","text"]),s(g,{icon:"Cog",text:p.$t("core::table.list_settings"),onClick:f[1]||(f[1]=$=>l(r)(So))},null,8,["text"])]),_:1})]),s(_,{to:{name:"create-company"},icon:"Plus",size:"sm",text:p.$t("contacts::company.create")},null,8,["text"])])]),default:b(()=>[c.value?(d(),R(nl,{key:0,"resource-name":l(t)},null,8,["resource-name"])):O("",!0),s(rB,{"table-id":So,initialize:i.value,onLoaded:f[2]||(f[2]=$=>u.value=$.empty),onDeleted:m},null,8,["initialize"]),s(l(go),{"url-path":"/companies/export","resource-name":l(t),"filters-view":So,title:p.$t("contacts::company.export")},null,8,["resource-name","title"]),s(I,{name:"create","redirect-to-view":!0,onCreated:f[3]||(f[3]=({isRegularAction:$})=>$?void 0:m()),onModalHidden:p.$router.back},null,8,["onModalHidden"])]),_:1})}}},cB={key:0},mB={class:"mb-4"},pB={class:"font-medium text-neutral-700 dark:text-white"},fB={class:"text-sm text-neutral-500 dark:text-neutral-300"},vB={class:"flex rounded-md border border-neutral-200 bg-white p-4 dark:border-neutral-700 dark:bg-neutral-900"},bB={class:"grow"},hB={class:"mt-3 flex items-center justify-end space-x-2"},na={__name:"ManageViewSections",props:{sections:{type:Array,required:!0},show:Boolean,identifier:{type:String,required:!0}},emits:["saved","update:show","update:sections"],setup(e,{emit:t}){const n=e,{draggableOptions:a}=Xt(),r=q({});n.sections.forEach(c=>{r.value[c.id]=c.enabled});const i=q(!1);function u(){i.value=!0,Innoclapps.request().post("/settings",{[n.identifier+"_view_sections"]:_t(n.sections,(c,m)=>({id:c.id,order:m+1,enabled:r.value[c.id]}))}).then(()=>{t("saved");const c=_t(n.sections,(m,p)=>Object.assign({},m,{order:p+1,enabled:r.value[m.id]}));t("update:sections",c)}).finally(()=>i.value=!1)}return(c,m)=>{const p=v("IFormCheckbox"),f=v("IButtonIcon"),h=v("IButton"),g=ae("t");return e.show?(d(),k("div",cB,[o("div",mB,[D(o("p",pB,null,512),[[g,"core::app.record_view.sections.edit_heading"]]),D(o("p",fB,null,512),[[g,"core::app.record_view.sections.edit_subheading"]])]),s(l(Et),Re({"model-value":e.sections,"item-key":"id",class:"space-y-3",handle:".section-reorder-handle"},l(a),{"onUpdate:modelValue":m[0]||(m[0]=y=>c.$emit("update:sections",y))}),{item:b(({element:y})=>[o("div",vB,[o("div",bB,[s(p,{id:"section-"+y.id,checked:r.value[y.id],"onUpdate:checked":_=>r.value[y.id]=_,name:"section-"+y.id},{default:b(()=>[Q(S(y.heading||y.id),1)]),_:2},1032,["id","checked","onUpdate:checked","name"])]),o("div",null,[s(f,{icon:"Selector",class:"section-reorder-handle cursor-move"})])])]),_:1},16,["model-value"]),o("div",hB,[s(h,{variant:"white",size:"sm",text:c.$t("core::app.cancel"),onClick:m[1]||(m[1]=y=>c.$emit("update:show",!1))},null,8,["text"]),s(h,{variant:"primary",size:"sm",disabled:i.value,loading:i.value,text:c.$t("core::app.save"),onClick:u},null,8,["disabled","loading","text"])])])):O("",!0)}}},oa=Object.assign({inheritAttrs:!1},{__name:"RecordTabTimeline",setup(e){return(t,n)=>{const a=v("ITab");return n[0]||(he(-1),n[0]=s(a,{title:t.$t("core::app.all"),icon:"Bars3BottomLeft"},null,8,["title"]),he(1),n[0])}}}),_B=["textContent"],gB={__name:"RecordTabTimelineAttached",props:Pt,setup(e){return(t,n)=>{const a=v("i18n-t"),r=v("router-link");return d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"Plus"},{heading:b(()=>[n[0]||(he(-1),n[0]=s(a,{scope:"global",keypath:"core::timeline.attached",user:t.log.causer_name},{user:b(()=>[o("span",{class:"font-medium",textContent:S(t.log.causer_name)},null,8,_B)]),_:1},8,["user"]),he(1),n[0]),s(r,{class:"link ml-1 font-medium",to:t.log.properties.path},{default:b(()=>[Q(S(t.log.properties.name),1)]),_:1},8,["to"])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key"])}}},yB=["textContent"],xB={__name:"RecordTabTimelineCreated",props:Pt,setup(e){return(t,n)=>{const a=v("i18n-t");return d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"User"},{heading:b(()=>[n[0]||(he(-1),n[0]=s(a,{scope:"global",keypath:"core::timeline.created"},{causer:b(()=>[o("span",{class:"font-medium",textContent:S(t.log.causer_name)},null,8,yB)]),_:1}),he(1),n[0])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key"])}}},IB=["textContent"],kB={__name:"RecordTabTimelineDeleted",props:Pt,setup(e){return(t,n)=>{const a=v("i18n-t");return d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"User"},{heading:b(()=>[n[0]||(he(-1),n[0]=s(a,{scope:"global",keypath:"core::timeline.deleted"},{causer:b(()=>[o("span",{class:"font-medium",textContent:S(t.log.causer_name)},null,8,IB)]),_:1}),he(1),n[0])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key"])}}},$B=["textContent"],wB={__name:"RecordTabTimelineDetached",props:Pt,setup(e){return(t,n)=>{const a=v("i18n-t"),r=v("router-link");return d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"X"},{heading:b(()=>[n[0]||(he(-1),n[0]=s(a,{scope:"global",keypath:"core::timeline.detached",user:t.log.causer_name},{user:b(()=>[o("span",{class:"font-medium",textContent:S(t.log.causer_name)},null,8,$B)]),_:1},8,["user"]),he(1),n[0]),s(r,{class:"link ml-1 font-medium",to:t.log.properties.path},{default:b(()=>[Q(S(t.log.properties.name),1)]),_:1},8,["to"])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key"])}}},CB={__name:"RecordTabTimelineGeneric",props:Pt,setup(e){const t=e,n=V(()=>{let a=t.log.properties.lang.attrs;return a?((cn(window.lang[Yn()],t.log.properties.lang.key.replace("::",".")).indexOf("{user}")>-1&&Object.keys(a).indexOf("user")===-1||Object.keys(a).indexOf("user")>-1&&a.user===null)&&(a=Object.assign({},a,{user:t.log.causer_name})),a):null});return(a,r)=>(d(),R(jt,{"resource-name":a.resourceName,"resource-id":a.resourceId,"created-at":a.log.created_at,"is-pinned":a.log.is_pinned,"timelineable-id":a.log.id,"timeline-relationship":a.log.timeline_relation,"timeline-subject-key":a.resource.timeline_subject_key,"timelineable-key":a.log.timeline_key,icon:a.log.properties.icon||"User",heading:a.$t(a.log.properties.lang.key,n.value)},null,8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key","icon","heading"]))}},SB=["textContent"],RB={__name:"RecordTabTimelineImported",props:Pt,setup(e){return(t,n)=>{const a=v("i18n-t");return d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"User"},{heading:b(()=>[n[0]||(he(-1),n[0]=s(a,{scope:"global",keypath:"core::timeline.imported"},{causer:b(()=>[o("span",{class:"font-medium",textContent:S(t.log.causer_name)},null,8,SB)]),_:1}),he(1),n[0])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key"])}}},FB=["textContent"],VB={__name:"RecordTabTimelineRestored",props:Pt,setup(e){return(t,n)=>{const a=v("i18n-t");return d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"Refresh"},{heading:b(()=>[n[0]||(he(-1),n[0]=s(a,{scope:"global",keypath:"core::timeline.restored"},{causer:b(()=>[o("span",{class:"font-medium",textContent:S(t.log.causer_name)},null,8,FB)]),_:1}),he(1),n[0])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key"])}}},TB=["textContent"],DB=["textContent"],qB={class:"mt-2"},EB={key:0},AB={class:"text-sm font-medium text-neutral-700 dark:text-neutral-300"},BB={class:"mt-2"},NB={class:"text-left"},OB={class:"text-left"},zB={class:"text-left"},MB=["onClick","textContent"],UB={__name:"RecordTabTimelineUpdated",props:Pt,setup(e){const t=e,{t:n,te:a}=ve(),{maybeFormatDateValue:r}=Ne(),i=q(!1),u=V(()=>i.value?n("core::fields.hide_updated"):n("core::fields.view_updated")+" ("+m.value+")"),c=V(()=>ns(t.log.properties.attributes,(h,g)=>g.indexOf("_id")===-1)),m=V(()=>Object.keys(c.value).length);function p(h,g){return h&&h.label?h.label:(t.log.module,t.log.module+"::fields."+t.resourceName+"."+g&&a(t.log.module+"::fields."+t.resourceName+"."+g)?n(t.log.module+"::fields."+t.resourceName+"."+g):g)}function f(h,g){return h&&Object.hasOwn(h,"value")?r(h.value,h.value):a("core::timeline."+g+"."+h)?n("core::timeline."+g+"."+h):r(h,h)}return(h,g)=>{const y=v("i18n-t"),_=v("ITable"),I=ae("t");return d(),R(jt,{"resource-name":h.resourceName,"resource-id":h.resourceId,"created-at":h.log.created_at,"is-pinned":h.log.is_pinned,"timelineable-id":h.log.id,"timeline-relationship":h.log.timeline_relation,"timeline-subject-key":h.resource.timeline_subject_key,"timelineable-key":h.log.timeline_key,icon:"PencilAlt"},{heading:b(()=>[g[0]||(he(-1),g[0]=h.log.causer_name?(d(),R(y,{key:0,scope:"global",keypath:"core::timeline.updated"},{causer:b(()=>[o("span",{class:"font-medium",textContent:S(h.log.causer_name)},null,8,TB)]),_:1})):(d(),k("span",{key:1,textContent:S(h.$t("core::timeline.updated"))},null,8,DB)),he(1),g[0])]),default:b(()=>[o("div",qB,[i.value?(d(),k("div",EB,[o("p",AB,S(h.$t("core::fields.updated"))+" ("+S(m.value)+") ",1),o("div",BB,[s(_,{class:"overflow-hidden rounded-lg",bordered:""},{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",NB,null,512),[[I,"core::fields.updated_field"]]),D(o("th",OB,null,512),[[I,"core::fields.new_value"]]),D(o("th",zB,null,512),[[I,"core::fields.old_value"]])])]),o("tbody",null,[(d(!0),k(te,null,re(c.value,(F,$)=>(d(),k("tr",{key:h.resourceName+$},[o("td",null,S(p(F,$)),1),o("td",null,S(f(F,$)),1),o("td",null,S(f(h.log.properties.old[$],$)),1)]))),128))])]),_:1})])])):O("",!0),o("a",{href:"#",class:"link mt-2 block text-sm",onClick:ie(F=>i.value=!i.value,["prevent"]),textContent:S(u.value)},null,8,MB)])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key"])}}},PB={class:"mt-4 inline-flex items-center sm:ml-1 sm:mt-2"},jB={class:"-mt-0.5 mr-1.5 text-sm font-medium text-neutral-700 dark:text-neutral-300"},LB={class:"pt-6"},HB={class:"flow-root"},GB={role:"list",class:"sm:-mb-8"},KB={class:"relative sm:pb-8"},YB={key:0,class:"absolute left-5 top-5 -ml-px hidden h-full w-0.5 bg-neutral-200 dark:bg-neutral-600 sm:block","aria-hidden":"true"},WB={class:"relative flex items-start sm:space-x-3"},QB={key:0,class:"block sm:hidden","aria-hidden":"true"},XB=o("div",{class:"py-5"},[o("div",{class:"border-t border-neutral-200 dark:border-neutral-600"})],-1),ZB=[XB],JB="changelog",la={__name:"RecordTabTimelinePanel",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object},scrollElement:{type:String}},setup(e){const t=e,n=Me("synchronizeResource"),a={"timeline-restored":VB,"timeline-deleted":kB,"timeline-created":xB,"timeline-updated":UB,"timeline-attached":gB,"timeline-detached":wB,"timeline-imported":RB,"timeline-generic":CB},{t:r}=ve(),i=q(null),{loadData:u,infiniteHandler:c,search:m,refresh:p}=Xn({resourceName:t.resourceName,resource:xe(t,"resource"),scrollElement:t.scrollElement,timelineRelation:JB,synchronizeResource:n,infinityRef:i,handleInfinityResult:F,makeRequestForData:I});dn(()=>t.resource._sync_timestamp,()=>p(),{debounce:500});const f=q([]),h=V(()=>[{id:null,name:r("core::app.all")},{id:"changelog",name:r("core::app.changelog")},...f.value.map($=>({id:$.name,name:$.label}))]),g=q({id:null,name:r("core::app.all")}),y=V(()=>!g.value.id||g.value.id==="changelog"?t.resource.changelog||[]:[]),_=V(()=>{const $=[...y.value];return f.value.forEach(C=>{$.push(...!g.value.id||g.value.id===C.name?t.resource[C.timeline_relation]||[]:[])}),ot($,["is_pinned","pinned_date",C=>new Date(C[C.timeline_sort_column])],["desc","desc","desc"])});function I($,C){return Innoclapps.request().get(`${t.resource.path}/timeline`,{params:{page:$,per_page:C,q:m.value}})}function F($){f.value=$.resources,n(wd($.data,"timeline_relation"))}return De(u),($,C)=>{const w=v("DropdownSelectInput"),x=v("ITabPanel"),A=ae("t");return d(),R(x,null,{default:b(()=>[o("div",PB,[D(o("p",jB,null,512),[[A,"core::filters.filter_by"]]),s(w,{modelValue:g.value,"onUpdate:modelValue":C[0]||(C[0]=N=>g.value=N),items:h.value,"value-key":"id","label-key":"name",onChange:l(u)},null,8,["modelValue","items","onChange"])]),o("div",LB,[o("div",HB,[o("ul",GB,[(d(!0),k(te,null,re(_.value,(N,T)=>(d(),k("li",{key:"timeline-"+N.timeline_component+"-"+N.id},[o("div",KB,[T!==_.value.length-1?(d(),k("span",YB)):O("",!0),o("div",WB,[(d(),R(We(Object.hasOwn(a,"timeline-"+N.timeline_component)?a["timeline-"+N.timeline_component]:N.timeline_component),{log:N,"resource-name":e.resourceName,"resource-id":e.resourceId,resource:e.resource},null,8,["log","resource-name","resource-id","resource"]))])]),T!==_.value.length-1?(d(),k("div",QB,ZB)):O("",!0)]))),128))]),s(xn,{ref_key:"infinityRef",ref:i,"scroll-element":e.scrollElement,onHandle:C[1]||(C[1]=N=>l(c)(N))},null,8,["scroll-element"])])])]),_:1})}}},eN={key:0,class:"inline-flex items-center"},tN={key:1,class:"text-neutral-500 dark:text-neutral-300"},nN={key:1,class:"inline-flex items-center text-sm text-neutral-800 dark:text-neutral-200"},aa={__name:"UserOwnerDropdown",props:["owner","authorizeUpdate"],emits:["change"],setup(e){const t=e,{users:n}=Le(),{t:a}=ve(),r=V(()=>t.owner?[...n.value,{id:null,icon:"X",prependIcon:!0,name:a("core::app.no_owner"),class:"border-t border-neutral-200 dark:border-neutral-700"}].map(i=>({id:i.id,name:i.name,class:i.class||void 0,prependIcon:i.prependIcon||void 0,icon:i.icon||void 0})):n.value);return(i,u)=>{var h;const c=v("IAvatar"),m=v("DropdownSelectInput"),p=ae("i-tooltip"),f=ae("t");return e.authorizeUpdate?(d(),R(m,{key:0,items:r.value,"model-value":(h=e.owner)==null?void 0:h.id,"value-key":"id","label-key":"name",onChange:u[0]||(u[0]=g=>i.$emit("change",g))},{label:b(({label:g})=>[e.owner?D((d(),k("span",eN,[s(c,{size:"xs",class:"mr-1.5",src:e.owner.avatar_url},null,8,["src"]),Q(" "+S(g),1)])),[[p,i.$t("deals::fields.deals.user.name"),void 0,{top:!0}]]):D((d(),k("span",tN,null,512)),[[f,"core::app.no_owner"]])]),_:1},8,["items","model-value"])):e.owner?(d(),k("p",nN,[s(c,{size:"xs",class:"mr-1.5",src:e.owner.avatar_url},null,8,["src"]),Q(" "+S(e.owner.name),1)])):O("",!0)}}},oN={class:"px-4 py-5 sm:px-6"},lN={__name:"CompaniesViewChildCompanies",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=e,n=V(()=>t.resource.parents.length),a=V(()=>n.value>0);return(r,i)=>a.value?St([e.resource.parents.map(u=>u.updated_at)],()=>(d(),k("div",{key:0,class:"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},[o("div",oN,[s(ta,{title:r.$t("contacts::company.child",{count:n.value}),companies:e.resource.parents},null,8,["title","companies"])])])),i,0):O("",!0)}},aN={class:"px-4 py-5 sm:px-6"},sN={__name:"CompaniesViewContacts",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>St([e.resource.contacts.map(a=>a.updated_at)],()=>(d(),k("div",{class:"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},[o("div",aN,[s(Ks,{"company-id":e.resourceId,contacts:e.resource.contacts,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onCreateRequested:n[0]||(n[0]=a=>t.$router.push({name:"createContactViaCompany",params:{id:e.resourceId}}))},null,8,["company-id","contacts","authorize-dissociate","show-create-button"])])])),n,1)}},rN={class:"px-4 py-5 sm:px-6"},iN={__name:"CompaniesViewDeals",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>St([e.resource.deals.map(a=>a.updated_at)],()=>(d(),k("div",{class:"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},[o("div",rN,[s(Ws,{"company-id":e.resourceId,deals:e.resource.deals,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onCreateRequested:n[0]||(n[0]=a=>t.$router.push({name:"createDealViaCompany",params:{id:e.resourceId}}))},null,8,["company-id","deals","authorize-dissociate","show-create-button"])])])),n,1)}},uN={class:"overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},dN={class:"flex items-center justify-between px-6 py-3"},cN={class:"inline-flex items-center"},mN={key:0,class:"mr-2 block h-2 w-2 rounded-full bg-danger-500"},pN={class:"font-medium text-neutral-800 dark:text-white"},fN={class:"flex items-center space-x-3"},vN=Object.assign({inheritAttrs:!1},{__name:"CompaniesViewDetails",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=e,n=Innoclapps.config("fields.views.detail"),a=q(!0),{fields:r,getDetailFields:i}=gt(),{floatResourceInEditMode:u}=an();i(t.resourceName,t.resource.id).then(m=>r.value.set(m).populate(t.resource));const c=V(()=>r.value.isNotEmpty());return(m,p)=>{const f=v("IButtonIcon"),h=v("DetailFields"),g=v("IOverlay"),y=ae("t"),_=ae("i-tooltip");return d(),R(g,{show:!c.value,class:X({"rounded-lg bg-white p-6 shadow dark:bg-neutral-900":!c.value})},{default:b(()=>[D(o("div",uN,[o("div",dN,[o("div",cN,[l(r).requiredFieldsMissingValues?(d(),k("span",mN)):O("",!0),D(o("h2",pN,null,512),[[y,"core::app.record_view.sections.details"]])]),o("div",fN,[s(f,{size:"sm",icon:"PencilAlt","icon-class":"h-[1.03rem] w-[1.03rem]",onClick:p[0]||(p[0]=I=>l(u)({resourceName:e.resourceName,resourceId:e.resourceId}))}),m.$gate.isSuperAdmin()?D((d(),R(f,{key:0,size:"sm",to:{name:"resource-fields",params:{resourceName:e.resourceName},query:{view:l(n)}},icon:"AdjustmentsVertical","icon-class":"h-[1.1rem] w-[1.1rem]"},null,8,["to"])),[[_,m.$t("core::fields.manage")]]):O("",!0),l(r).hasCollapsable?(d(),R(Bn,{key:1,collapsed:a.value,"onUpdate:collapsed":p[1]||(p[1]=I=>a.value=I),total:l(r).totalCollapsable},null,8,["collapsed","total"])):O("",!0)])]),c.value?(d(),R(h,Re({key:0},m.$attrs,{class:"overflow-y-auto px-3 py-4",resizeable:"","initial-height-class":"h-[7rem]",collapsed:a.value,fields:l(r),"resource-name":e.resourceName,"resource-id":e.resourceId,resource:e.resource}),null,16,["collapsed","fields","resource-name","resource-id","resource"])):O("",!0)],512),[[Y,c.value]])]),_:1},8,["show","class"])}}}),bN={__name:"CompaniesViewMedia",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=Me("synchronizeResource");return(n,a)=>St([e.resource.media.map(r=>r.updated_at)],()=>s(kn,{"resource-name":e.resourceName,"resource-id":e.resourceId,media:e.resource.media,"authorize-delete":e.resource.authorizations.update,onDeleted:a[0]||(a[0]=r=>l(t)({media:{id:r.id,_delete:!0}})),onUploaded:a[1]||(a[1]=r=>l(t)({media:[r]}))},null,8,["resource-name","resource-id","media","authorize-delete"]),a,2)}},hN={class:"mx-auto max-w-7xl"},_N={key:1,class:"relative"},gN={class:"overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},yN={class:"bg-white px-3 py-4 dark:bg-neutral-900 sm:p-6"},xN={class:"flex grow flex-col lg:flex-row lg:items-center"},IN={class:"overflow-hidden text-center lg:flex lg:grow lg:items-center lg:space-x-4 lg:text-left"},kN={class:"space-y-2 overflow-hidden lg:space-y-0"},$N={class:"lg:flex lg:items-center lg:space-x-4"},wN={class:"relative truncate"},CN=["textContent"],SN=o("button",{type:"button",class:"hide absolute left-1/2 top-1/2 mt-3 h-0 w-0 -translate-x-1/2 -translate-y-1/2 transform"},null,-1),RN={class:"p-4"},FN={class:"flex justify-end space-x-1 bg-neutral-100 px-4 py-3 dark:bg-neutral-900"},VN={class:"inline-block lg:shrink-0"},TN=["href"],DN={class:"ml-6 flex shrink-0 flex-col items-center lg:flex-row lg:space-x-3"},qN={class:"mt-5 flex shrink-0 justify-center space-x-3 lg:mt-0 lg:items-center lg:justify-normal"},EN={key:0,class:"absolute -top-5 right-2 rotate-90 lg:-right-6 lg:top-1.5 lg:rotate-0"},AN={key:2,class:"mt-8"},BN={class:"lg:grid lg:grid-cols-12 lg:gap-8"},NN={class:"col-span-4 space-y-3"},ON={class:"col-span-8 mt-4 lg:mt-0"},zN={__name:"CompaniesView",setup(e){const t={"timeline-tab":oa,"timeline-tab-panel":la},n={"details-section":vN,"deals-section":iN,"contacts-section":sN,"media-section":bN,"child-companies-section":lN},a=Innoclapps.resourceName("companies"),r=Qe(),i=Ye(),{form:u}=Ae(),c=q(null),m=q(!1),p=q(Innoclapps.resource("companies").pages.detail),f=i.query.section?p.value.tabs.findIndex(E=>E.id===i.query.section):0,h=V(()=>i.params.id),{resource:g,resourceSingularName:y,synchronizeResource:_,detachResourceAssociations:I,incrementResourceCount:F,decrementResourceCount:$,fetchResource:C,updateResource:w,resourceReady:x}=fo(a,h);mt("synchronizeResource",_),mt("detachResourceAssociations",I),mt("incrementResourceCount",F),mt("decrementResourceCount",$),Ut(V(()=>g.value.display_name)),rt("refresh-details-view",()=>C()),rt("floating-resource-updated",()=>C());const A=V(()=>p.value.sections.filter(E=>E.enabled===!0));function N(E){E.destroyable?r.push({name:"company-index"}):C()}function T(){w(u).then(()=>c.value.hide())}return C(),(E,B)=>{const z=v("IAlert"),M=v("IFormError"),j=v("IFormGroup"),U=v("IButton"),P=v("IPopover"),H=v("Icon"),L=v("IDropdownItem"),Z=v("IMinimalDropdown"),J=v("ITabList"),K=v("ITabPanels"),G=v("ITabGroup"),oe=v("router-view"),pe=v("ILayout");return d(),R(pe,{overlay:!l(x)},{default:b(()=>[o("div",hN,[l(x)&&E.$gate.denies("view",l(g))?(d(),R(z,{key:0,class:"mb-6",variant:"warning"},{default:b(()=>[Q(S(E.$t("core::role.view_non_authorized_after_record_create")),1)]),_:1})):O("",!0),l(x)?(d(),k("div",_N,[o("div",gN,[o("div",yN,[o("div",xN,[o("div",IN,[s(Qs,{class:"lg:shrink-0 lg:self-start"}),o("div",kN,[o("div",$N,[o("h1",wN,[o("span",{class:X(["text-2xl font-bold text-neutral-900 dark:text-white",{"cursor-pointer rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-700":l(g).authorizations.update}]),onClick:B[0]||(B[0]=ue=>l(g).authorizations.update&&E.$refs.namePopoverRef.show()),textContent:S(l(g).display_name)},null,10,CN),l(g).authorizations.update?(d(),R(P,{key:0,ref_key:"namePopoverRef",ref:c,class:"w-72",onShow:B[4]||(B[4]=ue=>l(u).name=l(g).name),onHide:B[5]||(B[5]=ue=>l(u).errors.clear())},{popper:b(()=>[o("div",RN,[s(j,{required:"",label:E.$t("contacts::fields.companies.name"),"label-for":"editCompanyName"},{default:b(()=>[(d(),R(We(l(g).name.length<=60?"IFormInput":"IFormTextarea"),{id:"editCompanyName",modelValue:l(u).name,"onUpdate:modelValue":B[1]||(B[1]=ue=>l(u).name=ue),class:"font-normal",onKeydown:[Tt(T,["enter"]),B[2]||(B[2]=ue=>l(u).errors.clear("name"))]},null,40,["modelValue","onKeydown"])),s(M,{textContent:S(l(u).getError("name"))},null,8,["textContent"])]),_:1},8,["label"])]),o("div",FN,[s(U,{size:"sm",variant:"white",disabled:l(u).busy,text:E.$t("core::app.cancel"),onClick:B[3]||(B[3]=()=>E.$refs.namePopoverRef.hide())},null,8,["disabled","text"]),s(U,{size:"sm",variant:"primary",loading:l(u).busy,disabled:l(u).busy||!l(u).name,text:E.$t("core::app.save"),onClick:T},null,8,["loading","disabled","text"])])]),default:b(()=>[SN]),_:1},512)):O("",!0)]),o("div",VN,[s(Wo,{simple:!0,disabled:!l(g).authorizations.update,class:"mt-0.5",type:"contacts","model-value":l(g).tags,"onUpdate:modelValue":B[6]||(B[6]=ue=>l(w)({tags:ue}))},null,8,["disabled","model-value"])])]),l(g).domain?(d(),k("a",{key:0,href:"http://"+l(g).domain,target:"_blank",rel:"noopener noreferrer",class:"link inline-flex items-center text-sm"},[Q(S(l(g).domain)+" ",1),s(H,{icon:"ExternalLink",class:"ml-1 h-4 w-4"})],8,TN)):O("",!0)])]),o("div",DN,[B[7]||(he(-1),B[7]=D(s(U,{variant:"success",class:"mr-3 mt-5 lg:mt-0 lg:shrink-0",icon:"Plus",to:{name:"createDealViaCompany"},text:E.$t("deals::deal.add")},null,8,["text"]),[[Y,l(g).authorizations.update]]),he(1),B[7]),o("div",qN,[s(aa,{owner:l(g).user,"authorize-update":l(g).authorizations.update,onChange:B[8]||(B[8]=ue=>l(w)({user_id:ue.id}))},null,8,["owner","authorize-update"]),s(Qn,{type:"dropdown",ids:l(g).id||[],actions:l(g).actions||[],"resource-name":l(a),onRun:N},null,8,["ids","actions","resource-name"])])])])])]),B[9]||(he(-1),B[9]=E.$gate.isSuperAdmin()?(d(),k("div",EN,[s(Z,{placement:"bottom-end"},{default:b(()=>[s(L,{text:E.$t("core::app.record_view.manage_sidebar"),onClick:ue=>m.value=!0},null,8,["text","onClick"])]),_:1})])):O("",!0),he(1),B[9])])):O("",!0),l(x)?(d(),k("div",AN,[o("div",BN,[o("div",NN,[(d(!0),k(te,null,re(A.value,ue=>D((d(),k("div",{key:ue.id},[(d(),R(We(Object.hasOwn(n,ue.component)?n[ue.component]:ue.component),{"resource-name":l(a),"resource-id":l(g).id,resource:l(g),onUpdated:B[10]||(B[10]=ee=>l(_)(ee,!0))},null,40,["resource-name","resource-id","resource"]))])),[[Y,!m.value]])),128)),s(na,{sections:p.value.sections,"onUpdate:sections":B[11]||(B[11]=ue=>p.value.sections=ue),show:m.value,"onUpdate:show":B[12]||(B[12]=ue=>m.value=ue),identifier:l(y),class:"-mt-3 inline",onSaved:B[13]||(B[13]=ue=>m.value=!1)},null,8,["sections","show","identifier"])]),o("div",ON,[s(G,{"default-index":l(f)},{default:b(()=>[s(J,{centered:"",bordered:!1,"list-wrapper-class":"rounded-md border border-neutral-200 bg-white py-0.5 shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},{default:b(()=>[(d(!0),k(te,null,re(p.value.tabs,ue=>(d(),R(We(Object.hasOwn(t,ue.component)?t[ue.component]:ue.component),{key:ue.id,"resource-name":l(a),"resource-id":l(g).id,resource:l(g)},null,8,["resource-name","resource-id","resource"]))),128))]),_:1}),s(K,null,{default:b(()=>[(d(!0),k(te,null,re(p.value.tabs,ue=>(d(),R(We(Object.hasOwn(t,ue.panelComponent)?t[ue.panelComponent]:ue.panelComponent),{id:"tabPanel-"+ue.id,key:ue.id,"resource-name":l(a),"resource-id":l(g).id,resource:l(g),"scroll-element":"#main"},null,8,["id","resource-name","resource-id","resource"]))),128))]),_:1})]),_:1},8,["default-index"])])])])):O("",!0)]),l(x)?(d(),R(oe,{key:0,"via-resource":l(a),"parent-resource":l(g),"go-to-list":!1,onAssociated:B[14]||(B[14]=ue=>(l(C)(),E.$router.back())),onCreated:B[15]||(B[15]=({isRegularAction:ue})=>(ue&&E.$router.back(),l(C)())),onModalHidden:E.$router.back},null,8,["via-resource","parent-resource","onModalHidden"])):O("",!0)]),_:1},8,["overlay"])}}},MN={key:0,class:"mb-4 rounded-md border border-success-400 px-4 py-3"},Cl={__name:"ContactsCreate",props:{viaResource:String,parentResource:Object},emits:["associated"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("contacts"),{t:r}=ve(),{fields:i}=gt([{asyncUrl:"/contacts/search",attribute:"contacts",formComponent:"FormSelectField",helpText:r("contacts::contact.associate_field_info"),helpTextDisplay:"text",label:r("contacts::contact.contact"),labelKey:"display_name",valueKey:"id",lazyLoad:{url:"/contacts",params:{order:"created_at|desc"}}}]),{form:u}=It(i),c=V(()=>!!i.value.find("contacts").currentValue),m=V(()=>n.viaResource?c.value?r("contacts::contact.associate_with",{name:n.parentResource.display_name}):r("contacts::contact.create_with",{name:n.parentResource.display_name}):r("contacts::contact.create"));async function p(){await u.hydrate().set({contacts:[u.contacts]}).put(`associations/${n.viaResource}/${n.parentResource.id}`),t("associated",u.contacts[0]),Innoclapps.success(r("core::resource.associated"))}n.viaResource||Ut(r("contacts::contact.create"));function f(h){n.viaResource&&h.value.updateValue(n.viaResource,[n.parentResource])}return(h,g)=>{const y=v("FormFields"),_=v("CreateContactModal");return d(),R(_,{title:m.value,"ok-title":c.value?h.$t("core::app.associate"):h.$t("core::app.create"),"fields-visible":!c.value,"with-extended-submit-buttons":!c.value,"create-using":I=>c.value?p():I(),onReady:f},{top:b(({isReady:I})=>[e.viaResource?D((d(),k("div",MN,[s(y,{fields:l(i),"form-id":l(u).formId,"resource-name":l(a)},null,8,["fields","form-id","resource-name"])],512)),[[Y,I]]):O("",!0)]),_:1},8,["title","ok-title","fields-visible","with-extended-submit-buttons","create-using"])}}},UN={class:"ml-auto flex items-center text-sm"},PN={class:"font-medium text-neutral-800 dark:text-neutral-300"},jN={__name:"ContactsTable",props:{tableId:{required:!0,type:String},initialize:{default:!0,type:Boolean}},emits:["deleted","loaded"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("contacts"),{t:r}=ve(),{reloadTable:i}=Bt(),{floatResourceInEditMode:u}=an(),{deleteResource:c}=Je(a),m=q(null);async function p(f){await Innoclapps.dialog().confirm(),await c(f),t("deleted",f),i(n.tableId),Innoclapps.success(r("core::resource.deleted"))}return(f,h)=>{const g=v("CreateActivityModal"),y=ae("t");return d(),k(te,null,[e.initialize?(d(),R(l(tn),{key:0,"resource-name":l(a),"table-id":e.tableId,"empty-state":{to:{name:"create-contact"},title:f.$t("contacts::contact.empty_state.title"),buttonText:f.$t("contacts::contact.create"),description:f.$t("contacts::contact.empty_state.description"),secondButtonText:f.$t("core::import.from_file",{file_type:"CSV"}),secondButtonIcon:"DocumentAdd",secondButtonTo:{name:"import-resource",params:{resourceName:l(a)}}},onLoaded:h[0]||(h[0]=_=>f.$emit("loaded",_))},{"after-search":b(({collection:_})=>[o("div",UN,[D(o("span",PN,null,512),[[y,{path:"contacts::contact.count.all",args:{count:_.state.meta.total}}]])])]),actions:b(({row:_})=>[s(Mn,null,{default:b(()=>[s(Ft,{tooltip:f.$t("activities::activity.create"),icon:"Clock",onClick:I=>m.value={..._,name:_.display_name}},null,8,["tooltip","onClick"]),_.authorizations.update?(d(),R(Ft,{key:0,tooltip:f.$t("core::app.edit"),icon:"PencilAlt",onClick:I=>l(u)({resourceName:l(a),resourceId:_.id})},null,8,["tooltip","onClick"])):O("",!0),_.authorizations.delete?(d(),R(Ft,{key:1,tooltip:f.$t("core::app.delete"),icon:"Trash",onClick:I=>p(_.id)},null,8,["tooltip","onClick"])):O("",!0)]),_:2},1024)]),_:1},8,["resource-name","table-id","empty-state"])):O("",!0),s(g,{visible:m.value!==null,contacts:[m.value],"with-extended-submit-buttons":!0,"go-to-list":!1,onCreated:h[1]||(h[1]=({isRegularAction:_})=>(_&&(m.value=null),l(i)(e.tableId))),onModalHidden:h[2]||(h[2]=_=>m.value=null)},null,8,["visible","contacts"])],64)}}},LN={class:"inline-flex items-center"},HN={class:"mr-3 lg:mr-6"},Ro="contacts",GN={__name:"ContactsIndex",setup(e){const t=Innoclapps.resourceName("contacts"),n=Ye(),{reloadTable:a,customizeTable:r}=Bt(),i=q(n.meta.initialize),u=q(!0),c=V(()=>i.value&&!u.value);function m(){Innoclapps.$emit("refresh-cards"),a(Ro)}return yn((p,f,h)=>{i.value=!0,h()}),(p,f)=>{const h=v("NavbarSeparator"),g=v("IDropdownItem"),y=v("IMinimalDropdown"),_=v("IButton"),I=v("router-view"),F=v("ILayout");return d(),R(F,null,{actions:b(()=>[s(h,{class:"hidden lg:block"}),o("div",LN,[o("div",HN,[s(y,{type:"horizontal"},{default:b(()=>[s(g,{icon:"DocumentAdd",to:{name:"import-resource",params:{resourceName:l(t)}},text:p.$t("core::import.import")},null,8,["to","text"]),p.$gate.userCan("export contacts")?(d(),R(g,{key:0,icon:"DocumentDownload",text:p.$t("core::app.export.export"),onClick:f[0]||(f[0]=$=>p.$iModal.show("export-modal"))},null,8,["text"])):O("",!0),s(g,{icon:"Trash",to:{name:"trashed-resource-records",params:{resourceName:l(t)}},text:p.$t("core::app.soft_deletes.trashed")},null,8,["to","text"]),s(g,{icon:"Cog",text:p.$t("core::table.list_settings"),onClick:f[1]||(f[1]=$=>l(r)(Ro))},null,8,["text"])]),_:1})]),s(_,{to:{name:"create-contact"},icon:"Plus",size:"sm",text:p.$t("contacts::contact.create")},null,8,["text"])])]),default:b(()=>[c.value?(d(),R(nl,{key:0,"resource-name":l(t)},null,8,["resource-name"])):O("",!0),s(jN,{"table-id":Ro,initialize:i.value,onLoaded:f[2]||(f[2]=$=>u.value=$.empty),onDeleted:m},null,8,["initialize"]),s(l(go),{"url-path":"/contacts/export","resource-name":l(t),"filters-view":Ro,title:p.$t("contacts::contact.export")},null,8,["resource-name","title"]),s(I,{name:"create","redirect-to-view":!0,onCreated:f[3]||(f[3]=({isRegularAction:$})=>$?void 0:m()),onModalHidden:p.$router.back},null,8,["onModalHidden"])]),_:1})}}},KN={class:"px-4 py-5 sm:px-6"},YN={__name:"ContactsViewCompanies",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>St([e.resource.companies.map(a=>a.updated_at)],()=>(d(),k("div",{class:"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},[o("div",KN,[s(Xs,{"contact-id":e.resourceId,companies:e.resource.companies,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onCreateRequested:n[0]||(n[0]=a=>t.$router.push({name:"createCompanyViaContact",params:{id:e.resourceId}}))},null,8,["contact-id","companies","authorize-dissociate","show-create-button"])])])),n,1)}},WN={class:"px-4 py-5 sm:px-6"},QN={__name:"ContactsViewDeals",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>St([e.resource.deals.map(a=>a.updated_at)],()=>(d(),k("div",{class:"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},[o("div",WN,[s(Zs,{"contact-id":e.resourceId,deals:e.resource.deals,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onCreateRequested:n[0]||(n[0]=a=>t.$router.push({name:"createDealViaContact",params:{id:e.resourceId}}))},null,8,["contact-id","deals","authorize-dissociate","show-create-button"])])])),n,1)}},XN={class:"overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},ZN={class:"flex items-center justify-between px-6 py-3"},JN={class:"inline-flex items-center"},eO={key:0,class:"mr-2 block h-2 w-2 rounded-full bg-danger-500"},tO={class:"font-medium text-neutral-800 dark:text-white"},nO={class:"flex items-center space-x-3"},oO=Object.assign({inheritAttrs:!1},{__name:"ContactsViewDetails",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=e,n=Innoclapps.config("fields.views.detail"),a=q(!0),{fields:r,getDetailFields:i}=gt(),{floatResourceInEditMode:u}=an();i(t.resourceName,t.resource.id).then(m=>r.value.set(m).populate(t.resource));const c=V(()=>r.value.isNotEmpty());return(m,p)=>{const f=v("IButtonIcon"),h=v("DetailFields"),g=v("IOverlay"),y=ae("t"),_=ae("i-tooltip");return d(),R(g,{show:!c.value,class:X({"rounded-lg bg-white p-6 shadow dark:bg-neutral-900":!c.value})},{default:b(()=>[D(o("div",XN,[o("div",ZN,[o("div",JN,[l(r).requiredFieldsMissingValues?(d(),k("span",eO)):O("",!0),D(o("h2",tO,null,512),[[y,"core::app.record_view.sections.details"]])]),o("div",nO,[s(f,{size:"sm",icon:"PencilAlt","icon-class":"h-[1.03rem] w-[1.03rem]",onClick:p[0]||(p[0]=I=>l(u)({resourceName:e.resourceName,resourceId:e.resourceId}))}),m.$gate.isSuperAdmin()?D((d(),R(f,{key:0,size:"sm",to:{name:"resource-fields",params:{resourceName:e.resourceName},query:{view:l(n)}},icon:"AdjustmentsVertical","icon-class":"h-[1.1rem] w-[1.1rem]"},null,8,["to"])),[[_,m.$t("core::fields.manage")]]):O("",!0),l(r).hasCollapsable?(d(),R(Bn,{key:1,collapsed:a.value,"onUpdate:collapsed":p[1]||(p[1]=I=>a.value=I),total:l(r).totalCollapsable},null,8,["collapsed","total"])):O("",!0)])]),c.value?(d(),R(h,Re({key:0},m.$attrs,{class:"overflow-y-auto px-3 py-4",resizeable:"","initial-height-class":"h-[10rem]",collapsed:a.value,fields:l(r),"resource-name":e.resourceName,"resource-id":e.resourceId,resource:e.resource}),null,16,["collapsed","fields","resource-name","resource-id","resource"])):O("",!0)],512),[[Y,c.value]])]),_:1},8,["show","class"])}}}),lO={__name:"ContactsViewMedia",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=Me("synchronizeResource");return(n,a)=>St([e.resource.media.map(r=>r.updated_at)],()=>s(kn,{"resource-name":e.resourceName,"resource-id":e.resourceId,media:e.resource.media,"authorize-delete":e.resource.authorizations.update,onDeleted:a[0]||(a[0]=r=>l(t)({media:{id:r.id,_delete:!0}})),onUploaded:a[1]||(a[1]=r=>l(t)({media:[r]}))},null,8,["resource-name","resource-id","media","authorize-delete"]),a,2)}},aO={class:"mx-auto max-w-7xl"},sO={key:1,class:"relative"},rO={class:"overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},iO={class:"bg-white px-3 py-4 dark:bg-neutral-900 sm:p-6"},uO={class:"flex grow flex-col lg:flex-row lg:items-center"},dO={class:"overflow-hidden text-center lg:flex lg:grow lg:items-center lg:space-x-4 lg:text-left"},cO={class:"space-y-2 overflow-hidden lg:space-y-0"},mO={class:"lg:flex lg:items-center lg:space-x-4"},pO={class:"relative truncate"},fO=["textContent"],vO=o("button",{type:"button",class:"hide absolute left-1/2 top-1/2 mt-3 h-0 w-0 -translate-x-1/2 -translate-y-1/2 transform"},null,-1),bO={class:"p-4"},hO={class:"flex justify-end space-x-1 bg-neutral-100 px-4 py-3 dark:bg-neutral-900"},_O={class:"inline-block lg:shrink-0"},gO={key:0,class:"block overflow-hidden truncate text-sm text-neutral-500 dark:text-neutral-200"},yO={class:"ml-6 flex shrink-0 flex-col items-center lg:flex-row lg:space-x-3"},xO={class:"mt-5 flex shrink-0 justify-center space-x-3 lg:mt-0 lg:items-center lg:justify-normal"},IO={key:0,class:"absolute -top-5 right-2 rotate-90 lg:-right-6 lg:top-1.5 lg:rotate-0"},kO={key:2,class:"mt-8"},$O={class:"lg:grid lg:grid-cols-12 lg:gap-8"},wO={class:"col-span-4 space-y-3"},CO={class:"col-span-8 mt-4 lg:mt-0"},SO={__name:"ContactsView",setup(e){const t={"timeline-tab":oa,"timeline-tab-panel":la},n={"details-section":oO,"deals-section":QN,"companies-section":YN,"media-section":lO},a=Innoclapps.resourceName("contacts"),r=Qe(),i=Ye(),{form:u}=Ae({first_name:null,last_name:null}),c=q(null),m=q(!1),p=q(Innoclapps.resource("contacts").pages.detail),f=i.query.section?p.value.tabs.findIndex(B=>B.id===i.query.section):0,h=V(()=>i.params.id),{resource:g,resourceSingularName:y,synchronizeResource:_,detachResourceAssociations:I,incrementResourceCount:F,decrementResourceCount:$,fetchResource:C,updateResource:w,resourceReady:x}=fo(a,h);mt("synchronizeResource",_),mt("detachResourceAssociations",I),mt("incrementResourceCount",F),mt("decrementResourceCount",$),Ut(V(()=>g.value.display_name)),rt("refresh-details-view",()=>C()),rt("floating-resource-updated",()=>C());const A=V(()=>g.value.companies.length==1),N=V(()=>p.value.sections.filter(B=>B.enabled===!0));function T(B){B.destroyable?r.push({name:"contact-index"}):C()}function E(){w(u).then(()=>c.value.hide())}return C(),(B,z)=>{const M=v("IAlert"),j=v("IAvatar"),U=v("IFormInput"),P=v("IFormError"),H=v("IFormGroup"),L=v("IButton"),Z=v("IPopover"),J=v("IDropdownItem"),K=v("IMinimalDropdown"),G=v("ITabList"),oe=v("ITabPanels"),pe=v("ITabGroup"),ue=v("router-view"),ee=v("ILayout");return d(),R(ee,{overlay:!l(x)},{default:b(()=>[o("div",aO,[l(x)&&B.$gate.denies("view",l(g))?(d(),R(M,{key:0,class:"mb-6",variant:"warning"},{default:b(()=>[Q(S(B.$t("core::role.view_non_authorized_after_record_create")),1)]),_:1})):O("",!0),l(x)?(d(),k("div",sO,[o("div",rO,[o("div",iO,[o("div",uO,[o("div",dO,[s(j,{src:l(g).avatar_url,title:l(g).name,class:"lg:shrink-0 lg:self-start"},null,8,["src","title"]),o("div",cO,[o("div",mO,[o("h1",pO,[o("span",{class:X(["text-2xl font-bold text-neutral-900 dark:text-white",{"cursor-pointer rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-700":l(g).authorizations.update}]),onClick:z[0]||(z[0]=W=>l(g).authorizations.update&&B.$refs.namePopoverRef.show()),textContent:S(l(g).display_name)},null,10,fO),l(g).authorizations.update?(d(),R(Z,{key:0,ref_key:"namePopoverRef",ref:c,class:"w-72",onShow:z[6]||(z[6]=W=>{l(u).first_name=l(g).first_name,l(u).last_name=l(g).last_name}),onHide:z[7]||(z[7]=W=>l(u).errors.clear())},{popper:b(()=>[o("div",bO,[s(H,{required:"",label:B.$t("contacts::fields.contacts.first_name"),"label-for":"editFirstName"},{default:b(()=>[s(U,{id:"editFirstName",modelValue:l(u).first_name,"onUpdate:modelValue":z[1]||(z[1]=W=>l(u).first_name=W),class:"font-normal",onKeydown:[Tt(E,["enter"]),z[2]||(z[2]=W=>l(u).errors.clear("first_name"))]},null,8,["modelValue","onKeydown"]),s(P,{textContent:S(l(u).getError("first_name"))},null,8,["textContent"])]),_:1},8,["label"]),s(H,{label:B.$t("contacts::fields.contacts.last_name"),"label-for":"editLastName"},{default:b(()=>[s(U,{id:"editLastName",modelValue:l(u).last_name,"onUpdate:modelValue":z[3]||(z[3]=W=>l(u).last_name=W),class:"font-normal",onKeydown:[Tt(E,["enter"]),z[4]||(z[4]=W=>l(u).errors.clear("last_name"))]},null,8,["modelValue","onKeydown"]),s(P,{textContent:S(l(u).getError("last_name"))},null,8,["textContent"])]),_:1},8,["label"])]),o("div",hO,[s(L,{size:"sm",variant:"white",disabled:l(u).busy,text:B.$t("core::app.cancel"),onClick:z[5]||(z[5]=()=>B.$refs.namePopoverRef.hide())},null,8,["disabled","text"]),s(L,{size:"sm",variant:"primary",loading:l(u).busy,disabled:l(u).busy||!l(u).first_name,text:B.$t("core::app.save"),onClick:E},null,8,["loading","disabled","text"])])]),default:b(()=>[vO]),_:1},512)):O("",!0)]),o("div",_O,[s(Wo,{simple:!0,disabled:!l(g).authorizations.update,class:"mt-0.5",type:"contacts","model-value":l(g).tags,"onUpdate:modelValue":z[8]||(z[8]=W=>l(w)({tags:W}))},null,8,["disabled","model-value"])])]),l(g).job_title?(d(),k("span",gO,S(A.value?B.$t("contacts::contact.works_at",{job_title:l(g).job_title,company:l(g).companies[0].name}):l(g).job_title),1)):O("",!0)])]),o("div",yO,[z[9]||(he(-1),z[9]=D(s(L,{variant:"success",class:"mr-3 mt-5 lg:mt-0 lg:shrink-0",icon:"Plus",to:{name:"createDealViaContact"},text:B.$t("deals::deal.add")},null,8,["text"]),[[Y,l(g).authorizations.update]]),he(1),z[9]),o("div",xO,[s(aa,{owner:l(g).user,"authorize-update":l(g).authorizations.update,onChange:z[10]||(z[10]=W=>l(w)({user_id:W.id}))},null,8,["owner","authorize-update"]),s(Qn,{type:"dropdown",ids:l(g).id||[],actions:l(g).actions||[],"resource-name":l(a),onRun:T},null,8,["ids","actions","resource-name"])])])])])]),z[11]||(he(-1),z[11]=B.$gate.isSuperAdmin()?(d(),k("div",IO,[s(K,{placement:"bottom-end"},{default:b(()=>[s(J,{text:B.$t("core::app.record_view.manage_sidebar"),onClick:W=>m.value=!0},null,8,["text","onClick"])]),_:1})])):O("",!0),he(1),z[11])])):O("",!0),l(x)?(d(),k("div",kO,[o("div",$O,[o("div",wO,[(d(!0),k(te,null,re(N.value,W=>D((d(),k("div",{key:W.id},[(d(),R(We(Object.hasOwn(n,W.component)?n[W.component]:W.component),{"resource-name":l(a),"resource-id":l(g).id,resource:l(g),onUpdated:z[12]||(z[12]=ne=>l(_)(ne,!0))},null,40,["resource-name","resource-id","resource"]))])),[[Y,!m.value]])),128)),s(na,{sections:p.value.sections,"onUpdate:sections":z[13]||(z[13]=W=>p.value.sections=W),show:m.value,"onUpdate:show":z[14]||(z[14]=W=>m.value=W),identifier:l(y),class:"-mt-3 inline",onSaved:z[15]||(z[15]=W=>m.value=!1)},null,8,["sections","show","identifier"])]),o("div",CO,[s(pe,{"default-index":l(f)},{default:b(()=>[s(G,{centered:"",bordered:!1,"list-wrapper-class":"rounded-md border border-neutral-200 bg-white py-0.5 shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},{default:b(()=>[(d(!0),k(te,null,re(p.value.tabs,W=>(d(),R(We(Object.hasOwn(t,W.component)?t[W.component]:W.component),{key:W.id,"resource-name":l(a),"resource-id":l(g).id,resource:l(g)},null,8,["resource-name","resource-id","resource"]))),128))]),_:1}),s(oe,null,{default:b(()=>[(d(!0),k(te,null,re(p.value.tabs,W=>(d(),R(We(Object.hasOwn(t,W.panelComponent)?t[W.panelComponent]:W.panelComponent),{id:"tabPanel-"+W.id,key:W.id,"resource-name":l(a),"resource-id":l(g).id,resource:l(g),"scroll-element":"#main"},null,8,["id","resource-name","resource-id","resource"]))),128))]),_:1})]),_:1},8,["default-index"])])])])):O("",!0)]),l(x)?(d(),R(ue,{key:0,"via-resource":l(a),"parent-resource":l(g),"go-to-list":!1,onAssociated:z[16]||(z[16]=W=>(l(C)(),B.$router.back())),onCreated:z[17]||(z[17]=({isRegularAction:W})=>(W&&B.$router.back(),l(C)())),onModalHidden:B.$router.back},null,8,["via-resource","parent-resource","onModalHidden"])):O("",!0)]),_:1},8,["overlay"])}}},RO=[{path:"/companies",name:"company-index",component:dB,meta:{title:qe.t("contacts::company.companies"),initialize:!1},beforeEnter:(e,t)=>{e.meta.initialize=e.name==="company-index"},children:[{path:"create",name:"create-company",components:{create:wl},meta:{title:qe.t("contacts::company.create")}}]},{path:"/companies/:id",name:"view-company",component:zN,children:[{path:"contacts/create",component:Cl,name:"createContactViaCompany"},{path:"deals/create",component:$l,name:"createDealViaCompany"}].map(e=>Object.assign(e,{meta:{scrollToTop:!1}}))},{path:"/contacts",name:"contact-index",component:GN,meta:{title:qe.t("contacts::contact.contacts"),initialize:!1},beforeEnter:(e,t)=>{e.meta.initialize=e.name==="contact-index"},children:[{path:"create",name:"create-contact",components:{create:Cl},meta:{title:qe.t("contacts::contact.create")}}]},{path:"/contacts/:id",name:"view-contact",component:SO,children:[{path:"companies/create",component:wl,name:"createCompanyViaContact"},{path:"deals/create",component:$l,name:"createDealViaContact"}].map(e=>Object.assign(e,{meta:{scrollToTop:!1}}))}];window.Innoclapps&&Innoclapps.booting(function(e,t){e.component("CompanyFloatingModal",c6),e.component("ContactFloatingModal",w6),e.component("CreateCompanyModal",E6),e.component("CreateContactModal",U6),e.component("FormPhoneField",tB),e.component("DetailPhoneField",H6),e.component("IndexPhoneField",js),RO.forEach(n=>t.addRoute(n)),t.addRoute("settings",{path:"companies",component:P6,name:"settings-companies",meta:{title:qe.t("contacts::company.companies")}})});const FO={key:0,class:"mb-4 border-b border-neutral-200 pb-8"},VO={class:"mb-5 inline-flex items-center text-base font-medium text-neutral-800"},TO=["onClick"],DO={class:"-mt-2 block text-right"},qO={class:"-mt-2 block text-right"},EO={class:"-mt-2 block text-right"},AO=["onClick"],BO=["onClick"],NO={__name:"CreateDealModal",props:{visible:{type:Boolean,default:!0},goToList:{type:Boolean,default:!0},redirectToView:Boolean,createUsing:Function,withExtendedSubmitButtons:Boolean,fieldsVisible:{type:Boolean,default:!0},title:String,disabledFields:[Array,String],hiddenFields:[Array,String],associations:Object,pipeline:Object,stageId:Number,name:String,contacts:Array,companies:Array},emits:["created","modal-shown","modal-hidden","update:visible","ready"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("deals"),{t:r}=ve(),i=Qe(),u=q(!1),c=q(!1),m=q(!1),{fields:p,getCreateFields:f}=gt(),{form:h}=It(p,{billable:{tax_type:Innoclapps.config("options.tax_type"),products:[]}}),{createResource:g}=Je(a),y=Kn(()=>null,()=>document.querySelector("#modalClose-createDealModal"));mn(()=>n.visible,B,{immediate:!0});function _(z){if(z.indexRoute={name:"deal-index"},z.action==="go-to-list")return i.push(z.indexRoute);if(z.action!=="create-another"&&n.redirectToView){let M=z.deal;i.deal=M,i.push({name:"view-deal",params:{id:M.id}})}}function I(){t("modal-shown"),y.trigger()}function F(){t("modal-hidden"),m.value=!1,$(),p.value.set([]),h.reset()}function $(){h.billable.products=[],h.billable.tax_type=Innoclapps.config("options.tax_type")}function C(){m.value=!0,p.value.update("amount",{readonly:!0})}function w(){m.value=!1,p.value.update("amount",{readonly:!1})}function x(z){h.errors.has("billable.products."+z.index+".name")&&h.errors.clear("billable.products."+z.index+".name")}function A(){E().then(_)}function N(){E("create-another").then(z=>{h.reset(),_(z)})}function T(){E("go-to-list").then(_)}async function E(z=null){m.value||$(),n.associations&&h.fill(n.associations);let j={deal:await g(h).catch(U=>(U.isValidationError()&&Innoclapps.error(r("core::app.form_validation_failed"),3e3),Promise.reject(U))),isRegularAction:z===null,action:z};return t("created",j),Innoclapps.success(r("core::resource.created")),j}async function B(){let z=nt(await f(a));["contacts","companies","name"].forEach(M=>{n[M]&&(z[Xe(z,["attribute",M])].value=n[M])}),n.pipeline&&(z[Xe(z,["attribute","pipeline_id"])].value=n.pipeline,n.stageId||(z[Xe(z,["attribute","stage_id"])].value=n.pipeline.stages[0])),n.stageId&&(z[Xe(z,["attribute","stage_id"])].value=n.stageId?Ee(n.pipeline.stages,M=>M.id===n.stageId):null),p.value.set(z),n.disabledFields&&wt(n.disabledFields).forEach(M=>p.value.update(M,{readonly:!0})),n.hiddenFields&&wt(n.hiddenFields).forEach(M=>p.value.update(M,{displayNone:!0})),t("ready",p)}return(z,M)=>{const j=v("FieldsPlaceholder"),U=v("IFormError"),P=v("FormFields"),H=v("IDropdownItem"),L=v("IDropdownButtonGroup"),Z=v("CreateContactModal"),J=v("CreateCompanyModal"),K=v("ISlideover"),G=ae("t");return d(),R(K,{id:"createDealModal",visible:e.visible,title:e.title||z.$t("deals::deal.create"),"ok-title":z.$t("core::app.create"),"ok-disabled":l(h).busy,"cancel-title":z.$t("core::app.cancel"),"initial-focus":l(y),"static-backdrop":"",form:"",size:m.value?"xxl":"md",onShown:I,onHidden:F,onSubmit:M[9]||(M[9]=oe=>e.createUsing?e.createUsing(A):A()),"onUpdate:visible":M[10]||(M[10]=oe=>z.$emit("update:visible",oe))},vt({default:b(()=>[l(p).isEmpty()?(d(),R(j,{key:0})):O("",!0),de(z.$slots,"top",{isReady:l(p).isNotEmpty()}),D(o("div",null,[m.value?(d(),k("div",FO,[o("h3",VO,[D(o("span",null,null,512),[[G,"billable::product.products"]]),D(o("a",{href:"#",class:"link ml-2 mt-0.5 text-sm",onClick:ie(w,["prevent"])},null,8,TO),[[Y,m.value],[G,"deals::deal.dont_add_products"]])]),s(Zl,{modelValue:l(h).billable.tax_type,"onUpdate:modelValue":M[0]||(M[0]=oe=>l(h).billable.tax_type=oe),class:"mb-4 flex flex-col space-y-1 sm:flex-row sm:space-x-2 sm:space-y-0"},null,8,["modelValue"]),s(Xl,{products:l(h).billable.products,"onUpdate:products":M[1]||(M[1]=oe=>l(h).billable.products=oe),"tax-type":l(h).billable.tax_type,onProductSelected:M[2]||(M[2]=oe=>l(h).errors.clear("billable.products."+oe.index+".name")),onProductRemoved:x},{"after-product-select":b(({index:oe})=>[s(U,{textContent:S(l(h).getError("billable.products."+oe+".name"))},null,8,["textContent"])]),_:1},8,["products","tax-type"])])):O("",!0),s(P,{fields:l(p),"form-id":l(h).formId,"resource-name":l(a),"is-floating":"","focus-first":""},{"after-contacts-field":b(()=>[o("span",DO,[o("a",{href:"#",class:"link text-sm",onClick:M[3]||(M[3]=ie(oe=>u.value=!0,["prevent"]))}," + "+S(z.$t("contacts::contact.create")),1)])]),"after-companies-field":b(()=>[o("span",qO,[o("a",{href:"#",class:"link text-sm",onClick:M[4]||(M[4]=ie(oe=>c.value=!0,["prevent"]))}," + "+S(z.$t("contacts::company.create")),1)])]),"after-amount-field":b(()=>[o("span",EO,[D(o("a",{href:"#",class:"link text-sm",onClick:ie(C,["prevent"])}," + "+S(z.$t("deals::deal.add_products")),9,AO),[[Y,!m.value]]),D(o("a",{href:"#",class:"link text-sm",onClick:ie(w,["prevent"])},null,8,BO),[[Y,m.value],[G,"deals::deal.dont_add_products"]])])]),_:1},8,["fields","form-id","resource-name"])],512),[[Y,e.fieldsVisible]]),s(Z,{visible:u.value,"onUpdate:visible":M[5]||(M[5]=oe=>u.value=oe),overlay:!1,onCreated:M[6]||(M[6]=oe=>(l(p).mergeValue("contacts",oe.contact),u.value=!1))},null,8,["visible"]),s(J,{visible:c.value,"onUpdate:visible":M[7]||(M[7]=oe=>c.value=oe),overlay:!1,onCreated:M[8]||(M[8]=oe=>(l(p).mergeValue("companies",oe.company),c.value=!1))},null,8,["visible"])]),_:2},[e.withExtendedSubmitButtons?{name:"modal-ok",fn:b(()=>[s(L,{type:"submit",placement:"top-end",disabled:l(h).busy,loading:l(h).busy,text:z.$t("core::app.create")},{default:b(()=>[s(H,{text:z.$t("core::app.create_and_add_another"),onClick:N},null,8,["text"]),e.goToList?(d(),R(H,{key:0,text:z.$t("core::app.create_and_go_to_list"),onClick:T},null,8,["text"])):O("",!0)]),_:1},8,["disabled","loading","text"])]),key:"0"}:void 0]),1032,["visible","title","ok-title","ok-disabled","cancel-title","initial-focus","size"])}}},Js={__name:"DealCompaniesList",props:{companies:{required:!0,type:Array},dealId:{required:!0,type:Number},authorizeDissociate:{required:!0,type:Boolean},showCreateButton:{required:!0,type:Boolean}},emits:["dissociated","create-requested"],setup(e,{emit:t}){const{t:n}=ve(),a=Me("detachResourceAssociations");async function r(i){await Innoclapps.dialog().confirm(),await a({companies:[i]}),t("dissociated",i),Innoclapps.success(n("core::resource.dissociated"))}return(i,u)=>{const c=v("IButton"),m=ae("i-tooltip");return d(),R(ta,{companies:e.companies,"empty-text":i.$t("deals::deal.no_companies_associated")},{actions:b(({company:p})=>[D(s(c,{size:"sm",variant:"white",icon:"X",onClick:f=>r(p.id)},null,8,["onClick"]),[[Y,e.authorizeDissociate],[m,i.$t("contacts::company.dissociate"),void 0,{left:!0}]])]),tail:b(()=>[e.showCreateButton?(d(),R(c,{key:0,variant:"white",class:"mt-6",block:"",text:i.$t("contacts::company.add"),onClick:u[0]||(u[0]=p=>i.$emit("create-requested"))},null,8,["text"])):O("",!0)]),_:1},8,["companies","empty-text"])}}},er={__name:"DealContactsList",props:{contacts:{required:!0,type:Array},dealId:{required:!0,type:Number},authorizeDissociate:{required:!0,type:Boolean},showCreateButton:{required:!0,type:Boolean}},emits:["dissociated","create-requested"],setup(e,{emit:t}){const n=Me("detachResourceAssociations"),{t:a}=ve();async function r(i){await Innoclapps.dialog().confirm(),await n({contacts:[i]}),t("dissociated",i),Innoclapps.success(a("core::resource.dissociated"))}return(i,u)=>{const c=v("IButton"),m=ae("i-tooltip");return d(),R(Gs,{contacts:e.contacts,"empty-text":i.$t("deals::deal.no_contacts_associated")},{actions:b(({contact:p})=>[D(s(c,{size:"sm",variant:"white",icon:"X",onClick:f=>r(p.id)},null,8,["onClick"]),[[Y,e.authorizeDissociate],[m,i.$t("contacts::contact.dissociate"),void 0,{left:!0}]])]),tail:b(()=>[e.showCreateButton?(d(),R(c,{key:0,class:"mt-6",variant:"white",block:"",text:i.$t("contacts::contact.add"),onClick:u[0]||(u[0]=p=>i.$emit("create-requested"))},null,8,["text"])):O("",!0)]),_:1},8,["contacts","empty-text"])}}},sn=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,["user_display_order","is_primary","name"],["asc","desc","asc"])),r=V({get(){return a.value},set(F){const $=_t(F,(C,w)=>Object.assign({},C,{user_display_order:w+1}));c($),i($)}});function i(F){Innoclapps.request().post("/pipelines/order",{order:F.map($=>({id:$.id,display_order:$.user_display_order}))})}function u(F){return n.value.findIndex($=>$.id==F)}function c(F){n.value=F}function m(F){return n.value[u(F)]}function p(F,$){const C=m(F);return C==null?void 0:C.stages.filter(w=>Number($)===Number(w.id))[0]}function f(F){n.value.splice(u(F),1)}function h(F){n.value.push(F)}function g(F,$){n.value[u(F)]=$}async function y(F,$={}){const{data:C}=await Innoclapps.request().get(`/pipelines/${F}`,$);return C}async function _(F){await Innoclapps.request().delete(`/pipelines/${F}`),f(F)}function I(){e(!0),Innoclapps.request().get("/pipelines").then(({data:F})=>n.value=F).finally(()=>e(!1))}return{pipelines:n,orderedPipelines:a,pipelinesAreBeingFetched:t,addPipeline:h,removePipeline:f,setPipelines:c,setPipeline:g,findPipelineById:m,findPipelineStageById:p,fetchPipelines:I,fetchPipeline:y,deletePipeline:_,orderedPipelinesForDraggable:r}}),OO={class:"flex items-center"},zO={key:0},MO={type:"button",class:"flex flex-wrap items-center justify-center focus:outline-none md:flex-nowrap md:justify-start"},UO={class:"p-4"},PO={class:"flex justify-end space-x-1 bg-neutral-100 px-6 py-3 dark:bg-neutral-900"},jO={key:1,class:"flex items-center text-neutral-800 dark:text-neutral-200"},LO={key:1,class:"flex items-center text-neutral-800 dark:text-neutral-200"},tr={__name:"DealStagePopover",props:{dealId:{required:!0,type:Number},pipeline:{required:!0,type:Object},stageId:{required:!0,type:Number},status:{required:!0,type:String},authorizedToUpdate:{required:!0,type:Boolean}},emits:["updated"],setup(e,{emit:t}){const n=e,{orderedPipelines:a}=sn(),{form:r}=Ae(),{updateResource:i}=Je(Innoclapps.resourceName("deals")),u=V(()=>n.pipeline),c=V(()=>n.pipeline.stages.filter(_=>_.id==n.stageId)[0]),m=q(!1),p=dt(null),f=dt(null);async function h(){let _=await i(r.fill({pipeline_id:p.value.id,stage_id:f.value.id}),n.dealId);t("updated",_),m.value=!1}function g(){p.value=u.value,f.value=c.value}function y(_){_.id!=n.pipeline.id?f.value=_.stages[0]||null:_.id===n.pipeline.id&&(f.value=c.value)}return(_,I)=>{const F=v("Icon"),$=v("ICustomSelect"),C=v("IFormError"),w=v("IButton"),x=v("IPopover");return d(),k("div",OO,[e.authorizedToUpdate?(d(),k("div",zO,[e.status!=="lost"?(d(),R(x,{key:0,visible:m.value,"onUpdate:visible":I[5]||(I[5]=A=>m.value=A),class:"w-72",onShow:g},{popper:b(()=>[o("div",UO,[s($,{modelValue:p.value,"onUpdate:modelValue":[I[0]||(I[0]=A=>p.value=A),I[1]||(I[1]=A=>(l(r).errors.clear("pipeline_id"),l(r).errors.clear("stage_id")))],options:l(a),clearable:!1,class:"mb-2",label:"name","onOption:selected":y},null,8,["modelValue","options"]),s(C,{textContent:S(l(r).getError("pipeline_id"))},null,8,["textContent"]),s($,{modelValue:f.value,"onUpdate:modelValue":[I[2]||(I[2]=A=>f.value=A),I[3]||(I[3]=A=>l(r).errors.clear("stage_id"))],options:p.value?p.value.stages:[],clearable:!1,label:"name"},null,8,["modelValue","options"]),s(C,{textContent:S(l(r).getError("stage_id"))},null,8,["textContent"])]),o("div",PO,[s(w,{size:"sm",variant:"white",disabled:l(r).busy,text:_.$t("core::app.cancel"),onClick:I[4]||(I[4]=A=>m.value=!1)},null,8,["disabled","text"]),s(w,{size:"sm",variant:"primary",text:_.$t("core::app.save"),loading:l(r).busy,disabled:l(r).busy||!f.value,onClick:h},null,8,["text","loading","disabled"])])]),default:b(()=>[o("button",MO,[o("span",null,S(u.value.name),1),s(F,{icon:"ChevronRight",class:"h-4 w-4"}),Q(" "+S(c.value.name)+" ",1),s(F,{icon:"ChevronDown",class:"ml-1.5 hidden h-4 w-4 md:block"})])]),_:1},8,["visible"])):(d(),k("div",jO,[Q(S(u.value.name)+" ",1),s(F,{icon:"ChevronRight",class:"h-4 w-4"}),Q(" "+S(c.value.name),1)]))])):(d(),k("div",LO,[Q(S(u.value.name)+" ",1),s(F,{icon:"ChevronRight",class:"h-4 w-4"}),Q(" "+S(c.value.name),1)])),de(_.$slots,"default")])}}},sa=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name"));function r(u){n.value=u}function i(){e(!0),Innoclapps.request().get("/lost-reasons",{params:{per_page:100}}).then(({data:u})=>n.value=u.data).finally(()=>e(!1))}return{lostReasons:n,lostReasonsByName:a,lostReasonsAreBeingFetched:t,setLostReasons:r,fetchLostReasons:i}}),HO=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),GO=[HO],ra={__name:"DealLostReasonField",props:{modelValue:String,allowCustom:{type:Boolean,default(){return Innoclapps.config("options.allow_lost_reason_enter")}},attribute:{default:"lost_reason",type:String}},emits:["update:modelValue"],setup(e){const t=e,n=q(!1),{lostReasonsByName:a}=sa();return a.value.length===0&&t.allowCustom&&(n.value=!0),De(()=>{Fe(()=>{t.modelValue&&(n.value=!0)})}),(r,i)=>{const u=v("ICustomSelect"),c=v("IFormTextarea"),m=v("IFormText"),p=ae("t");return d(),k(te,null,[!n.value&&l(a).length>0||!e.allowCustom?(d(),R(u,{key:0,options:l(a),"input-id":n.value?`${e.attribute}-hidden`:e.attribute,label:"name","onUpdate:modelValue":i[0]||(i[0]=f=>r.$emit("update:modelValue",f?f.name:null))},null,8,["options","input-id"])):O("",!0),D(o("div",null,[s(c,{id:n.value?e.attribute:`${e.attribute}-hidden`,"model-value":e.modelValue,rows:"2","onUpdate:modelValue":i[1]||(i[1]=f=>r.$emit("update:modelValue",f))},null,8,["id","model-value"])],512),[[Y,n.value]]),l(a).length>0&&e.allowCustom?(d(),R(m,{key:1,class:"mt-2 inline-flex items-center space-x-1"},{default:b(()=>[D(o("a",{href:"#",tabindex:"-1",class:"focus:outline-none",onClick:i[2]||(i[2]=ie(f=>n.value=!n.value,["prevent"]))},null,512),[[p,`deals::deal.lost_reasons.${n.value?"choose_lost_reason":"choose_lost_reason_or_enter"}`]]),o("a",{href:"#",class:"link",onClick:i[3]||(i[3]=ie(f=>n.value=!n.value,["prevent"]))},GO)]),_:1})):O("",!0)],64)}}},KO={key:0},YO={class:"inline-flex"},WO={class:"flex flex-col p-4"},QO={key:1,class:"flex items-center"},nr={__name:"DealStatusChange",props:{dealId:{type:Number,required:!0},dealStatus:{type:String,required:!0}},emits:["updated"],setup(e,{emit:t}){const n=e,a=q(!1),{setting:r}=Le(),{form:i}=Ae({lost_reason:null},{resetOnSuccess:!0}),{updateResource:u}=Je(Innoclapps.resourceName("deals")),c=_n({won:!1,lost:!1,open:!1});async function m(p){c[p]=!0;try{let f=await u(i.fill({status:p}),n.dealId);p==="won"&&Ml(),t("updated",f)}finally{c[p]=!1}}return(p,f)=>{const h=v("IButton"),g=v("IFormError"),y=v("IFormGroup"),_=v("IPopover"),I=v("Icon"),F=v("IBadge"),$=ae("i-tooltip");return e.dealStatus==="open"?(d(),k("div",KO,[o("div",YO,[e.dealStatus!=="won"?D((d(),R(h,{key:0,variant:"success",class:"mr-2 px-5",loading:c.won,disabled:c.won,size:"sm",text:p.$t("deals::deal.status.won"),onClick:f[0]||(f[0]=C=>m("won"))},null,8,["loading","disabled","text"])),[[$,p.$t("deals::deal.actions.mark_as_won")]]):O("",!0),e.dealStatus!=="lost"?(d(),R(_,{key:1,visible:a.value,"onUpdate:visible":f[3]||(f[3]=C=>a.value=C),shift:"",title:p.$t("deals::deal.actions.mark_as_lost"),closeable:"",class:"w-80 max-w-xs sm:max-w-sm"},{popper:b(()=>[o("div",WO,[s(y,{label:p.$t("deals::deal.lost_reasons.lost_reason"),"label-for":"lost_reason",optional:!l(r)("lost_reason_is_required"),required:l(r)("lost_reason_is_required")},{default:b(()=>[s(ra,{modelValue:l(i).lost_reason,"onUpdate:modelValue":f[1]||(f[1]=C=>l(i).lost_reason=C)},null,8,["modelValue"]),s(g,{textContent:S(l(i).getError("lost_reason"))},null,8,["textContent"])]),_:1},8,["label","optional","required"]),s(h,{variant:"danger",size:"sm",block:"",loading:c.lost,disabled:c.lost,text:p.$t("deals::deal.actions.mark_as_lost"),onClick:f[2]||(f[2]=C=>m("lost"))},null,8,["loading","disabled","text"])])]),default:b(()=>[D(s(h,{variant:"danger",size:"sm",class:"px-5",text:p.$t("deals::deal.status.lost")},null,8,["text"]),[[$,p.$t("deals::deal.actions.mark_as_lost")]])]),_:1},8,["visible","title"])):O("",!0)])])):(d(),k("div",QO,[s(F,{size:"lg",variant:e.dealStatus==="won"?"success":"danger"},{default:b(()=>[e.dealStatus==="won"?(d(),R(I,{key:0,icon:"CheckBadge",class:"mr-1.5 h-4 w-4 text-current"})):e.dealStatus==="lost"?(d(),R(I,{key:1,icon:"X",class:"mr-1.5 h-4 w-4 text-current"})):O("",!0),Q(" "+S(p.$t("deals::deal.status."+e.dealStatus)),1)]),_:1},8,["variant"]),s(h,{size:"sm",class:"ml-2 px-5",disabled:c.open,loading:c.open,variant:"white",text:p.$t("deals::deal.reopen"),onClick:f[4]||(f[4]=C=>m("open"))},null,8,["disabled","loading","text"])]))}}},XO={class:"flex flex-col items-center md:flex-row"},ZO=["textContent"],JO=["textContent"],ez={__name:"DealFloatingModal",props:{resource:Object,form:Object,fields:en,mode:String},setup(e){const t=e,n=Innoclapps.resourceName("deals"),a=q(!0),r=q(!1),i=q(!1),u=Me("setModalSubTitle"),c=Me("synchronizeAndEmitUpdatedEvent"),{t:m}=ve(),{localizedDateTime:p}=Ne();u(`${m("core::app.created_at")} ${p(t.resource.created_at)}`),bt(()=>{u(null)});const f=V(()=>{const y=moment.duration({seconds:t.resource.time_in_stages[t.resource.stage.id]});return m("deals::deal.been_in_stage_time",{time:y.humanize()})});function h(y){r.value=!1,c({companies:y.company}),Fe(()=>t.fields.sync({companies:t.resource.companies}))}function g(y){i.value=!1,c({contacts:y.contact}),Fe(()=>t.fields.sync({contacts:t.resource.contacts}))}return(y,_)=>{const I=v("FormFields"),F=v("DetailFields"),$=v("CreateContactModal"),C=v("CreateCompanyModal");return d(),k(te,null,[o("div",null,[o("div",{class:X(["mb-7 rounded-md border px-4 py-3 md:px-5",{"border-primary-200":e.resource.status==="open","border-danger-200 bg-danger-50":e.resource.status==="lost","border-success-200 bg-success-50":e.resource.status==="won"}])},[o("div",XO,[s(tr,{class:"shrink-0 text-neutral-800 hover:text-neutral-600 dark:text-neutral-200 dark:hover:text-neutral-400 md:mr-3","deal-id":e.resource.id,pipeline:e.resource.pipeline,"stage-id":e.resource.stage_id,status:e.resource.status,"authorized-to-update":e.resource.authorizations.update,onUpdated:_[0]||(_[0]=w=>l(c)(w,!0))},null,8,["deal-id","pipeline","stage-id","status","authorized-to-update"]),o("p",{class:"block text-sm text-neutral-500 md:hidden",textContent:S(f.value)},null,8,ZO),s(nr,{class:"my-2 md:my-0 md:ml-auto","deal-id":e.resource.id,"deal-status":e.resource.status,onUpdated:_[1]||(_[1]=w=>l(c)(w,!0))},null,8,["deal-id","deal-status"])]),o("p",{class:"-mt-1.5 hidden text-center text-sm text-neutral-500 dark:text-neutral-300 md:block md:text-left",textContent:S(f.value)},null,8,JO)],2),e.fields.hasCollapsable?(d(),R(Bn,{key:0,collapsed:a.value,"onUpdate:collapsed":_[2]||(_[2]=w=>a.value=w),total:e.fields.totalCollapsable,class:"mb-2 ml-auto"},null,8,["collapsed","total"])):O("",!0),e.mode==="edit"?(d(),R(I,{key:1,fields:e.fields,"form-id":e.form.formId,"resource-name":l(n),"resource-id":e.resource.id,collapsed:a.value,"is-floating":""},null,8,["fields","form-id","resource-name","resource-id","collapsed"])):(d(),R(F,{key:2,fields:e.fields,"resource-name":l(n),"resource-id":e.resource.id,resource:e.resource,collapsed:a.value,"is-floating":"",onUpdated:_[3]||(_[3]=w=>l(c)(w,!0))},null,8,["fields","resource-name","resource-id","resource","collapsed"])),o("div",{class:X(["mt-8 space-y-6 border-t border-neutral-200 pt-8 dark:border-neutral-700 sm:space-y-8",{"px-10":e.mode==="detail"}])},[s(er,{"float-mode":e.mode,"deal-id":e.resource.id,contacts:e.resource.contacts,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onDissociated:_[4]||(_[4]=w=>(e.fields.sync({contacts:e.resource.contacts}),l(c)({contacts:{id:w,_delete:!0}}))),onCreateRequested:_[5]||(_[5]=w=>i.value=!0)},null,8,["float-mode","deal-id","contacts","authorize-dissociate","show-create-button"]),s(Js,{"float-mode":e.mode,"deal-id":e.resource.id,companies:e.resource.companies,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onDissociated:_[6]||(_[6]=w=>(e.fields.sync({companies:e.resource.companies}),l(c)({companies:{id:w,_delete:!0}}))),onCreateRequested:_[7]||(_[7]=w=>r.value=!0)},null,8,["float-mode","deal-id","companies","authorize-dissociate","show-create-button"]),s(kn,{card:!1,"resource-name":l(n),"resource-id":e.resource.id,media:e.resource.media,"authorize-delete":e.resource.authorizations.update,"is-floating":"",onUploaded:_[8]||(_[8]=w=>l(c)({media:[w]})),onDeleted:_[9]||(_[9]=w=>l(c)({media:{id:w.id,_delete:!0}}))},null,8,["resource-name","resource-id","media","authorize-delete"])],2)]),s($,{visible:i.value,"onUpdate:visible":_[10]||(_[10]=w=>i.value=w),overlay:!1,deals:[e.resource],onCreated:g,onRestored:g},null,8,["visible","deals"]),s(C,{visible:r.value,"onUpdate:visible":_[11]||(_[11]=w=>r.value=w),overlay:!1,deals:[e.resource],onCreated:h,onRestored:h},null,8,["visible","deals"])],64)}}},tz={__name:"DealPresentationCard",props:{card:Object},setup(e){const t=e,{orderedPipelines:n,findPipelineById:a}=sn(),r=dt(a(t.card.pipeline_id)),i=V(()=>({pipeline_id:r.value.id}));return(u,c)=>{const m=v("DropdownSelectInput"),p=v("PresentationChart");return d(),R(p,{card:e.card,"request-query-string":i.value},{actions:b(()=>[s(m,{modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=f=>r.value=f),items:l(n),"toggle-class":"md:mr-3","label-key":"name","value-key":"id",placement:"bottom-end"},null,8,["modelValue","items"])]),_:1},8,["card","request-query-string"])}}},nz={__name:"DealsLostReasonsIndex",setup(e){const t=Innoclapps.resourceName("lost-reasons"),{fetchLostReasons:n}=sa();return(a,r)=>{const i=v("ICardHeading");return d(),R(vo,{"resource-name":l(t),"with-cancel":!1,onCreated:l(n),onUpdated:l(n),onDeleted:l(n)},{header:b(()=>[s(i,null,{default:b(()=>[Q(S(a.$t("deals::deal.lost_reasons.lost_reasons")),1)]),_:1})]),_:1},8,["resource-name","onCreated","onUpdated","onDeleted"])}}},oz={class:"text-left",width:"5%"},lz={class:"text-left"},az=o("th",null,null,-1),sz=["textContent"],rz={class:"flex justify-end"},iz=o("tbody",null,null,-1),uz={__name:"DealsPipelinesIndex",setup(e){const{t}=ve(),{orderedPipelinesForDraggable:n,deletePipeline:a}=sn(),{draggableOptions:r}=Xt();async function i(u){await Innoclapps.dialog().confirm(),await a(u),Innoclapps.success(t("deals::deal.pipeline.deleted"))}return(u,c)=>{const m=v("IButton"),p=v("router-link"),f=v("IDropdownItem"),h=v("IMinimalDropdown"),g=v("ITable"),y=v("ICard"),_=v("router-view"),I=ae("t");return d(),k(te,null,[s(y,{header:u.$t("deals::deal.pipeline.pipelines"),"no-body":""},{actions:b(()=>[s(m,{to:{name:"create-pipeline"},icon:"plus",size:"sm",text:u.$t("deals::deal.pipeline.create")},null,8,["text"])]),default:b(()=>[s(g,{class:"-mt-px overflow-y-hidden"},{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",oz,null,512),[[I,"core::app.id"]]),D(o("th",lz,null,512),[[I,"deals::deal.pipeline.pipeline"]]),az])]),s(l(Et),Re(l(r),{modelValue:l(n),"onUpdate:modelValue":c[0]||(c[0]=F=>xt(n)?n.value=F:null),tag:"tbody","item-key":"id"}),{item:b(({element:F})=>[o("tr",null,[o("td",{textContent:S(F.id)},null,8,sz),o("td",null,[s(p,{class:"link",to:{name:"edit-pipeline",params:{id:F.id}}},{default:b(()=>[Q(S(F.name),1)]),_:2},1032,["to"])]),o("td",rz,[s(h,null,{default:b(()=>[s(f,{to:{name:"edit-pipeline",params:{id:F.id}},text:u.$t("core::app.edit")},null,8,["to","text"]),s(f,{text:u.$t("core::app.delete"),onClick:$=>i(F.id)},null,8,["text","onClick"])]),_:2},1024)])])]),_:1},16,["modelValue"]),iz]),_:1})]),_:1},8,["header"]),s(_)],64)}}},dz={class:"space-y-3"},cz={__name:"SettingsDeals",setup(e){const{form:t,submit:n,isReady:a}=Gt();return(r,i)=>{const u=v("ICard");return d(),k("div",dz,[s(uz),s(u,{"no-body":"",header:r.$t("deals::deal.deals"),overlay:!l(a)},{default:b(()=>[s(bo,null,{default:b(()=>[s(Tn,{modelValue:l(t).allow_lost_reason_enter,"onUpdate:modelValue":i[0]||(i[0]=c=>l(t).allow_lost_reason_enter=c),heading:r.$t("deals::deal.settings.allow_lost_reason_enter"),description:r.$t("deals::deal.settings.allow_lost_reason_enter_info"),onChange:l(n)},null,8,["modelValue","heading","description","onChange"]),s(Tn,{modelValue:l(t).lost_reason_is_required,"onUpdate:modelValue":i[1]||(i[1]=c=>l(t).lost_reason_is_required=c),heading:r.$t("deals::deal.settings.lost_reason_is_required"),description:r.$t("deals::deal.settings.lost_reason_is_required_info"),onChange:l(n)},null,8,["modelValue","heading","description","onChange"])]),_:1})]),_:1},8,["header","overlay"]),s(nz)])}}},mz={__name:"LostReasonField",props:ut,setup(e){const t=e,n=q(""),{field:a,label:r,fieldId:i,initialize:u}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(u),(c,m)=>(d(),R(it,{field:l(a),label:l(r),"form-id":c.formId,"field-id":l(i)},{default:b(()=>[s(ra,{modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=p=>n.value=p),attribute:l(a).attribute},null,8,["modelValue","attribute"])]),_:1},8,["field","label","form-id","field-id"]))}},pz={__name:"PipelineStageField",props:ut,setup(e){var w;const t=e,n=q(""),{field:a,label:r,fieldId:i,isReadonly:u,onSearch:c,onDropdownOpen:m,filterable:p,options:f,setOptions:h,lazyLoadingOptions:g,noOptionsText:y,headerText:_,prepareValue:I}=Yo(n,xe(t,"field"),t.formId,xe(t,"isFloating"),{options:$((w=t.field.value)==null?void 0:w.pipeline_id)}),F=V(()=>f.value.length>0);function $(x){return t.field.options.filter(A=>A[t.field.dependsOn]==x)}function C(x){h($(x.id)),n.value=I(x.stages[0])}return rt("field-pipeline_id-value-changed",C),(x,A)=>{const N=v("IAlert"),T=v("ICustomSelect");return d(),R(it,{field:l(a),label:l(r),"field-id":l(i),"form-id":x.formId},{default:b(()=>[F.value?O("",!0):(d(),R(N,{key:0,class:"mb-2"},{default:b(()=>[Q(S(x.$t("deals::deal.pipeline.missing_stages")),1)]),_:1})),s(T,Re({modelValue:n.value,"onUpdate:modelValue":A[0]||(A[0]=E=>n.value=E),class:F.value?"":"hidden","input-id":l(i),disabled:l(u),filterable:l(p),options:l(f),loading:l(g),name:l(a).attribute,label:l(a).labelKey},l(a).attributes,{onSearch:l(c),onOpen:l(m)}),{"no-options":b(()=>[Q(S(l(y)),1)]),header:b(()=>[D(o("span",{class:"block px-3 py-2 text-sm text-neutral-500 dark:text-neutral-200"},S(l(_)),513),[[Y,l(_)]])]),_:1},16,["modelValue","class","input-id","disabled","filterable","options","loading","name","label","onSearch","onOpen"])]),_:1},8,["field","label","field-id","form-id"])}}},fz={};function vz(e,t){const n=v("IndexTextareaField");return d(),R(n)}const bz=ct(fz,[["render",vz]]),hz={__name:"PipelineStageField",props:["column","row","field","resourceName","resourceId"],setup(e){return(t,n)=>{const a=v("IndexFieldsItem");return d(),R(a,{"resource-name":e.resourceName,"resource-id":e.resourceId,row:e.row,field:e.field},{field:b(()=>[Q(S(e.field.value.name),1)]),_:1},8,["resource-name","resource-id","row","field"])}}},_z={__name:"DealsPipelinesCreate",setup(e){const t=Qe(),{addPipeline:n}=sn(),{resetStoreState:a}=Le(),{form:r}=Ae({name:null});function i(){r.post("/pipelines").then(u=>{n(u),a(),t.push("/settings/deals/pipelines/"+u.id+"/edit")})}return(u,c)=>{const m=v("IFormInput"),p=v("IFormError"),f=v("IFormGroup"),h=v("IModal");return d(),R(h,{"ok-title":u.$t("core::app.create"),"ok-disabled":l(r).busy,title:u.$t("deals::deal.pipeline.create"),size:"sm",form:"",visible:"",onKeydown:c[1]||(c[1]=g=>l(r).onKeydown(g)),onSubmit:i,onShown:c[2]||(c[2]=()=>u.$refs.inputNameRef.focus()),onHidden:u.$router.back},{default:b(()=>[s(f,{"label-for":"name",label:u.$t("deals::deal.pipeline.name"),required:""},{default:b(()=>[s(m,{id:"name",ref:"inputNameRef",modelValue:l(r).name,"onUpdate:modelValue":c[0]||(c[0]=g=>l(r).name=g),name:"name",type:"text"},null,8,["modelValue"]),s(p,{textContent:S(l(r).getError("name"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1},8,["ok-title","ok-disabled","title","onHidden"])}}},gz=["onSubmit"],yz={class:"text-left"},xz={class:"text-left"},Iz={class:"w-full sm:w-auto"},kz={class:"flex rounded-md shadow-sm"},$z={class:"relative flex grow items-stretch focus-within:z-10"},wz={class:"absolute inset-y-0 left-0 flex items-center pl-3"},Cz={key:0,class:"absolute inset-y-0 left-11 hidden w-14 border-l border-r border-neutral-300 px-2 dark:border-neutral-500 sm:flex sm:items-center sm:justify-center"},Sz={class:"mt-sm-0 mt-4 flex items-center"},Rz={class:"mr-4 grow"},Fz=["onUpdate:modelValue"],Vz={colspan:"2",class:"px-7 py-3"},Tz={class:"flex justify-end"},Dz={__name:"DealsPipelinesEdit",setup(e){const{t}=ve(),n=Ye(),{draggableOptions:a}=Xt(),{resetStoreState:r}=Le(),{setPipeline:i,fetchPipeline:u}=sn(),{updateResource:c}=Je("pipelines"),m=q(null),p=q({}),f=q(!1),{form:h}=Ae({name:null,stages:[],visibility_group:{type:"all",depends_on:[]}});async function g(){h.stages=_t(h.stages,(C,w)=>(C.display_order=w,C));const $=await c(h,n.params.id,{params:{with:"visibilityGroup.users;visibilityGroup.teams"}});i($.id,$),r(),h.stages=$.stages,Innoclapps.success(t("deals::deal.pipeline.updated"))}function y(){h.stages.push({name:"",win_probability:100}),Fe(()=>{m.value.focus()})}function _($){h.stages.splice($,1)}async function I($){let C=h.stages[$].id;if(!C){_($);return}await Innoclapps.dialog().confirm(),await Innoclapps.request().delete(`/pipeline-stages/${C}`),r(),_($)}async function F(){try{const $=await u(n.params.id,{params:{with:"visibilityGroup.users;visibilityGroup.teams"}});p.value=$,h.fill("name",$.name),h.fill("stages",$.stages),$.visibility_group&&h.fill("visibility_group",$.visibility_group),h.stages.length===0&&y()}finally{f.value=!0}}return F(),($,C)=>{const w=v("IFormInput"),x=v("IFormError"),A=v("IFormGroup"),N=v("IAlert"),T=v("ICardBody"),E=v("IButtonIcon"),B=v("IButton"),z=v("IButtonMinimal"),M=v("ITable"),j=v("ICard"),U=ae("t");return d(),R(j,{"no-body":"",header:$.$t("deals::deal.pipeline.edit"),overlay:!f.value},{footer:b(()=>[o("div",Tz,[s(B,{type:"button",disabled:l(h).busy,text:$.$t("core::app.save"),onClick:g},null,8,["disabled","text"])])]),default:b(()=>[o("form",{onKeydown:C[4]||(C[4]=P=>l(h).onKeydown(P)),onSubmit:ie(g,["prevent"])},[s(T,null,{default:b(()=>[s(A,{"label-for":"name",label:$.$t("deals::deal.pipeline.name"),required:""},{default:b(()=>[s(w,{id:"name",modelValue:l(h).name,"onUpdate:modelValue":C[0]||(C[0]=P=>l(h).name=P),name:"name",type:"text"},null,8,["modelValue"]),s(x,{textContent:S(l(h).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(A,{class:"mt-4"},{default:b(()=>[s(Xo,{type:l(h).visibility_group.type,"onUpdate:type":C[1]||(C[1]=P=>l(h).visibility_group.type=P),dependsOn:l(h).visibility_group.depends_on,"onUpdate:dependsOn":C[2]||(C[2]=P=>l(h).visibility_group.depends_on=P),disabled:p.value.is_primary},null,8,["type","dependsOn","disabled"])]),_:1}),s(N,{variant:"info",show:f.value&&p.value.is_primary,class:"mt-4"},{default:b(()=>[Q(S($.$t("deals::deal.pipeline.visibility_group.primary_restrictions")),1)]),_:1},8,["show"])]),_:1}),s(M,null,{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",yz,null,512),[[U,"deals::deal.stage.name"]]),D(o("th",xz,null,512),[[U,"deals::deal.stage.win_probability"]])])]),s(l(Et),Re({modelValue:l(h).stages,"onUpdate:modelValue":C[3]||(C[3]=P=>l(h).stages=P),tag:"tbody","item-key":(P,H)=>H},l(a),{handle:".draggable-handle"}),{item:b(({element:P,index:H})=>[o("tr",null,[o("td",Iz,[o("div",kz,[o("div",$z,[o("div",wz,[s(E,{icon:"Selector",class:"draggable-handle cursor-move"})]),P.id?(d(),k("div",Cz," ID: "+S(P.id),1)):O("",!0),s(w,{ref_key:"stageNameInputRef",ref:m,modelValue:l(h).stages[H].name,"onUpdate:modelValue":L=>l(h).stages[H].name=L,class:X(["rounded-l-md",[P.id?"pl-10 sm:pl-[6.7rem]":"pl-10"]]),rounded:!1,onKeydown:Tt(y,["enter"])},null,8,["modelValue","onUpdate:modelValue","class","onKeydown"])]),s(B,{variant:"white",text:$.$t("core::app.delete"),rounded:!1,class:"relative -ml-px rounded-r-md",onClick:L=>I(H)},null,8,["text","onClick"])]),s(x,{textContent:S(l(h).getError("stages."+H+".name"))},null,8,["textContent"])]),o("td",null,[o("div",Sz,[o("div",Rz,[D(o("input",{"onUpdate:modelValue":L=>l(h).stages[H].win_probability=L,type:"range",class:"h-2 w-full appearance-none rounded-md border border-neutral-200 bg-neutral-200 dark:border-neutral-500 dark:bg-neutral-700",min:1,max:100},null,8,Fz),[[Zt,l(h).stages[H].win_probability]])]),o("div",null,S(l(h).stages[H].win_probability),1)]),s(x,{textContent:S(l(h).getError("stages."+H+".win_probability"))},null,8,["textContent"])])])]),_:1},16,["modelValue","item-key"]),o("tfoot",null,[o("tr",null,[o("td",Vz,[s(z,{variant:"primary",text:$.$t("deals::deal.stage.add"),onClick:y},null,8,["text"])])])])]),_:1})],40,gz)]),_:1},8,["header","overlay"])}}};const qz={class:"board-top px-4 py-4 sm:px-6"},Ez=["id"],Az={__name:"Board",props:{boardClass:[String,Array,Object],boardId:{required:!0,type:String}},setup(e){return(t,n)=>(d(),k("div",null,[o("div",qz,[de(t.$slots,"top")]),o("div",{id:e.boardId,class:X(["board block space-x-4 overflow-x-scroll whitespace-nowrap px-4 pb-2 sm:px-6",e.boardClass])},[de(t.$slots,"default")],10,Ez)]))}},Bz={class:"inline-flex h-full w-80 flex-col overflow-y-hidden rounded-lg border border-neutral-300/40 bg-neutral-200/40 align-top shadow dark:border-neutral-700 dark:bg-neutral-900"},Nz={class:"px-3 py-2.5"},Oz={class:"flex items-center"},zz=["textContent"],Mz=["id"],Uz={class:"m-2 overflow-hidden whitespace-normal rounded-md bg-white shadow dark:bg-neutral-800"},Pz={class:"px-4 py-5 sm:p-6"},jz=o("div",{class:"flex items-center p-3"},null,-1),Lz={__name:"BoardColumn",props:{name:{required:!0,type:String},columnId:{required:!0,type:Number},modelValue:{required:!0,type:Array},boardId:{required:!0,type:String},loader:{required:!0,type:Function},move:Function},emits:["drag-start","drag-end","updated","added","removed","update:modelValue"],setup(e,{emit:t}){const n=e,{scrollableDraggableOptions:a}=Xt(),r=V(()=>({...a,delay:5,preventOnFilter:!1}));function i(f){n.loader(n.columnId,f)}function u(f){t("drag-start",f)}function c(f){t("drag-end",f)}function m(f,h){if(n.move&&n.move(f,h)===!1)return!1}function p(f){f.removed&&t("removed",{columnId:n.columnId,event:f}),f.moved&&t("updated",{columnId:n.columnId,event:f}),f.added&&(t("added",{columnId:n.columnId,event:f}),t("updated",{columnId:n.columnId,event:f}))}return(f,h)=>(d(),k("div",Bz,[o("div",Nz,[o("div",Oz,[de(f.$slots,"columnHeader",{},()=>[o("h5",{class:"mr-auto truncate text-sm font-medium text-neutral-800 dark:text-neutral-100",textContent:S(e.name)},null,8,zz),o("div",null,[de(f.$slots,"topRight")])])]),de(f.$slots,"afterColumnHeader")]),o("div",{id:"boardColumn"+e.columnId,class:"h-auto overflow-y-auto overflow-x-hidden"},[s(l(Et),Re({"data-column":e.columnId,"model-value":e.modelValue,move:m,"item-key":g=>g.id,"empty-insert-threshold":100},r.value,{group:{name:e.boardId},"onUpdate:modelValue":h[0]||(h[0]=g=>f.$emit("update:modelValue",g)),onStart:u,onEnd:c,onChange:p}),{item:b(({element:g})=>[o("div",Uz,[de(f.$slots,"card",{card:g},()=>[o("div",Pz,S(g.display_name),1)])])]),_:3},16,["data-column","model-value","item-key","group"])],8,Mz),jz,s(xn,{"scroll-element":"#boardColumn"+e.columnId,onHandle:h[1]||(h[1]=g=>i(g))},null,8,["scroll-element"])]))}};const Hz={style:{bottom:"0",right:"0"},class:"h-dropper fixed left-0 border border-neutral-300 bg-white shadow-sm dark:border-neutral-900 dark:bg-neutral-900 sm:left-56"},Gz={class:"flex justify-end"},Kz={class:"h-dropper relative w-1/3 border-t-2 border-neutral-800 sm:w-1/5"},Yz=o("div",null,null,-1),Wz={class:"dropper-header h-dropper absolute inset-0 flex place-content-center items-center font-medium text-neutral-800 dark:text-neutral-200"},Qz={class:"h-dropper relative w-1/3 border-t-2 border-danger-500 sm:w-1/5"},Xz=o("div",null,null,-1),Zz={class:"dropper-header h-dropper absolute inset-0 flex place-content-center items-center font-medium text-neutral-800 dark:text-neutral-200"},Jz={class:"h-dropper relative w-1/3 border-t-2 border-success-500 sm:w-1/5"},eM=o("div",null,null,-1),tM={class:"dropper-header h-dropper absolute inset-0 flex place-content-center items-center font-medium text-neutral-800 dark:text-neutral-200"},nM={__name:"DealBoardBottomDropper",props:{resourceId:{required:!0}},emits:["deleted","won","refresh-requested"],setup(e,{emit:t}){const{setting:n}=Le(),a=q(null),{form:r}=Ae({lost_reason:null},{resetOnSuccess:!0}),{updateResource:i,deleteResource:u}=Je(Innoclapps.resourceName("deals"));async function c(_){if(_.added)try{await Innoclapps.dialog().confirm(),await u(_.added.element.id),t("deleted",_.added.element)}catch{m()}}function m(){t("refresh-requested")}function p(_){_.added&&(a.value=_.added.element.id,Innoclapps.modal().show("markAsLostModal"))}function f(){r.reset(),r.errors.clear(),a.value=null,m()}function h(_){i(r.fill({status:"lost"}),_).then(()=>Innoclapps.modal().hide("markAsLostModal"))}function g(_){i(r.fill({status:"won"}),_).then(I=>{Ml(),t("won",I),m()}).catch(()=>m())}function y(_){_.added&&g(_.added.element.id)}return(_,I)=>{const F=v("IFormError"),$=v("IFormGroup"),C=v("IModal"),w=ae("t");return d(),k("div",Hz,[s(C,{id:"markAsLostModal",size:"sm",title:_.$t("deals::deal.actions.mark_as_lost"),form:"","ok-disabled":l(r).busy,"ok-title":_.$t("deals::deal.actions.mark_as_lost"),"ok-variant":"danger",onSubmit:I[1]||(I[1]=x=>h(a.value)),onHidden:f},{default:b(()=>[s($,{label:_.$t("deals::deal.lost_reasons.lost_reason"),"label-for":"lost_reason",optional:!l(n)("lost_reason_is_required"),required:l(n)("lost_reason_is_required")},{default:b(()=>[s(ra,{modelValue:l(r).lost_reason,"onUpdate:modelValue":I[0]||(I[0]=x=>l(r).lost_reason=x)},null,8,["modelValue"]),s(F,{textContent:S(l(r).getError("lost_reason"))},null,8,["textContent"])]),_:1},8,["label","optional","required"])]),_:1},8,["title","ok-disabled","ok-title"]),o("div",Gz,[o("div",Kz,[s(l(Et),{"model-value":[],"item-key":x=>x.id,class:"h-dropper dropper-delete dropper",group:{name:"delete",put:!0,pull:!1},async:"",onChange:c},{item:b(()=>[Yz]),header:b(()=>[D(o("div",Wz,null,512),[[w,"core::app.delete"]])]),_:1},8,["item-key"])]),o("div",Qz,[s(l(Et),{"model-value":[],"item-key":x=>x.id,class:"h-dropper dropper-lost dropper",group:{name:"lost",put:!0,pull:!1},onChange:p},{item:b(()=>[Xz]),header:b(()=>[D(o("div",Zz,null,512),[[w,"deals::deal.status.lost"]])]),_:1},8,["item-key"])]),o("div",Jz,[s(l(Et),{"model-value":[],"item-key":x=>x.id,class:"h-dropper dropper-won dropper",group:{group:"won",put:!0,pull:!1},onChange:y},{item:b(()=>[eM]),header:b(()=>[D(o("div",tM,null,512),[[w,"deals::deal.status.won"]])]),_:1},8,["item-key"])])])])}}},oM={class:"flex"},lM={class:"grow truncate"},aM=["href","textContent"],sM={class:"mt-1 flex text-sm"},rM=["onClick","textContent"],iM={key:0,class:"border-b border-neutral-200 dark:border-neutral-700"},uM={class:"px-4 py-3 text-xs"},dM={class:"text-neutral-500 dark:text-neutral-300"},cM={class:"font-medium text-neutral-700 dark:text-neutral-100"},mM={class:"relative"},pM=["onClick","textContent"],fM={class:"p-4"},vM={class:"flex justify-end space-x-1 bg-neutral-100 px-4 py-3 dark:bg-neutral-900"},bM=["textContent"],hM={class:"mt-1 flex flex-col items-center space-y-1"},_M={class:"p-4"},gM={__name:"DealBoardCard",props:{dealId:{required:!0,type:Number},displayName:{required:!0,type:String},amount:{required:!0,type:[String,Number]},path:{required:!0,type:String},status:{required:!0,type:String},incompleteActivitiesCount:{required:!0,type:Number},productsCount:{required:!0,type:Number},expectedCloseDate:String,nextActivityDate:String,swatchColor:String,fallsBehindExpectedCloseDate:Boolean},emits:["create-activity-requested","update:amount","update:productsCount","update:swatchColor"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("deals"),r=q(!1),i=q(!1),u=Innoclapps.config("favourite_colors"),{localizedDate:c,localizedDateTime:m}=Ne(),{formatMoney:p}=Mt(),{floatResourceInDetailMode:f}=an(),{form:h}=Ae({amount:n.amount}),{updateResource:g}=Je(a);function y(){g(h,n.dealId).then($=>{t("update:amount",$.amount),h.set("amount",$.amount),i.value=!1})}function _(){n.productsCount>0?F():i.value=!i.value}async function I($){t("update:amount",$.total),h.set("amount",$.total),t("update:productsCount",$.products.length)}function F(){r.value=!0}return($,C)=>{const w=v("IDropdownItem"),x=v("IDropdown"),A=v("IFormNumericInput"),N=v("IFormError"),T=v("IFormGroup"),E=v("Icon"),B=v("IButton"),z=v("IPopover"),M=v("IMinimalDropdown"),j=v("IButtonIcon"),U=v("IColorSwatch"),P=ae("t");return d(),k(te,null,[e.swatchColor?(d(),k("div",{key:0,class:"bottom-hidden p-2",style:st({background:e.swatchColor})},null,4)):O("",!0),o("div",{class:X(["bottom-hidden group px-4 py-2",{"bg-danger-50/50":e.fallsBehindExpectedCloseDate,"bg-success-50/70 dark:bg-success-500/30":e.status=="won","opacity-50":e.status=="lost"}])},[o("div",oM,[o("div",lM,[o("a",{class:"truncate text-sm font-medium text-neutral-900 hover:text-neutral-500 focus:outline-none dark:text-white",href:e.path,onClick:C[0]||(C[0]=ie(H=>l(f)({resourceName:l(a),resourceId:e.dealId}),["prevent"])),textContent:S(e.displayName)},null,8,aM),o("div",sM,[s(x,null,{toggle:b(({toggle:H})=>[o("button",{type:"button",class:X({"text-warning-500":e.incompleteActivitiesCount>0,"text-success-500":e.incompleteActivitiesCount===0}),onClick:H,textContent:S($.$t("activities::activity.count",e.incompleteActivitiesCount,{count:e.incompleteActivitiesCount}))},null,10,rM)]),default:b(()=>[e.nextActivityDate?(d(),k("div",iM,[o("div",uM,[o("p",dM,S($.$t("activities.activity.next_activity_date")),1),o("p",cM,S(l(m)(e.nextActivityDate)),1)])])):O("",!0),s(w,{icon:"Clock",text:$.$t("activities::activity.create"),onClick:C[1]||(C[1]=H=>$.$emit("create-activity-requested",e.dealId))},null,8,["text"])]),_:1}),o("div",mM,[r.value?(d(),R(el,{key:0,"resource-name":l(a),"resource-id":e.dealId,visible:"",prefetch:"",onSaved:I,onHidden:C[2]||(C[2]=H=>r.value=!1)},null,8,["resource-name","resource-id"])):O("",!0),s(z,{visible:i.value,"onUpdate:visible":C[6]||(C[6]=H=>i.value=H),class:"w-80"},{popper:b(()=>[o("div",fM,[s(T,{required:"",label:$.$t("deals::fields.deals.amount"),"label-for":"editDealAmount"},{default:b(()=>[s(A,{id:"editDealAmount",modelValue:l(h).amount,"onUpdate:modelValue":C[3]||(C[3]=H=>l(h).amount=H)},null,8,["modelValue"]),s(N,{textContent:S(l(h).getError("amount"))},null,8,["textContent"])]),_:1},8,["label"]),o("a",{href:"#",class:"link flex items-center text-sm",onClick:C[4]||(C[4]=ie(H=>(r.value=!0,i.value=!1),["prevent"]))},[D(o("span",null,null,512),[[P,"billable::product.manage"]]),s(E,{icon:"Window",class:"ml-2 mt-px h-4 w-4"})])]),o("div",vM,[s(B,{size:"sm",variant:"white",disabled:l(h).busy,text:$.$t("core::app.cancel"),onClick:C[5]||(C[5]=H=>i.value=!1)},null,8,["disabled","text"]),s(B,{size:"sm",variant:"primary",loading:l(h).busy,disabled:l(h).busy,text:$.$t("core::app.save"),onClick:y},null,8,["loading","disabled","text"])])]),default:b(()=>[o("a",{href:"#",class:"ml-2 text-neutral-600 hover:text-neutral-900 dark:text-neutral-300 dark:hover:text-neutral-100",onClick:ie(_,["prevent","stop"]),textContent:S(l(p)(e.amount))},null,8,pM)]),_:1},8,["visible"])])]),D(o("p",{class:"mt-1 text-xs text-neutral-700 dark:text-neutral-300",textContent:S(l(c)(e.expectedCloseDate))},null,8,bM),[[Y,e.expectedCloseDate]])]),o("div",hM,[s(M,null,{default:b(()=>[s(w,{icon:"Clock",text:$.$t("activities::activity.create"),onClick:C[7]||(C[7]=H=>$.$emit("create-activity-requested",e.dealId))},null,8,["text"]),s(w,{icon:"Eye",text:$.$t("core::app.view_record"),onClick:C[8]||(C[8]=H=>$.$router.push(e.path))},null,8,["text"]),s(w,{icon:"Bars3CenterLeft",text:$.$t("core::app.preview"),onClick:C[9]||(C[9]=H=>$.preview(e.dealId))},null,8,["text"])]),_:1}),s(z,{class:"w-56","auto-placement":""},{popper:b(()=>[o("div",_M,[s(U,{"model-value":e.swatchColor,swatches:l(u),"allow-custom":!1,onInput:C[10]||(C[10]=H=>$.$emit("update:swatchColor",H))},null,8,["model-value","swatches"])])]),default:b(()=>[s(j,{icon:"ColorSwatch",class:"opacity-100 md:opacity-0 md:group-hover:opacity-100"})]),_:1})])])],2)],64)}}},yM={class:"flex"},xM={class:"mr-2 grow"},IM={value:"expected_close_date"},kM={value:"created_at"},$M={value:"amount"},wM={value:"name"},CM={value:"asc"},SM={value:"desc"},RM={__name:"DealBoardSortOptions",emits:["applied"],setup(e,{emit:t}){const n=q({field:null,direction:"asc"});function a(){Innoclapps.modal().hide("boardSort")}function r(){t("applied",n.value),a()}return(i,u)=>{const c=v("IFormSelect"),m=v("IModal"),p=ae("t");return d(),R(m,{id:"boardSort",size:"sm",form:"","ok-disabled":!n.value.field,"ok-title":i.$t("core::app.apply"),title:i.$t("deals::deal.sort_by"),onSubmit:r},{default:b(()=>[o("div",yM,[o("div",xM,[s(c,{modelValue:n.value.field,"onUpdate:modelValue":u[0]||(u[0]=f=>n.value.field=f)},{default:b(()=>[D(o("option",IM,null,512),[[p,"deals::fields.deals.expected_close_date"]]),D(o("option",kM,null,512),[[p,"core::app.creation_date"]]),D(o("option",$M,null,512),[[p,"deals::fields.deals.amount"]]),D(o("option",wM,null,512),[[p,"deals::deal.name"]])]),_:1},8,["modelValue"])]),o("div",null,[s(c,{modelValue:n.value.direction,"onUpdate:modelValue":u[1]||(u[1]=f=>n.value.direction=f)},{default:b(()=>[o("option",CM,[Q(" Asc ("),D(o("span",null,null,512),[[p,"core::app.ascending"]]),Q(") ")]),o("option",SM,[Q(" Desc ("),D(o("span",null,null,512),[[p,"core::app.descending"]]),Q(") ")])]),_:1},8,["modelValue"])])])]),_:1},8,["ok-disabled","ok-title","title"])}}},FM={class:"inline-flex items-center"},VM={class:"sm:flex sm:flex-wrap"},TM={key:0,class:"mb-1 mr-0 flex content-center space-x-1 sm:mb-0 sm:mr-1 sm:w-auto sm:flex-row"},DM={class:"mt-4 flex w-full flex-wrap justify-between sm:ml-auto sm:mt-0 sm:w-auto md:justify-end"},qM={class:"flex justify-between rounded border border-neutral-300 p-3 text-sm dark:border-neutral-700"},EM=["textContent"],AM={key:0,class:"border-t border-neutral-200 py-1.5 dark:border-neutral-700"},BM={class:"flex items-center text-sm"},NM=["textContent"],OM={key:1,class:"inline-flex items-center text-neutral-600 dark:text-neutral-300"},zM=o("span",{class:"mx-1 text-neutral-900 dark:text-neutral-300"},"-",-1),MM={class:"text-neutral-700 dark:text-neutral-300"},Un="deals",Fo="deals-board",UM={__name:"DealsBoard",setup(e){const t={field:"board_order",direction:"asc"},{gate:n}=On(),{t:a}=ve(),{setLoading:r,isLoading:i}=Ct(),u=Bl("deals-board-last-pipeline"),c=Ye(),{draggableOptions:m}=Xt(),{formatMoney:p}=Mt(),f=q(!1),h=Un,g=q({}),y=q({q:"",with_default_filter:!0}),_=q(null),I=q(null),F=q(!1),$=q(!1),C=q(new Map),w=q(0),x=q({}),A=q(t),N=q(!1),T=q(!1),{orderedPipelinesForDraggable:E}=sn(),{queryBuilderRules:B,rulesAreValid:z,hasRulesApplied:M,rulesAreVisible:j,toggleFiltersRules:U,findRule:P}=pn(h,Fo),{activeFilter:H,rules:L,hasRules:Z,filters:J}=ho(h,Fo),K=V(()=>{var me,we;return((we=(me=P("status"))==null?void 0:me.query)==null?void 0:we.value)==="lost"}),G=V(()=>{var me,we;return((we=(me=P("status"))==null?void 0:me.query)==null?void 0:we.value)==="won"}),oe=V(()=>G.value||K.value),pe=V(()=>x.value.authorizations&&x.value.authorizations.update),ue=V(()=>"/deals/board/"+x.value.id),ee=V(()=>{let me={},we=[];return me.pipeline=x.value,we.push("pipeline_id"),I.value&&(me["stage-id"]=I.value,we.push("stage_id")),me["hidden-fields"]=we,me});function W(){return{order:A.value,rules:z.value?B.value:[],...y.value}}function ne(me){if(n.denies("update",me.draggedContext.element))return!1}function ce(me){A.value=me,Ve().then(()=>{A.value=t,C.value.forEach(we=>Te(we)),Innoclapps.info(a("deals::board.columns_sorted"))})}async function fe(){const me=[Innoclapps.request().get(Un+"/rules"),Innoclapps.request().get("/filters/"+Un)];let we=await Promise.all(me);L.value=we[0].data.filter(Ue=>Ue.id!=="pipeline_id"),J.value=we[1].data,Se()}async function Se(){r(!1);let me=u.value,we=me?Ee(E.value,["id",Number(me)]):void 0;we||(we=E.value[0]),$e(we),T.value=!0}function Ie(){w.value>0&&Ve(),I.value=null,w.value=0}function Ce(me){I.value=Number(me.id),F.value=!0}function le(){F.value=!0}function ye(me){w.value++,me.isRegularAction&&(F.value=!1)}async function Ge(me,we){let Ue=C.value.get(me);Object.hasOwn(Ue,"infinityState")||(Ue.infinityState=we),Ue.page+=1;const{data:Oe}=await Innoclapps.request().get(`${ue.value}/${Ue.id}`,{params:{...W(),page:Ue.page}});Oe.cards.length===0?we.complete():(C.value.set(Oe.id,Object.assign(C.value.get(Oe.id),Rn(Oe,["cards","summary"]))),Oe.cards.forEach(se=>{C.value.get(Oe.id).cards.push(se)}),we.loaded())}function be(){Ve(!1)}async function Ve(me=!0){let we={};if(me){let Ue={};C.value.forEach(Oe=>{Ue[Oe.id]=Oe.page}),y.value.pages=Ue}else delete y.value.pages,C.value.forEach(Ue=>{Ue.infinityState&&(Ue.infinityState.pause(),we[Ue.id]=Ue.infinityState)});r(!0);try{const{data:Ue}=await Innoclapps.request().get(ue.value,{params:W()});return me||(C.value=new Map,g.value={}),Ue.forEach(Oe=>{var se;Oe.page=me&&((se=C.value.get(Oe.id))==null?void 0:se.page)||1,C.value.set(Oe.id,Rn(Oe,["summary"])),Fe(()=>{setTimeout(()=>{Object.hasOwn(we,Oe.id)&&(C.value.set(Oe.id,Object.assign(C.value.get(Oe.id),{infinityState:we[Oe.id]})),C.value.get(Oe.id).infinityState.resume(),delete we[Oe.id])},300)}),g.value[Oe.id]=Oe.summary}),Ue}finally{r(!1),delete y.value.pages}}function $e(me){u.value=me.id,x.value=me,be()}function et(me=null){Innoclapps.request().get(`${ue.value}/summary${me?"/"+me:""}`,{params:W()}).then(({data:we})=>Object.keys(we).forEach(Ue=>g.value[Ue]=we[Ue]))}function Te(me){tt(me,!1)}function tt(me,we=!0){at(Ko(me.cards,(Ue,Oe,se)=>(Ue.push({id:Oe.id,board_order:se+1,stage_id:me.id,swatch_color:Oe.swatch_color?Oe.swatch_color:null}),Ue),[]),we)}function at(me,we=!0){$.value=!0,Innoclapps.request().post(ue.value,me).finally(()=>{$.value=!1,we&&et()})}function lt(me){tt(C.value.get(me.columnId))}function _e(){$.value&&window.confirm("Update is in progress, please wait till the update finishes, if you still can see the message after few seconds, try to force-refresh the page.")}return fe(),c.query.filter_id?(delete y.value.with_default_filter,y.value.filter_id=c.query.filter_id):H.value&&(delete y.value.with_default_filter,y.value.filter_id=H.value.id),window.addEventListener("beforeunload",_e),rt("floating-resource-updated",()=>Ve()),on(()=>{j.value=!1,window.removeEventListener("beforeunload",_e)}),(me,we)=>{const Ue=v("NavbarSeparator"),Oe=v("IButton"),se=v("IButtonGroup"),ke=v("SearchInput"),He=v("IButtonIcon"),yt=v("IModal"),Ke=v("IDropdownItem"),Ze=v("IDropdown"),ze=v("Icon"),Vt=v("CreateDealModal"),Nt=v("CreateActivityModal"),je=v("ILayout"),Rt=ae("i-tooltip"),Kt=ae("i-modal");return d(),R(je,{full:"",overlay:l(i)},{actions:b(()=>[s(Ue,{class:"hidden lg:block"}),o("div",FM,[s(se,{class:"mr-5"},{default:b(()=>[D(s(Oe,{size:"sm",to:{name:"deal-index"},class:"relative focus:z-10",variant:"white",icon:"Bars3","icon-class":"w-4 h-4 text-neutral-500 dark:text-neutral-400"},null,512),[[Rt,me.$t("core::app.list_view"),void 0,{bottom:!0}]]),D(s(Oe,{class:"relative bg-neutral-100 focus:z-10",size:"sm",to:{name:"deal-board"},variant:"white",icon:"ViewColumns","icon-class":"w-4 h-4 text-neutral-700 dark:text-neutral-100"},null,512),[[Rt,me.$t("deals::board.board"),void 0,{bottom:!0}]])]),_:1}),s(Oe,{icon:"Plus",size:"sm",text:me.$t("deals::deal.create"),onClick:le},null,8,["text"])])]),default:b(()=>[s(Az,{"board-id":Un,"board-class":"deals-board"},{top:b(()=>[o("div",VM,[T.value&&l(Z)?(d(),k("div",TM,[s(Rs,{identifier:l(h),view:Fo,class:"flex-1",placement:"bottom-start",onApply:be},null,8,["identifier"]),D(s(Oe,{variant:"white",icon:"PencilAlt",onClick:l(U)},null,8,["onClick"]),[[Y,l(M)&&!l(j)]]),D(s(Oe,{variant:"white",text:me.$t("core::filters.add_filter"),icon:"Plus",onClick:l(U)},null,8,["text","onClick"]),[[Y,!l(M)&&!l(j)]]),T.value?(d(),R(l(Ss),{key:0,identifier:l(h),view:Fo,"initial-apply":!1,"active-filter-id":me.$route.query.filter_id?Number(me.$route.query.filter_id):void 0,onApply:be},null,8,["identifier","active-filter-id"])):O("",!0)])):O("",!0),s(ke,{modelValue:y.value.q,"onUpdate:modelValue":we[0]||(we[0]=kt=>y.value.q=kt),class:"w-full sm:w-auto",placeholder:me.$t("core::app.search"),disabled:l(Z)&&!l(z),onInput:be},null,8,["modelValue","placeholder","disabled"]),o("div",DM,[s(yt,{visible:f.value,"onUpdate:visible":we[3]||(we[3]=kt=>f.value=kt),size:"sm","hide-footer":!0,title:me.$t("deals::deal.pipeline.reorder")},{default:b(()=>[s(l(Et),Re({modelValue:l(E),"onUpdate:modelValue":we[1]||(we[1]=kt=>xt(E)?E.value=kt:null),"item-key":"id",class:"space-y-2 pb-2",handle:".pipeline-order-handle"},l(m),{onChange:we[2]||(we[2]=kt=>u.value=void 0)}),{item:b(({element:kt})=>[o("div",qM,[o("p",{class:"font-medium text-neutral-700 dark:text-neutral-200",textContent:S(kt.name)},null,8,EM),s(He,{icon:"Selector",class:"pipeline-order-handle"})])]),_:1},16,["modelValue"])]),_:1},8,["visible","title"]),o("div",{class:X(["mr-2 w-52 flex-1",{blur:!T.value}])},[s(Ze,{"adaptive-width":"",text:x.value.name},{default:b(()=>[(d(!0),k(te,null,re(l(E),kt=>(d(),R(Ke,{key:kt.id,text:kt.name,onClick:Ot=>$e(kt)},null,8,["text","onClick"]))),128)),l(E).length>1||pe.value?(d(),k("div",AM,[l(E).length>1?(d(),R(Ke,{key:0,class:"font-medium",icon:"Bars3BottomLeft",text:me.$t("deals::deal.pipeline.reorder"),onClick:we[4]||(we[4]=kt=>f.value=!0)},null,8,["text"])):O("",!0),pe.value?(d(),R(Ke,{key:1,class:"font-medium",to:{name:"edit-pipeline",params:{id:x.value.id}},icon:"PencilAlt",text:me.$t("deals::deal.pipeline.edit")},null,8,["to","text"])):O("",!0)])):O("",!0)]),_:1},8,["text"])],2),o("div",null,[D(s(Oe,{variant:"white",icon:"SortAscending"},null,512),[[Rt,me.$t("core::app.sort")],[Kt,"boardSort"]]),s(RM,{onApplied:ce})])])])]),default:b(()=>[(d(!0),k(te,null,re(C.value,([kt,Ot])=>(d(),R(Lz,{key:Ot.name,modelValue:Ot.cards,"onUpdate:modelValue":$t=>Ot.cards=$t,name:Ot.name,"column-id":kt,move:ne,loader:Ge,"board-id":Un,onDragStart:we[5]||(we[5]=$t=>N.value=!0),onDragEnd:we[6]||(we[6]=$t=>N.value=!1),onUpdated:lt},{afterColumnHeader:b(()=>[o("div",BM,[Ot.win_probability===100||oe.value||g.value[Ot.id].value===0?(d(),k("span",{key:0,class:"text-neutral-600 dark:text-neutral-300",textContent:S(l(p)(g.value[Ot.id].value))},null,8,NM)):D((d(),k("span",OM,[s(ze,{icon:"Scale",class:"mr-1 h-4 w-4"}),o("span",null,S(l(p)(g.value[Ot.id].weighted_value)),1)])),[[Rt,me.$t("deals::deal.stage.weighted_value",{weighted_total:l(p)(g.value[Ot.id].weighted_value),win_probability:Ot.win_probability+"%",total:l(p)(g.value[Ot.id].value)}),void 0,{right:!0}]]),zM,o("span",MM,S(me.$t("deals::deal.count.all",{count:g.value[Ot.id].count})),1)])]),topRight:b(()=>[s(He,{icon:"Plus",variant:"primary",onClick:$t=>Ce(Ot)},null,8,["onClick"])]),card:b(({card:$t})=>[s(gM,{amount:$t.amount,"onUpdate:amount":[rn=>$t.amount=rn,rn=>et($t.stage_id)],"products-count":$t.products_count,"onUpdate:productsCount":[rn=>$t.products_count=rn,rn=>et($t.stage_id)],"swatch-color":$t.swatch_color,"onUpdate:swatchColor":[rn=>$t.swatch_color=rn,rn=>Te(Ot)],"deal-id":$t.id,"display-name":$t.display_name,path:$t.path,status:$t.status,"incomplete-activities-count":$t.incomplete_activities_for_user_count,"next-activity-date":$t.next_activity_date||void 0,"expected-close-date":$t.expected_close_date||void 0,"falls-behind-expected-close-date":$t.falls_behind_expected_close_date,onCreateActivityRequested:rn=>_.value=$t},null,8,["amount","onUpdate:amount","products-count","onUpdate:productsCount","swatch-color","onUpdate:swatchColor","deal-id","display-name","path","status","incomplete-activities-count","next-activity-date","expected-close-date","falls-behind-expected-close-date","onCreateActivityRequested"])]),_:2},1032,["modelValue","onUpdate:modelValue","name","column-id"]))),128))]),_:1}),s(Vt,Re({visible:F.value,"onUpdate:visible":we[7]||(we[7]=kt=>F.value=kt),"with-extended-submit-buttons":!0,"go-to-list":!1},ee.value,{onModalHidden:Ie,onCreated:ye}),null,16,["visible"]),s(Nt,{visible:_.value!==null,deals:[_.value],"with-extended-submit-buttons":!0,"go-to-list":!1,onCreated:we[8]||(we[8]=({isRegularAction:kt})=>(kt&&(_.value=null),Ve())),onModalHidden:we[9]||(we[9]=kt=>_.value=null)},null,8,["visible","deals"]),D(s(nM,{"resource-id":Un,onUpdateRequest:at,onRefreshRequested:Ve,onDeleted:we[10]||(we[10]=kt=>et()),onWon:we[11]||(we[11]=kt=>et())},null,512),[[Y,N.value]])]),_:1},8,["overlay"])}}},PM={class:"ml-3 sm:w-1/5"},jM={__name:"DealsImport",setup(e){const t=Innoclapps.resourceName("deals"),{orderedPipelines:n}=sn(),a=dt(n.value[0]);return(r,i)=>{const u=v("ICustomSelect"),c=v("i18n-t"),m=v("ICardHeading"),p=v("ILayout");return d(),R(p,null,{default:b(()=>[s(l($s),{"resource-name":l(t),"request-query-string":{pipeline_id:a.value.id}},{header:b(()=>[s(m,{class:"flex items-center"},{default:b(()=>[s(c,{scope:"global",keypath:"deals::deal.import_in"},{pipeline:b(()=>[o("div",PM,[s(u,{modelValue:a.value,"onUpdate:modelValue":i[0]||(i[0]=f=>a.value=f),clearable:!1,label:"name",options:l(n)},null,8,["modelValue","options"])])]),_:1})]),_:1})]),_:1},8,["resource-name","request-query-string"])]),_:1})}}},LM={class:"ml-auto flex items-center text-sm"},HM=["textContent"],GM={class:"mx-1 text-neutral-900 dark:text-neutral-300",textContent:"-"},KM={class:"inline-flex items-center font-medium text-neutral-800 dark:text-neutral-300"},YM=o("span",{class:"mx-1 text-neutral-900 dark:text-neutral-300"},"-",-1),WM={class:"font-medium text-neutral-800 dark:text-neutral-300"},QM=Object.assign({inheritAttrs:!1},{__name:"DealsTable",props:{tableId:{required:!0,type:String},initialize:{default:!0,type:Boolean}},emits:["deleted","loaded"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("deals"),{t:r}=ve(),{formatMoney:i}=Mt(),{reloadTable:u}=Bt(),{floatResourceInEditMode:c}=an(),{deleteResource:m}=Je(a),p=q(null),{findRule:f}=pn(n.tableId),h=V(()=>{let _=f("status");return _?_.query.value==="won"||_.query.value==="lost":!1});function g(_){return{"has-warning":!0,"warning-confirmed":_.falls_behind_expected_close_date===!0}}async function y(_){await Innoclapps.dialog().confirm(),await m(_),t("deleted",_),u(n.tableId),Innoclapps.success(r("core::resource.deleted"))}return(_,I)=>{const F=v("Icon"),$=v("IBadge"),C=v("CreateActivityModal"),w=ae("t");return d(),k(te,null,[e.initialize?(d(),R(l(tn),Re({key:0,"resource-name":l(a),"row-class":g,"table-id":e.tableId,"empty-state":{to:{name:"create-deal"},title:_.$t("deals::deal.empty_state.title"),buttonText:_.$t("deals::deal.create"),description:_.$t("deals::deal.empty_state.description"),secondButtonText:_.$t("core::import.from_file",{file_type:"CSV"}),secondButtonIcon:"DocumentAdd",secondButtonTo:{name:"import-resource",params:{resourceName:l(a)}}}},_.$attrs,{onLoaded:I[0]||(I[0]=x=>_.$emit("loaded",x))}),{"after-search":b(({collection:x})=>{var A,N,T,E,B,z,M,j,U;return[o("div",LM,[o("span",{class:"font-medium text-neutral-800 dark:text-neutral-300",textContent:S(l(i)((A=x.state.meta.summary)==null?void 0:A.value))},null,8,HM),D(o("span",GM,null,512),[[Y,!h.value&&((N=x.state.meta.summary)==null?void 0:N.weighted_value)>0&&((T=x.state.meta.summary)==null?void 0:T.weighted_value)!==((E=x.state.meta.summary)==null?void 0:E.value)]]),D(o("span",KM,[s(F,{icon:"Scale",class:"mr-1 h-4 w-4"}),o("span",null,S(l(i)((B=x.state.meta.summary)==null?void 0:B.weighted_value)),1)],512),[[Y,!h.value&&((z=x.state.meta.summary)==null?void 0:z.weighted_value)>0&&((M=x.state.meta.summary)==null?void 0:M.weighted_value)!==((j=x.state.meta.summary)==null?void 0:j.value)]]),YM,D(o("span",WM,null,512),[[w,{path:"deals::deal.count.all",args:{count:(U=x.state.meta.summary)==null?void 0:U.count}}]])])]}),status:b(({row:x,column:A})=>[s($,{variant:A.statuses[x.status].badge,rounded:!1,class:"rounded"},{default:b(()=>[Q(S(_.$t("deals::deal.status."+A.statuses[x.status].name)),1)]),_:2},1032,["variant"])]),actions:b(({row:x})=>[s(Mn,null,{default:b(()=>[s(Ft,{tooltip:_.$t("activities::activity.create"),icon:"Clock",onClick:A=>p.value=x},null,8,["tooltip","onClick"]),x.authorizations.update?(d(),R(Ft,{key:0,tooltip:_.$t("core::app.edit"),icon:"PencilAlt",onClick:A=>l(c)({resourceName:l(a),resourceId:x.id})},null,8,["tooltip","onClick"])):O("",!0),x.authorizations.delete?(d(),R(Ft,{key:1,tooltip:_.$t("core::app.delete"),icon:"Trash",onClick:A=>y(x.id)},null,8,["tooltip","onClick"])):O("",!0)]),_:2},1024)]),_:1},16,["resource-name","table-id","empty-state"])):O("",!0),s(C,{visible:p.value!==null,deals:[p.value],"with-extended-submit-buttons":!0,"go-to-list":!1,onCreated:I[1]||(I[1]=({isRegularAction:x})=>(x&&(p.value=null),l(u)(e.tableId))),onModalHidden:I[2]||(I[2]=x=>p.value=null)},null,8,["visible","deals"])],64)}}}),XM={class:"inline-flex items-center"},ZM={class:"mr-3 lg:mr-6"},Vo="deals",JM={__name:"DealsIndex",setup(e){const t=Innoclapps.resourceName("deals"),n=Ye(),{reloadTable:a,customizeTable:r}=Bt(),i=q(n.meta.initialize),u=q(!0),c=V(()=>i.value&&!u.value);function m(){Innoclapps.$emit("refresh-cards"),a(Vo)}return yn((p,f,h)=>{i.value=!0,h()}),(p,f)=>{const h=v("NavbarSeparator"),g=v("IDropdownItem"),y=v("IMinimalDropdown"),_=v("IButton"),I=v("IButtonGroup"),F=v("router-view"),$=v("ILayout"),C=ae("i-tooltip");return d(),R($,null,{actions:b(()=>[s(h,{class:"hidden lg:block"}),o("div",XM,[o("div",ZM,[s(y,{type:"horizontal"},{default:b(()=>[s(g,{icon:"DocumentAdd",to:{name:"import-deal"},text:p.$t("core::import.import")},null,8,["text"]),p.$gate.userCan("export deals")?(d(),R(g,{key:0,icon:"DocumentDownload",text:p.$t("core::app.export.export"),onClick:f[0]||(f[0]=w=>p.$iModal.show("export-modal"))},null,8,["text"])):O("",!0),s(g,{icon:"Trash",to:{name:"trashed-resource-records",params:{resourceName:l(t)}},text:p.$t("core::app.soft_deletes.trashed")},null,8,["to","text"]),s(g,{icon:"Cog",text:p.$t("core::table.list_settings"),onClick:f[1]||(f[1]=w=>l(r)(Vo))},null,8,["text"])]),_:1})]),s(I,{class:"mr-5"},{default:b(()=>[D(s(_,{size:"sm",class:"relative bg-neutral-100 focus:z-10",to:{name:"deal-index"},variant:"white",icon:"Bars3","icon-class":"w-4 h-4 text-neutral-700 dark:text-neutral-100"},null,512),[[C,p.$t("core::app.list_view"),void 0,{bottom:!0}]]),D(s(_,{size:"sm",class:"relative focus:z-10",to:{name:"deal-board"},variant:"white",icon:"ViewColumns","icon-class":"w-4 h-4 text-neutral-500 dark:text-neutral-400"},null,512),[[C,p.$t("deals::board.board"),void 0,{bottom:!0}]])]),_:1}),s(_,{to:{name:"create-deal"},icon:"Plus",size:"sm",text:p.$t("deals::deal.create")},null,8,["text"])])]),default:b(()=>[c.value?(d(),R(nl,{key:0,"resource-name":l(t)},null,8,["resource-name"])):O("",!0),s(QM,{"table-id":Vo,initialize:i.value,"filter-id":p.$route.query.filter_id?Number(p.$route.query.filter_id):void 0,onLoaded:f[2]||(f[2]=w=>u.value=w.empty),onDeleted:m},null,8,["initialize","filter-id"]),s(l(go),{"url-path":"/deals/export","resource-name":l(t),"filters-view":Vo,title:p.$t("deals::deal.export")},null,8,["resource-name","title"]),s(F,{name:"create","redirect-to-view":!0,onCreated:f[3]||(f[3]=({isRegularAction:w})=>w?void 0:m()),onModalHidden:p.$router.back},null,8,["onModalHidden"])]),_:1})}}},eU={class:"px-4 py-5 sm:px-6"},tU={__name:"DealsViewCompanies",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>St([e.resource.companies.map(a=>a.updated_at)],()=>(d(),k("div",{class:"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},[o("div",eU,[s(Js,{"deal-id":e.resourceId,companies:e.resource.companies,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onCreateRequested:n[0]||(n[0]=a=>t.$router.push({name:"createCompanyViaDeal",params:{id:e.resourceId}}))},null,8,["deal-id","companies","authorize-dissociate","show-create-button"])])])),n,1)}},nU={class:"px-4 py-5 sm:px-6"},oU={__name:"DealsViewContacts",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>St([e.resource.contacts.map(a=>a.updated_at)],()=>(d(),k("div",{class:"rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},[o("div",nU,[s(er,{"deal-id":e.resourceId,contacts:e.resource.contacts,"authorize-dissociate":e.resource.authorizations.update,"show-create-button":e.resource.authorizations.update,onCreateRequested:n[0]||(n[0]=a=>t.$router.push({name:"createContactViaDeal",params:{id:e.resourceId}}))},null,8,["deal-id","contacts","authorize-dissociate","show-create-button"])])])),n,1)}},lU={class:"overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},aU={class:"flex items-center justify-between px-6 py-3"},sU={class:"inline-flex items-center"},rU={key:0,class:"mr-2 block h-2 w-2 rounded-full bg-danger-500"},iU={class:"font-medium text-neutral-800 dark:text-white"},uU={class:"flex items-center space-x-3"},dU=Object.assign({inheritAttrs:!1},{__name:"DealsViewDetails",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=e,n=Innoclapps.config("fields.views.detail"),a=q(!0),{fields:r,getDetailFields:i}=gt(),{floatResourceInEditMode:u}=an();i(t.resourceName,t.resource.id).then(m=>r.value.set(m).populate(t.resource));const c=V(()=>r.value.isNotEmpty());return(m,p)=>{const f=v("IButtonIcon"),h=v("DetailFields"),g=v("IOverlay"),y=ae("t"),_=ae("i-tooltip");return d(),R(g,{show:!c.value,class:X({"rounded-lg bg-white p-6 shadow dark:bg-neutral-900":!c.value})},{default:b(()=>[D(o("div",lU,[o("div",aU,[o("div",sU,[l(r).requiredFieldsMissingValues?(d(),k("span",rU)):O("",!0),D(o("h2",iU,null,512),[[y,"core::app.record_view.sections.details"]])]),o("div",uU,[s(f,{size:"sm",icon:"PencilAlt","icon-class":"h-[1.03rem] w-[1.03rem]",onClick:p[0]||(p[0]=I=>l(u)({resourceName:e.resourceName,resourceId:e.resourceId}))}),m.$gate.isSuperAdmin()?D((d(),R(f,{key:0,size:"sm",to:{name:"resource-fields",params:{resourceName:e.resourceName},query:{view:l(n)}},icon:"AdjustmentsVertical","icon-class":"h-[1.1rem] w-[1.1rem]"},null,8,["to"])),[[_,m.$t("core::fields.manage")]]):O("",!0),l(r).hasCollapsable?(d(),R(Bn,{key:1,collapsed:a.value,"onUpdate:collapsed":p[1]||(p[1]=I=>a.value=I),total:l(r).totalCollapsable},null,8,["collapsed","total"])):O("",!0)])]),c.value?(d(),R(h,Re({key:0},m.$attrs,{class:"overflow-y-auto px-3 py-4",resizeable:"","initial-height-class":"h-[8rem]",collapsed:a.value,fields:l(r),"resource-name":e.resourceName,"resource-id":e.resource.id,resource:e.resource}),null,16,["collapsed","fields","resource-name","resource-id","resource"])):O("",!0)],512),[[Y,c.value]])]),_:1},8,["show","class"])}}}),cU={__name:"DealsViewMedia",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=Me("synchronizeResource");return(n,a)=>St([e.resource.media.map(r=>r.updated_at)],()=>s(kn,{"resource-name":e.resourceName,"resource-id":e.resourceId,media:e.resource.media,"authorize-delete":e.resource.authorizations.update,onDeleted:a[0]||(a[0]=r=>l(t)({media:{id:r.id,_delete:!0}})),onUploaded:a[1]||(a[1]=r=>l(t)({media:[r]}))},null,8,["resource-name","resource-id","media","authorize-delete"]),a,2)}},mU={class:"flex items-center px-4 py-2 text-sm font-medium"},pU={class:"ml-4 text-sm font-medium text-neutral-900 dark:text-neutral-200"},fU={__name:"DealMiniPipelineStageComplete",props:{dealStatus:{type:String,required:!0},requestInProgress:Boolean,stageIndex:{required:!0,type:Number},dealStageIndex:{required:!0,type:Number}},emits:["click"],setup(e){const t=e,n=V(()=>t.stageIndex>t.dealStageIndex),a=V(()=>t.stageIndex<=t.dealStageIndex);return(r,i)=>{const u=v("ISpinner"),c=v("Icon");return d(),k("a",{href:"#",class:"group flex w-full items-center",onClick:i[0]||(i[0]=ie(m=>r.$emit("click"),["prevent"]))},[o("span",mU,[o("span",{class:X(["flex h-7 w-7 shrink-0 items-center justify-center rounded-full",[{"bg-success-500 group-hover:bg-success-700 dark:bg-success-400 dark:group-hover:bg-success-600":e.dealStatus==="won"&&a.value||e.dealStatus==="open","border border-success-500 bg-transparent group-hover:border-success-700 dark:border-success-400 dark:group-hover:border-success-600":e.dealStatus==="won"&&n.value,"bg-danger-500 group-hover:bg-danger-700 dark:bg-danger-400 dark:group-hover:bg-danger-600":e.dealStatus==="lost"&&a.value,"border border-danger-500 bg-transparent group-hover:border-danger-700 dark:border-danger-400 dark:group-hover:border-danger-600":e.dealStatus==="lost"&&n.value}]])},[e.requestInProgress?(d(),R(u,{key:0,class:"h-6 w-6 text-current"})):e.dealStatus==="open"||e.dealStatus==="won"?(d(),R(c,{key:1,icon:"Check",class:X(["h-6 w-6",e.dealStatus==="open"?"text-white":{"text-white":a.value,"text-success-500":n.value}])},null,8,["class"])):(d(),R(c,{key:2,icon:"X",class:X(["h-6 w-6",{"text-white":a.value,"text-danger-500":n.value}])},null,8,["class"]))],2),o("span",pU,[de(r.$slots,"default")])])])}}},vU={class:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border-2 border-success-500 dark:border-success-400"},bU={class:"text-success-500 dark:text-success-400"},hU={class:"ml-4 text-sm font-medium text-success-500 dark:text-success-400"},_U={__name:"DealMiniPipelineStageCurrent",props:{requestInProgress:Boolean},emits:["click"],setup(e){return(t,n)=>{const a=v("ISpinner"),r=v("Icon");return d(),k("a",{href:"#",class:"flex items-center px-4 py-2 text-sm font-medium","aria-current":"step",onClick:n[0]||(n[0]=ie(i=>t.$emit("click"),["prevent"]))},[o("span",vU,[o("span",bU,[e.requestInProgress?(d(),R(a,{key:0,class:"h-6 w-6 text-success-500 dark:text-success-400"})):(d(),R(r,{key:1,icon:"Check",class:"h-6 w-6 text-success-500 dark:text-success-400"}))])]),o("span",hU,[de(t.$slots,"default")])])}}},gU={class:"flex items-center px-4 py-2 text-sm font-medium"},yU={class:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full border-2 border-neutral-300 group-hover:border-neutral-400 dark:border-neutral-500 dark:group-hover:border-neutral-100"},xU={class:"ml-4 text-sm font-medium text-neutral-500 group-hover:text-neutral-900 dark:text-neutral-400 dark:group-hover:text-neutral-100"},IU={__name:"DealMiniPipelineStageFuture",props:{requestInProgress:Boolean},emits:["click"],setup(e){return(t,n)=>{const a=v("ISpinner"),r=v("Icon");return d(),k("a",{href:"#",class:"group flex items-center",onClick:n[0]||(n[0]=ie(i=>t.$emit("click"),["prevent"]))},[o("span",gU,[o("span",yU,[e.requestInProgress?(d(),R(a,{key:0,class:"h-6 w-6 text-neutral-500 dark:text-neutral-200"})):(d(),R(r,{key:1,icon:"Plus",class:"h-5 w-5 text-neutral-500 dark:text-neutral-100"}))]),o("span",xU,[de(t.$slots,"default")])])])}}},kU={class:"relative overflow-hidden truncate bg-neutral-50 dark:bg-neutral-800 lg:flex lg:flex-1"},$U={key:3,class:"absolute right-0 top-0 hidden h-full w-5 bg-neutral-50 dark:bg-neutral-800 lg:block","aria-hidden":"true"},wU=o("svg",{class:"h-full w-full text-neutral-300 dark:text-neutral-600",viewBox:"0 0 22 80",fill:"none",preserveAspectRatio:"none"},[o("path",{d:"M0 -2L20 40L0 82","vector-effect":"non-scaling-stroke",stroke:"currentcolor","stroke-linejoin":"round"})],-1),CU=[wU],SU={__name:"DealMiniPipelineStage",props:{dealStatus:{type:String,required:!0},stageId:{type:Number,required:!0},timeInStages:{type:Object,required:!0},stageName:{type:String,required:!0},totalStages:{type:Number,required:!0},dealId:{type:Number,required:!0},dealStageId:{type:Number,required:!0},dealStageIndex:{type:Number,required:!0},index:{required:!0,type:Number}},emits:["stage-updated"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{updateResource:r,resourceBeingUpdated:i}=Je(Innoclapps.resourceName("deals")),u=V(()=>n.index),c=V(()=>n.dealStageIndex>u.value),m=V(()=>n.dealStageIndex===u.value),p=V(()=>n.timeInStages[n.stageId]!=null),f=V(()=>moment.duration({seconds:p.value?n.timeInStages[n.stageId]:0})),h=V(()=>{let y="";return n.totalStages>6&&(y+=n.stageName+" - "),p.value?y+=a("deals::deal.been_in_stage_time",{time:f.value.humanize()}):y+=a("deals::deal.hasnt_been_in_stage"),y});function g(){n.stageId===n.dealStageId||n.dealStatus!=="open"||r({stage_id:n.stageId},n.dealId).then(y=>{t("stage-updated",y)})}return(y,_)=>{const I=ae("i-tooltip");return d(),k("li",kU,[c.value||e.dealStatus==="lost"||e.dealStatus==="won"?D((d(),R(fU,{key:0,"request-in-progress":l(i),"deal-status":e.dealStatus,"deal-stage-index":e.dealStageIndex,"stage-index":e.index,onClick:g},{default:b(()=>[Q(S(e.stageName),1)]),_:1},8,["request-in-progress","deal-status","deal-stage-index","stage-index"])),[[I,h.value]]):m.value?D((d(),R(_U,{key:1,"request-in-progress":l(i),onClick:g},{default:b(()=>[Q(S(e.stageName),1)]),_:1},8,["request-in-progress"])),[[I,h.value]]):D((d(),R(IU,{key:2,"request-in-progress":l(i),onClick:g},{default:b(()=>[Q(S(e.stageName),1)]),_:1},8,["request-in-progress"])),[[I,h.value]]),e.index!==e.totalStages-1?(d(),k("div",$U,CU)):O("",!0)])}}},RU={"aria-label":"Progress"},FU={class:"divide-y divide-neutral-300 overflow-hidden rounded-md border border-neutral-300 dark:divide-neutral-600 dark:border-neutral-600 lg:flex lg:flex-wrap lg:divide-y-0"},VU={__name:"DealMiniPipeline",props:{stages:{type:Array,required:!0},dealId:{type:Number,required:!0},dealStageId:{type:Number,required:!0},dealStatus:{type:String,required:!0},timeInStages:{type:Object,required:!0}},emits:["stage-updated"],setup(e){const t=e,n=V(()=>t.stages.findIndex(a=>a.id==t.dealStageId));return(a,r)=>(d(),k("nav",RU,[o("ol",FU,[(d(!0),k(te,null,re(e.stages,(i,u)=>(d(),R(SU,{key:i.id,"stage-id":i.id,"stage-name":i.name,"total-stages":e.stages.length,"time-in-stages":e.timeInStages,"deal-stage-id":e.dealStageId,"deal-id":e.dealId,"deal-status":e.dealStatus,"deal-stage-index":n.value,index:u,onStageUpdated:r[0]||(r[0]=c=>a.$emit("stage-updated",c))},null,8,["stage-id","stage-name","total-stages","time-in-stages","deal-stage-id","deal-id","deal-status","deal-stage-index","index"]))),128))])]))}},TU={class:"mx-auto max-w-7xl"},DU={key:1,class:"relative"},qU={class:"overflow-hidden rounded-lg border border-neutral-200 bg-white shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},EU={class:"bg-white px-3 py-4 dark:bg-neutral-900 sm:p-6"},AU={class:"flex grow flex-col lg:flex-row lg:items-center"},BU={class:"overflow-hidden text-center lg:flex lg:grow lg:items-center lg:space-x-4 lg:text-left"},NU={class:"overflow-hidden"},OU={class:"lg:flex lg:items-center lg:space-x-4"},zU={class:"relative truncate"},MU=["textContent"],UU=o("button",{type:"button",class:"hide absolute left-1/2 top-1/2 mt-3 h-0 w-0 -translate-x-1/2 -translate-y-1/2 transform"},null,-1),PU={class:"p-4"},jU={class:"flex justify-end space-x-1 bg-neutral-100 px-4 py-3 dark:bg-neutral-900"},LU={class:"inline-block lg:shrink-0"},HU={class:"my-1 flex flex-col justify-center space-y-2 lg:mb-1 lg:flex-row lg:justify-start lg:space-x-3 lg:space-y-0"},GU=["onClick"],KU={key:1,class:"order-2 shrink-0 text-sm text-neutral-700 dark:text-neutral-200 sm:order-1"},YU={class:"ml-6 flex shrink-0 flex-col items-center lg:flex-row lg:space-x-3"},WU={class:"mt-5 flex shrink-0 justify-center space-x-3 lg:mt-0 lg:items-center lg:justify-normal"},QU={key:0,class:"absolute -top-5 right-2 rotate-90 lg:-right-6 lg:top-1.5 lg:rotate-0"},XU={key:2,class:"mt-8"},ZU={class:"lg:grid lg:grid-cols-12 lg:gap-8"},JU={class:"col-span-4 space-y-3"},eP={class:"col-span-8 mt-4 lg:mt-0"},tP={__name:"DealsView",setup(e){const t={"timeline-tab":oa,"timeline-tab-panel":la},n={"details-section":dU,"contacts-section":oU,"companies-section":tU,"media-section":cU},a=Innoclapps.resourceName("deals"),r=Qe(),i=Ye(),{localizedDateTime:u}=Ne(),{form:c}=Ae({name:null}),m=q(null),p=q(!1),f=q(!1),h=q(Innoclapps.resource("deals").pages.detail),g=i.query.section?h.value.tabs.findIndex(U=>U.id===i.query.section):0;let y=V(()=>i.params.id);const{resource:_,resourceSingularName:I,synchronizeResource:F,detachResourceAssociations:$,incrementResourceCount:C,decrementResourceCount:w,fetchResource:x,updateResource:A,resourceReady:N}=fo(a,y),T=V(()=>{var U,P;return(P=(U=_.value)==null?void 0:U.authorizations)!=null&&P.view?`Modules.Deals.Models.Deal.${y.value}`:null});rt("refresh-details-view",()=>x()),rt("floating-resource-updated",()=>x());const E=V(()=>h.value.sections.filter(U=>U.enabled===!0)),B=V(()=>_.value.pipeline.stages.map(({id:U,name:P})=>({id:U,name:P})));mt("synchronizeResource",F),mt("detachResourceAssociations",$),mt("incrementResourceCount",C),mt("decrementResourceCount",w),Ut(V(()=>_.value.display_name)),Fs(T,".DealUpdated",()=>x());function z(){f.value=!0}function M(U){U.destroyable?r.push({name:"deal-index"}):x()}function j(){A(c).then(()=>m.value.hide())}return x(),(U,P)=>{const H=v("IAlert"),L=v("IFormError"),Z=v("IFormGroup"),J=v("IButton"),K=v("IPopover"),G=v("IDropdownItem"),oe=v("IMinimalDropdown"),pe=v("ITabList"),ue=v("ITabPanels"),ee=v("ITabGroup"),W=v("router-view"),ne=v("ILayout"),ce=ae("t");return d(),R(ne,{overlay:!l(N)},{default:b(()=>[o("div",TU,[l(N)&&U.$gate.denies("view",l(_))?(d(),R(H,{key:0,class:"mb-6",variant:"warning"},{default:b(()=>[Q(S(U.$t("core::role.view_non_authorized_after_record_create")),1)]),_:1})):O("",!0),l(N)?(d(),k("div",DU,[o("div",qU,[o("div",EU,[o("div",AU,[o("div",BU,[o("div",NU,[o("div",OU,[o("h1",zU,[o("span",{class:X(["text-2xl font-bold text-neutral-900 dark:text-white",{"cursor-pointer rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-700":l(_).authorizations.update}]),onClick:P[0]||(P[0]=fe=>l(_).authorizations.update&&U.$refs.namePopoverRef.show()),textContent:S(l(_).display_name)},null,10,MU),l(_).authorizations.update?(d(),R(K,{key:0,ref_key:"namePopoverRef",ref:m,class:"w-72",onShow:P[4]||(P[4]=fe=>l(c).name=l(_).name),onHide:P[5]||(P[5]=fe=>l(c).errors.clear())},{popper:b(()=>[o("div",PU,[s(Z,{required:"",label:U.$t("deals::fields.deals.name"),"label-for":"editDealName"},{default:b(()=>[(d(),R(We(l(_).name.length<=60?"IFormInput":"IFormTextarea"),{id:"editDealName",modelValue:l(c).name,"onUpdate:modelValue":P[1]||(P[1]=fe=>l(c).name=fe),class:"font-normal",onKeydown:[Tt(j,["enter"]),P[2]||(P[2]=fe=>l(c).errors.clear("name"))]},null,40,["modelValue","onKeydown"])),s(L,{textContent:S(l(c).getError("name"))},null,8,["textContent"])]),_:1},8,["label"])]),o("div",jU,[s(J,{size:"sm",variant:"white",disabled:l(c).busy,text:U.$t("core::app.cancel"),onClick:P[3]||(P[3]=()=>U.$refs.namePopoverRef.hide())},null,8,["disabled","text"]),s(J,{size:"sm",variant:"primary",loading:l(c).busy,disabled:l(c).busy||!l(c).name,text:U.$t("core::app.save"),onClick:j},null,8,["loading","disabled","text"])])]),default:b(()=>[UU]),_:1},512)):O("",!0)]),o("div",LU,[s(Wo,{simple:!0,disabled:!l(_).authorizations.update,class:"mt-0.5",type:"deals","model-value":l(_).tags,"onUpdate:modelValue":P[6]||(P[6]=fe=>l(A)({tags:fe}))},null,8,["disabled","model-value"])])]),l(_).authorizations.update?(d(),R(el,{key:0,"resource-name":l(a),"resource-id":l(_).id,visible:f.value,prefetch:"",onHidden:P[7]||(P[7]=fe=>f.value=!1),onSaved:P[8]||(P[8]=fe=>l(F)({_sync_timestamp:new Date,billable:fe,amount:fe.total,products_count:fe.products.length}))},null,8,["resource-name","resource-id","visible"])):O("",!0),o("div",HU,[l(_).authorizations.update?D((d(),k("a",{key:0,href:"#",class:"link order-2 shrink-0 text-sm font-normal sm:order-1",onClick:ie(z,["prevent"])},null,8,GU)),[[ce,{path:"billable::product.count",args:{count:l(_).products_count}}]]):D((d(),k("span",KU,null,512)),[[ce,{path:"billable::product.count",args:{count:l(_).products_count}}]]),s(tr,{"deal-id":l(_).id,pipeline:l(_).pipeline,"stage-id":l(_).stage_id,status:l(_).status,"authorized-to-update":l(_).authorizations.update,class:"order-1 shrink-0 justify-center text-sm font-medium text-neutral-800 hover:text-neutral-600 dark:text-neutral-200 dark:hover:text-neutral-400 sm:order-2 lg:justify-start",onUpdated:P[9]||(P[9]=fe=>l(F)(fe,!0))},null,8,["deal-id","pipeline","stage-id","status","authorized-to-update"])]),P[10]||(he(-1),P[10]=o("p",{class:"text-sm text-neutral-600 dark:text-neutral-300"},[Q(S(U.$t("core::app.created_at"))+" "+S(l(u)(l(_).created_at)),1)]),he(1),P[10])])]),o("div",YU,[l(_).authorizations.update?(d(),R(nr,{key:0,class:"mr-3 mt-5 lg:mt-0 lg:shrink-0","deal-id":l(_).id,"deal-status":l(_).status,onUpdated:P[11]||(P[11]=fe=>l(F)(fe,!0))},null,8,["deal-id","deal-status"])):O("",!0),o("div",WU,[s(aa,{owner:l(_).user,"authorize-update":l(_).authorizations.update,onChange:P[12]||(P[12]=fe=>l(A)({user_id:fe.id}))},null,8,["owner","authorize-update"]),s(Qn,{type:"dropdown",ids:l(_).id||[],actions:l(_).actions||[],"resource-name":l(a),onRun:M},null,8,["ids","actions","resource-name"])])])]),s(VU,{stages:B.value,"time-in-stages":l(_).time_in_stages,"deal-status":l(_).status,"deal-stage-id":l(_).stage_id,"deal-id":l(_).id,class:"mt-5",onStageUpdated:l(F)},null,8,["stages","time-in-stages","deal-status","deal-stage-id","deal-id","onStageUpdated"])])]),P[13]||(he(-1),P[13]=U.$gate.isSuperAdmin()?(d(),k("div",QU,[s(oe,{placement:"bottom-end"},{default:b(()=>[s(G,{text:U.$t("core::app.record_view.manage_sidebar"),onClick:fe=>p.value=!0},null,8,["text","onClick"])]),_:1})])):O("",!0),he(1),P[13])])):O("",!0),l(N)?(d(),k("div",XU,[o("div",ZU,[o("div",JU,[(d(!0),k(te,null,re(E.value,fe=>D((d(),k("div",{key:fe.id},[(d(),R(We(Object.hasOwn(n,fe.component)?n[fe.component]:fe.component),{"resource-name":l(a),"resource-id":l(_).id,resource:l(_),onUpdated:P[14]||(P[14]=Se=>l(F)(Se,!0))},null,40,["resource-name","resource-id","resource"]))])),[[Y,!p.value]])),128)),s(na,{sections:h.value.sections,"onUpdate:sections":P[15]||(P[15]=fe=>h.value.sections=fe),show:p.value,"onUpdate:show":P[16]||(P[16]=fe=>p.value=fe),identifier:l(I),class:"-mt-3 inline",onSaved:P[17]||(P[17]=fe=>p.value=!1)},null,8,["sections","show","identifier"])]),o("div",eP,[s(ee,{"default-index":l(g)},{default:b(()=>[s(pe,{centered:"",bordered:!1,"list-wrapper-class":"rounded-md border border-neutral-200 bg-white py-0.5 shadow-sm dark:border-neutral-700 dark:bg-neutral-900"},{default:b(()=>[(d(!0),k(te,null,re(h.value.tabs,fe=>(d(),R(We(Object.hasOwn(t,fe.component)?t[fe.component]:fe.component),{key:fe.id,"resource-name":l(a),"resource-id":l(_).id,resource:l(_)},null,8,["resource-name","resource-id","resource"]))),128))]),_:1}),s(ue,null,{default:b(()=>[(d(!0),k(te,null,re(h.value.tabs,fe=>(d(),R(We(Object.hasOwn(t,fe.panelComponent)?t[fe.panelComponent]:fe.panelComponent),{id:"tabPanel-"+fe.id,key:fe.id,"resource-name":l(a),"resource-id":l(_).id,resource:l(_),"scroll-element":"#main"},null,8,["id","resource-name","resource-id","resource"]))),128))]),_:1})]),_:1},8,["default-index"])])])])):O("",!0)]),l(N)?(d(),R(W,{key:0,"via-resource":l(a),"parent-resource":l(_),"go-to-list":!1,onAssociated:P[18]||(P[18]=fe=>(l(x)(),U.$router.back())),onCreated:P[19]||(P[19]=({isRegularAction:fe})=>(fe&&U.$router.back(),l(x)())),onModalHidden:U.$router.back},null,8,["via-resource","parent-resource","onModalHidden"])):O("",!0)]),_:1},8,["overlay"])}}},fl=Bl("deals-board-view-default",!1),nP=[{path:"/deals",name:"deal-index",component:JM,meta:{title:qe.t("deals::deal.deals"),subRoutes:["create-deal"],boardRoute:"deal-board",initialize:!1},beforeEnter:async(e,t)=>{if(fl.value&&t.name!=e.meta.boardRoute&&e.meta.subRoutes.indexOf(e.name)===-1)return{name:e.meta.boardRoute,query:e.query};e.meta.initialize=e.name==="deal-index",e.meta.subRoutes.indexOf(e.name)===-1&&(fl.value=!1)},children:[{path:"create",name:"create-deal",components:{create:$l},meta:{title:qe.t("deals::deal.create")}}]},{path:"/import/deals",name:"import-deal",component:jM,meta:{title:qe.t("deals::deal.import")}},{path:"/deals/board",name:"deal-board",component:UM,meta:{title:qe.t("deals::deal.deals")},beforeEnter:()=>{fl.value=!0}},{path:"/deals/:id",name:"view-deal",component:tP,children:[{path:"contacts/create",component:Cl,name:"createContactViaDeal"},{path:"companies/create",component:wl,name:"createCompanyViaDeal"}].map(e=>Object.assign(e,{meta:{scrollToTop:!1}}))}],{setPipelines:oP}=sn(),{setLostReasons:lP}=sa();window.Innoclapps&&Innoclapps.booting((e,t)=>{e.component("DealPresentationCard",tz),e.component("DealFloatingModal",ez),e.component("CreateDealModal",NO),e.component("FormLostReasonField",mz),e.component("FormPipelineStageField",pz),e.component("IndexPipelineStageField",hz),e.component("IndexLostReasonField",bz),oP(Innoclapps.config("deals.pipelines")||[]),lP(Innoclapps.config("deals.lost_reasons")||[]),nP.forEach(n=>t.addRoute(n)),t.addRoute("settings",{path:"deals",name:"deals-settings-index",component:cz,meta:{title:qe.t("deals::deal.deals")},children:[{path:"pipelines/create",name:"create-pipeline",component:_z,meta:{title:qe.t("deals::deal.pipeline.create")}}]}),t.addRoute("settings",{path:"deals/pipelines/:id/edit",name:"edit-pipeline",component:Dz,meta:{title:qe.t("deals::deal.pipeline.edit")}})});const aP={__name:"RecordTabDocument",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){const t=e,n=V(()=>t.resource.draft_documents_for_user_count>0?t.resource.draft_documents_for_user_count:t.resource.documents_for_user_count),a=V(()=>(t.resource.documents||[]).filter(r=>r.status==="draft").length>0?"danger":"neutral");return(r,i)=>{const u=v("ITab");return St([n.value,a.value],()=>s(u,{badge:n.value,"badge-variant":a.value,title:r.$t("documents::document.documents"),icon:"DocumentText"},null,8,["badge","badge-variant","title"]),i,0)}}},sP=(e,t)=>{if(rP(e)){t&&t();return}var n=document.createElement("script");n.onload=()=>{t&&t()},n.src=e,document.head.appendChild(n)},Uo=e=>{e.forEach(t=>{or(`https://fonts.googleapis.com/css2?family=${decodeURI(t.name)}${t.stylesQueryString}&display=swap`)})},or=(e,t=!1)=>{if(!iP(e)){var n=document.createElement("link");n.rel="stylesheet",n.href=e,t?document.head.prepend(n):document.head.appendChild(n)}},rP=e=>{const t=document.getElementsByTagName("script");for(let n=0;n<t.length;n++)if(t[n].getAttribute("src")===e)return!0;return!1},iP=e=>{const t=document.getElementsByTagName("link");for(let n=0;n<t.length;n++)if(t[n].getAttribute("href")===e)return!0;return!1},uP=e=>{const t=document.getElementsByTagName("link");for(let n=0;n<t.length;n++)t[n].getAttribute("href")===e&&t[n].parentNode.removeChild(t[n])};const dP=o("div",{class:"contentbuilder"},null,-1),cP=["innerHTML"],ia={__name:"ContentBuilder",props:{modelValue:{},disabled:Boolean,placeholders:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{expose:t,emit:n}){const a=e,{t:r}=ve(),i=Pe(),u=q(""),c=q(!1),m=qt(),p=Innoclapps.config("favourite_colors").concat(["#388d3c","#616161","#e64918","#d32f2f","#5d4038"]);window._txt=window.lang[Yn()].core.contentbuilder.builder;const f=["elm-remove","cell-remove","row-remove"];let h=null;const g=F("contentbuilder/contentbuilder.css"),y=F("contentbuilder/contentbuilder.min.js");ge(()=>a.disabled,(E,B)=>{E?_():!E&&B&&x()},{immediate:!0}),ge(u,E=>{E!=a.modelValue&&n("update:modelValue",E)}),ge(()=>a.modelValue,E=>{E!=u.value&&h&&h.loadHtml(E||"")},{immediate:!0});function _(){let E=document.querySelector(".add-more");E&&E.removeEventListener("click",I),document.removeEventListener("click",N),h&&h.destroy(),h=null}function I(){h.viewSnippets();let B=document.querySelector(".is-modal.snippets").querySelector("iframe");if(B){B.classList.add("rounded-md");let z=B.contentDocument||B.contentWindow.document,M=document.createElement("style");z.head.appendChild(M);let j=`
          .light *::-webkit-scrollbar-thumb { background-color: rgba(148, 163, 184, 0.7); }
          .is-pop-close {margin-top: 5px; margin-right: 5px;}
           svg { fill: #475569; !important;}
          .is-pop-close:hover svg {fill: #64748b; !important;}
          .is-category-list>div {background:#e2e8f0 !important;}
          .is-more-categories {margin-top: 1px;}
          .is-more-categories a {color:white;}
          .is-category-list a {background: #f1f5f9 !important; color: #334155 !important}
          .is-category-list a.active, .is-category-list a:hover {background: #cbd5e1 !important;}
          .is-more-categories a {color:#334155 !important;}
          .is-more-categories a.active, .is-more-categories a:hover, .is-more-categories a:focus {background:#cbd5e1 !important;}
          .is-design-list, .is-more-categories a {background:white !important;}
        `,U=`
          .light *::-webkit-scrollbar-thumb { background-color: rgba(148, 163, 184, 0.5); }
          .is-pop-close {margin-top: 5px; margin-right: 5px;}
           svg { fill: white; !important;}
          .is-pop-close:hover svg {fill: #cbd5e1; !important;}
          .is-category-list>div {background:#1e293a !important;}
          .is-more-categories {margin-top: 1px;}
          .is-more-categories a {color:white;}
          .is-category-list a {background: #64748b !important; color: white !important}
          .is-category-list a.active, .is-category-list a:hover {background: #475569 !important;}
          .is-more-categories a.active, .is-more-categories a:hover, .is-more-categories a:focus {background:#475569 !important;}
          .is-design-list, .is-more-categories a {background:#0f172a !important;}
        `;M.appendChild(document.createTextNode(po()?U:j))}}function F(E){return`${i.state.url}/assets/contentbuilder/${E}`}async function $(E,B,z){z=z||(E.match(/^data:([^;]+);/)||"")[1];const j=await(await fetch(E)).arrayBuffer();return new File([j],B,{type:z})}function C(E){return new Promise((B,z)=>{const M=new FormData;M.append("file",E),Innoclapps.request().post(`/media/pending/${m}`,M).then(({data:j})=>B(j.preview_path)).catch(j=>{let U=j.message&&j.message.includes("413")?r("core::app.file_too_large"):j.response.data.message;Innoclapps.error(U),z(U)})})}function w(){return new Promise((E,B)=>{if(!h){E();return}h.saveImages("",()=>{u.value=h.html(),E()},(z,M,j)=>{$(z.getAttribute("src"),j).then(U=>{C(U).then(P=>z.setAttribute("src",P)).catch(P=>B(P))}).catch(U=>B(U))})})}function x(){if(a.disabled)return;_();const E=".contentbuilder";h=new ContentBuilder({container:E,colors:p,useCssClasses:!1,toolStyle:"gray",outlineStyle:"grayoutline",rowHtmlEditor:!1,columnHtmlEditor:!1,enableDragResize:!0,customTags:a.placeholders.map(B=>{let z=`${B.interpolation_start} ${B.tag} ${B.interpolation_end}`;return[B.description||z,z]}),buttons:["bold","italic","underline","formatting","formatPara","color","align","createLink","tags","|","undo","redo","more"],buttonsMore:["textsettings","icon","image","|","list","font"],elementButtons:["left","center","right","full","undo","redo","more"],elementButtonsMore:[],iconButtons:["icon","color","textsettings","createLink","|","undo","redo","more"],iconButtonsMore:[],onChange:()=>{u.value=h.html()},snippetUrl:F("assets/minimalist-blocks/content.js"),snippetPath:F("assets/minimalist-blocks/"),modulePath:F("assets/modules/"),assetPath:F("assets/"),fontAssetPath:F("assets/fonts/"),maxColumns:3,snippetCategories:[[120,r("core::contentbuilder.snippets.basic")],[118,r("core::contentbuilder.snippets.text")],[101,r("core::contentbuilder.snippets.headline")],[119,r("core::contentbuilder.snippets.buttons")],[102,r("core::contentbuilder.snippets.photos")],[103,r("core::contentbuilder.snippets.profile")],[116,r("core::contentbuilder.snippets.contact")],[104,r("core::contentbuilder.snippets.products")],[105,r("core::contentbuilder.snippets.features")],[106,r("core::contentbuilder.snippets.process")],[107,r("core::contentbuilder.snippets.pricing")],[108,r("core::contentbuilder.snippets.skills")],[109,r("core::contentbuilder.snippets.achievements")],[110,r("core::contentbuilder.snippets.quotes")],[111,r("core::contentbuilder.snippets.partners")],[112,r("core::contentbuilder.snippets.as_featured_on")],[115,r("core::contentbuilder.snippets.help_and_faq")]],defaultSnippetCategory:120,plugins:[{name:"pagebreak",showInMainToolbar:!1,showInElementToolbar:!1},{name:"products",showInMainToolbar:!1,showInElementToolbar:!1},{name:"signatures",showInMainToolbar:!1,showInElementToolbar:!1}],pluginPath:F("contentbuilder/"),imageSelect:F("assets.html"),fileSelect:F("assets.html"),videoSelect:F("assets.html"),onMediaUpload:B=>{C(B.target.files[0]).then(z=>{h.returnUrl(z)})},onVideoUpload:B=>{C(B.target.files[0]).then(z=>{h.returnUrl(z)})}}),h.loadSnippets(F("assets/minimalist-blocks/content.js")),h.loadHtml(a.modelValue),c.value=!0}function A(E){f.forEach(B=>{if(E.target.classList.contains(B)){let z=document.querySelector(".is-modal.is-confirm");z&&z.querySelector("button").focus();return}})}function N(){document.addEventListener("click",A)}function T(){let E=document.querySelector(".add-more");if(E){let B=E.cloneNode(!0);E.parentNode.replaceChild(B,E),B.addEventListener("click",I)}}return De(()=>{or(g,!0),sP(y,x),setTimeout(()=>{T(),N()},1e3)}),bt(()=>{uP(g),_()}),t({saveBase64Images:w,viewSnippets:I}),(E,B)=>{const z=v("IOverlay");return d(),R(z,{show:!c.value&&!e.disabled},{default:b(()=>[dP,e.disabled?(d(),k("div",{key:0,class:"contentbuilder",innerHTML:e.modelValue},null,8,cP)):O("",!0)]),_:1},8,["show"])}}},Io={form:{required:!0},visible:Boolean,document:{default:()=>({}),type:Object}};const mP={class:"mx-auto max-w-6xl"},pP={class:"mb-8 flex justify-end space-x-2 text-right"},fP={class:"relative w-72"},vP=["onClick"],bP={class:"border-b border-neutral-200 pb-3 dark:border-neutral-600"},hP={class:"mb-4 inline-flex w-full items-center border-b border-neutral-200 pb-2 text-sm font-medium text-neutral-700 dark:border-neutral-600 dark:text-neutral-100"},_P={class:"grid auto-cols-max grid-flow-col gap-4"},gP={class:"w-72"},yP={class:"grid auto-cols-max grid-flow-col gap-4"},xP={class:"w-72"},IP={class:"mt-2.5"},kP={class:"grid auto-cols-max grid-flow-col gap-4"},$P={class:"w-72"},wP={class:"grid auto-cols-max grid-flow-col gap-4"},CP={class:"w-72"},SP={class:"mt-10"},RP={class:"prose prose-sm prose-neutral relative max-w-none dark:prose-invert"},lr={__name:"DocumentFormContent",props:{...Io,isReady:{default:!0,type:Boolean}},setup(e,{expose:t}){const n=e,a=Innoclapps.config("contentbuilder.fonts"),r=V(()=>a.map(M=>M["font-family"])),i=q(null),u=q(null),c=q([]),m=q(null),p=q(!1),f=q(!1),h=Innoclapps.config("documents.placeholders"),g=q(!1),{form:y}=Ae({name:"",content:"",is_shared:!1});ge(()=>n.document.updated_at,()=>{n.visible&&A()}),mn(()=>n.visible,()=>{!p.value&&z(),A()},{immediate:!0});const _=V(()=>n.form.content&&n.form.content.indexOf("{{ ")>-1),I=V(()=>n.form.content&&n.form.content.match(/(contact.|deal.|company.)/)),F=V(()=>{let M=!1;return Object.keys(n.document.associations||{}).forEach(j=>{var U;((U=n.document.associations[j])==null?void 0:U.length)>0&&(M=!0)}),M}),$=V(()=>n.form.billable.products.length>0&&(!n.form.content||n.form.content.indexOf("products-section")===-1)),C=V(()=>n.form.signers.length>0&&(!n.form.content||n.form.content.indexOf("signatures-section")===-1)),w=V(()=>n.isReady&&n.document.id&&!F.value&&_.value&&I.value),x=V(()=>En(c.value,["name","asc"]).map(M=>Rn(M,["content"])));function A(){Uo(n.document.google_fonts||[])}function N(){i.value.viewSnippets()}function T(){u.value.focus(),y.content=n.form.content}function E(){y.post("/document-templates").then(M=>{c.value.push(M),Innoclapps.modal().hide("saveAsTemplateModal")})}function B(M){Uo(M.google_fonts),n.form.content===null&&(n.form.content="");let j=Ee(c.value,["id",M.id]);n.form.content+=j.content,j.view_type&&(n.form.view_type=j.view_type),setTimeout(()=>m.value=null,500)}function z(){f.value=!0,Innoclapps.request().get("document-templates",{params:{per_page:100}}).then(({data:M})=>{c.value=M.data,p.value=!0}).finally(()=>f.value=!1)}return t({builderRef:i}),(M,j)=>{const U=v("IFormInput"),P=v("IFormError"),H=v("IFormGroup"),L=v("IFormCheckbox"),Z=v("IModal"),J=v("IButtonIcon"),K=v("IButton"),G=v("ICustomSelect"),oe=v("Icon"),pe=v("router-link"),ue=v("IFormLabel"),ee=v("i18n-t"),W=ae("i-modal"),ne=ae("i-tooltip");return D((d(),k("div",mP,[o("div",pP,[s(Z,{id:"saveAsTemplateModal",size:"sm","ok-title":M.$t("core::app.save"),"ok-disabled":l(y).busy,"static-backdrop":"",title:M.$t("documents::document.template.save_as_template"),form:"",onShown:T,onSubmit:E,onKeydown:j[2]||(j[2]=ce=>l(y).onKeydown(ce))},{default:b(()=>[s(H,{"label-for":"name",label:M.$t("documents::document.template.name"),required:""},{default:b(()=>[s(U,{id:"name",ref_key:"inputNameRef",ref:u,modelValue:l(y).name,"onUpdate:modelValue":j[0]||(j[0]=ce=>l(y).name=ce)},null,8,["modelValue"]),s(P,{textContent:S(l(y).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(H,null,{default:b(()=>[s(L,{id:"is_shared",checked:l(y).is_shared,"onUpdate:checked":j[1]||(j[1]=ce=>l(y).is_shared=ce),name:"is_shared",label:M.$t("documents::document.template.share_with_team_members")},null,8,["checked","label"]),s(P,{textContent:S(l(y).getError("is_shared"))},null,8,["textContent"])]),_:1})]),_:1},8,["ok-title","ok-disabled","title"]),s(J,{icon:"AdjustmentsVertical",class:"mr-2 mt-2 shrink-0 self-start",onClick:j[3]||(j[3]=ce=>g.value=!g.value)}),s(K,{icon:"Sparkles",size:"sm",disabled:M.document.status==="accepted",variant:"white",class:"shrink-0 self-start",text:M.$t("core::contentbuilder.builder.Snippets"),onClick:N},null,8,["disabled","text"]),D(s(K,{variant:"white",size:"sm",icon:"Bookmark",class:"shrink-0 self-start",text:M.$t("documents::document.template.save_as_template")},null,8,["text"]),[[Y,M.form.content],[W,"saveAsTemplateModal"]]),o("div",fP,[s(G,{modelValue:m.value,"onUpdate:modelValue":j[4]||(j[4]=ce=>m.value=ce),label:"name",size:"sm",clearable:!1,loading:f.value,disabled:M.document.status==="accepted",placeholder:M.$t("documents::document.template.insert_template"),options:x.value,"onOption:selected":B},null,8,["modelValue","loading","disabled","placeholder","options"]),D(o("a",{href:"#",class:"absolute right-9 top-2 mt-px text-neutral-400 hover:text-neutral-600 focus:outline-none",onClick:ie(z,["prevent","stop"])},[s(oe,{icon:"Refresh",class:"h-4 w-4"})],8,vP),[[Y,!f.value]]),s(pe,{target:"_blank",to:{name:"document-templates-index"},class:"link inline-flex items-center text-sm"},{default:b(()=>[Q(S(M.$t("documents::document.template.manage"))+" ",1),s(oe,{icon:"ExternalLink",class:"ml-2 h-4 w-4"})]),_:1})])]),D(o("div",bP,[o("h4",hP,[s(oe,{icon:"Document",class:"mr-1.5 h-4 w-4"}),Q(" "+S(M.$t("documents::pdf.settings")),1)]),o("div",_P,[s(ue,{label:M.$t("documents::pdf.padding"),for:"pdf-padding",class:"mt-2.5 w-32"},null,8,["label"]),o("div",gP,[s(U,{id:"pdf-padding",modelValue:M.form.pdf.padding,"onUpdate:modelValue":j[5]||(j[5]=ce=>M.form.pdf.padding=ce),placeholder:M.$t("documents::pdf.no_padding")},null,8,["modelValue","placeholder"]),s(P,{textContent:S(M.form.getError("pdf.padding"))},null,8,["textContent"])])]),o("div",yP,[s(ue,{label:M.$t("documents::pdf.default_font"),for:"pdf-font",class:"mt-2.5 w-32"},null,8,["label"]),o("div",xP,[s(G,{modelValue:M.form.pdf.font,"onUpdate:modelValue":j[6]||(j[6]=ce=>M.form.pdf.font=ce),"input-id":"pdf-font",placeholder:M.$t("documents::document.settings.inherits_setting_from_brand"),options:r.value},null,8,["modelValue","placeholder","options"]),s(P,{textContent:S(M.form.getError("pdf.font"))},null,8,["textContent"])]),D((d(),k("span",IP,[s(oe,{icon:"QuestionMarkCircle",class:"h-5 w-5"})])),[[ne,M.$t("documents::pdf.default_font_info",{fontName:"DejaVu Sans"})]])]),o("div",kP,[s(ue,{label:M.$t("documents::pdf.size"),for:"pdf-size",class:"mt-2.5 w-32"},null,8,["label"]),o("div",$P,[s(G,{modelValue:M.form.pdf.size,"onUpdate:modelValue":j[7]||(j[7]=ce=>M.form.pdf.size=ce),"input-id":"pdf-size",options:["a4","letter"],placeholder:M.$t("documents::document.settings.inherits_setting_from_brand")},null,8,["modelValue","placeholder"]),s(P,{textContent:S(M.form.getError("pdf.size"))},null,8,["textContent"])])]),o("div",wP,[s(ue,{label:M.$t("documents::pdf.orientation"),for:"pdf-orientation",class:"mt-2.5 w-32"},null,8,["label"]),o("div",CP,[s(G,{modelValue:M.form.pdf.orientation,"onUpdate:modelValue":j[8]||(j[8]=ce=>M.form.pdf.orientation=ce),"input-id":"pdf-orientation",options:["portrait","landscape"],placeholder:M.$t("documents::document.settings.inherits_setting_from_brand")},null,8,["modelValue","placeholder"]),s(P,{textContent:S(M.form.getError("pdf.orientation"))},null,8,["textContent"])])])],512),[[Y,g.value]]),o("div",SP,[w.value?(d(),R(Do,{key:0,class:"mb-4"},{default:b(()=>[Q(S(M.$t("documents::document.placeholders_replacement_info")),1)]),_:1})):O("",!0),$.value?(d(),R(Do,{key:1,class:"mb-4"},{default:b(()=>[s(ee,{scope:"global",keypath:"documents::document.products_snippet_missing",tag:"span",class:"inline-flex"},{icon:b(()=>[s(oe,{icon:"Plus",class:"h-5 w-5"})]),_:1},8,["keypath"])]),_:1})):O("",!0),C.value?(d(),R(Do,{key:2,class:"mb-4"},{default:b(()=>[s(ee,{scope:"global",keypath:"documents::document.signatures_snippet_missing",tag:"span",class:"inline-flex"},{icon:b(()=>[s(oe,{icon:"Plus",class:"h-5 w-5"})]),_:1},8,["keypath"])]),_:1})):O("",!0),o("div",RP,[s(ia,{ref_key:"builderRef",ref:i,modelValue:M.form.content,"onUpdate:modelValue":j[9]||(j[9]=ce=>M.form.content=ce),disabled:M.document.status==="accepted",placeholders:l(h)},null,8,["modelValue","disabled","placeholders"])])])],512)),[[Y,M.visible]])}}},Jn=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name"));function r(c){return a.value.find(m=>m.id==c)}function i(c){n.value=c}function u(){e(!0),Innoclapps.request().get("/document-types",{params:{per_page:100}}).then(({data:c})=>n.value=c.data).finally(()=>e(!1))}return{documentTypes:n,typesByName:a,typesAreBeingFetched:t,findTypeById:r,setDocumentTypes:i,fetchDocumentTypes:u}}),FP={class:"grid grid-cols-1 gap-y-6 sm:grid-cols-3 sm:gap-x-4"},VP={class:"flex flex-1"},TP={class:"flex flex-col"},DP={class:"mt-2 h-[104px] w-full overflow-hidden rounded border border-neutral-200 bg-white dark:border-neutral-600 dark:bg-neutral-400"},qP={key:0,class:"flex flex-col"},EP=o("div",{class:"h-5 w-full bg-neutral-100 dark:bg-neutral-300"},null,-1),AP=o("div",{class:"mt-1 space-y-1 px-5 py-2"},[o("div",{class:"h-3 w-1/3 rounded bg-neutral-200 dark:bg-neutral-300"}),o("div",{class:"h-3 w-full rounded bg-neutral-100 dark:bg-neutral-200"}),o("div",{class:"mt h-3 w-1/2 rounded bg-neutral-100 dark:bg-neutral-200"}),o("div",{class:"mt h-3 w-full rounded bg-neutral-100 dark:bg-neutral-200"})],-1),BP=[EP,AP],NP={key:1,class:"flex"},OP=o("div",{class:"h-[102px] w-6 bg-neutral-200"},null,-1),zP=o("div",{class:"mt-1 flex-1 space-y-1 p-2"},[o("div",{class:"h-3 w-1/3 rounded bg-neutral-200"}),o("div",{class:"h-3 w-full rounded bg-neutral-100"}),o("div",{class:"mt h-3 w-1/2 rounded bg-neutral-100"}),o("div",{class:"mt h-3 w-full rounded bg-neutral-100"}),o("div",{class:"h-3 w-1/3 rounded bg-neutral-100"})],-1),MP=[OP,zP],UP={key:2,class:"flex"},PP=o("div",{class:"h-[102px] w-6 bg-neutral-200 dark:bg-neutral-200"},null,-1),jP=o("div",{class:"flex-1"},[o("div",{class:"flex flex-col"},[o("div",{class:"flex"},[o("div",{class:"flex h-8 w-full flex-col items-center justify-center space-y-1 bg-neutral-100 p-2.5 dark:bg-neutral-300"},[o("div",{class:"h-1.5 w-1/2 shrink-0 rounded bg-neutral-200"}),o("div",{class:"h-1.5 w-full shrink-0 rounded bg-neutral-200"})]),o("div",{class:"flex h-8 w-full flex-col items-center justify-center space-y-1 bg-neutral-100 p-2.5 dark:bg-neutral-300"},[o("div",{class:"h-1.5 w-1/2 shrink-0 rounded bg-neutral-200"}),o("div",{class:"h-1.5 w-full shrink-0 rounded bg-neutral-200"})])]),o("div",{class:"flex h-12 w-full flex-col items-center justify-center space-y-1 bg-neutral-300 p-2.5 dark:bg-neutral-400"},[o("div",{class:"h-1.5 w-1/2 shrink-0 rounded bg-neutral-200 dark:bg-neutral-300"}),o("div",{class:"h-1.5 w-full shrink-0 rounded bg-neutral-200 dark:bg-neutral-300"}),o("div",{class:"h-1.5 w-full shrink-0 rounded bg-neutral-200 dark:bg-neutral-300"})]),o("div",{class:"flex h-[22px] w-full flex-col justify-center space-y-1 bg-neutral-200/70 p-2"},[o("div",{class:"h-1.5 w-1/2 shrink-0 rounded bg-neutral-200"})])])],-1),LP=[PP,jP],ua={__name:"DocumentFormViewTypes",props:{modelValue:String},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,{t:a}=ve(),r=[{id:"nav-top",title:a("documents::document.view_type.nav_top.name"),description:a("documents::document.view_type.nav_top.description")},{id:"nav-left",title:a("documents::document.view_type.nav_left.name"),description:a("documents::document.view_type.nav_left.description",{headingTagName:Innoclapps.config("documents.navigation_heading_tag_name")})},{id:"nav-left-full-width",title:a("documents::document.view_type.nav_left_full_width.name"),description:a("documents::document.view_type.nav_left_full_width.description",{headingTagName:Innoclapps.config("documents.navigation_heading_tag_name")})}],i=Go(n,"modelValue",t);return(u,c)=>{const m=v("Icon");return d(),R(l(zl),{modelValue:l(i),"onUpdate:modelValue":c[0]||(c[0]=p=>xt(i)?i.value=p:null)},{default:b(()=>[s(l(Ln),{class:"sr-only"},{default:b(()=>[Q("Select HTML view type")]),_:1}),o("div",FP,[(d(),k(te,null,re(r,p=>s(l(Ol),{key:p.id,as:"template",value:p.id},{default:b(({checked:f,active:h})=>[o("div",{class:X([f?"border-transparent":"border-neutral-300 dark:border-neutral-700",h?"border-primary-500 ring-2 ring-primary-500":"","relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none dark:bg-neutral-800"])},[o("span",VP,[o("span",TP,[s(l(Ln),{as:"span",class:"block text-sm font-medium text-neutral-900 dark:text-white"},{default:b(()=>[Q(S(p.title),1)]),_:2},1024),s(l(Ao),{as:"span",class:"mt-1 flex items-center text-sm text-neutral-500 dark:text-neutral-300"},{default:b(()=>[Q(S(p.description),1)]),_:2},1024),s(l(Ao),{class:"mt-auto"},{default:b(()=>[o("div",DP,[p.id==="nav-top"?(d(),k("div",qP,BP)):p.id==="nav-left"?(d(),k("div",NP,MP)):p.id==="nav-left-full-width"?(d(),k("div",UP,LP)):O("",!0)])]),_:2},1024)])]),s(m,{icon:"CheckCircle",class:X([f?"":"invisible","h-5 w-5 shrink-0 text-primary-600"])},null,8,["class"]),o("span",{class:X([h?"border":"border-2",f?"border-primary-500":"border-transparent","pointer-events-none absolute -inset-px rounded-lg"]),"aria-hidden":"true"},null,2)],2)]),_:2},1032,["value"])),64))])]),_:1},8,["modelValue"])}}},HP={class:"mx-auto max-w-3xl"},GP={class:"relative"},KP={class:"mb-4 mt-3 flex items-center md:absolute md:right-1 md:top-3.5 md:my-0 md:space-x-2.5"},YP={class:"order-last ml-auto mr-0 place-self-end md:-order-none md:mr-2.5"},WP={class:"my-2 text-sm font-medium text-neutral-800 dark:text-neutral-100"},QP={role:"list",class:"space-y-6"},XP=o("div",{class:"w-px bg-neutral-200"},null,-1),ZP=[XP],JP={class:"relative flex h-6 w-6 flex-none items-center justify-center bg-white"},ej={key:0,class:"flex-auto rounded-md p-3 ring-1 ring-inset ring-neutral-200"},tj={class:"flex justify-between gap-x-4"},nj=["textContent"],oj=["datetime","textContent"],lj={class:"mt-1.5 py-0.5 text-sm leading-5 text-neutral-500"},aj={class:"flex-none"},sj=["textContent"],rj=["textContent"],ij=["datetime","textContent"],ar={__name:"DocumentFormDetails",props:Io,setup(e){const t=e,{localizedDateTime:n}=Ne(),a=Innoclapps.config("documents.statuses"),r=q(null),i=q(null),u=q(null),c=Me("brands"),{users:m,currentUser:p,locales:f}=Le(),{typesByName:h}=Jn(),g=V(()=>t.document.changelog?t.document.changelog.slice().reverse():[]);function y(){Object.keys(t.document).length===0?(u.value=Ee(c.value,_=>_.is_default),u.value&&t.form.set("brand_id",u.value.id),i.value=h.value.find(_=>_.id==Innoclapps.config("documents.default_document_type")),i.value&&t.form.set("document_type_id",i.value.id),r.value=p.value,t.form.set("user_id",r.value.id)):(u.value=t.document.brand,i.value=t.document.type,r.value=t.document.user)}return y(),(_,I)=>{const F=v("ITab"),$=v("ITabList"),C=v("IAlert"),w=v("Icon"),x=v("ICustomSelect"),A=v("IFormError"),N=v("IFormGroup"),T=v("IFormInput"),E=v("ITabPanel"),B=v("ITabPanels"),z=v("ITabGroup"),M=ae("t");return D((d(),k("div",HP,[o("div",GP,[s(z,null,{default:b(()=>[s($,null,{default:b(()=>[s(F,{title:_.$t("documents::document.document_details"),icon:"AdjustmentsVertical"},null,8,["title"]),s(F,{disabled:Object.keys(_.document).length===0,title:_.$t("documents::document.document_activity"),badge:g.value.length,icon:"DocumentText"},null,8,["disabled","title","badge"])]),_:1}),s(B,null,{default:b(()=>[s(E,null,{default:b(()=>[_.document.status==="accepted"?(d(),R(C,{key:0,variant:"info",class:"mb-6"},{default:b(()=>[Q(S(_.$t("documents::document.limited_editing")),1)]),_:1})):O("",!0),o("div",KP,[o("div",YP,[de(_.$slots,"actions")]),i.value?(d(),R(zt,{key:0,color:i.value.swatch_color,class:"mr-2.5 inline-flex items-center justify-center rounded-full px-2.5 py-0.5 text-sm/5 font-normal dark:!text-white md:mr-0"},{default:b(()=>[s(w,{icon:i.value.icon,class:"mr-1.5 h-4 w-4 text-current"},null,8,["icon"]),Q(" "+S(i.value.name),1)]),_:1},8,["color"])):O("",!0),s(zt,{color:_.document.status?l(a)[_.document.status].color:l(a).draft.color,class:"mr-2.5 inline-flex items-center justify-center rounded-full px-2.5 py-0.5 text-sm/5 font-normal dark:!text-white md:mr-0"},{default:b(()=>[Q(S(_.$t("documents::document.status."+(_.document.status?_.document.status:l(a).draft.name))),1)]),_:1},8,["color"])]),de(_.$slots,"top"),s(N,{label:_.$t("brands::brand.brand"),"label-for":"brand_id",required:""},{default:b(()=>[s(x,{modelValue:u.value,"onUpdate:modelValue":[I[0]||(I[0]=j=>u.value=j),I[1]||(I[1]=j=>_.form.brand_id=j.id)],options:l(c),clearable:!1,"input-id":"brand_id",disabled:_.document.status==="accepted",label:"name"},null,8,["modelValue","options","disabled"]),s(A,{textContent:S(_.form.getError("brand_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(N,{label:_.$t("documents::document.title"),"label-for":"title",required:""},{default:b(()=>[s(T,{id:"title",modelValue:_.form.title,"onUpdate:modelValue":I[2]||(I[2]=j=>_.form.title=j),disabled:_.document.status==="accepted"},null,8,["modelValue","disabled"]),s(A,{textContent:S(_.form.getError("title"))},null,8,["textContent"])]),_:1},8,["label"]),s(N,{label:_.$t("documents::document.type.type"),"label-for":"document_type_id",required:""},{default:b(()=>[s(x,{modelValue:i.value,"onUpdate:modelValue":[I[3]||(I[3]=j=>i.value=j),I[4]||(I[4]=j=>_.form.document_type_id=j.id)],options:l(h),clearable:!1,"input-id":"document_type_id",label:"name"},null,8,["modelValue","options"]),s(A,{textContent:S(_.form.getError("document_type_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(N,{label:_.$t("documents::fields.documents.user.name"),"label-for":"user_id",required:""},{default:b(()=>[s(x,{modelValue:r.value,"onUpdate:modelValue":[I[5]||(I[5]=j=>r.value=j),I[6]||(I[6]=j=>_.form.user_id=j?j.id:null)],label:"name","input-id":"user_id",clearable:!1,options:l(m),disabled:_.document.status==="accepted"},null,8,["modelValue","options","disabled"]),s(A,{textContent:S(_.form.getError("user_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(N,{label:_.$t("core::app.locale"),"label-for":"locale",required:""},{default:b(()=>[s(x,{modelValue:_.form.locale,"onUpdate:modelValue":I[7]||(I[7]=j=>_.form.locale=j),"input-id":"locale",clearable:!1,options:l(f)},null,8,["modelValue","options"]),s(A,{textContent:S(_.form.getError("locale"))},null,8,["textContent"])]),_:1},8,["label"]),D(o("h3",WP,null,512),[[M,"documents::document.view_type.html_view_type"]]),s(ua,{modelValue:_.form.view_type,"onUpdate:modelValue":I[8]||(I[8]=j=>_.form.view_type=j)},null,8,["modelValue"]),s(A,{textContent:S(_.form.getError("view_type"))},null,8,["textContent"])]),_:3}),s(E,null,{default:b(()=>[o("ul",QP,[(d(!0),k(te,null,re(g.value,(j,U)=>(d(),k("li",{key:j.id,class:"relative flex gap-x-4"},[o("div",{class:X([U===g.value.length-1?"h-6":"-bottom-6","absolute left-0 top-0 flex w-6 justify-center"])},ZP,2),o("div",JP,[o("div",{class:X(["h-1.5 w-1.5 rounded-full ring-1",j.properties.type==="success"?"bg-success-200 ring-success-500":"bg-neutral-100 ring-neutral-300"])},null,2)]),j.properties.section?(d(),k("div",ej,[o("div",tj,[o("div",{class:"py-0.5 text-sm leading-5 text-neutral-500",textContent:S(_.$t(j.properties.lang.key,j.properties.lang.attrs))},null,8,nj),o("time",{datetime:j.dateTime,class:"flex-none py-0.5 text-xs leading-5 text-neutral-500",textContent:S(l(n)(j.created_at))},null,8,oj)]),o("div",lj,[Q(S(_.$t(j.properties.section.lang.key,j.properties.section.lang.attrs||{}))+" ",1),o("ul",aj,[(d(!0),k(te,null,re(j.properties.section.list,(P,H)=>(d(),k("li",{key:H,class:"text-neutral-600 dark:text-neutral-400",textContent:S(_.$t(P.lang.key,P.lang.attrs||{}))},null,8,sj))),128))])])])):(d(),k(te,{key:1},[o("p",{class:"flex-auto py-0.5 text-sm leading-5 text-neutral-500",textContent:S(_.$t(j.properties.lang.key,j.properties.lang.attrs))},null,8,rj),o("time",{datetime:j.dateTime,class:"flex-none py-0.5 text-xs leading-5 text-neutral-500",textContent:S(l(n)(j.created_at))},null,8,ij)],64))]))),128))])]),_:1})]),_:3})]),_:3})])],512)),[[Y,_.visible]])}}},uj={class:"absolute inset-0 z-40 h-full max-h-full min-h-screen w-full bg-white dark:bg-neutral-900"},dj={class:"sticky top-0 z-50 border-b border-neutral-200 bg-neutral-100 dark:border-neutral-700 dark:bg-neutral-800"},cj={class:"container mx-auto"},mj={class:"mx-auto max-w-6xl"},pj={class:"px-3 py-4 sm:px-0"},fj={class:"flex items-center justify-between space-x-4 sm:space-x-0"},vj=["value"],bj={class:"hidden justify-center sm:flex"},hj=["onClick"],_j={class:"inline-flex"},gj=["textContent"],yj={class:"h-full min-h-full overflow-y-auto"},xj={class:"px-4 py-6 sm:px-0"},Ij={style:{"padding-bottom":"200px"}},sr={__name:"DocumentFormLayout",props:{activeSection:{required:!0,type:String},totalProducts:Number,totalSigners:Number,remainingSigners:Number},emits:["exit-requested","update:active-section"],setup(e,{emit:t}){const n=e,{t:a}=ve(),r=V(()=>[{name:a("documents::document.sections.details"),id:"details"},{name:a("documents::document.sections.products"),id:"products",badge:n.totalProducts},{name:a("documents::document.sections.signature"),id:"signature",badge:n.totalSigners>0&&n.remainingSigners>0?n.remainingSigners:n.totalSigners,badgeVariant:n.remainingSigners>0?"warning":n.remainingSigners===0&&n.totalSigners>0?"success":"primary"},{name:a("documents::document.sections.content"),id:"content"},{name:a("documents::document.sections.send"),id:"send"}]);function i(u){t("update:active-section",u)}return Dn(()=>{document.body.classList.add("overflow-y-hidden")}),bt(()=>{document.body.classList.remove("overflow-y-hidden"),document.body.classList.remove("document-section-"+n.activeSection)}),ge(()=>n.activeSection,(u,c)=>{document.body.classList.remove("document-section-"+c),document.body.classList.add("document-section-"+u)},{immediate:!0}),(u,c)=>{const m=v("IFormSelect"),p=v("IBadge"),f=v("Icon"),h=ae("t");return d(),k("div",uj,[o("div",dj,[o("div",cj,[o("div",mj,[o("div",pj,[o("div",fj,[D(o("a",{href:"#",class:"link text-sm sm:text-base",onClick:c[0]||(c[0]=ie(g=>u.$emit("exit-requested"),["prevent"]))},null,512),[[h,"core::app.exit"]]),s(m,{class:"block sm:hidden",size:"sm","model-value":e.activeSection,"onUpdate:modelValue":c[1]||(c[1]=g=>i(g))},{default:b(()=>[(d(!0),k(te,null,re(r.value,g=>(d(),k("option",{key:g.id,value:g.id},S(g.name),9,vj))),128))]),_:1},8,["model-value"]),o("div",bj,[(d(!0),k(te,null,re(r.value,(g,y)=>(d(),k("a",{key:g.id,href:"#",class:X(["flex items-center focus:outline-none",g.id===e.activeSection?"link":"text-neutral-800 hover:text-neutral-600 dark:text-neutral-300 dark:hover:text-neutral-400",y!==r.value.length-1?"mr-6 space-x-4":""]),onClick:ie(_=>i(g.id),["prevent"])},[o("div",_j,[o("span",{textContent:S(g.name)},null,8,gj),D(s(p,{variant:g.badgeVariant||"primary",size:"circle","wrapper-class":"ml-1.5 -mt-px"},{default:b(()=>[Q(S(g.badge),1)]),_:2},1032,["variant"]),[[Y,g.badge]])]),y!==r.value.length-1?(d(),R(f,{key:0,icon:"ChevronRight",class:"mt-0.5 h-4 w-4 shrink-0 text-neutral-400 dark:text-neutral-500"})):O("",!0)],10,hj))),128))]),de(u.$slots,"actions")])])])])]),o("div",yj,[o("div",xj,[o("div",Ij,[de(u.$slots,"default")])])])])}}},kj={class:"mx-auto max-w-5xl"},$j={class:"mb-6 text-base font-medium text-neutral-800 dark:text-neutral-100"},rr={__name:"DocumentFormProducts",props:Io,setup(e){const t=e;function n(a){t.form.errors.has("billable.products."+a.index+".name")&&t.form.errors.clear("billable.products."+a.index+".name")}return(a,r)=>{const i=v("IFormError"),u=ae("t");return D((d(),k("div",kj,[D(o("h3",$j,null,512),[[u,"documents::document.document_products"]]),o("div",{class:X({"pointer-events-none opacity-70":a.document.status==="accepted"})},[s(Zl,{modelValue:a.form.billable.tax_type,"onUpdate:modelValue":r[0]||(r[0]=c=>a.form.billable.tax_type=c),class:"mb-4 flex flex-col space-y-1 sm:flex-row sm:space-x-2 sm:space-y-0"},null,8,["modelValue"]),s(Xl,{products:a.form.billable.products,"onUpdate:products":r[1]||(r[1]=c=>a.form.billable.products=c),"removed-products":a.form.billable.removed_products,"onUpdate:removedProducts":r[2]||(r[2]=c=>a.form.billable.removed_products=c),"tax-type":a.form.billable.tax_type,onProductSelected:r[3]||(r[3]=c=>a.form.errors.clear("billable.products."+c.index+".name")),onProductRemoved:n},{"after-product-select":b(({index:c})=>[s(i,{textContent:S(a.form.getError("billable.products."+c+".name"))},null,8,["textContent"])]),_:1},8,["products","removed-products","tax-type"])],2)],512)),[[Y,a.visible]])}}},wj={class:"mx-auto max-w-3xl"},Cj={key:1,class:"mb-6"},Sj={class:"-mt-3 text-sm text-neutral-500 dark:text-neutral-300"},Rj={key:0,class:"text-neutral-500 dark:text-neutral-300"},Fj={class:"mb-3 inline-flex items-center"},Vj={class:"text-base font-medium text-neutral-800 dark:text-neutral-100"},Tj={class:"ml-1 mt-1 text-xs text-neutral-500 dark:text-neutral-400"},Dj={class:"table-responsive"},qj={class:"overflow-auto border border-neutral-200 dark:border-neutral-800 sm:rounded-md"},Ej={class:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-700"},Aj={class:"bg-neutral-50 dark:bg-neutral-800"},Bj=o("th",{class:"bg-neutral-50 p-2 text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},null,-1),Nj={class:"bg-neutral-50 p-2 text-left text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},Oj={class:"bg-neutral-50 p-2 text-left text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},zj={class:"bg-neutral-50 p-2 text-center text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},Mj=o("th",null,null,-1),Uj={class:"divide-y divide-neutral-200 bg-white dark:divide-neutral-700 dark:bg-neutral-800"},Pj={key:0},jj={colspan:"5",class:"bg-white p-3 align-middle text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},Lj={class:"border-r border-neutral-200 bg-white p-2 text-neutral-900 dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-100"},Hj={class:"ml-1 inline-flex min-w-full items-center justify-center"},Gj={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},Kj={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},Yj={class:"bg-white p-2 text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},Wj={class:"inline-flex min-w-full justify-center"},Qj={class:"bg-white p-2 text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},Xj=["onClick"],Zj={class:"mb-3 mt-6 text-base font-medium text-neutral-800 dark:text-neutral-100"},Jj={class:"mt-3 text-sm text-neutral-500"},e7={key:2},t7={class:"mb-4"},n7={class:"inline-block"},o7={class:"inline-block"},ir={__name:"DocumentFormSend",props:{...Io,sending:Boolean},emits:["send-requested","save-requested"],setup(e){const t=e,n=Pe(),{localizedDateTime:a,appDate:r}=Ne(),i=Me("brands"),u=q(null),c=q(null),m=q(!!t.form.send_at),p=V(()=>t.form.brand_id?Ee(i.value,["id",t.form.brand_id]):null),f=V(()=>n.getters["emailAccounts/accounts"]),h=V(()=>t.form.signers.filter(x=>!Be(x.name)&&!Be(x.email))),g=V(()=>t.form.recipients.filter(x=>x.send_email&&!Be(x.name)&&!Be(x.email))),y=V(()=>t.form.signers.filter(x=>x.send_email&&!Be(x.name)&&!Be(x.email))),_=V(()=>t.form.recipients.filter(x=>Be(x.name)||Be(x.email)).length>0),I=V(()=>!(!t.form.send_mail_body||!t.form.send_mail_subject||!t.form.send_mail_account_id||g.value.length===0&&y.value.length===0));function F(){return n.dispatch("emailAccounts/fetch")}function $(x){t.form.recipients.splice(x,1)}function C(){t.form.recipients.push({name:"",email:"",send_email:!0}),Fe(()=>{u.value[t.form.recipients.length-1].focus()})}function w(x){t.form.send_mail_account_id?c.value=Ee(x,["id",Number(t.form.send_mail_account_id)]):(c.value=x.length?x[0]:null,c.value&&(t.form.send_mail_account_id=c.value.id))}return ge(p,(x,A)=>{(x&&Be(t.form.send_mail_body)||A&&t.form.send_mail_body===A.config.document.mail_message[t.form.locale])&&(t.form.send_mail_body=x.config.document.mail_message[t.form.locale]),(x&&Be(t.form.send_mail_subject)||A&&A.config.document.mail_subject[t.form.locale]===t.form.send_mail_subject)&&(t.form.send_mail_subject=x.config.document.mail_subject[t.form.locale])},{immediate:!0}),F().then(w),(x,A)=>{const N=v("IAlert"),T=v("IFormCheckbox"),E=v("IFormInput"),B=v("IFormError"),z=v("IButtonIcon"),M=v("ICustomSelect"),j=v("Icon"),U=v("IFormText"),P=v("IFormGroup"),H=v("Editor"),L=v("DatePicker"),Z=v("IButton"),J=ae("t"),K=ae("i-tooltip");return D((d(),k("div",wj,[x.form.originalData.send_at?(d(),R(N,{key:0,variant:"info",class:"mb-5"},{default:b(()=>[Q(S(x.$t("documents::document.send.is_scheduled",{date:l(a)(x.form.originalData.send_at)})),1)]),_:1})):O("",!0),x.form.requires_signature?(d(),k("div",Cj,[D(o("h3",{class:X(["mb-3 text-base font-medium text-neutral-800 dark:text-neutral-100",{hidden:h.value.length===0&&x.document.status==="accepted"}])},null,2),[[J,"documents::document.send.send_to_signers"]]),D(o("p",Sj,null,512),[[Y,h.value.length===0&&x.document.status!=="accepted"],[J,"documents::document.send.send_to_signers_empty"]]),(d(!0),k(te,null,re(h.value,G=>(d(),R(T,{key:G.email,checked:G.send_email,"onUpdate:checked":oe=>G.send_email=oe},{default:b(()=>[Q(S(G.name+" ("+G.email+")")+" ",1),G.sent_at?(d(),k("span",Rj," - "+S(x.$t("documents::document.sent_at",{date:l(a)(G.sent_at)})),1)):O("",!0)]),_:2},1032,["checked","onUpdate:checked"]))),128))])):O("",!0),o("div",Fj,[D(o("h3",Vj,null,512),[[J,"documents::document.recipients.recipients"]]),o("span",Tj," ("+S(x.$t("documents::document.recipients.additional_recipients"))+") ",1)]),o("div",Dj,[o("div",qj,[o("table",Ej,[o("thead",Aj,[o("tr",null,[Bj,D(o("th",Nj,null,512),[[J,"documents::document.recipients.recipient_name"]]),D(o("th",Oj,null,512),[[J,"documents::document.recipients.recipient_email"]]),D(o("th",zj,null,512),[[J,"documents::document.recipients.is_sent"]]),Mj])]),o("tbody",Uj,[x.form.recipients.length===0?(d(),k("tr",Pj,[D(o("td",jj,null,512),[[J,"documents::document.recipients.no_recipients"]])])):O("",!0),(d(!0),k(te,null,re(x.form.recipients,(G,oe)=>(d(),k("tr",{key:oe},[o("td",Lj,[o("span",Hj,[s(T,{checked:G.send_email,"onUpdate:checked":pe=>G.send_email=pe},null,8,["checked","onUpdate:checked"])])]),o("td",Gj,[s(E,{ref_for:!0,ref_key:"recipientNameInputRef",ref:u,modelValue:G.name,"onUpdate:modelValue":pe=>G.name=pe,placeholder:x.$t("documents::document.recipients.enter_full_name"),onInput:pe=>x.form.errors.clear("recipients."+oe+".name")},null,8,["modelValue","onUpdate:modelValue","placeholder","onInput"]),s(B,{textContent:S(x.form.getError("recipients."+oe+".name"))},null,8,["textContent"])]),o("td",Kj,[s(E,{modelValue:G.email,"onUpdate:modelValue":pe=>G.email=pe,type:"email",placeholder:x.$t("documents::document.recipients.enter_email"),onKeyup:Tt(C,["enter"]),onInput:pe=>x.form.errors.clear("recipients."+oe+".email")},null,8,["modelValue","onUpdate:modelValue","placeholder","onKeyup","onInput"]),s(B,{textContent:S(x.form.getError("recipients."+oe+".email"))},null,8,["textContent"])]),o("td",Yj,[o("span",Wj,[D(o("span",{class:X(["inline-block h-4 w-4 rounded-full",G.sent_at?"bg-success-400":"bg-danger-400"])},null,2),[[K,G.sent_at?l(a)(G.sent_at):null]])])]),o("td",Qj,[s(z,{icon:"X",onClick:pe=>$(oe)},null,8,["onClick"])])]))),128))])])])]),D(o("a",{class:"link mt-3 inline-block text-sm font-medium",href:"#",onClick:ie(C,["prevent"])}," + "+S(x.$t("documents::document.recipients.add")),9,Xj),[[Y,!_.value]]),D(o("h3",Zj,null,512),[[J,"documents::document.send.send"]]),D(o("p",Jj,null,512),[[Y,!p.value],[J,"documents::document.send.select_brand"]]),p.value?(d(),k("div",e7,[s(P,{label:x.$t("documents::document.send.send_from_account"),"label-for":"send_mail_account_id"},{default:b(()=>[f.value.length?(d(),R(M,{key:0,"model-value":c.value,"input-id":"send_mail_account_id",clearable:!1,options:f.value,label:"email","onUpdate:modelValue":A[0]||(A[0]=G=>x.form.send_mail_account_id=G.id),"onOption:selected":A[1]||(A[1]=G=>w(f.value))},null,8,["model-value","options"])):(d(),R(U,{key:1,class:"mt-2 inline-flex items-center"},{default:b(()=>[s(j,{icon:"ExclamationTriangle",class:"mr-1 h-5 w-5 text-warning-500"}),Q(" "+S(x.$t("documents::document.send.connect_an_email_account")),1)]),_:1}))]),_:1},8,["label"]),s(P,{label:x.$t("documents::document.send.send_subject"),"label-for":"send_mail_subject",class:"mt-4"},{default:b(()=>[s(E,{id:"send_mail_subject",modelValue:x.form.send_mail_subject,"onUpdate:modelValue":A[2]||(A[2]=G=>x.form.send_mail_subject=G)},null,8,["modelValue"])]),_:1},8,["label"]),s(P,{label:x.$t("documents::document.send.send_body"),"label-for":"send_mail_body"},{default:b(()=>[s(H,{id:"send_mail_body",modelValue:x.form.send_mail_body,"onUpdate:modelValue":A[3]||(A[3]=G=>x.form.send_mail_body=G),"with-image":!1},null,8,["modelValue"])]),_:1},8,["label"]),o("div",t7,[o("div",n7,[D(s(T,{checked:m.value,"onUpdate:checked":[A[4]||(A[4]=G=>m.value=G),A[5]||(A[5]=G=>G?"":x.form.send_at=null)],disabled:!x.document.id,label:x.$t("documents::document.send.send_later")},null,8,["checked","disabled","label"]),[[K,x.document.id?null:x.$t("documents::document.send.save_to_schedule")]])]),m.value&&x.document.id?(d(),R(L,{key:0,modelValue:x.form.send_at,"onUpdate:modelValue":A[6]||(A[6]=G=>x.form.send_at=G),class:"mt-3","min-date":l(r)(),mode:"dateTime",placeholder:x.$t("documents::document.send.select_schedule_date"),required:!0},null,8,["modelValue","min-date","placeholder"])):O("",!0)]),D((d(),k("span",o7,[D(s(Z,{loading:x.sending,icon:"Mail",text:x.$t("core::app.send"),disabled:x.sending||!I.value||x.document.authorizations&&!x.document.authorizations.update,onClick:A[7]||(A[7]=G=>x.$emit("send-requested"))},null,8,["loading","text","disabled"]),[[Y,!m.value]]),D(s(Z,{text:x.$t("documents::document.send.schedule"),disabled:x.form.busy||!I.value||!x.form.send_at||x.document.authorizations&&!x.document.authorizations.update,icon:"Clock",onClick:A[8]||(A[8]=G=>x.$emit("save-requested"))},null,8,["text","disabled"]),[[Y,m.value]])])),[[K,x.document.authorizations&&!x.document.authorizations.update?x.$t("core::app.action_not_authorized"):""]])])):O("",!0)],512)),[[Y,x.visible]])}}},l7={class:"mx-auto max-w-3xl"},a7={class:"mb-3 text-base font-medium text-neutral-800 dark:text-neutral-100"},s7={class:"-space-y-px rounded-md bg-white"},r7=o("span",{class:"h-1.5 w-1.5 rounded-full bg-white"},null,-1),i7=[r7],u7={class:"ml-3 flex flex-col"},d7={class:"mb-3 mt-6 text-base font-medium text-neutral-800 dark:text-neutral-100"},c7={class:"table-responsive"},m7={class:"overflow-auto border border-neutral-200 dark:border-neutral-800 sm:rounded-md"},p7={class:"min-w-full divide-y divide-neutral-200 dark:divide-neutral-700"},f7={class:"bg-neutral-50 dark:bg-neutral-800"},v7={class:"bg-neutral-50 p-2 text-left text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},b7={class:"bg-neutral-50 p-2 text-left text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},h7={class:"bg-neutral-50 p-2 text-center text-xs font-semibold uppercase tracking-wider text-neutral-600 dark:bg-neutral-800 dark:text-neutral-200"},_7={class:"hidden sm:block"},g7=o("th",null,null,-1),y7={class:"divide-y divide-neutral-200 bg-white dark:divide-neutral-700 dark:bg-neutral-800"},x7={key:0},I7={colspan:"4",class:"bg-white p-3 align-middle text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},k7={key:0},$7={colspan:"4",class:"bg-success-50 p-2 text-center text-sm dark:bg-neutral-800 dark:text-neutral-100"},w7={class:"text-success-500"},C7={class:"font-medium"},S7=["textContent"],R7={class:"mt-1 inline-flex flex-row space-x-2"},F7={class:"text-success-500"},V7={class:"font-medium"},T7=["textContent"],D7={class:"text-success-500"},q7={class:"font-medium"},E7=["textContent"],A7={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},B7={class:"bg-white p-2 align-top text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},N7={class:"bg-white p-2 text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},O7={class:"inline-flex min-w-full justify-center"},z7={class:"bg-white p-2 text-sm font-medium text-neutral-900 dark:bg-neutral-800 dark:text-neutral-100"},M7=["onClick"],ur={__name:"DocumentFormSignature",props:Io,setup(e){const t=e,{t:n}=ve(),{localizedDateTime:a}=Ne(),r=q(null),i=[{name:n("documents::document.signature.no_signature"),description:n("documents::document.signature.no_signature_description"),value:!1},{name:n("documents::document.signature.e_signature"),description:n("documents::document.signature.e_signature_description"),value:!0}],u=V(()=>t.form.signers.filter(p=>Be(p.name)||Be(p.email)).length>0);function c(){t.form.signers.push({name:"",email:"",send_email:!0}),Fe(()=>{r.value[t.form.signers.length-1].focus()})}function m(p){t.form.signers.splice(p,1)}return(p,f)=>{const h=v("IFormInput"),g=v("IFormError"),y=v("IButtonIcon"),_=ae("t"),I=ae("i-tooltip");return D((d(),k("div",l7,[D(o("h3",a7,null,512),[[_,"documents::document.sections.signature"]]),s(l(zl),{modelValue:p.form.requires_signature,"onUpdate:modelValue":f[0]||(f[0]=F=>p.form.requires_signature=F)},{default:b(()=>[s(l(Ln),{class:"sr-only"},{default:b(()=>[Q(S(p.$t("documents::document.sections.signature")),1)]),_:1}),o("div",s7,[(d(),k(te,null,re(i,(F,$)=>s(l(Ol),{key:F.name,as:"template",value:F.value},{default:b(({checked:C,active:w})=>[o("div",{class:X([p.document.status==="accepted"?"pointer-events-none opacity-70":"",$===0?"rounded-tl-md rounded-tr-md":"",$===i.length-1?"rounded-bl-md rounded-br-md":"",C?"z-10 border-primary-200 bg-primary-50 dark:bg-primary-100":"border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-800","relative flex cursor-pointer border p-4 focus:outline-none"])},[o("span",{class:X([C?"border-transparent bg-primary-600":"border-neutral-300 bg-white",w?"ring-2 ring-primary-500 ring-offset-2":"","mt-0.5 flex h-4 w-4 shrink-0 cursor-pointer items-center justify-center rounded-full border"]),"aria-hidden":"true"},i7,2),o("span",u7,[s(l(Ln),{as:"span",class:X([C?"text-primary-900":"text-neutral-900 dark:text-neutral-200","block text-sm font-medium"])},{default:b(()=>[Q(S(F.name),1)]),_:2},1032,["class"]),s(l(Ao),{as:"span",class:X([C?"text-primary-700":"text-neutral-500 dark:text-neutral-400","block text-sm"])},{default:b(()=>[Q(S(F.description),1)]),_:2},1032,["class"])])],2)]),_:2},1032,["value"])),64))])]),_:1},8,["modelValue"]),D(o("div",null,[D(o("h3",d7,null,512),[[_,"documents::document.signers.document_signers"]]),o("div",c7,[o("div",m7,[o("table",p7,[o("thead",f7,[o("tr",null,[D(o("th",v7,null,512),[[_,"documents::document.signers.signer_name"]]),D(o("th",b7,null,512),[[_,"documents::document.signers.signer_email"]]),o("th",h7,[D(o("span",_7,null,512),[[_,"documents::document.signers.is_signed"]])]),g7])]),o("tbody",y7,[p.form.signers.length===0?(d(),k("tr",x7,[D(o("td",I7,null,512),[[_,"documents::document.signers.no_signers"]])])):O("",!0),(d(!0),k(te,null,re(p.form.signers,(F,$)=>(d(),k(te,{key:"signer-"+$},[F.signed_at?(d(),k("tr",k7,[o("td",$7,[o("p",w7,[o("span",C7,S(p.$t("documents::document.signature.signature"))+": ",1),o("span",{class:"font-signature text-[1.4rem] text-success-700",textContent:S(F.signature)},null,8,S7)]),o("div",R7,[o("p",F7,[o("span",V7,S(p.$t("documents::document.signature.signed_on"))+": ",1),o("span",{textContent:S(l(a)(F.signed_at))},null,8,T7)]),o("p",D7,[o("span",q7,S(p.$t("documents::document.signature.sign_ip"))+": ",1),o("span",{textContent:S(F.sign_ip)},null,8,E7)])])])])):O("",!0),o("tr",null,[o("td",A7,[s(h,{ref_for:!0,ref_key:"signerNameInputRef",ref:r,modelValue:F.name,"onUpdate:modelValue":C=>F.name=C,placeholder:p.$t("documents::document.signers.enter_full_name"),disabled:p.document.status==="accepted",onInput:C=>p.form.errors.clear("signers."+$+".name")},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled","onInput"]),s(g,{textContent:S(p.form.getError("signers."+$+".name"))},null,8,["textContent"])]),o("td",B7,[s(h,{modelValue:F.email,"onUpdate:modelValue":C=>F.email=C,disabled:p.document.status==="accepted",type:"email",placeholder:p.$t("documents::document.signers.enter_email"),onInput:C=>p.form.errors.clear("signers."+$+".email"),onKeyup:Tt(c,["enter"])},null,8,["modelValue","onUpdate:modelValue","disabled","placeholder","onInput","onKeyup"]),s(g,{textContent:S(p.form.getError("signers."+$+".email"))},null,8,["textContent"])]),o("td",N7,[o("span",O7,[D(o("span",{class:X(["inline-block h-4 w-4 rounded-full",F.signed_at?"bg-success-400":"bg-danger-400"])},null,2),[[I,F.signed_at?l(a)(F.signed_at):null]])])]),o("td",z7,[s(y,{icon:"X",onClick:C=>m($)},null,8,["onClick"])])])],64))),128))])])])]),D(o("a",{class:"link mt-3 inline-block text-sm font-medium",href:"#",onClick:ie(c,["prevent"])}," + "+S(p.$t("documents::document.signers.add")),9,M7),[[Y,!u.value&&p.document.status!=="accepted"]])],512),[[Y,p.form.requires_signature]])],512)),[[Y,p.visible]])}}},U7={key:0},P7={class:"inline-block"},j7={key:0,class:"ml-1.5 self-start"},L7=["textContent"],dr={__name:"DocumentsCreate",props:{viaResource:String,viaResourceId:[String,Number],relatedResource:Object,editRedirectHandler:Function,exitUsing:Function},emits:["created","sent"],setup(e,{emit:t}){const n=e,a=Me("synchronizeResource",null),r=Me("incrementResourceCount",null),{t:i}=ve(),u=Qe(),c=Ye(),{currentUser:m}=Le(),{createResource:p,updateResource:f}=Je(Innoclapps.resourceName("documents")),h=q(null),g=q(!1),{orderedBrands:y,brandsAreBeingFetched:_}=yo(),I=q(c.query.section||"details"),F=q({}),$=q(!1),C=q(null),w=q(!0),x=q([]);mt("brands",y);const A=V(()=>!_.value),{documentTypes:N}=Jn(),{form:T}=Ae({title:null,brand_id:null,user_id:null,content:null,view_type:"nav-top",locale:m.value.locale,document_type_id:null,requires_signature:!0,signers:[],recipients:[],pdf:{padding:"15px"},billable:{tax_type:Innoclapps.config("options.tax_type"),products:[]},send:!1,send_mail_account_id:null,send_mail_body:null,send_mail_subject:null,associations:{}});function E(){if(n.exitUsing){n.exitUsing();return}u.back()}function B(ee,W={}){if(u.document=ee,n.editRedirectHandler){n.editRedirectHandler(ee,W);return}u.replace({name:"edit-document",params:{id:ee.id},query:W})}function z(){g.value=!0,U().then(ee=>{if(T.send=!0,!ee.authorizations.view){B(ee,{section:"send"}),Innoclapps.error("Document not sent, your account not authorized to perform this action.");return}T.billable=ee.billable,T.signers=ee.signers,f(T,ee.id).then(W=>{Innoclapps.success(i("documents::document.sent")),t("sent",W),B(W,{section:"send"})})}).catch(()=>g.value=!1)}function M(){U().then(E)}async function j(){let ee=await U();return B(ee,{section:I.value}),ee}async function U(){T.busy=!0,await h.value.builderRef.saveBase64Images(),await Fe();let ee=await p(T).catch(W=>(W.isValidationError()&&Innoclapps.error(i("core::app.form_validation_failed_with_sections"),3e3),Promise.reject(W)));return n.viaResource&&ee.authorizations.view&&(a({documents:[ee]}),r(["documents_count","documents_for_user_count","draft_documents_for_user_count"])),t("created",ee),ee}function P({deal:ee}){C.value=ee,x.value.push(ee),Z(ee),$.value=!1}function H(ee,W){let ne=Xe(F.value[W],["id",ee]),ce=T.associations[W].findIndex(fe=>fe===ee);ne!==-1&&F.value[W].splice(ne,1),ce!==-1&&T.associations[W].splice(ce,1)}function L(ee,W){Object.hasOwn(T.associations,W)||(T.associations[W]=[]),Object.hasOwn(F.value,W)||(F.value[W]=[]),Ee(T.associations[W],["id",ee.id])||(T.associations[W].push(ee.id),F.value[W].push(ee))}function Z(ee){ee&&(L({id:ee.id,display_name:ee.display_name},"deals"),K(ee))}function J(ee){!ee&&C.value&&H(C.value.id,"deals"),C.value=ee}function K(ee){!T.title&&T.document_type_id&&(T.title=`${ee.display_name} ${Ee(N.value,["id",T.document_type_id]).name}`),ee.billable&&(T.billable.products=ee.billable.products.map(W=>Rn(W,["id"])),T.billable.tax_type=ee.billable.tax_type),T.requires_signature&&(ee.contacts||[]).filter(W=>!!W.email).forEach(W=>T.signers.unshift({name:W.display_name,email:W.email,send_email:!0}))}function G(){L({id:n.viaResourceId,display_name:n.relatedResource.display_name},n.viaResource),n.viaResource==="deals"&&(K(n.relatedResource),w.value=!1),n.viaResource==="contacts"&&n.relatedResource.email&&T.signers.unshift({name:n.relatedResource.display_name,email:n.relatedResource.email,send_email:!0}),n.viaResource==="companies"&&(n.relatedResource.contacts||[]).filter(ee=>!!ee.email).forEach(ee=>{T.signers.unshift({name:ee.display_name,email:ee.email,send_email:!0})})}const oe=Dt(function(ee,W){if(ee==""){x.value=[];return}pe(ee,W)},400);async function pe(ee,W){W(!0);let{data:ne}=await Innoclapps.request().get("/deals/search",{params:{q:ee,with:"billable.products"}});x.value=ne,W(!1)}function ue(){n.viaResource&&G(),T.set("user_id",m.value.id)}return ue(),(ee,W)=>{const ne=v("IDropdownItem"),ce=v("IDropdownButtonGroup"),fe=v("Icon"),Se=v("ICustomSelect"),Ie=v("IFormGroup"),Ce=v("CreateDealModal"),le=ae("i-tooltip"),ye=ae("t");return d(),R(gn,{to:"body"},[s(sr,{"active-section":I.value,"onUpdate:activeSection":W[2]||(W[2]=Ge=>I.value=Ge),"total-products":l(T).billable.products.length,"total-signers":l(T).requires_signature?l(T).signers.length:void 0,onExitRequested:E},{actions:b(()=>[s(ce,{size:"sm",placement:"bottom-end",disabled:l(T).busy,loading:l(T).busy,text:ee.$t("core::app.save"),onClick:j},{default:b(()=>[s(ne,{text:ee.$t("core::app.save_and_exit"),onClick:M},null,8,["text"])]),_:1},8,["disabled","loading","text"])]),default:b(()=>[A.value?(d(),k("div",U7,[s(ar,{form:l(T),visible:I.value=="details"},{actions:b(()=>[o("div",P7,[s(vn,{modelValue:l(T).associations,"onUpdate:modelValue":W[0]||(W[0]=Ge=>l(T).associations=Ge),"width-class":"w-80","primary-resource-name":e.viaResource,"primary-record":e.viaResource?e.relatedResource:void 0,"primary-record-disabled":!0,"initial-associateables":e.viaResource?e.relatedResource:void 0,associateables:F.value},{"after-record":b(({record:Ge,selectedRecords:be,isSearching:Ve,title:$e})=>[be[0]===Ge.id&&!Ve?D((d(),k("span",j7,[s(fe,{icon:"CodeBracket",class:"h-5 w-5 text-neutral-500 dark:text-neutral-400"})])),[[le,ee.$t("documents::document.will_use_placeholders_from_record",{resourceName:$e}),void 0,{top:!0}]]):O("",!0)]),_:1},8,["modelValue","primary-resource-name","primary-record","initial-associateables","associateables"])])]),top:b(()=>[w.value?(d(),R(Ie,{key:0,class:"mb-6 mt-3 rounded-md border border-neutral-300 p-5 dark:border-neutral-700",description:ee.$t("documents::document.deal_description")},{default:b(()=>[s(Se,{ref:"createDealSelectRef",placeholder:ee.$t("deals::deal.choose_or_create"),label:"name","input-id":"deal_id",options:x.value,filterable:!1,"model-value":C.value,"onUpdate:modelValue":J,onSearch:l(oe),"onOption:selected":Z},{"no-options":b(({searching:Ge,text:be})=>[D(o("span",{textContent:S(be)},null,8,L7),[[Y,Ge]]),D(o("span",null,null,512),[[Y,!Ge],[ye,"core::app.type_to_search"]])]),footer:b(()=>[o("a",{href:"#",class:"link block border-t border-neutral-200 px-4 py-2 text-sm hover:bg-neutral-50 dark:border-neutral-600 dark:hover:bg-neutral-700",onClick:W[1]||(W[1]=ie(Ge=>{$.value=!0,ee.$refs.createDealSelectRef.hide()},["prevent"]))}," + "+S(ee.$t("deals::deal.create")),1)]),_:1},8,["placeholder","options","model-value","onSearch"])]),_:1},8,["description"])):O("",!0)]),_:1},8,["form","visible"]),s(rr,{form:l(T),visible:I.value=="products"},null,8,["form","visible"]),s(lr,{ref_key:"sectionContentRef",ref:h,form:l(T),visible:I.value=="content"},null,8,["form","visible"]),s(ur,{form:l(T),visible:I.value=="signature"},null,8,["form","visible"]),s(ir,{sending:g.value,form:l(T),visible:I.value=="send",onSendRequested:z,onSaveRequested:j},null,8,["sending","form","visible"])])):O("",!0)]),_:1},8,["active-section","total-products","total-signers"]),s(Ce,{visible:$.value,"onUpdate:visible":W[3]||(W[3]=Ge=>$.value=Ge),onCreated:P},null,8,["visible"])])}}},H7={class:"flex items-center space-x-2"},G7={class:"inline-block"},K7={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},Y7={key:0,class:"container mx-auto"},W7={key:0,class:"mx-auto mb-6 max-w-6xl"},Q7={class:"inline-block"},X7={key:0,class:"ml-1.5 self-start"},Po={__name:"DocumentsEdit",props:{id:Number,viaResource:String,viaResourceId:[String,Number],relatedResource:Object,section:String,exitUsing:Function},emits:["changed","updated","deleted","cloned","lost","reactivated","accept","sent","associations-updated"],setup(e,{emit:t}){const n=e,a=Me("synchronizeResource",null),r=Me("incrementResourceCount",null),{t:i}=ve(),{syncAssociations:u,associationsBeingSaved:c,retrieveResource:m,deleteResource:p,cloneResource:f}=Je(Innoclapps.resourceName("documents")),h=Qe(),g=Ye(),y=Ut(),_=q(null),I=q(!1),F=q(!1),{orderedBrands:$,brandsAreBeingFetched:C}=yo(),w=q(n.section||g.query.section||"details"),x=q({}),A=q(!1),{form:N}=Ae(),T=V(()=>F.value&&!C.value);mt("brands",$),mt("document",x);function E(G){u(x.value.id,G).then(oe=>{x.value.associations=To(x.value.associations,oe.associations),t("associations-updated",oe),t("changed",oe)})}function B(G){(h.document?new Promise(oe=>oe(h.document)):m(G)).then(oe=>{N.set({send:!1}),z(oe),F.value=!0,h.document&&delete h.document}).catch(oe=>{oe.response.status===404&&(A.value=!0)})}function z(G){x.value=G,n.viaResource||(y.value=G.title),N.set({title:G.title,view_type:G.view_type,locale:G.locale,user_id:G.user_id,brand_id:G.brand_id,document_type_id:G.document_type_id,content:G.content,requires_signature:G.requires_signature,signers:G.signers,recipients:G.recipients,pdf:G.pdf,billable:{tax_type:G.billable.tax_type,products:G.billable.products,removed_products:[]},send_at:G.send_at,send_mail_account_id:G.send_mail_account_id,send_mail_body:G.send_mail_body,send_mail_subject:G.send_mail_subject})}async function M(){await Innoclapps.dialog().confirm({message:i("documents::document.actions.mark_as_lost_message"),title:!1,icon:"QuestionMarkCircle",iconWrapperColorClass:"bg-info-100",iconColorClass:"text-info-400",html:!0,confirmText:i("core::app.confirm"),confirmVariant:"secondary"}),Innoclapps.request().post(`/documents/${x.value.id}/lost`).then(({data:G})=>{t("lost",G),t("changed",G),Innoclapps.success(i("documents::document.marked_as_lost")),K()})}function j(){Innoclapps.request().post(`/documents/${x.value.id}/accept`).then(({data:G})=>{t("accept",G),t("changed",G),Innoclapps.success(i("documents::document.marked_as_accepted")),z(G)})}async function U(){await Innoclapps.dialog().confirm(),Innoclapps.request().post(`/documents/${x.value.id}/draft`).then(({data:G})=>{Innoclapps.success(i("documents::document.reactivated")),t("reactivated",G),t("changed",G),z(G)})}function P(){I.value=!0,H().then(()=>{N.send=!0,H().then(()=>Innoclapps.success(i("documents::document.sent"))).finally(G=>{N.send=!1,I.value=!1,t("sent",G)})}).catch(G=>{console.error(G),I.value=!1})}async function H(){N.busy=!0,await _.value.builderRef.saveBase64Images(),await Fe();let G=await N.put(`/documents/${x.value.id}`).catch(oe=>(oe.isValidationError()&&Innoclapps.error(i("core::app.form_validation_failed_with_sections"),3e3),Promise.reject(oe)));return z(G),t("updated",G),t("changed",G),G}function L(){H().then(K)}async function Z(){const G=await f(x.value.id);t("cloned",G),n.viaResource?(h.push({name:g.name,params:{documentId:G.id}}),n.viaResource&&G.authorizations.view&&(a({documents:[G]}),r(["documents_count","documents_for_user_count","draft_documents_for_user_count"]))):h.push({name:g.name,params:{id:G.id}}),z(G)}async function J(){await Innoclapps.dialog().confirm(),await p(x.value.id),t("deleted",x.value),Innoclapps.success(i("documents::document.deleted")),K()}function K(){if(n.exitUsing){n.exitUsing();return}h.back()}return B(n.id||g.params.id),(G,oe)=>{const pe=v("IButtonCopy"),ue=v("Icon"),ee=v("IDropdownItem"),W=v("IDropdown"),ne=v("IDropdownButtonGroup"),ce=v("IAlert"),fe=v("IOverlay"),Se=ae("i-tooltip");return d(),R(gn,{to:"body",disabled:A.value},[s(sr,{"active-section":w.value,"onUpdate:activeSection":oe[0]||(oe[0]=Ie=>w.value=Ie),"total-products":T.value?l(N).billable.products.length:void 0,"total-signers":T.value&&l(N).requires_signature?l(N).signers.length:void 0,"remaining-signers":T.value?l(N).signers.filter(Ie=>!Ie.signed_at).length:void 0,onExitRequested:K},{actions:b(()=>[o("div",H7,[T.value&&x.value.authorizations.view?D((d(),R(pe,{key:0,text:x.value.public_url,"success-message":G.$t("documents::document.url_copied"),class:"mr-1 shrink-0"},null,8,["text","success-message"])),[[Se,G.$t("documents::document.copy_url"),void 0,{bottom:!0}]]):O("",!0),T.value&&x.value.authorizations.view?(d(),R(W,{key:1,size:"sm",variant:"white","no-caret":"",placement:"bottom-end"},{"toggle-content":b(()=>[s(ue,{icon:"DocumentDownload",class:"h-4 w-4"})]),default:b(()=>[s(ee,{href:x.value.public_url+"/pdf",target:"_blank",rel:"noopener noreferrer",text:G.$t("documents::document.view_pdf")},null,8,["href","text"]),s(ee,{href:x.value.public_url+"/pdf?output=download",text:G.$t("documents::document.download_pdf")},null,8,["href","text"])]),_:1})):O("",!0),D((d(),k("span",G7,[T.value?(d(),R(ne,{key:0,size:"sm",placement:"bottom-end",disabled:l(N).busy||l(c)||!x.value.authorizations.update,loading:l(N).busy||l(c),text:G.$t("core::app.save"),onClick:H},{default:b(()=>[o("div",K7,[o("div",null,[s(ee,{text:G.$t("core::app.save_and_exit"),onClick:L},null,8,["text"]),x.value.status!=="accepted"&&x.value.status!=="lost"?(d(),R(ee,{key:0,text:G.$t("documents::document.actions.mark_as_lost"),onClick:M},null,8,["text"])):O("",!0),x.value.status!=="accepted"?(d(),R(ee,{key:1,text:G.$t("documents::document.actions.mark_as_accepted"),onClick:j},null,8,["text"])):O("",!0),x.value.status==="lost"?(d(),R(ee,{key:2,text:G.$t("documents::document.actions.reactivate"),onClick:U},null,8,["text"])):O("",!0),x.value.status==="accepted"&&x.value.marked_accepted_by?(d(),R(ee,{key:3,text:G.$t("documents::document.actions.undo_acceptance"),onClick:U},null,8,["text"])):O("",!0),s(ee,{text:G.$t("core::app.clone"),onClick:Z},null,8,["text"])]),x.value.authorizations.delete?(d(),R(ee,{key:0,text:G.$t("core::app.delete"),onClick:J},null,8,["text"])):O("",!0)])]),_:1},8,["disabled","loading","text"])):O("",!0)])),[[Se,x.value.authorizations&&!x.value.authorizations.update?G.$t("core::app.action_not_authorized"):"",void 0,{bottom:!0}]])])]),default:b(()=>[s(fe,{show:!T.value},{default:b(()=>[T.value?(d(),k("div",Y7,[T.value&&G.$gate.denies("view",x.value)?(d(),k("div",W7,[s(ce,{variant:"warning"},{default:b(()=>[Q(S(G.$t("core::role.view_non_authorized_after_record_create")),1)]),_:1})])):O("",!0),s(ar,{form:l(N),document:x.value,visible:w.value=="details"},{actions:b(()=>[o("div",Q7,[s(vn,{"width-class":"w-80",disabled:l(c),associateables:x.value.associations,"initial-associateables":e.viaResource?e.relatedResource:void 0,"model-value":x.value.associations,"primary-resource-name":e.viaResource,onChange:E},{"after-record":b(({record:Ie,isSelected:Ce,isSearching:le,title:ye})=>[Ie.is_primary_associated&&Ce&&!le?D((d(),k("span",X7,[s(ue,{icon:"CodeBracket",class:"h-5 w-5 text-neutral-500 dark:text-neutral-400"})])),[[Se,G.$t("documents::document.will_use_placeholders_from_record",{resourceName:ye}),void 0,{top:!0}]]):O("",!0)]),_:1},8,["disabled","associateables","initial-associateables","model-value","primary-resource-name"])])]),_:1},8,["form","document","visible"]),s(rr,{form:l(N),visible:w.value=="products",document:x.value},null,8,["form","visible","document"]),s(lr,{ref_key:"sectionContentRef",ref:_,form:l(N),document:x.value,visible:w.value=="content","is-ready":T.value},null,8,["form","document","visible","is-ready"]),s(ur,{form:l(N),document:x.value,visible:w.value=="signature"},null,8,["form","document","visible"]),s(ir,{sending:I.value,form:l(N),document:x.value,visible:w.value=="send",onSendRequested:P,onSaveRequested:H},null,8,["sending","form","document","visible"])])):O("",!0)]),_:1},8,["show"])]),_:1},8,["active-section","total-products","total-signers","remaining-signers"])],8,["disabled"])}}},Z7={class:"flex items-center"},J7=["href","textContent"],eL={class:"mt-5"},tL={class:"rounded-md bg-neutral-50 px-6 py-5 dark:bg-neutral-800 sm:flex sm:items-start sm:justify-between"},nL={class:"sm:flex sm:items-start"},oL={class:"mt-3 sm:ml-4 sm:mt-0"},lL=["textContent"],aL=["textContent"],sL={key:0,class:"mt-1 text-sm text-neutral-600 sm:flex sm:items-center"},rL=["textContent"],iL={class:"mt-4 sm:ml-6 sm:mt-0 sm:shrink-0"},uL={class:"flex items-center space-x-2"},dL={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},cr=Object.assign({inheritAttrs:!1},{__name:"RelatedDocument",props:{documentId:{type:Number,required:!0},typeId:{type:Number,required:!0},status:{type:String,required:!0},displayName:{type:String,required:!0},path:{type:String,required:!0},publicUrl:{type:String,required:!0},acceptedAt:String,lastDateSent:String,amount:{required:!0},authorizations:{type:Object,required:!0},associations:{type:Object,required:!0},viaResource:{type:String,required:!0},viaResourceId:{required:!0,type:[String,Number]},relatedResource:{required:!0,type:Object}},setup(e){const t=e,n=Me("synchronizeResource"),a=Me("decrementResourceCount"),{t:r}=ve(),{syncAssociations:i,associationsBeingSaved:u,deleteResource:c}=Je(Innoclapps.resourceName("documents")),{formatMoney:m}=Mt(),{localizedDateTime:p}=Ne(),{findTypeById:f}=Jn(),h=q(!1),g=q(null),y=V(()=>f(t.typeId)),_=Innoclapps.config("documents.statuses");function I(x){n({documents:x})}function F(x){n({documents:{id:x.id,_delete:!0}}),C()}function $(x=null){g.value=x||"details",h.value=!0}function C(){Innoclapps.$emit("refresh-details-view")}async function w(x){await Innoclapps.dialog().confirm(),await c(x),t.status==="draft"&&a("draft_documents_for_user_count"),n({documents:{id:x,_delete:!0}}),a("documents_count"),a("documents_for_user_count"),Innoclapps.success(r("documents::document.deleted"))}return(x,A)=>{const N=v("Icon"),T=v("IButton"),E=v("IDropdownItem"),B=v("IMinimalDropdown"),z=v("ICard");return d(),k(te,null,[h.value?(d(),R(Po,{key:0,id:e.documentId,section:g.value,"via-resource":e.viaResource,"exit-using":()=>h.value=!1,onReactivated:C,onSent:C,onLost:C,onAccept:C,onChanged:I,onDeleted:F},null,8,["id","section","via-resource","exit-using"])):O("",!0),s(z,Re(x.$attrs,{class:"document-"+e.documentId}),{default:b(()=>[o("div",Z7,[o("a",{class:"text-base/6 font-medium text-neutral-900 dark:text-white",href:e.path,onClick:A[0]||(A[0]=ie(M=>$(),["prevent"])),textContent:S(e.displayName)},null,8,J7),s(zt,{color:y.value.swatch_color,class:"ml-3 inline-flex items-center justify-center rounded-full px-2.5 text-sm/5 font-normal dark:!text-white"},{default:b(()=>[s(N,{icon:y.value.icon,class:"mr-1.5 h-4 w-4 text-current"},null,8,["icon"]),Q(" "+S(y.value.name),1)]),_:1},8,["color"])]),s(vn,{"model-value":e.associations,associateables:e.associations,"initial-associateables":e.relatedResource,disabled:l(u),"primary-resource-name":e.viaResource,onChange:A[1]||(A[1]=M=>l(i)(e.documentId,M).then(j=>l(n)({documents:j})))},null,8,["model-value","associateables","initial-associateables","disabled","primary-resource-name"]),o("div",eL,[o("div",tL,[o("div",nL,[s(zt,{color:l(_)[e.status].color,class:"inline-flex w-auto items-center justify-center self-start rounded-full px-2.5 text-sm/5 font-normal dark:!text-white sm:shrink-0"},{default:b(()=>[Q(S(x.$t("documents::document.status."+e.status)),1)]),_:1},8,["color"]),o("div",oL,[o("div",{class:"text-sm font-medium text-neutral-900 dark:text-neutral-100",textContent:S(l(m)(e.amount))},null,8,lL),o("div",{class:"mt-1 text-sm text-neutral-600 dark:text-neutral-200 sm:flex sm:items-center",textContent:S(x.$t("documents::document.sent_at",{date:e.lastDateSent?l(p)(e.lastDateSent):"N/A"}))},null,8,aL),e.acceptedAt?(d(),k("div",sL,[Q(S(x.$t("documents::document.accepted_at"))+": ",1),o("span",{class:"ml-1",textContent:S(l(p)(e.acceptedAt))},null,8,rL)])):O("",!0)])]),o("div",iL,[o("div",uL,[D(s(T,{size:"sm",variant:"white",text:x.$t("core::app.edit"),onClick:A[2]||(A[2]=M=>$())},null,8,["text"]),[[Y,e.authorizations.view]]),e.status==="draft"?D((d(),R(T,{key:0,size:"sm",variant:"white",icon:"Mail",text:x.$t("documents::document.send.send"),onClick:A[3]||(A[3]=M=>$("send"))},null,8,["text"])),[[Y,e.authorizations.view]]):O("",!0),s(B,null,{default:b(()=>[o("div",dL,[s(E,{href:e.publicUrl,text:x.$t("documents::document.view")},null,8,["href","text"]),o("div",null,[s(E,{href:e.publicUrl+"/pdf",target:"_blank",rel:"noopener noreferrer",text:x.$t("documents::document.view_pdf")},null,8,["href","text"]),s(E,{href:e.publicUrl+"/pdf?output=download",text:x.$t("documents::document.download_pdf")},null,8,["href","text"])]),o("div",null,[e.authorizations.update?(d(),R(E,{key:0,text:x.$t("core::app.edit"),onClick:A[4]||(A[4]=M=>$())},null,8,["text"])):O("",!0),e.authorizations.delete?(d(),R(E,{key:1,text:x.$t("core::app.delete"),onClick:A[5]||(A[5]=M=>w(e.documentId))},null,8,["text"])):O("",!0)])])]),_:1})])])])])]),_:1},16,["class"])],64)}}}),cL={class:"-mt-[20px] mb-3 rounded-b-md border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-900 sm:mb-7"},mL={class:"px-4 py-5 sm:p-6"},pL={class:"sm:flex sm:items-start sm:justify-between"},fL={class:"text-base/6 font-medium text-neutral-900 dark:text-white"},vL={class:"mt-2 max-w-xl text-sm text-neutral-500 dark:text-neutral-200"},bL={class:"mt-5 sm:ml-6 sm:mt-0 sm:flex sm:shrink-0 sm:items-center"},hL={class:"mt-6 text-center text-neutral-800 dark:text-neutral-200"},_L="documents",gL={__name:"RecordTabDocumentPanel",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object},scrollElement:{type:String}},setup(e){const t=e,n=Me("synchronizeResource"),a=q(null),r=q(!1),i=q(null),{dataLoadedFirstTime:u,searchResults:c,isSearching:m,hasSearchResults:p,performSearch:f,search:h,loadData:g,infiniteHandler:y}=Xn({resourceName:t.resourceName,resource:xe(t,"resource"),scrollElement:t.scrollElement,infinityRef:a,synchronizeResource:n,timelineRelation:_L}),_=V(()=>m.value?c.value||[]:t.resource.documents||[]),I=V(()=>ot(_.value.filter(B=>B.status==="lost"),B=>new Date(B.created_at),"asc")),F=V(()=>ot(_.value.filter(B=>B.status==="accepted"),B=>new Date(B.accepted_at),"asc")),$=V(()=>ot(_.value.filter(B=>B.status==="draft"),B=>new Date(B.created_at),"asc")),C=V(()=>ot(_.value.filter(B=>B.status==="sent"),B=>new Date(B.last_date_sent),"desc")),w=V(()=>[...$.value,...C.value,...I.value,...F.value]),x=V(()=>w.value.length>0);function A(B){n({documents:B})}function N(B){n({documents:{id:B.id,_delete:!0}}),E()}function T(B){i.value=B.id,r.value=!1}function E(){Innoclapps.$emit("refresh-details-view")}return(B,z)=>{const M=v("IButton"),j=v("SearchInput"),U=v("ITabPanel"),P=ae("t");return d(),R(U,{lazy:!l(u),onActivatedOnce:l(g)},{default:b(()=>[o("div",cL,[o("div",mL,[o("div",pL,[o("div",null,[D(o("h3",fL,null,512),[[P,"documents::document.manage_documents"]]),o("div",vL,[D(o("p",null,null,512),[[P,"documents::document.info"]])])]),o("div",bL,[s(M,{size:"sm",text:B.$t("documents::document.create"),icon:"Plus",onClick:z[0]||(z[0]=H=>r.value=!0)},null,8,["text"])])]),D(s(j,{modelValue:l(h),"onUpdate:modelValue":z[1]||(z[1]=H=>xt(h)?h.value=H:null),class:"mt-2",onInput:l(f)},null,8,["modelValue","onInput"]),[[Y,x.value||l(h)]])])]),r.value?(d(),R(dr,{key:0,"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource":e.resource,"exit-using":()=>r.value=null,"edit-redirect-handler":T},null,8,["via-resource","via-resource-id","related-resource","exit-using"])):O("",!0),i.value?(d(),R(Po,{key:1,id:i.value,"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource":e.resource,"exit-using":()=>i.value=!1,onReactivated:E,onSent:E,onLost:E,onAccept:E,onChanged:A,onDeleted:N},null,8,["id","via-resource","via-resource-id","related-resource","exit-using"])):O("",!0),(d(!0),k(te,null,re(w.value,H=>(d(),R(cr,{key:H.id,"document-id":H.id,"type-id":H.document_type_id,status:H.status,"display-name":H.display_name,path:H.path,"public-url":H.public_url,"accepted-at":H.accepted_at,"last-date-sent":H.last_date_sent,amount:H.amount,authorizations:H.authorizations,associations:H.associations,"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource":e.resource,class:"mb-3"},null,8,["document-id","type-id","status","display-name","path","public-url","accepted-at","last-date-sent","amount","authorizations","associations","via-resource","via-resource-id","related-resource"]))),128)),D(o("div",hL,null,512),[[Y,l(m)&&!l(p)],[P,"core::app.no_search_results"]]),s(xn,{ref_key:"infinityRef",ref:a,"scroll-element":e.scrollElement,onHandle:z[2]||(z[2]=H=>l(y)(H))},null,8,["scroll-element"])]),_:1},8,["lazy","onActivatedOnce"])}}},yL={__name:"RecordTabTimelineDocument",props:Pt,setup(e){return(t,n)=>(d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned||!1,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:t.log.type.icon,heading:t.$t("documents::document.timeline.heading"),"heading-class":"font-medium"},{default:b(()=>[s(cr,{class:"mt-3","document-id":t.log.id,"type-id":t.log.document_type_id,status:t.log.status,"display-name":t.log.display_name,path:t.log.path,"public-url":t.log.public_url,"accepted-at":t.log.accepted_at,"last-date-sent":t.log.last_date_sent,amount:t.log.amount,authorizations:t.log.authorizations,associations:t.log.associations,"via-resource":t.resourceName,"via-resource-id":t.resourceId,"related-resource":t.resource},null,8,["document-id","type-id","status","display-name","path","public-url","accepted-at","last-date-sent","amount","authorizations","associations","via-resource","via-resource-id","related-resource"])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key","icon","heading"]))}},xL={__name:"DocumentsTypeIndex",setup(e){const t=Innoclapps.resourceName("document-types"),{fetchDocumentTypes:n}=Jn();return(a,r)=>{const i=v("ICardHeading");return d(),R(vo,{"resource-name":l(t),"with-cancel":!1,onCreated:l(n),onUpdated:l(n),onDeleted:l(n)},{header:b(()=>[s(i,null,{default:b(()=>[Q(S(a.$t("documents::document.type.types")),1)]),_:1})]),_:1},8,["resource-name","onCreated","onUpdated","onDeleted"])}}},IL={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},kL={class:"px-4 py-4 sm:px-6"},$L={__name:"SettingsDocuments",setup(e){const{resetStoreState:t}=Le(),{form:n,submit:a,isReady:r}=Gt(),i=q(null),{typesByName:u}=Jn();function c(m){n.default_document_type=m.id,a(t)}return An(r,()=>{i.value=u.value.find(m=>m.id==n.default_document_type)}),(m,p)=>{const f=v("ICustomSelect"),h=v("IFormGroup"),g=v("ICard");return d(),k("div",null,[s(g,{"no-body":"",header:m.$t("documents::document.documents"),class:"mb-3",overlay:!l(r)},{default:b(()=>[o("ul",IL,[o("li",kL,[s(h,{label:m.$t("documents::document.type.default_type"),class:"mb-0","label-for":"default_document_type"},{default:b(()=>[s(f,{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=y=>i.value=y),"input-id":"default_document_type",class:"xl:w-1/3",clearable:!1,label:"name",options:l(u),"onOption:selected":c},null,8,["modelValue","options"])]),_:1},8,["label"])])])]),_:1},8,["header","overlay"]),s(xL)])}}},wL={class:"container mx-auto"},CL={class:"mx-auto max-w-6xl"},SL={class:"px-4 py-4"},RL={class:"flex items-center justify-between"},FL={class:"min-w-0 flex-1"},VL=["href"],TL=["src","alt"],DL={class:"flex space-x-3 md:ml-3"},qL={class:"py-6"},EL={class:"container mx-auto"},AL={class:"mx-auto max-w-6xl"},BL={__name:"DocumentsPublicViewNavbar",props:["publicUrl","brandName","logo","backgroundColor"],setup(e){return(t,n)=>{const a=v("Icon");return d(),k(te,null,[o("div",{class:"sticky top-0 z-50 drop-shadow-[0_1.5px_1.5px_rgba(0,0,0,0.15)]",style:st({backgroundColor:e.backgroundColor})},[o("div",wL,[o("div",CL,[o("div",SL,[o("div",RL,[o("div",FL,[o("a",{href:e.publicUrl,class:"focus:outline-none"},[e.logo?(d(),k("img",{key:0,src:e.logo,alt:e.brandName,class:"h-12 w-auto"},null,8,TL)):(d(),R(a,{key:1,icon:"Document",class:"h-8 w-8 text-neutral-400"}))],8,VL)]),o("div",DL,[de(t.$slots,"actions")])])])])])],4),o("div",qL,[o("div",EL,[o("div",AL,[de(t.$slots,"content")])])])],64)}}},NL=o("div",{class:"fixed inset-0 bg-neutral-600 bg-opacity-75"},null,-1),OL={class:"fixed inset-0 z-40 flex"},zL={class:"absolute right-0 top-0 -mr-12 pt-2"},ML=o("span",{class:"sr-only"},"Close sidebar",-1),UL={class:"h-0 flex-1 overflow-y-auto py-10"},PL={class:"flex shrink-0 items-center px-4"},jL=["href"],LL=["src","alt"],HL={class:"mt-5 space-y-1 px-3"},GL=["href","textContent"],KL={class:"flex shrink-0 space-x-3 p-4"},YL=o("div",{class:"w-14 shrink-0"},null,-1),WL={class:"z-10 hidden md:fixed md:inset-y-0 md:flex md:w-72 md:flex-col"},QL={class:"flex flex-1 flex-col overflow-y-auto py-10"},XL={class:"flex shrink-0 items-center px-4"},ZL=["href"],JL=["src","alt"],e9=["href","textContent"],t9={class:"flex shrink-0 space-x-3 p-4"},n9={class:"flex flex-1 flex-col md:pl-72"},o9={class:"sticky top-0 z-10 bg-white pl-1 pt-1 sm:pl-3 sm:pt-3 md:hidden"},l9=o("span",{class:"sr-only"},"Open sidebar",-1),a9={class:"flex-1"},s9={__name:"DocumentsPublicViewSidebar",props:["navigation","publicUrl","brandName","logo","backgroundColor","full","navigationHeadingTagName"],setup(e){const t=e,n=q(!1),a=q(null);document.body.classList.add("h-full");var r=document.getElementsByTagName("html")[0];return r.className+=" h-full scroll-smooth",a.value=window.location.hash,!a.value&&t.navigation.length>0&&(a.value=t.navigation[0].href),window.addEventListener("hashchange",i=>{a.value=i.currentTarget.location.hash}),De(()=>{let i=document.querySelectorAll(t.navigationHeadingTagName),u=[];i.forEach(m=>{const p=Ee(t.navigation,{name:m.innerText});p&&(m.getAttribute("id")||m.setAttribute("id",p.id),u.push({...p,element:m}))});const c=function(m){const p=m.getBoundingClientRect();return p.top>=0&&p.left>=0&&p.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&p.right<=(window.innerWidth||document.documentElement.clientWidth)};window.addEventListener("scroll",Dt(()=>{let m=[];u.forEach(p=>{c(p.element)&&m.push(p),m.length>0&&(a.value=`${m[0].href}`)})},150))}),(i,u)=>{const c=v("Icon");return d(),k("div",null,[s(l(co),{as:"template",show:n.value},{default:b(()=>[s(l(uo),{as:"div",class:"relative z-40 md:hidden",onClose:u[1]||(u[1]=m=>n.value=!1)},{default:b(()=>[s(l(Jt),{as:"template",enter:"transition-opacity ease-linear duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"transition-opacity ease-linear duration-300","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>[NL]),_:1}),o("div",OL,[s(l(Jt),{as:"template",enter:"transition ease-in-out duration-300 transform","enter-from":"-translate-x-full","enter-to":"translate-x-0",leave:"transition ease-in-out duration-300 transform","leave-from":"translate-x-0","leave-to":"-translate-x-full"},{default:b(()=>[s(l(Cd),{class:"relative flex w-full max-w-xs flex-1 flex-col",style:st({backgroundColor:e.backgroundColor})},{default:b(()=>[s(l(Jt),{as:"template",enter:"ease-in-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-300","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>[o("div",zL,[o("button",{type:"button",class:"ml-1 flex h-10 w-10 items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:u[0]||(u[0]=m=>n.value=!1)},[ML,s(c,{icon:"X",class:"h-6 w-6 text-white"})])])]),_:1}),o("div",UL,[o("div",PL,[o("a",{href:e.publicUrl,class:"focus:outline-none"},[e.logo?(d(),k("img",{key:0,src:e.logo,alt:e.brandName,class:"h-8 w-auto"},null,8,LL)):(d(),R(c,{key:1,icon:"Document",class:"h-8 w-8 text-neutral-400"}))],8,jL)]),o("nav",HL,[(d(!0),k(te,null,re(e.navigation,m=>(d(),k("a",{key:m.name,href:m.href,style:st({color:l(Vn)(e.backgroundColor)}),class:X([a.value===m.href?"font-medium":"font-normal","flex px-2 py-2 text-base focus:outline-none"]),textContent:S(m.name)},null,14,GL))),128))])]),o("div",KL,[de(i.$slots,"actions")])]),_:3},8,["style"])]),_:3}),YL])]),_:3})]),_:3},8,["show"]),o("div",WL,[o("div",{class:"flex min-h-0 flex-1 flex-col shadow-[0px_0px_25px_0px_rgba(0,0,0,0.3)]",style:st({backgroundColor:e.backgroundColor})},[o("div",QL,[o("div",XL,[o("a",{href:e.publicUrl,class:"focus:outline-none"},[e.logo?(d(),k("img",{key:0,src:e.logo,alt:e.brandName,class:"h-8 w-auto"},null,8,JL)):(d(),R(c,{key:1,icon:"Document",class:"h-8 w-8 text-neutral-400"}))],8,ZL)]),o("nav",{class:"mt-5 flex-1 space-y-1 px-3",style:st({backgroundColor:e.backgroundColor})},[(d(!0),k(te,null,re(e.navigation,m=>(d(),k("a",{key:m.name,href:m.href,style:st({color:l(Vn)(e.backgroundColor)}),class:X([a.value===m.href?"font-medium":"font-normal","flex px-2 py-2 text-sm focus:outline-none"]),textContent:S(m.name)},null,14,e9))),128))],4)]),o("div",t9,[de(i.$slots,"actions")])],4)]),o("div",n9,[o("div",o9,[o("button",{type:"button",class:"-ml-0.5 -mt-0.5 inline-flex h-12 w-12 items-center justify-center rounded-md text-neutral-500 hover:text-neutral-900 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500",onClick:u[2]||(u[2]=m=>n.value=!0)},[l9,s(c,{icon:"Bars3BottomLeft",class:"h-6 w-6"})])]),o("main",a9,[o("div",{class:X({"py-6":!e.full})},[o("div",{class:X({"mx-auto max-w-7xl px-4 sm:px-6 md:px-8":!e.full})},[de(i.$slots,"content")],2)],2)])])])}}};const r9={class:"h-full max-h-full w-full bg-white"},i9={class:"inline-flex items-center"},u9={class:"hidden sm:block"},d9={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 512",class:"mr-2 h-5 w-5 fill-white"},c9=o("path",{d:"M192 128c0-17.7 14.3-32 32-32s32 14.3 32 32v7.8c0 27.7-2.4 55.3-7.1 82.5l-84.4 25.3c-40.6 12.2-68.4 49.6-68.4 92v71.9c0 40 32.5 72.5 72.5 72.5c26 0 50-13.9 62.9-36.5l13.9-24.3c26.8-47 46.5-97.7 58.4-150.5l94.4-28.3-12.5 37.5c-3.3 9.8-1.6 20.5 4.4 28.8s15.7 13.3 26 13.3H544c17.7 0 32-14.3 32-32s-14.3-32-32-32H460.4l18-53.9c3.8-11.3 .9-23.8-7.4-32.4s-20.7-11.8-32.2-8.4L316.4 198.1c2.4-20.7 3.6-41.4 3.6-62.3V128c0-53-43-96-96-96s-96 43-96 96v32c0 17.7 14.3 32 32 32s32-14.3 32-32V128zm-9.2 177l49-14.7c-10.4 33.8-24.5 66.4-42.1 97.2l-13.9 24.3c-1.5 2.6-4.3 4.3-7.4 4.3c-4.7 0-8.5-3.8-8.5-8.5V335.6c0-14.1 9.3-26.6 22.8-30.7zM24 368c-13.3 0-24 10.7-24 24s10.7 24 24 24H64.3c-.2-2.8-.3-5.6-.3-8.5V368H24zm592 48c13.3 0 24-10.7 24-24s-10.7-24-24-24H305.9c-6.7 16.3-14.2 32.3-22.3 48H616z"},null,-1),m9=[c9],p9=["innerHTML"],f9=["innerHTML"],v9=["innerHTML"],b9={class:"pb-3"},h9={class:"flex justify-center rounded-md shadow-sm"},_9={class:"flex grow items-stretch focus-within:z-10"},g9=["textContent"],y9={__name:"DocumentsPublicView",props:["requiresSignature","title","content","uuid","status","publicUrl","signatureBoundText","acceptThankYouMessage","signThankYouMessage","navigationBackgroundColor","brandName","logo","viewType","navigation","navigationHeadingTagName"],setup(e){const t=e,n=q(null),a=q(!1),r=q(!1),i=q(!1),u=q(!1),c=q(!1),{form:m}=Ae({email:null,signature:null}),p=V(()=>t.viewType==="nav-top"?BL:s9),f=V(()=>{let _={publicUrl:t.publicUrl,brandName:t.brandName,logo:t.logo,backgroundColor:t.navigationBackgroundColor};return t.viewType!=="nav-top"&&(_.navigation=t.navigation,_.navigationHeadingTagName=t.navigationHeadingTagName,_.full=t.viewType==="nav-left-full-width"),_});function h(){t.requiresSignature?c.value=!0:(u.value=!0,Innoclapps.request().post(`/d/${t.uuid}/accept`).then(()=>window.location.href=`${t.publicUrl}?accepted=1`).finally(()=>u.value=!1))}function g(){m.post(`/d/${t.uuid}/sign`).then(()=>window.location.href=`${t.publicUrl}?signed=1`)}function y(){r.value=!1,i.value=!0,Innoclapps.request().post(`/d/${t.uuid}/validate`,{email:m.email}).then(({data:_})=>{typeof _=="object"?(n.value=_.name,a.value=!0):r.value=!0}).finally(()=>i.value=!1)}return(_,I)=>{const F=v("Icon"),$=v("IButton"),C=v("IAlert"),w=v("IFormInput"),x=v("IFormError"),A=v("IFormGroup"),N=v("IModal"),T=ae("t");return d(),k("div",r9,[(d(),R(We(p.value),pt(ft(f.value)),{actions:b(()=>[s($,{class:"shrink-0",variant:"white",tag:"a",size:"sm",type:"",href:e.publicUrl+"/pdf?output=download"},{default:b(()=>[o("div",i9,[s(F,{icon:"DocumentDownload",class:"h-4 w-4 sm:mr-2"}),D(o("span",u9,null,512),[[T,"documents::document.download_pdf"]])])]),_:1},8,["href"]),e.status!=="accepted"?(d(),R($,{key:0,class:"shrink-0",variant:"success",size:"sm",icon:e.requiresSignature?"":"Check",disabled:u.value,loading:u.value,onClick:h},{default:b(()=>[e.requiresSignature?(d(),k("svg",d9,m9)):O("",!0),Q(" "+S(e.requiresSignature?_.$t("documents::document.sign"):_.$t("documents::document.accept")),1)]),_:1},8,["icon","disabled","loading"])):O("",!0)]),content:b(()=>[_.$route.query.accepted?(d(),R(C,{key:0,class:"mb-6",variant:"success"},{default:b(()=>[o("div",{innerHTML:e.acceptThankYouMessage},null,8,p9)]),_:1})):_.$route.query.signed?(d(),R(C,{key:1,class:"mb-6",variant:"success"},{default:b(()=>[o("div",{innerHTML:e.signThankYouMessage},null,8,f9)]),_:1})):O("",!0),o("div",{class:"contentbuilder prose prose-sm prose-neutral relative max-w-none",innerHTML:e.content},null,8,v9)]),_:1},16)),s(N,{id:"signModal",visible:c.value,"onUpdate:visible":I[3]||(I[3]=E=>c.value=E),size:"sm","ok-title":"Sign","ok-disabled":l(m).busy,"static-backdrop":"",title:a.value?_.$t("documents::document.sign"):_.$t("documents::document.signers.confirm_email"),"hide-footer":!a.value,form:"",onSubmit:g,onKeydown:I[4]||(I[4]=E=>l(m).onKeydown(E))},{default:b(()=>[D(o("div",b9,[o("div",h9,[o("div",_9,[s(w,{modelValue:l(m).email,"onUpdate:modelValue":I[0]||(I[0]=E=>l(m).email=E),rounded:!1,type:"email",class:"rounded-l-md border-neutral-300",placeholder:_.$t("documents::document.signers.enter_email"),onKeyup:Tt(y,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),s($,{class:"relative -ml-px shrink-0 rounded-r-md",variant:"white",rounded:!1,loading:i.value,disabled:!l(m).email||i.value,text:_.$t("core::app.confirm"),onClick:y},null,8,["loading","disabled","text"])])],512),[[Y,!a.value]]),D(s(A,{"label-for":"emailAddress",label:_.$t("documents::document.signers.signer_email")},{default:b(()=>[s(w,{id:"emailAddress",modelValue:l(m).email,"onUpdate:modelValue":I[1]||(I[1]=E=>l(m).email=E),type:"email",disabled:!0,placeholder:_.$t("documents::document.signers.enter_email")},null,8,["modelValue","placeholder"]),s(x,{textContent:S(l(m).getError("email"))},null,8,["textContent"])]),_:1},8,["label"]),[[Y,a.value]]),r.value?(d(),R(C,{key:0,variant:"warning",class:"mt-3"},{default:b(()=>[Q(S(_.$t("documents::document.signature.verification_failed")),1)]),_:1})):O("",!0),D(s(A,{"label-for":"signature",label:_.$t("documents::document.signature.accept_name")},{default:b(()=>[s(w,{id:"signature",modelValue:l(m).signature,"onUpdate:modelValue":I[2]||(I[2]=E=>l(m).signature=E),class:"font-signature text-[1.4rem]"},null,8,["modelValue"]),s(x,{textContent:S(l(m).getError("signature"))},null,8,["textContent"])]),_:1},8,["label"]),[[Y,a.value]]),D(o("p",{class:"mb-3 text-sm text-neutral-500",textContent:S(e.signatureBoundText.replace("{{ signerName }}",n.value).replace("{{signerName}}",e.signatureBoundText))},null,8,g9),[[Y,a.value]])]),_:1},8,["visible","ok-disabled","title","hide-footer"])])}}},x9={class:"flex w-full items-center overflow-x-auto"},Ma={__name:"DocumentsTableStatusPicker",props:["modelValue"],emits:["update:modelValue"],setup(e,{emit:t}){const n=e,a=Innoclapps.config("documents.statuses"),r=q(n.modelValue),{hasBuilderRules:i,rulesAreValid:u,findRule:c}=pn("documents"),m=V(()=>!!c("status")),p=V(()=>m.value||!u.value);return ge(r,f=>{t("update:modelValue",f)}),ge(i,f=>{f&&u.value&&(r.value=void 0)}),ge(u,f=>{i.value&&f&&(r.value=void 0)}),(f,h)=>{const g=v("Icon"),y=ae("t"),_=ae("i-tooltip");return d(),k("div",x9,[D(o("a",{href:"#",class:"link mr-3 border-r-2 border-neutral-200 pr-3 dark:border-neutral-600",onClick:h[0]||(h[0]=ie(I=>r.value=null,["prevent"]))},null,512),[[Y,r.value&&!p.value],[y,"core::app.all"]]),(d(!0),k(te,null,re(l(a),I=>(d(),k("div",{key:I.name,class:X(["mr-2 rounded-md",I.name===e.modelValue?"bg-neutral-800/10":""])},[D((d(),R(zt,{color:I.color,"bg-opacity":.09,class:X([p.value?"opacity-70":"cursor-pointer","inline-flex items-center justify-center rounded-md px-3 py-2 text-sm/5 font-normal dark:!text-white"]),onClick:F=>p.value?void 0:r.value=I.name},{default:b(()=>[s(g,{icon:I.icon,class:"mr-1.5 h-4 w-4 text-current"},null,8,["icon"]),Q(" "+S(f.$t("documents::document.status."+I.name)),1)]),_:2},1032,["color","class","onClick"])),[[_,m.value?f.$t("documents::document.filters.status_disabled"):""]])],2))),128))])}}},I9={class:"mb-2 block lg:hidden"},k9={class:"hidden lg:ml-6 lg:block"},$9={class:"ml-auto flex items-center text-sm"},w9={class:"font-medium text-neutral-800 dark:text-neutral-300"},C9={__name:"DocumentsTable",props:{tableId:{required:!0,type:String},initialize:{default:!0,type:Boolean}},emits:["deleted","loaded"],setup(e,{emit:t}){const n=e,a=Innoclapps.resourceName("documents"),{t:r}=ve(),i=Qe(),{reloadTable:u}=Bt(),{deleteResource:c,cloneResource:m}=Je(a),p=Innoclapps.config("documents.statuses"),f=q(null),h=V(()=>({status:f.value}));async function g(_){const I=await m(_);u(n.tableId),i.push({name:"edit-document",params:{id:I.id}})}async function y(_){await Innoclapps.dialog().confirm(),await c(_),t("deleted",_),u(n.tableId),Innoclapps.success(r("core::resource.deleted"))}return(_,I)=>{const F=ae("t");return d(),k(te,null,[o("div",I9,[s(Ma,{modelValue:f.value,"onUpdate:modelValue":I[0]||(I[0]=$=>f.value=$)},null,8,["modelValue"])]),e.initialize?(d(),R(l(tn),{key:0,"resource-name":l(a),"table-id":e.tableId,"data-request-query-string":h.value,"empty-state":{to:{name:"create-document"},title:_.$t("documents::document.empty_state.title"),buttonText:_.$t("documents::document.create"),description:_.$t("documents::document.empty_state.description")},onLoaded:I[2]||(I[2]=$=>_.$emit("loaded",$))},{"after-search":b(({collection:$})=>[o("div",k9,[s(Ma,{modelValue:f.value,"onUpdate:modelValue":I[1]||(I[1]=C=>f.value=C)},null,8,["modelValue"])]),o("div",$9,[D(o("span",w9,null,512),[[F,{path:"documents::document.count.all",args:{count:$.state.meta.total}}]])])]),status:b(({row:$})=>[s(zt,{color:l(p)[$.status].color,class:"inline-flex items-center justify-center rounded-full px-2.5 text-sm/5 font-normal dark:!text-white"},{default:b(()=>[Q(S(_.$t("documents::document.status."+$.status)),1)]),_:2},1032,["color"])]),actions:b(({row:$})=>[s(Mn,null,{default:b(()=>[s(Ft,{href:$.public_url,tooltip:_.$t("documents::document.view"),icon:"Eye"},null,8,["href","tooltip"]),$.authorizations.update&&$.status==="draft"?(d(),R(Ft,{key:0,to:{name:"edit-document",params:{id:$.id},query:{section:"send"}},tooltip:_.$t("documents::document.send.send"),icon:"Mail"},null,8,["to","tooltip"])):O("",!0),s(Ft,{tooltip:_.$t("core::app.clone"),icon:"Duplicate",onClick:C=>g($.id)},null,8,["tooltip","onClick"]),$.authorizations.delete?(d(),R(Ft,{key:1,tooltip:_.$t("core::app.delete"),icon:"Trash",onClick:C=>y($.id)},null,8,["tooltip","onClick"])):O("",!0)]),_:2},1024)]),_:1},8,["resource-name","table-id","data-request-query-string","empty-state"])):O("",!0)],64)}}},S9={class:"inline-flex items-center"},R9={class:"mr-3 lg:mr-6"},vl="documents",F9={__name:"DocumentsIndex",setup(e){const t=Innoclapps.resourceName("documents"),n=Ye(),{reloadTable:a,customizeTable:r}=Bt(),i=q(n.meta.initialize),u=q(!0),c=V(()=>i.value&&!u.value);function m(){Innoclapps.$emit("refresh-cards"),a(vl)}return yn((p,f,h)=>{i.value=!0,h()}),(p,f)=>{const h=v("NavbarSeparator"),g=v("IDropdownItem"),y=v("IMinimalDropdown"),_=v("IButton"),I=v("router-view"),F=v("ILayout");return d(),R(F,null,{actions:b(()=>[s(h,{class:"hidden lg:block"}),o("div",S9,[o("div",R9,[s(y,{type:"horizontal"},{default:b(()=>[s(g,{icon:"Bars3CenterLeft",to:{name:"document-templates-index"},text:p.$t("documents::document.template.manage")},null,8,["text"]),s(g,{icon:"Trash",to:{name:"trashed-resource-records",params:{resourceName:l(t)}},text:p.$t("core::app.soft_deletes.trashed")},null,8,["to","text"]),s(g,{icon:"Cog",text:p.$t("core::table.list_settings"),onClick:f[0]||(f[0]=$=>l(r)(vl))},null,8,["text"])]),_:1})]),s(_,{to:{name:"create-document"},icon:"Plus",size:"sm",text:p.$t("documents::document.create")},null,8,["text"])])]),default:b(()=>[c.value?(d(),R(nl,{key:0,"resource-name":l(t)},null,8,["resource-name"])):O("",!0),s(C9,{"table-id":vl,initialize:i.value,onLoaded:f[1]||(f[1]=$=>u.value=$.empty),onDeleted:m},null,8,["initialize"]),s(I,{name:"create",onCreated:m,onSent:m}),s(I,{name:"edit","exit-using":()=>p.$router.push({name:"document-index"}),onChanged:m,onDeleted:m,onCloned:m},null,8,["exit-using"])]),_:1})}}},V9={class:"absolute inset-0 z-40 h-full max-h-full w-full bg-white dark:bg-neutral-900"},T9={class:"sticky top-0 z-50 border-b border-neutral-200 bg-neutral-100 dark:border-neutral-700 dark:bg-neutral-800"},D9={class:"container mx-auto"},q9={class:"mx-auto max-w-6xl"},E9={class:"px-3 py-4 sm:px-0"},A9={class:"flex items-center justify-between space-x-4 sm:space-x-0"},B9={class:"h-full min-h-full overflow-y-auto"},N9={class:"px-4 py-6 sm:px-0"},O9={class:"container mx-auto max-w-6xl"},z9={class:"flex"},M9={class:"text-sm font-medium text-neutral-800 dark:text-neutral-100"},U9={class:"ml-1 self-end text-xs text-neutral-600 dark:text-neutral-200"},P9={class:"prose prose-sm prose-neutral relative max-w-none dark:prose-invert",style:{"padding-bottom":"200px"}},j9={__name:"DocumentsTemplatesCreate",emits:["created"],setup(e,{emit:t}){const{t:n}=ve(),a=Qe(),r=q(null),i=Innoclapps.config("documents.placeholders"),{form:u}=Ae({name:"Template name",is_shared:!1,content:"",view_type:null});function c(){m(!1).then(()=>a.back())}async function m(p=!0){u.busy=!0,await r.value.saveBase64Images(),await Fe();let f=await u.post("/document-templates").catch(h=>(h.isValidationError()&&Innoclapps.error(n("core::app.form_validation_failed"),3e3),Promise.reject(h)));return t("created",f),p&&a.replace({name:"edit-document-template",params:{id:f.id}}),f}return Dn(()=>{document.body.classList.add("overflow-y-hidden")}),bt(()=>{document.body.classList.remove("overflow-y-hidden")}),(p,f)=>{const h=v("IDropdownItem"),g=v("IDropdownButtonGroup"),y=v("IFormInput"),_=v("IFormError"),I=v("IFormGroup"),F=v("IFormCheckbox"),$=v("IFormText"),C=ae("t");return d(),R(gn,{to:"body"},[o("div",V9,[o("div",T9,[o("div",D9,[o("div",q9,[o("div",E9,[o("div",A9,[D(o("a",{href:"#",class:"link",onClick:f[0]||(f[0]=ie((...w)=>p.$router.back&&p.$router.back(...w),["prevent"]))},null,512),[[C,"core::app.exit"]]),s(g,{size:"sm",placement:"bottom-end",disabled:l(u).busy,loading:l(u).busy,text:p.$t("core::app.save"),onClick:m},{default:b(()=>[s(h,{text:p.$t("core::app.save_and_exit"),onClick:c},null,8,["text"])]),_:1},8,["disabled","loading","text"])])])])])]),o("div",B9,[o("div",N9,[o("div",O9,[s(I,{"label-for":"templateName",label:p.$t("documents::document.template.name"),required:""},{default:b(()=>[s(y,{id:"templateName",modelValue:l(u).name,"onUpdate:modelValue":f[1]||(f[1]=w=>l(u).name=w),onInput:f[2]||(f[2]=w=>l(u).errors.clear("name"))},null,8,["modelValue"]),s(_,{textContent:S(l(u).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(I,null,{default:b(()=>[s(F,{id:"is_shared",checked:l(u).is_shared,"onUpdate:checked":f[3]||(f[3]=w=>l(u).is_shared=w),name:"is_shared",label:p.$t("documents::document.template.share_with_team_members"),onChange:f[4]||(f[4]=w=>l(u).errors.clear("is_shared"))},null,8,["checked","label"]),s(_,{textContent:S(l(u).getError("is_shared"))},null,8,["textContent"])]),_:1}),s(I,{class:"mt-6"},{default:b(()=>[o("div",z9,[D(o("h3",M9,null,512),[[C,"documents::document.view_type.html_view_type"]]),D(o("span",U9,null,512),[[C,"core::app.optional"]])]),D(s($,{class:"-mt-px mb-3"},null,512),[[C,"documents::document.view_type.template_info"]]),s(ua,{modelValue:l(u).view_type,"onUpdate:modelValue":f[5]||(f[5]=w=>l(u).view_type=w)},null,8,["modelValue"]),s(_,{textContent:S(l(u).getError("view_type"))},null,8,["textContent"])]),_:1}),s(I,{class:"mt-6"},{default:b(()=>[o("div",P9,[s(ia,{ref_key:"builderRef",ref:r,modelValue:l(u).content,"onUpdate:modelValue":[f[6]||(f[6]=w=>l(u).content=w),f[7]||(f[7]=w=>l(u).errors.clear("content"))],placeholders:l(i)},null,8,["modelValue","placeholders"]),s(_,{textContent:S(l(u).getError("content"))},null,8,["textContent"])])]),_:1})])])])])])}}},L9={class:"absolute inset-0 z-40 h-full max-h-full w-full bg-white dark:bg-neutral-900"},H9={class:"sticky top-0 z-50 border-b border-neutral-200 bg-neutral-100 dark:border-neutral-700 dark:bg-neutral-800"},G9={class:"container mx-auto"},K9={class:"mx-auto max-w-6xl"},Y9={class:"px-3 py-4 sm:px-0"},W9={class:"flex items-center justify-between space-x-4 sm:space-x-0"},Q9={class:"h-full min-h-full overflow-y-auto"},X9={class:"px-4 py-6 sm:px-0"},Z9={class:"container mx-auto max-w-6xl"},J9={class:"flex"},eH={class:"text-sm font-medium text-neutral-800 dark:text-neutral-100"},tH={class:"ml-1 self-end text-xs text-neutral-600 dark:text-neutral-200"},nH={class:"prose prose-sm prose-neutral relative max-w-none dark:prose-invert",style:{"padding-bottom":"200px"}},oH={__name:"DocumentsTemplatesEdit",emits:["updated"],setup(e,{emit:t}){const{t:n}=ve(),a=Qe(),r=Ye(),i=q(null),u=Innoclapps.config("documents.placeholders"),c=q(!0),m=q(null),{form:p}=Ae({name:null,is_shared:!1,content:"",view_type:null});function f(_){Innoclapps.request().get(`/document-templates/${_}`).then(({data:I})=>{m.value=I,h(I),Uo(I.google_fonts)}).finally(()=>c.value=!1)}function h(_){p.set({name:_.name,is_shared:_.is_shared,content:_.content,view_type:_.view_type})}function g(){y().then(()=>a.back())}async function y(){p.busy=!0,await i.value.saveBase64Images(),await Fe();let _=await p.put(`/document-templates/${m.value.id}`).catch(I=>(I.isValidationError()&&Innoclapps.error(n("core::app.form_validation_failed"),3e3),Promise.reject(I)));return Uo(_.google_fonts),h(_),t("updated",_),_}return Dn(()=>{f(r.params.id),document.body.classList.add("overflow-y-hidden")}),bt(()=>{document.body.classList.remove("overflow-y-hidden")}),(_,I)=>{const F=v("IDropdownItem"),$=v("IDropdownButtonGroup"),C=v("IFormInput"),w=v("IFormError"),x=v("IFormGroup"),A=v("IFormCheckbox"),N=v("IFormText"),T=v("IOverlay"),E=ae("t");return d(),R(gn,{to:"body"},[o("div",L9,[o("div",H9,[o("div",G9,[o("div",K9,[o("div",Y9,[o("div",W9,[D(o("a",{href:"#",class:"link",onClick:I[0]||(I[0]=ie((...B)=>_.$router.back&&_.$router.back(...B),["prevent"]))},null,512),[[E,"core::app.exit"]]),s($,{size:"sm",placement:"bottom-end",disabled:l(p).busy,loading:l(p).busy,text:_.$t("core::app.save"),onClick:y},{default:b(()=>[s(F,{text:_.$t("core::app.save_and_exit"),onClick:g},null,8,["text"])]),_:1},8,["disabled","loading","text"])])])])])]),o("div",Q9,[s(T,{show:c.value,class:"h-full"},{default:b(()=>[o("div",X9,[o("div",Z9,[s(x,{"label-for":"templateName",label:_.$t("documents::document.template.name"),required:""},{default:b(()=>[s(C,{id:"templateName",modelValue:l(p).name,"onUpdate:modelValue":I[1]||(I[1]=B=>l(p).name=B),onInput:I[2]||(I[2]=B=>l(p).errors.clear("name"))},null,8,["modelValue"]),s(w,{textContent:S(l(p).getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(x,null,{default:b(()=>[s(A,{id:"is_shared",checked:l(p).is_shared,"onUpdate:checked":I[3]||(I[3]=B=>l(p).is_shared=B),name:"is_shared",label:_.$t("documents::document.template.share_with_team_members"),onChange:I[4]||(I[4]=B=>l(p).errors.clear("is_shared"))},null,8,["checked","label"]),s(w,{textContent:S(l(p).getError("is_shared"))},null,8,["textContent"])]),_:1}),s(x,{class:"mt-6"},{default:b(()=>[o("div",J9,[D(o("h3",eH,null,512),[[E,"documents::document.view_type.html_view_type"]]),D(o("span",tH,null,512),[[E,"core::app.optional"]])]),D(s(N,{class:"-mt-px mb-3"},null,512),[[E,"documents::document.view_type.template_info"]]),s(ua,{modelValue:l(p).view_type,"onUpdate:modelValue":I[5]||(I[5]=B=>l(p).view_type=B)},null,8,["modelValue"]),s(w,{textContent:S(l(p).getError("view_type"))},null,8,["textContent"])]),_:1}),s(x,{class:"mt-6"},{default:b(()=>[o("div",nH,[s(ia,{ref_key:"builderRef",ref:i,modelValue:l(p).content,"onUpdate:modelValue":[I[6]||(I[6]=B=>l(p).content=B),I[7]||(I[7]=B=>l(p).errors.clear("content"))],placeholders:l(u)},null,8,["modelValue","placeholders"]),s(w,{textContent:S(l(p).getError("content"))},null,8,["textContent"])])]),_:1})])])]),_:1},8,["show"])])])])}}},lH={class:"inline-flex items-center"},no="document-templates",aH={__name:"DocumentsTemplatesIndex",setup(e){const t=Innoclapps.resourceName("document-templates"),{t:n}=ve(),a=Qe(),{reloadTable:r}=Bt(),{deleteResource:i,cloneResource:u}=Je(t);async function c(p){const f=await u(p);r(no),a.push({name:"edit-document-template",params:{id:f.id}})}async function m(p){await Innoclapps.dialog().confirm(),await i(p),r(no),Innoclapps.success(n("documents::document.template.deleted"))}return(p,f)=>{const h=v("NavbarSeparator"),g=v("IButton"),y=v("router-view"),_=v("ILayout");return d(),R(_,null,{actions:b(()=>[s(h,{class:"hidden lg:block"}),o("div",lH,[s(g,{to:{name:"create-document-template"},icon:"Plus",text:p.$t("documents::document.template.create"),size:"sm"},null,8,["text"])])]),default:b(()=>[s(l(tn),{"resource-name":l(t),"table-id":no,"empty-state":{to:{name:"create-document-template"},title:p.$t("documents::document.template.empty_state.title"),buttonText:p.$t("documents::document.template.create"),description:p.$t("documents::document.template.empty_state.description")}},{actions:b(({row:I})=>[s(Mn,null,{default:b(()=>[I.authorizations.update?(d(),R(Ft,{key:0,to:{name:"edit-document-template",params:{id:I.id}},tooltip:p.$t("core::app.edit"),icon:"PencilAlt"},null,8,["to","tooltip"])):O("",!0),s(Ft,{tooltip:p.$t("core::app.clone"),icon:"Duplicate",onClick:F=>c(I.id)},null,8,["tooltip","onClick"]),I.authorizations.delete?(d(),R(Ft,{key:1,tooltip:p.$t("core::app.delete"),icon:"Trash",onClick:F=>m(I.id)},null,8,["tooltip","onClick"])):O("",!0)]),_:2},1024)]),_:1},8,["resource-name","empty-state"]),s(y,{name:"create",onCreated:f[0]||(f[0]=I=>l(r)(no))}),s(y,{name:"edit",onUpdated:f[1]||(f[1]=I=>l(r)(no))})]),_:1})}}},sH=[{path:"/documents",name:"document-index",component:F9,meta:{title:qe.t("documents::document.documents")},beforeEnter:(e,t)=>{e.meta.initialize=e.name==="document-index"},children:[{path:"create",name:"create-document",components:{create:dr},meta:{title:qe.t("documents::document.create")}},{path:":id",name:"view-document",components:{edit:Po}},{path:":id/edit",name:"edit-document",components:{edit:Po}}]},{path:"/document-templates",name:"document-templates-index",component:aH,meta:{title:qe.t("documents::document.template.templates")},children:[{path:"create",name:"create-document-template",components:{create:j9},meta:{title:qe.t("documents::document.template.create")}},{path:":id/edit",name:"edit-document-template",components:{edit:oH}}]}],{setDocumentTypes:rH}=Jn();window.Innoclapps&&Innoclapps.booting(function(e,t){e.component("DocumentPublicView",y9),e.component("DocumentsTab",aP),e.component("DocumentsTabPanel",gL),e.component("RecordTabTimelineDocument",yL),rH(Innoclapps.config("documents.types")||[]),sH.forEach(n=>t.addRoute(n)),t.addRoute("settings",{path:"documents",name:"document-settings",component:$L,meta:{title:qe.t("documents::document.documents")}})});const iH=["href","target"],uH={class:"text-sm text-neutral-900 dark:text-white"},dH={role:"list",class:"divide-y divide-neutral-100 rounded-md border border-neutral-200 bg-white dark:divide-neutral-800 dark:border-neutral-800 dark:bg-neutral-900"},cH={class:"flex w-0 flex-1 items-center"},mH={class:"ml-4 flex min-w-0 flex-1 gap-2"},pH={class:"truncate font-medium"},fH=["href","textContent"],vH=["href","onClick","textContent"],bH=["textContent"],hH={class:"ml-4 shrink-0"},_H=["href"],mr={__name:"MessageAttachments",props:{attachments:{required:!0,type:Array}},setup(e){const t=e,n=q(null),a=V(()=>t.attachments.filter(c=>c.aggregate_type==="image")),r=V(()=>a.value.map(c=>c.preview_url)),i=V(()=>a.value[n.value]);function u(c){return t.attachments.findIndex(m=>m.preview_url===c)}return(c,m)=>{const p=v("Icon"),f=ae("t");return d(),k(te,null,[s(Wl,{modelValue:n.value,"onUpdate:modelValue":m[0]||(m[0]=h=>n.value=h),urls:r.value},{toolbar:b(()=>[(d(),k(te,null,re(["preview_url","download_url"],h=>o("a",{key:h,href:i.value[h],target:h==="preview_url"?"_blank":void 0,tabindex:"-1",rel:"noopener noreferrer",class:"toolbar-btn"},[s(p,{icon:h==="preview_url"?"Eye":"Download",class:"h-5 w-5"},null,8,["icon"])],8,iH)),64))]),_:1},8,["modelValue","urls"]),o("dd",uH,[o("ul",dH,[(d(!0),k(te,null,re(e.attachments,h=>(d(),k("li",{key:h.id,class:"flex items-center justify-between py-4 pl-4 pr-5 text-sm leading-6"},[o("div",cH,[s(p,{icon:"PaperClip",class:"h-5 w-5 shrink-0 text-neutral-400"}),o("div",mH,[o("span",pH,[h.aggregate_type!=="image"?(d(),k("a",{key:0,href:h.view_url,target:"_blank",rel:"noopener noreferrer",tabindex:"0",textContent:S(h.file_name)},null,8,fH)):(d(),k("a",{key:1,href:h.view_url,rel:"noopener noreferrer",tabindex:"0",onClick:ie(g=>n.value=u(h.preview_url),["prevent"]),textContent:S(h.file_name)},null,8,vH))]),o("span",{class:"shrink-0 text-neutral-400",textContent:S(l(ls)(h.size))},null,8,bH)])]),o("div",hH,[D(o("a",{href:h.download_url,class:"link font-medium"},null,8,_H),[[f,"core::app.download"]])])]))),128))])])],64)}}},gH=["id"],pr={__name:"MessageHiddenText",props:{text:{required:!0}},setup(e){const t=qt();return(n,a)=>{const r=v("IButton"),i=ae("i-tooltip"),u=ae("i-toggle");return D((d(),k("div",null,[D(s(r,{size:!1,variant:"white",class:"mt-4 inline-flex rounded-md px-1.5 py-0",icon:"DotsHorizontal"},null,512),[[i,n.$t("mailclient::mail.trimmed_content")],[u,l(t)]]),o("div",{id:l(t),class:"mt-5 hidden"},[s(ea,{html:e.text},null,8,["html"])],8,gH)],512)),[[Y,e.text]])}}},yH=["textContent"],da={__name:"MessageRecipient",props:{recipient:{type:Object,required:!0}},setup(e){return(t,n)=>{const a=ae("i-tooltip");return e.recipient.name?D((d(),k("span",{key:0,class:X(["text-neutral-700 dark:text-neutral-300",{"border-b border-dashed border-neutral-400":e.recipient.address}])},[Q(S(e.recipient.name),1)],2)),[[a,e.recipient.address]]):(d(),k("span",{key:1,class:"text-neutral-700 dark:text-neutral-300",textContent:S(e.recipient.address)},null,8,yH))}}},xH={class:"space-x-1 text-sm text-neutral-800 dark:text-neutral-100"},IH={class:"font-semibold"},kH=["textContent"],Yt={__name:"MessageRecipients",props:{showWhenEmpty:{default:!0,type:Boolean},label:String,recipients:{}},setup(e){const t=e,n=V(()=>wt(t.recipients)),a=V(()=>!t.recipients||n.value.length>0),r=V(()=>t.showWhenEmpty?!0:!(!a.value&&t.showWhenEmpty===!1));return(i,u)=>D((d(),k("div",null,[o("p",xH,[o("span",IH,S(e.label)+":",1),(d(!0),k(te,null,re(n.value,c=>(d(),k("span",null,[s(da,{recipient:c},null,8,["recipient"]),a.value?O("",!0):(d(),k("span",{key:0,textContent:S("("+i.$t("mailclient::inbox.unknown_address")+")")},null,8,kH))]))),256))])],512)),[[Y,r.value]])}},$H={class:"mt-4 flex flex-wrap"},wH=["data-placeholder","onClick","onMouseup","textContent"],CH={__name:"MailEditorPlacehodersList",props:["placeholders"],emits:["insert-requested"],setup(e,{emit:t}){const n=e,a=q(null),r=q(null),{copy:i,isSupported:u}=Ya({source:"",legacy:!0});function c(h){u.value&&(i(`{{ ${h.tag} }}`),Innoclapps.info("Placeholder copied"))}const m=V(()=>a.value?n.placeholders.filter(h=>h.description.toLowerCase().includes(a.value.toLowerCase())||h.tag.toLowerCase().includes(a.value.toLowerCase())):n.placeholders);function p(h){a.value=null,r.value=h,t("insert-requested",h),setTimeout(()=>r.value=null,3e3)}function f(h){h.dataTransfer.setData("text/plain",h.target.dataset.placeholder)}return(h,g)=>{const y=v("SearchInput"),_=v("Icon"),I=ae("i-tooltip");return d(),k("div",null,[s(y,{modelValue:a.value,"onUpdate:modelValue":g[0]||(g[0]=F=>a.value=F)},null,8,["modelValue"]),o("div",$H,[(d(!0),k(te,null,re(m.value,F=>(d(),k("div",{key:F.tag,class:"relative mb-1 mr-1 flex items-center rounded border border-neutral-200 px-4 py-1 dark:border-neutral-700 dark:hover:border-neutral-600"},[D(o("a",{href:"#","data-placeholder":`${F.interpolation_start} ${F.tag} ${F.interpolation_end}`,class:X(["mr-1 text-sm text-neutral-600 hover:text-neutral-900 dark:text-neutral-200 dark:hover:text-neutral-400",{"pointer-events-none":r.value&&r.value.tag===F.tag}]),onDragstart:f,onClick:ie($=>p(F),["prevent"]),onMouseup:ie($=>c(F),["right"]),onContextmenu:g[1]||(g[1]=ie(()=>{},["prevent"])),textContent:S(F.description)},null,42,wH),[[I,`${F.interpolation_start} ${F.tag} ${F.interpolation_end}`,void 0,{top:!0}]]),D(s(_,{icon:"Check",class:"absolute right-1 top-2 h-3 w-3 rounded-full text-neutral-600 dark:text-neutral-100"},null,512),[[Y,r.value&&r.value.tag===F.tag]])]))),128)),de(h.$slots,"default")])])}}},SH={class:"relative"},RH={__name:"MailEditorPlaceholders",props:{placeholders:{type:Object},visible:{type:Boolean,default:!0}},emits:["update:visible","inserted"],setup(e,{emit:t}){function n(a,r){let i="";a.newlineable?i=`<textarea class="_placeholder"
                        rows="1"
                        data-tag="${a.tag}"
                        placeholder="${a.description} (${r})"></textarea> `:i=`<input type="text"
                        class="_placeholder"
                        data-tag="${a.tag}"
                        placeholder="${a.description} (${r})" /> `,tinymce.activeEditor.execCommand("mceInsertContent",!1,i),setTimeout(()=>t("inserted"),500)}return(a,r)=>{const i=v("IButtonIcon"),u=v("ITab"),c=v("ITabList"),m=v("ITabPanel"),p=v("ITabPanels"),f=v("ITabGroup");return D((d(),k("div",SH,[s(i,{icon:"X",class:"absolute right-4 top-5 hidden sm:block",onClick:r[0]||(r[0]=h=>a.$emit("update:visible",!1))}),s(f,null,{default:b(()=>[s(c,null,{default:b(()=>[(d(!0),k(te,null,re(e.placeholders,(h,g)=>(d(),R(u,{key:g,title:h.label},null,8,["title"]))),128))]),_:1}),s(p,null,{default:b(()=>[(d(!0),k(te,null,re(e.placeholders,(h,g)=>(d(),R(m,{key:g},{default:b(()=>[s(CH,{placeholders:h.placeholders,onInsertRequested:y=>n(y,h.label)},{default:b(()=>[s(i,{icon:"X",class:"text-right sm:hidden",onClick:r[1]||(r[1]=y=>a.$emit("update:visible",!1))})]),_:2},1032,["placeholders","onInsertRequested"])]),_:2},1024))),128))]),_:1})]),_:1})],512)),[[Y,e.visible]])}}},ol={__name:"MailEditor",props:{modelValue:{},placeholders:Object,placeholdersDisabled:Boolean,placeholder:{type:String,default:""},disabled:Boolean,withDrop:Boolean},emits:["update:modelValue","init","placeholder-inserted"],setup(e,{expose:t,emit:n}){const a=e,r=Yn(),{t:i}=ve(),u=q(!1);qt();const c=q(!1),m=q(!1),p=q(null);let f=null,h=null;const g=q({menubar:!1,body_class:a.placeholdersDisabled?"placeholders-disabled":"",height:"200px",max_height:1e3,visual:!1,statusbar:!1,contextmenu:!1,branding:!1,language:Object.hasOwn(Oo,r)?Oo[r]:r,automatic_uploads:!0,images_reuse_filename:!0,paste_data_images:a.withDrop,relative_urls:!1,remove_script_host:!1,placeholder:a.placeholder,browser_spellcheck:!0,content_style:`
        // p:has(._placeholder) {
        //   display: inline-flex;
        //   align-items: center;
        //   white-space: pre-wrap;
        //   flex-flow: wrap;
        // }

        ._placeholder {
          box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
          border: 0.0625rem solid #cad1d7;
          min-width: 120px;
          display: inline-block;
          height: 29px;
          border-radius: 3px;
          line-height: 25px;
          padding-right: 0.7rem;
          padding-left: 0.7rem;
        }

        ._placeholder:focus {
          border: 0.0625rem solid #93b3cf;
          outline:0;
        }

        ._placeholder[data-autofilled] {
          background-color: #f2f9ff;
        }

        .placeholders-disabled ._placeholder {
          pointer-events: none !important;
          cursor:not-allowed !important;
          background-color: #f4f5f7 !important;
          opacity:0.8;
        }
        `,block_formats:`${tinymce.util.I18n.translate("Paragraph")}=p; ${tinymce.util.I18n.translate("Heading 1")}=h1; ${tinymce.util.I18n.translate("Heading 2")}=h2; ${tinymce.util.I18n.translate("Heading 3")}=h3;  ${tinymce.util.I18n.translate("Heading 4")}=h4`,setup:$=>{$.ui.registry.addGroupToolbarButton("alignment",{icon:"align-left",tooltip:tinymce.util.I18n.translate("Alignment"),items:"alignleft aligncenter alignright | alignjustify"}),a.placeholders&&$.ui.registry.addButton("fields",{text:i("core::fields.fields"),onAction:()=>c.value=!c.value}),$.on("init",C=>{h=C.target,m.value=!0,n("init")}),$.on("input",C=>{C.target.classList.contains("_placeholder")&&a.placeholdersDisabled&&(C.target.disabled=!0,C.target.value=""),C.currentTarget&&C.currentTarget.querySelectorAll("._placeholder").forEach(w=>{w.tagName==="TEXTAREA"?w.textContent=w.value:w.setAttribute("value",w.value)})})},plugins:["advlist","lists","autolink","link","image","media","table","autoresize"],toolbar:`fields | blocks |
                              bold italic underline strikethrough |
                              forecolor backcolor |
                              link table |
                              alignment |
                              bullist numlist |
                              blockquote removeformat undo redo`});ge(p,$=>{$!=a.modelValue&&n("update:modelValue",$)}),ge(()=>a.modelValue,$=>{$!=p.value&&(p.value=$)},{immediate:!0});const y=V(()=>{let $=g.value;return po()&&($.skin="oxide-dark",$.content_css="dark"),$});function _($){p.value=$}function I(){_("")}function F(){h.focus()}return De(()=>{f=setTimeout(()=>u.value=!0,250)}),bt(()=>{f&&clearTimeout(f)}),t({focus:F,setContent:_,clearContent:I}),($,C)=>{const w=v("IOverlay");return d(),R(w,{show:!u.value},{default:b(()=>[e.placeholders&&m.value?(d(),R(RH,{key:0,visible:c.value,"onUpdate:visible":C[0]||(C[0]=x=>c.value=x),placeholders:e.placeholders,onInserted:C[1]||(C[1]=x=>$.$emit("placeholder-inserted"))},null,8,["visible","placeholders"])):O("",!0),u.value?(d(),R(l(Ka),{key:1,modelValue:p.value,"onUpdate:modelValue":C[2]||(C[2]=x=>p.value=x),disabled:e.disabled,init:y.value},null,8,["modelValue","disabled","init"])):O("",!0)]),_:1},8,["show"])}}};function fr(){const{currentUser:e}=Le();function t(n=""){return n+(e.value.mail_signature?"<br /><br />----------<br />"+e.value.mail_signature:"")}return{addSignature:t}}function vr(e,t,n){const{t:a}=ve(),r=Pe(),{addSignature:i}=fr(),{createFollowUpActivity:u}=xo(),c=q(!1),m=q({}),p=q(qt()),f=q([]),h=q(null),g=q(null),{form:y}=Ae({subject:null,message:i(),to:[],cc:null,bcc:null,associations:{},task_date:null}),_=V(()=>r.state.fields.placeholders),I=V(()=>{if(!y.message)return!1;let ne=document.createElement("template");ne.innerHTML=y.message.trim();const ce=ne.content.firstChild.querySelectorAll("._placeholder");return ce.length===0?!1:Array.from(ce).filter(fe=>fe.value.trim()==="").length>0}),F=V(()=>{let ne=[];return Object.keys(_.value).forEach(ce=>{_.value[ce].placeholders.forEach(fe=>{ne.push(fe)})}),ne}),$=V(()=>F.value.reduce((ne,ce)=>{const fe=[ce.interpolation_start,ce.interpolation_end];return ne.length===0?ne.push(fe):ne.forEach(Se=>{Se[0]!==fe[0]&&Se[1]!==fe[1]&&ne.push(fe)}),ne},[]));function C(ne,ce,fe,Se,Ie){if(Ie||!Se)return!1;const Ce=ce[0]===ne.id;if(fe==="contacts"||fe==="companies"){const ye=y.to.filter(Ge=>Ge.resourceName===fe)[0];return ye?ye.id===ne.id:Ce}return Ce}const w=V(()=>{const ne=[];return Object.keys(y.associations).forEach(ce=>{if(y.associations[ce].length===0)return;if(ce==="contacts"||ce==="companies"){const Se=y.to.filter(Ie=>Ie.resourceName===ce)[0];Se?ne.push({name:ce,id:Se.id}):ne.push({name:ce,id:y.associations[ce][0]})}else ne.push({name:ce,id:y.associations[ce][0]})}),ne}),x=V(()=>{if(!_.value||!g.value)return[];const ne=[];return $.value.forEach(ce=>{const fe=new RegExp(`${ce[0]}\\s?(.*?)\\s?${ce[1]}`).exec(g.value);fe&&ne.push({interpolation_start:ce[0],interpolation_end:ce[1],tag:fe[1].trim()})}),ne}),A=V(()=>{let ne=!1;return x.value.forEach(ce=>Ee(F.value,["tag",ce.tag])?!0:(ne=!0,!1)),ne}),N=V(()=>{if(!g.value)return!0;let ne=!0;return F.value.concat(x.value).every(ce=>g.value.indexOf(ce.tag)>-1&&!new RegExp(`${ce.interpolation_start}\\s?${ce.tag}\\s?${ce.interpolation_end}`).test(g.value)?(ne=!1,!1):!0),ne}),T=V(()=>x.value.length>0),E=V(()=>!!(y.errors.first("to.0.address")||y.errors.first("cc.0.address")||y.errors.first("bcc.0.address"))),B=V(()=>y.cc!==null),z=V(()=>y.bcc!==null);function M(){U(y.message,"input-fields").then(ne=>y.message=ne)}function j(){!T.value||!N.value||U(g.value,"interpolation").then(ne=>h.value=ne)}async function U(ne,ce){if(ne)return w.value.length===0?ne:W(w.value,ne,ce)}function P(ne){n({activities:[ne],incomplete_activities_for_user_count:t.incomplete_activities_for_user_count+1})}async function H(ne){c.value=!0,y.subject=h.value||g.value,y.fill("attachments_draft_id",p),e&&(y.fill("via_resource",e),y.fill("via_resource_id",l(t).id));try{let ce=await Innoclapps.request().post(ne,y.data());if(ce.status!==202?(Innoclapps.success(a("mailclient::inbox.message_sent")),Innoclapps.$emit("email-sent",ce.data.message)):Innoclapps.info(a("mailclient::mail.message_queued_for_sending")),y.task_date&&e){let fe=await u(y.task_date,e,l(t).id,l(t).display_name);P(fe)}return y.reset(),ce}catch(ce){Promise.reject(ce)}finally{c.value=!1}}function L(){y.cc=[]}function Z(){y.bcc=[]}function J(ne){f.value.push(ne)}function K(ne){Innoclapps.request().delete(`/media/pending/${ne.pending_data.id}`).then(()=>{let ce=Xe(f.value,["id",ne.id]);f.value.splice(ce,1)})}function G(ne){ee(ne),M(),j()}function oe(ne){pe(ne),M(),j()}function pe(ne){if(!ne.resourceName||!m.value[ne.resourceName]||e===ne.resourceName&&l(t).id===ne.id)return;let ce=Xe(m.value[ne.resourceName],["id",ne.id]),fe=y.associations[ne.resourceName].findIndex(Se=>Se===ne.id);ce!==-1&&m.value[ne.resourceName].splice(ce,1),fe!==-1&&y.associations[ne.resourceName].splice(fe,1)}function ue(ne,ce){m.value[ce]||(m.value[ce]=[]),Ee(m.value[ce],["id",ne.id])||m.value[ce].push(ne),Object.hasOwn(y.associations,ce)||(y.associations[ce]=[]),y.associations[ce].find(fe=>fe==ne.id)||y.associations[ce].push(ne.id)}function ee(ne){ne.filter(ce=>!!ce.resourceName).forEach(ce=>{ce.disabled=!0,ue({...ce,display_name:ce.name},ce.resourceName)})}async function W(ne,ce,fe){if(!ce)return ce;let{data:Se}=await Innoclapps.request().post("/placeholders/"+fe,{resources:ne,content:ce});return Se}return dn(g,()=>{j()},{debounce:600}),Dn(()=>{r.dispatch("fields/fetchPlaceholders")}),{form:y,sending:c,customAssociationsValue:m,attachments:f,attachmentsDraftId:p,placeholders:_,resourcesForPlaceholders:w,parsedSubject:h,hasEmptyPlaceholders:I,subject:g,hasInvalidAddresses:E,wantsCc:B,wantsBcc:z,sendRequest:H,subjectContainsPlaceholders:T,parsePlaceholdersForMessage:M,parsePlaceholdersForSubject:j,subjectPlaceholdersSyntaxIsValid:N,showWillUsePlaceholdersIconToAssociateResourceRecord:C,hasInvalidSubjectPlaceholders:A,handleAttachmentUploaded:J,destroyPendingAttachment:K,associateSelectedRecipients:ee,dissociateRemovedRecipients:pe,associateMessageRecord:ue,handleRecipientSelectedEvent:G,handleToRecipientRemovedEvent:oe,setWantsBCC:Z,setWantsCC:L}}const ca=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,"name"));h();function r(g){return n.value.findIndex(y=>y.id==g)}function i(g){return n.value[r(g)]}function u(g){n.value.splice(r(g),1)}function c(g){n.value.push(g)}function m(g,y){n.value[r(g)]=y}async function p(g,y={}){const{data:_}=await Innoclapps.request().get("/mails/templates/"+g,y);return _}async function f(g){await Innoclapps.request().delete(`/mails/templates/${g}`),u(g)}function h(){e(!0),Innoclapps.request().get("/mails/templates").then(({data:g})=>n.value=g).finally(()=>e(!1))}return{mailTemplates:n,templatesByName:a,templatesAreBeingFetched:t,addTemplate:c,removeTemplate:u,setTemplate:m,findTemplateById:i,fetchMailTemplates:h,fetchTemplate:p,deleteTemplate:f}}),br={__name:"PredefinedMailTemplatesForm",props:{form:{type:Object,default:()=>({})}},setup(e){const t=q(!1),n=Pe(),a=V(()=>n.state.fields.placeholders);return n.dispatch("fields/fetchPlaceholders"),(r,i)=>{const u=v("IFormInput"),c=v("IFormError"),m=v("IFormGroup"),p=v("IFormCheckbox");return d(),k("form",{onKeydown:i[7]||(i[7]=f=>e.form.onKeydown(f)),onSubmit:i[8]||(i[8]=ie(()=>{},["prevent"]))},[s(m,{"label-for":"name",label:r.$t("mailclient::mail.templates.name"),required:""},{default:b(()=>[s(u,{modelValue:e.form.name,"onUpdate:modelValue":i[0]||(i[0]=f=>e.form.name=f)},null,8,["modelValue"]),s(c,{textContent:S(e.form.getError("name"))},null,8,["textContent"])]),_:1},8,["label"]),s(m,{"label-for":"subject",label:r.$t("mailclient::mail.templates.subject"),required:""},{default:b(()=>[s(u,{modelValue:e.form.subject,"onUpdate:modelValue":i[1]||(i[1]=f=>e.form.subject=f),class:X({"border-dashed !border-neutral-400":t.value}),onDragover:i[2]||(i[2]=f=>t.value=!0),onDragleave:i[3]||(i[3]=f=>t.value=!1),onDrop:i[4]||(i[4]=f=>t.value=!1)},null,8,["modelValue","class"]),s(c,{textContent:S(e.form.getError("subject"))},null,8,["textContent"])]),_:1},8,["label"]),s(m,{"label-for":"body",label:r.$t("mailclient::mail.templates.body"),required:""},{default:b(()=>[s(l(ol),{modelValue:e.form.body,"onUpdate:modelValue":i[5]||(i[5]=f=>e.form.body=f),placeholders:a.value,"placeholders-disabled":!0},null,8,["modelValue","placeholders"]),s(c,{textContent:S(e.form.getError("body"))},null,8,["textContent"])]),_:1},8,["label"]),s(m,null,{default:b(()=>[s(p,{id:"is_shared",checked:e.form.is_shared,"onUpdate:checked":i[6]||(i[6]=f=>e.form.is_shared=f),name:"is_shared",label:r.$t("mailclient::mail.templates.is_shared")},null,8,["checked","label"]),s(c,{textContent:S(e.form.getError("is_shared"))},null,8,["textContent"])]),_:1}),de(r.$slots,"bottom")],32)}}},FH={class:"space-x-2 divide-y divide-neutral-200 border-t border-neutral-200 pt-3 text-right dark:divide-neutral-700 dark:border-neutral-700"},VH={__name:"PredefinedMailTemplatesCreate",emits:["created","cancel-requested"],setup(e,{emit:t}){const{t:n}=ve(),{addTemplate:a}=ca(),{form:r}=Ae({name:null,body:null,subject:null,is_shared:!0});function i(){r.post("/mails/templates").then(u=>{a(u),t("created",u),Innoclapps.success(n("mailclient::mail.templates.created"))})}return(u,c)=>{const m=v("IButton");return d(),R(br,{form:l(r)},{bottom:b(()=>[o("div",FH,[s(m,{variant:"white",text:u.$t("core::app.cancel"),onClick:c[0]||(c[0]=p=>u.$emit("cancel-requested"))},null,8,["text"]),s(m,{type:"submit",variant:"primary",text:u.$t("core::app.create"),onClick:i},null,8,["text"])])]),_:1},8,["form"])}}},TH={class:"space-x-2 divide-y divide-neutral-200 border-t border-neutral-200 pt-3 text-right dark:divide-neutral-700 dark:border-neutral-700"},DH={__name:"PredefinedMailTemplatesEdit",props:{templateId:{required:!0,type:Number}},emits:["updated","cancel-requested"],setup(e,{emit:t}){const n=e,{t:a}=ve(),{setTemplate:r,findTemplateById:i}=ca(),{form:u}=Ae();function c(){u.put(`/mails/templates/${n.templateId}`).then(p=>{r(p.id,p),t("updated",p),Innoclapps.success(a("mailclient::mail.templates.updated"))})}function m(){u.set(Rl(i(n.templateId),["subject","body","name","is_shared"]))}return m(),(p,f)=>{const h=v("IButton");return d(),R(br,{form:l(u)},{bottom:b(()=>[o("div",TH,[s(h,{variant:"white",text:p.$t("core::app.cancel"),onClick:f[0]||(f[0]=g=>p.$emit("cancel-requested"))},null,8,["text"]),s(h,{type:"submit",variant:"primary",text:p.$t("core::app.save"),onClick:c},null,8,["text"])])]),_:1},8,["form"])}}},qH={class:"mb-3 text-right"},EH={class:"text-left",width:"50%"},AH={class:"text-left"},BH={class:"text-left"},NH={width:"50%"},OH={class:"flex"},zH={class:"grow"},MH=["textContent"],UH={class:"text-sm text-neutral-600 dark:text-neutral-300"},PH={class:"flex items-center space-x-2"},jH={class:"bg-white"},LH={colspan:3,class:"p-5 text-center"},HH={class:"text-center"},hr={__name:"PredefinedMailTemplatesList",emits:["selected","updated","created","will-edit","will-create"],setup(e,{emit:t}){const{t:n}=ve(),{localizedDateTime:a}=Ne(),{templatesByName:r,deleteTemplate:i}=ca(),u=q(null),c=q(!1),m=V(()=>r.value.length>0),p=V(()=>u.value||c.value);function f(F){t("will-edit",F),u.value=F}function h(){c.value=!0,t("will-create")}function g(F){c.value=!1,t("created",F)}function y(F){u.value=!1,t("updated",F)}async function _(F){await Innoclapps.dialog().confirm(),await i(F),Innoclapps.success(n("mailclient::mail.templates.deleted"))}function I(F){t("selected",r.value[F])}return(F,$)=>{const C=v("IButton"),w=v("IDropdownItem"),x=v("IMinimalDropdown"),A=v("ITable"),N=ae("t");return d(),k("div",null,[D(o("div",null,[o("div",qH,[s(C,{variant:"primary",size:"sm",text:F.$t("mailclient::mail.templates.create"),onClick:h},null,8,["text"])]),s(A,{bordered:""},{default:b(()=>[o("thead",null,[o("tr",null,[D(o("th",EH,null,512),[[N,"mailclient.mail.templates.name"]]),D(o("th",AH,null,512),[[N,"core::app.created_by"]]),D(o("th",BH,null,512),[[N,"core::app.last_modified_at"]])])]),o("tbody",null,[(d(!0),k(te,null,re(l(r),(T,E)=>(d(),k("tr",{key:T.id},[o("td",NH,[o("div",OH,[o("div",zH,[o("p",{class:"text-neutral-800 dark:text-neutral-100",textContent:S(T.name)},null,8,MH),o("p",UH,S(F.$t("mailclient::mail.templates.subject"))+": "+S(T.subject),1)]),o("div",PH,[s(C,{size:"sm",variant:"primary",text:F.$t("mailclient::mail.templates.select"),onClick:B=>I(E)},null,8,["text","onClick"]),T.authorizations.update||T.authorizations.delete?(d(),R(x,{key:0},{default:b(()=>[T.authorizations.update?(d(),R(w,{key:0,text:F.$t("core::app.edit"),onClick:B=>f(T.id)},null,8,["text","onClick"])):O("",!0),T.authorizations.delete?(d(),R(w,{key:1,text:F.$t("core::app.delete"),onClick:B=>_(T.id)},null,8,["text","onClick"])):O("",!0)]),_:2},1024)):O("",!0)])])]),o("td",null,S(T.user.name),1),o("td",null,S(l(a)(T.updated_at)),1)]))),128)),D(o("tr",jH,[o("td",LH,[D(o("div",HH,null,512),[[N,"core::table.empty"]])])],512),[[Y,!m.value]])])]),_:1})],512),[[Y,!p.value]]),c.value?(d(),R(VH,{key:0,onCancelRequested:$[0]||($[0]=T=>c.value=!1),onCreated:g})):O("",!0),u.value?(d(),R(DH,{key:1,"template-id":u.value,onUpdated:y,onCancelRequested:$[1]||($[1]=T=>u.value=null)},null,8,["template-id"])):O("",!0)])}}};const GH={class:"w-14"},KH={class:"recipient grow"},YH={class:"flex justify-between"},WH={class:"mr-2 truncate"},QH={key:0},XH={key:1},ZH=["disabled","onClick"],JH={__name:"RecipientSelectorField",props:{label:String,type:{type:String,required:!0},form:{required:!0}},emits:["recipient-removed","recipient-selected"],setup(e,{expose:t,emit:n}){const a=q(null),r=dt([]);let i=null;function u(y,_,I){return(_||"").toLowerCase().indexOf(I.toLowerCase())>-1||(y.name||"").toLowerCase().indexOf(I.toLowerCase())>-1}function c(y){n("recipient-selected",y)}function m(y,_){y(_),n("recipient-removed",_)}function p(){a.value.focus()}const f=Dt(function(y,_){y&&(i&&i(),_(!0),Innoclapps.request().get("/search/email-address",h(y)).then(({data:I})=>{if(I){let F=[];I.forEach($=>F.push(...$.data)),r.value=F}}).finally(()=>_(!1)))},400);function h(y){return{params:{q:y},cancelToken:new Nn(_=>i=_)}}function g(y){return Sd.validate(y)}return t({focus:p}),(y,_)=>{const I=v("IFormLabel"),F=v("Icon"),$=v("ICustomSelect"),C=v("IFormError"),w=ae("i-tooltip");return d(),k("div",{class:X(["flex items-center",e.type])},[o("div",GH,[s(I,{label:e.label,for:e.type},null,8,["label","for"])]),o("div",KH,[s($,{ref_key:"selectRef",ref:a,modelValue:e.form[e.type],"onUpdate:modelValue":_[0]||(_[0]=x=>e.form[e.type]=x),"input-id":e.type,options:r.value,filterable:!1,clearable:!1,taggable:!0,multiple:!0,label:"address","filter-by":u,"option-key-provider":x=>String(x.address+x.id+x.resourceName+x.name),"create-option-provider":x=>({name:"",address:x}),"option-comparator-provider":(x,A,N)=>typeof x=="string"&&typeof A=="object"?x===A.address:typeof A=="string"&&typeof x=="object"?A===x.address:N(x)===N(A),"display-new-options-last":!0,placeholder:y.$t("mailclient::inbox.search_recipients"),"onOption:selected":c,onSearch:l(f)},{option:b(x=>[o("span",YH,[o("span",WH,S(x.name)+" "+S(x.address),1),x.resourceName?(d(),R(F,{key:0,icon:x.resourceName==="contacts"?"User":"OfficeBuilding",class:"h-5 w-5"},null,8,["icon"])):O("",!0)])]),"selected-option-container":b(({option:x,disabled:A,deselect:N,multiple:T})=>[(d(),k("span",{key:x.index,class:X(["mr-2 inline-flex rounded-md bg-neutral-100 px-2 dark:bg-neutral-500 dark:text-white",{"border border-danger-500":!g(x.address)}])},[x.name?(d(),k("span",XH,[D((d(),k("span",null,[Q(S(x.name),1)])),[[w,x.address]])])):(d(),k("span",QH,S(x.address),1)),T?(d(),k("button",{key:2,type:"button",disabled:A,class:"ml-1 text-neutral-400 hover:text-neutral-600 dark:text-neutral-200 dark:hover:text-neutral-400",title:"Remove recipient","aria-label":"Remove recipient",onClick:ie(E=>m(N,x),["prevent","stop"])},[s(F,{icon:"X",class:"h-4 w-4"})],8,ZH)):O("",!0)],2))]),_:1},8,["modelValue","input-id","options","option-key-provider","create-option-provider","option-comparator-provider","placeholder","onSearch"]),s(C,{textContent:S(e.form.getError(e.type))},null,8,["textContent"])]),de(y.$slots,"after",{},void 0,!0)],2)}}},jn=ct(JH,[["__scopeId","data-v-ff3f7b79"]]),eG={class:"-mx-6 mb-4 border-y border-neutral-200 px-6 py-3 dark:border-neutral-700"},tG={class:"flex"},nG={class:"mr-4"},oG={class:"font-medium"},lG={class:"ml-1.5 self-start"},aG={class:"-mt-2 ml-2 space-x-2"},sG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),rG={key:0},iG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),uG={key:1},dG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),cG={class:"flex items-center"},mG={class:"w-14"},pG={class:"grow"},fG={class:"relative"},vG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),bG={class:"relative mt-3"},hG={class:"flex flex-col sm:flex-row sm:items-center"},_G={class:"grow"},gG={class:"mt-2 space-y-2 sm:mt-0 sm:flex sm:items-center sm:space-x-2 sm:space-y-0"},_r={__name:"MessageReply",props:{resourceName:String,resourceId:[String,Number],relatedResource:Object,visible:Boolean,toAll:Boolean,forward:Boolean,message:{type:Object,required:!0}},emits:["modal-hidden"],setup(e,{emit:t}){const n=e,a=Me("synchronizeResource",null),r=["RE:","SV:","Antw:","VS:","RE:","REF:",":",":","V:","R:","RIF:","BLS:","RES:","Odp:","YNT:","ATB:","FW:","FWD:","Doorst:","VL:","TR:","WG:",":","Tovbbts:","I:","FS:","TRS:","VB:","RV:","ENC:","PD:","LT:","YML:"],{t:i}=ve(),{dateFromAppTimezone:u}=Ne(),{addSignature:c}=fr(),{form:m,attachments:p,attachmentsDraftId:f,handleAttachmentUploaded:h,destroyPendingAttachment:g,customAssociationsValue:y,placeholders:_,resourcesForPlaceholders:I,subject:F,parsedSubject:$,subjectPlaceholdersSyntaxIsValid:C,hasInvalidSubjectPlaceholders:w,subjectContainsPlaceholders:x,parsePlaceholdersForMessage:A,parsePlaceholdersForSubject:N,showWillUsePlaceholdersIconToAssociateResourceRecord:T,hasEmptyPlaceholders:E,sending:B,sendRequest:z,hasInvalidAddresses:M,associateSelectedRecipients:j,dissociateRemovedRecipients:U,handleRecipientSelectedEvent:P,handleToRecipientRemovedEvent:H,setWantsCC:L,setWantsBCC:Z,wantsBcc:J,wantsCc:K}=vr(n.resourceName,n.relatedResource,a),G=q(!1),oe=q(!1);ge(E,(_e,me)=>{me&&!_e&&(G.value=!1)}),m.set("associations",n.message.associations);const pe=q(null),ue=q(null),ee=q(!1),W=q([]),ne=q(!1),ce=V(()=>m.to.length===0||B.value),fe=V(()=>n.message.cc&&n.message.cc.length>0),Se=V(()=>n.message.reply_to&&n.message.reply_to.length>0);function Ie(){document.querySelector(".dialog").scrollTo({top:0,behavior:"instant"})}function Ce(_e){const me=Xe(W.value,["id",_e.id]);W.value.splice(me,1)}function le(_e){m.message=_e.body+m.message,ee.value=!1,A(),N(),Ie(),Fe(()=>ue.value.focus())}function ye(){f.value=qt();let _e=lt(n.message.subject);n.forward?(W.value=nt(n.message.media),["cc","bcc","to"].forEach(me=>m.set(me,me==="to"?[]:null)),m.message="<br /><div class='concord_attr'>"+i("mailclient::inbox.forwarded_message_placeholder",{from:`${n.message.from.name?n.message.from.name+" ":""}&lt;${n.message.from.address}&gt;`,date:u(n.message.date,"llll"),subject:n.message.subject,to:n.message.to.reduce((me,we)=>(me.push((we.name?we.name+" ":"")+`&lt;${we.address}&gt;`),me),[]).join(", "),pre:"----------",after:"---------"})+"</div><br /><div>"+n.message.editor_text+"</div>",_e&&(_e=Innoclapps.config("mail.forward_prefix")+_e),pe.value.focus()):(W.value=[],at(),m.message=Ge(),setTimeout(()=>ue.value.focus(),800),_e&&(_e=Innoclapps.config("mail.reply_prefix")+_e)),m.message=c(m.message),F.value=_e}function Ge(){let _e=n.message.editor_text;if(!_e)return"";let me=`&lt;${n.message.from.address}&gt;`;return n.message.from.name&&(me=n.message.from.name+" "+me),"<br /><div class='concord_attr'>"+`On ${u(n.message.date,"llll")} ${me} wrote:`+'</div><blockquote class="concord_quote">'+_e+"</blockquote>"}function be(){m.reset(),F.value=null,$.value=null,p.value=[],y.value={},t("modal-hidden")}function Ve(_e=!1){if(_e===!1&&E.value){G.value=!0;return}else G.value&&(G.value=!1);n.forward?(m.fill("forward_attachments",W.value.map(me=>me.id)),z(`/emails/${n.message.id}/forward`).then(()=>Innoclapps.modal().hide("replyMessageModal"))):z(`/emails/${n.message.id}/reply`).then(()=>Innoclapps.modal().hide("replyMessageModal"))}function $e(){if(et()||tt(),fe.value){let _e=[];n.message.cc.forEach(me=>{Xe(n.message.reply_to,["address",me.address])===-1&&_e.push({address:me.address,name:me.name})}),_e.length>0&&m.set("cc",_e)}}function et(){if(Se.value){let _e=[];return n.message.reply_to.forEach(me=>{_e.push({address:me.address,name:me.name})}),m.set("to",_e),!0}return!1}function Te(){m.set("to",n.message.to.map(_e=>({address:_e.address,name:_e.name})))}function tt(){n.message.from&&m.set("to",[{address:n.message.from.address,name:n.message.from.name}])}function at(){n.toAll?$e():(n.message.reply_to.length===1&&n.message.reply_to[0].address===n.message.email_account_email||!Se.value&&n.message.from.address===n.message.email_account_email?Te():et()||tt(),m.set("cc",null))}function lt(_e){if(_e===null)return _e;const me=r;return me.push(Innoclapps.config("mail.reply_prefix"),Innoclapps.config("mail.forward_prefix")),_e.replace(new RegExp(me.join("|"),"gmi"),"").trim()}return(_e,me)=>{const we=v("Icon"),Ue=v("IAlert"),Oe=v("IFormLabel"),se=v("IFormInput"),ke=v("IFormError"),He=v("IButton"),yt=v("IModal"),Ke=ae("t"),Ze=ae("i-tooltip");return d(),R(yt,{id:"replyMessageModal",size:"xl","static-backdrop":"","hide-footer":ee.value,visible:e.visible,title:_e.$t("mailclient::inbox."+(e.forward?"forward_message":"reply_to_message"),{subject:e.message.subject}),onHidden:be,onShown:ye},{"modal-footer":b(({cancel:ze})=>[o("div",hG,[o("div",_G,[D(s(Zn,{modelValue:l(m).task_date,"onUpdate:modelValue":me[13]||(me[13]=Vt=>l(m).task_date=Vt)},null,8,["modelValue"]),[[Y,!!e.resourceName]])]),o("div",gG,[s(He,{class:"w-full sm:w-auto",variant:"white",text:_e.$t("core::app.cancel"),onClick:ze},null,8,["text","onClick"]),s(He,{class:"w-full sm:w-auto",variant:G.value?"danger":"primary",loading:l(B),disabled:ce.value,text:G.value?_e.$t("core::app.confirm"):e.forward?_e.$t("mailclient::inbox.forward"):_e.$t("mailclient::inbox.reply"),onClick:me[14]||(me[14]=Vt=>Ve(G.value))},null,8,["variant","loading","disabled","text"])])])]),default:b(()=>[o("div",eG,[o("div",tG,[o("div",nG,[D(o("a",{href:"#",class:"link text-sm font-medium",onClick:me[0]||(me[0]=ie(ze=>ee.value=!0,["prevent"]))},null,512),[[Y,!ee.value],[Ke,"mailclient.mail.templates.templates"]]),D(o("a",{href:"#",class:"link text-sm font-medium",onClick:me[1]||(me[1]=ie(ze=>ee.value=!1,["prevent"]))},null,512),[[Y,ee.value],[Ke,"mailclient.mail.compose"]])]),D(o("div",oG,[s(vn,{modelValue:l(m).associations,"onUpdate:modelValue":me[2]||(me[2]=ze=>l(m).associations=ze),"primary-resource-name":e.resourceName,"initial-associateables":e.resourceName?e.relatedResource:void 0,associateables:[l(y),e.message.associations],onChange:me[3]||(me[3]=ze=>(l(A)(),l(N)()))},{"after-record":b(({title:ze,resource:Vt,record:Nt,isSelected:je,isSearching:Rt,selectedRecords:Kt})=>[D((d(),k("span",lG,[l(T)(Nt,Kt,Vt,je,Rt)?(d(),R(we,{key:0,icon:"CodeBracket",class:"h-5 w-5 text-neutral-500 dark:text-neutral-400"})):O("",!0)])),[[Ze,_e.$t("mailclient::inbox.will_use_placeholders_from_record",{resourceName:ze}),void 0,{top:!0}]])]),_:1},8,["modelValue","primary-resource-name","initial-associateables","associateables"])],512),[[Y,!ee.value]])])]),D(o("div",null,[s(Ue,{variant:"danger",dismissible:"",show:l(M)},{default:b(()=>[Q(S(_e.$t("mailclient::mail.validation.invalid_recipients")),1)]),_:1},8,["show"]),s(jn,{ref_key:"toRef",ref:pe,form:l(m),type:"to",label:_e.$t("mailclient::inbox.to"),onRecipientRemoved:l(H),onRecipientSelected:l(P)},{after:b(()=>[o("div",aG,[l(K)?O("",!0):D((d(),k("a",{key:0,href:"#",class:"link",onClick:me[4]||(me[4]=ie((...ze)=>l(L)&&l(L)(...ze),["prevent"]))},null,512)),[[Ke,"mailclient.inbox.cc"]]),l(J)?O("",!0):D((d(),k("a",{key:1,href:"#",class:"link",onClick:me[5]||(me[5]=ie((...ze)=>l(Z)&&l(Z)(...ze),["prevent"]))},null,512)),[[Ke,"mailclient.inbox.bcc"]])])]),_:1},8,["form","label","onRecipientRemoved","onRecipientSelected"]),sG,l(K)?(d(),k("div",rG,[s(jn,{form:l(m),type:"cc",label:_e.$t("mailclient::inbox.cc"),onRecipientRemoved:l(U),onRecipientSelected:l(j)},null,8,["form","label","onRecipientRemoved","onRecipientSelected"]),iG])):O("",!0),l(J)?(d(),k("div",uG,[s(jn,{form:l(m),type:"bcc",label:_e.$t("mailclient::inbox.bcc")},null,8,["form","label"]),dG])):O("",!0),o("div",cG,[o("div",mG,[s(Oe,{for:"subject",label:_e.$t("mailclient::inbox.subject")},null,8,["label"])]),o("div",pG,[o("div",fG,[s(se,{id:"subject",class:X({"border-danger-600":!l(C)||l(w),"border-dashed !border-neutral-400":oe.value}),"model-value":ne.value?l($):l(F),disabled:ne.value,"onUpdate:modelValue":me[6]||(me[6]=ze=>F.value=ze),onDragover:me[7]||(me[7]=ze=>ne.value?void 0:oe.value=!0),onDragleave:me[8]||(me[8]=ze=>oe.value=!1),onDrop:me[9]||(me[9]=ze=>oe.value=!1)},null,8,["class","model-value","disabled"]),D(o("a",{href:"#",tabindex:"-1",onClick:me[10]||(me[10]=ie(ze=>ne.value=!1,["prevent"]))},[s(we,{icon:"CodeBracket",class:"absolute bottom-0 right-4 top-0 m-auto h-5 w-5 text-neutral-500"})],512),[[Y,ne.value]]),l(x)&&!ne.value&&l(I).length>0?(d(),k("a",{key:0,href:"#",tabindex:"-1",onClick:me[11]||(me[11]=ie(ze=>ne.value=!0,["prevent"]))},[s(we,{icon:"ViewfinderCircle",class:"absolute bottom-0 right-4 top-0 m-auto h-5 w-5 text-neutral-500"})])):O("",!0)]),s(ke,{textContent:S(l(m).getError("subject"))},null,8,["textContent"])])]),vG,s(l(ol),{ref_key:"editorRef",ref:ue,modelValue:l(m).message,"onUpdate:modelValue":me[12]||(me[12]=ze=>l(m).message=ze),placeholders:l(_),"with-drop":!0,onPlaceholderInserted:l(A)},null,8,["modelValue","placeholders","onPlaceholderInserted"]),o("div",bG,[s(Hn,{"action-url":`${_e.$store.state.apiURL}/media/pending/${l(f)}`,"select-file-text":_e.$t("core::app.attach_files"),onFileUploaded:l(h)},{default:b(()=>[s(Mo,{class:X({"border-b border-neutral-200 dark:border-neutral-700":W.value.length>0&&l(p).length>0}),items:W.value,"authorize-delete":!0,onDeleteRequested:Ce},null,8,["class","items"]),s(Mo,{class:"mb-3",items:l(p),"authorize-delete":!0,onDeleteRequested:l(g)},null,8,["items","onDeleteRequested"])]),_:1},8,["action-url","select-file-text","onFileUploaded"])]),G.value?(d(),R(Ue,{key:2,variant:"warning",class:"mt-4"},{default:b(()=>[Q(S(_e.$t("mailclient::inbox.pre_send_empty_placeholders_found")),1)]),_:1})):O("",!0)],512),[[Y,!ee.value]]),ee.value?(d(),R(hr,{key:0,onSelected:le,onCreated:Ie,onUpdated:Ie,onWillCreate:Ie,onWillEdit:Ie})):O("",!0)]),_:1},8,["hide-footer","visible","title"])}}},yG={class:"flex space-x-1"},xG={class:"inline-flex grow flex-col"},IG={class:"flex"},kG={class:"ml-3 flex shrink-0 items-center self-start"},$G={class:"mr-1"},wG={class:"flex"},CG={class:"-mt-0.5 ml-3"},SG={type:"button",class:"link text-sm focus:outline-none"},RG=o("span",{"aria-hidden":"true"},"",-1),FG={class:"flex flex-col px-4 py-2"},VG={class:"font-sans text-sm leading-[initial] dark:text-white"},TG=o("div",{class:"clear-both"},null,-1),DG={key:0,class:"-mx-6 mb-3 mt-4 border-t border-neutral-200 px-6 pt-4 dark:border-neutral-700"},qG={class:"mb-2 text-sm font-medium leading-6 text-neutral-900 dark:text-neutral-100"},EG=o("div",{class:"clear-both"},null,-1),AG={class:"flex divide-x divide-neutral-200 dark:divide-neutral-700"},BG=["onClick"],gr={__name:"RelatedMessage",props:{viaResource:{type:String,required:!0},viaResourceId:{type:[String,Number],required:!0},relatedResource:{type:Object,required:!0},email:{type:Object,required:!0}},setup(e){const t=e,n=Me("synchronizeResource"),a=Me("decrementResourceCount"),r=Rd,i=Pe(),{syncAssociations:u,associationsBeingSaved:c,deleteResource:m}=Je(Innoclapps.resourceName("emails")),{localizedDateTime:p}=Ne(),f=q(!1),h=q(!1),g=q(!1),y=V(()=>t.email.cc&&t.email.cc.length>0);function _(){setTimeout(()=>{$(!1),C(!1)},300)}function I(x){x&&!t.email.is_read&&Innoclapps.request().post(`/emails/${t.email.id}/read`).then(({data:A})=>{n({emails:A}),a("unread_emails_for_user_count"),i.dispatch("emailAccounts/decrementUnreadCountUI")})}async function F(){await Innoclapps.dialog().confirm(),await m(t.email.id),t.email.is_read||(a("unread_emails_for_user_count"),i.dispatch("emailAccounts/decrementUnreadCountUI")),n({emails:{id:t.email.id,_delete:!0}})}function $(x=!0){f.value=x,g.value=!1}function C(x=!0){h.value=x}function w(){f.value=!0,g.value=!0}return(x,A)=>{const N=v("Icon"),T=v("IBadge"),E=v("IDropdownItem"),B=v("IMinimalDropdown"),z=v("IPopover"),M=v("TextCollapse"),j=v("ICard"),U=ae("t");return D((d(),R(j,{class:X("email-"+e.email.id),condensed:""},{header:b(()=>[o("div",yG,[o("div",xG,[o("h3",{class:X([[e.email.is_read?"font-semibold":"font-bold"],"truncate whitespace-normal text-base/6 font-medium text-neutral-700 dark:text-white md:text-lg"])},[A[0]||(he(-1),A[0]=o("span",{textContent:S(e.email.subject?e.email.subject:"("+x.$t("mailclient::inbox.no_subject")+")")},null,8,["textContent"]),he(1),A[0])],2),A[1]||(he(-1),A[1]=o("span",{class:"text-sm text-neutral-500 dark:text-neutral-300"},[Q(S(l(p)(e.email.date)),1)]),he(1),A[1]),o("div",IG,[s(vn,{"model-value":e.email.associations,associateables:e.email.associations,"initial-associateables":e.relatedResource,disabled:l(c),"primary-resource-name":e.viaResource,onChange:A[2]||(A[2]=P=>l(u)(e.email.id,P).then(H=>l(n)({emails:H})))},null,8,["model-value","associateables","initial-associateables","disabled","primary-resource-name"])])]),o("div",kG,[A[3]||(he(-1),A[3]=e.email.opened_at?(d(),R(T,{key:0,variant:"success","wrapper-class":"mr-1 flex"},{default:b(()=>[s(N,{icon:"Eye",class:"mr-1 h-5 w-5"}),o("span",$G," ("+S(e.email.opens)+") - ",1),Q(" "+S(l(p)(e.email.opened_at)),1)]),_:1})):O("",!0),he(1),A[3]),s(B,null,{default:b(()=>[s(E,{text:x.$t("mailclient::mail.view"),onClick:A[4]||(A[4]=P=>x.$router.push({name:"inbox-message",params:{id:e.email.id,account_id:e.email.email_account_id,folder_id:e.email.folders[0].id}}))},null,8,["text"]),s(E,{text:x.$t("core::app.delete"),onClick:F},null,8,["text"])]),_:1})])])]),footer:b(()=>[EG,o("div",AG,[o("a",{href:"#",class:"link flex items-center text-sm",onClick:A[14]||(A[14]=ie(P=>$(!0),["prevent"]))},[s(N,{icon:"Reply",class:"mr-1.5 h-4 w-4"}),Q(" "+S(x.$t("mailclient::inbox.reply")),1)]),y.value?(d(),k("a",{key:0,href:"#",class:"link ml-2 flex items-center pl-2 text-sm",onClick:ie(w,["prevent"])},[s(N,{icon:"Reply",class:"mr-1.5 h-4 w-4"}),Q(" "+S(x.$t("mailclient::inbox.reply_all")),1)],8,BG)):O("",!0),o("a",{href:"#",class:"link ml-2 flex items-center pl-2 text-sm",onClick:A[15]||(A[15]=ie(P=>C(!0),["prevent"]))},[s(N,{icon:"Share",class:"mr-1.5 h-4 w-4"}),Q(" "+S(x.$t("mailclient::inbox.forward")),1)])])]),default:b(()=>[A[5]||(he(-1),A[5]=s(Yt,{label:x.$t("mailclient::inbox.from"),recipients:e.email.from},null,8,["label","recipients"]),he(1),A[5]),o("div",wG,[o("div",null,[A[6]||(he(-1),A[6]=s(Yt,{label:x.$t("mailclient::inbox.to"),recipients:e.email.to},null,8,["label","recipients"]),he(1),A[6])]),o("div",CG,[s(z,{placement:"top",class:"w-72"},{popper:b(()=>[o("div",FG,[A[7]||(he(-1),A[7]=s(Yt,{label:x.$t("mailclient::inbox.from"),recipients:e.email.from},null,8,["label","recipients"]),he(1),A[7]),A[8]||(he(-1),A[8]=s(Yt,{label:x.$t("mailclient::inbox.to"),recipients:e.email.to},null,8,["label","recipients"]),he(1),A[8]),A[9]||(he(-1),A[9]=s(Yt,{label:x.$t("mailclient::inbox.reply_to"),recipients:e.email.reply_to,"show-when-empty":!1},null,8,["label","recipients"]),he(1),A[9]),A[10]||(he(-1),A[10]=s(Yt,{label:x.$t("mailclient::inbox.cc"),recipients:e.email.cc,"show-when-empty":!1},null,8,["label","recipients"]),he(1),A[10]),A[11]||(he(-1),A[11]=s(Yt,{label:x.$t("mailclient::inbox.bcc"),recipients:e.email.bcc,"show-when-empty":!1},null,8,["label","recipients"]),he(1),A[11])])]),default:b(()=>[o("button",SG,[Q(S(x.$t("core::app.details"))+" ",1),RG])]),_:1})])]),A[12]||(he(-1),A[12]=o("div",{class:"mail-text all-revert"},[o("div",VG,[e.email.visible_text?(d(),R(M,{key:0,text:e.email.visible_text,lightbox:"",length:250,class:"mt-3"},null,8,["text"])):O("",!0),TG,s(pr,{text:e.email.hidden_text},null,8,["text"])])]),he(1),A[12]),A[13]||(he(-1),A[13]=e.email.media.length>0?(d(),k("div",DG,[D(o("dd",qG,null,512),[[U,"mailclient.mail.attachments"]]),s(mr,{attachments:e.email.media},null,8,["attachments"])])):O("",!0),he(1),A[13]),s(_r,{message:e.email,visible:f.value||h.value,forward:h.value,"resource-name":e.viaResource,"resource-id":e.viaResourceId,"related-resource":e.relatedResource,"to-all":g.value,onModalHidden:_},null,8,["message","visible","forward","resource-name","resource-id","related-resource","to-all"])]),_:1},8,["class"])),[[l(r),{callback:I,once:!0,throttle:300,intersection:{threshold:.5}}]])}}},NG={class:"mt-3"},OG={__name:"RecordTabTimelineEmail",props:Pt,setup(e){const{localizedDateTime:t}=Ne();return(n,a)=>(d(),R(jt,{"resource-name":n.resourceName,"resource-id":n.resourceId,"created-at":n.log.created_at,"is-pinned":n.log.is_pinned,"timelineable-id":n.log.id,"timeline-relationship":n.log.timeline_relation,"timeline-subject-key":n.resource.timeline_subject_key,"timelineable-key":n.log.timeline_key,icon:"Mail",heading:n.$t("mailclient::inbox.message"),"heading-class":"font-medium"},{date:b(()=>[Q(S(l(t)(n.log.date)),1)]),default:b(()=>[o("div",NG,[s(gr,{email:n.log,"via-resource":n.resourceName,"via-resource-id":n.resourceId,"related-resource":n.resource},null,8,["email","via-resource","via-resource-id","related-resource"])])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key","heading"]))}},zG={class:"-mx-6 mb-4 border-y border-neutral-200 px-6 py-3 dark:border-neutral-700"},MG={class:"flex"},UG={class:"mr-4"},PG={class:"font-medium"},jG={key:0,class:"ml-1.5 self-start"},LG={key:0,class:"-mt-2 ml-2 space-x-2"},HG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),GG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),KG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),YG={class:"flex items-center"},WG=["textContent"],QG=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),XG={class:"flex items-center"},ZG={class:"w-14"},JG={class:"grow"},eK={class:"relative"},tK=o("hr",{class:"my-3 border-t border-neutral-200 dark:border-neutral-700"},null,-1),nK={class:"relative mt-3"},oK={class:"flex flex-col sm:flex-row sm:items-center"},lK={class:"grow"},aK={class:"mt-2 space-y-2 sm:mt-0 sm:flex sm:items-center sm:space-x-2 sm:space-y-0"},ll={__name:"ComposeMessage",props:{resourceName:String,resourceId:[String,Number],relatedResource:Object,visible:Boolean,defaultAccount:Object,to:{type:Array,default:()=>[]},associations:{type:Array,default:()=>[]}},emits:["modal-hidden"],setup(e,{expose:t,emit:n}){const a=e,r=Me("synchronizeResource",null),i=Pe(),{form:u,attachments:c,attachmentsDraftId:m,handleAttachmentUploaded:p,destroyPendingAttachment:f,customAssociationsValue:h,placeholders:g,resourcesForPlaceholders:y,subject:_,parsedSubject:I,subjectPlaceholdersSyntaxIsValid:F,hasInvalidSubjectPlaceholders:$,subjectContainsPlaceholders:C,parsePlaceholdersForMessage:w,parsePlaceholdersForSubject:x,showWillUsePlaceholdersIconToAssociateResourceRecord:A,sending:N,sendRequest:T,hasInvalidAddresses:E,associateSelectedRecipients:B,dissociateRemovedRecipients:z,associateMessageRecord:M,handleRecipientSelectedEvent:j,handleToRecipientRemovedEvent:U,setWantsCC:P,setWantsBCC:H,wantsBcc:L,wantsCc:Z,hasEmptyPlaceholders:J}=vr(a.resourceName,a.relatedResource,r),K=q(!1);ge(J,(Ve,$e)=>{$e&&!Ve&&(K.value=!1)});const G=q(null),oe=q(null),pe=q(!1),ue=q({}),ee=q(!1),W=q(!1),ne=q(!1),ce=V(()=>i.getters["emailAccounts/accounts"]),fe=V(()=>u.to.length===0||!_.value||N.value);ge(()=>a.defaultAccount,Ve=>{ue.value=Ve}),ge(()=>a.to,Ve=>{u.to=Ve,B(Ve)},{immediate:!0});function Se(Ve){Ve.forEach($e=>M($e,$e.resourceName))}ge(()=>a.associations,Ve=>{Se(Ve)},{immediate:!0});function Ie(Ve){_.value||(_.value=Ve.subject),u.message=Ve.body+u.message,W.value=!1,w(),x(),Ce(),Fe(()=>G.value.focus())}function Ce(){document.querySelector(".dialog").scrollTo({top:0,behavior:"instant"})}function le(){u.to&&B(u.to),Se(a.associations),m.value=qt()}function ye(){u.reset(),a.to&&(u.to=a.to),_.value=null,I.value=null,c.value=[],h.value={},n("modal-hidden")}function Ge(Ve=!1){if(Ve===!1&&J.value){K.value=!0;return}else K.value&&(K.value=!1);T(`/inbox/emails/${ue.value.id}`).then(()=>Innoclapps.modal().hide("composeMessageModal"))}function be(){i.dispatch("emailAccounts/fetch").then(Ve=>{ue.value=a.defaultAccount||Ve[0],ee.value=!0})}return be(),t({subjectRef:oe}),(Ve,$e)=>{const et=v("Icon"),Te=v("IAlert"),tt=v("IFormLabel"),at=v("DropdownSelectInput"),lt=v("IFormInput"),_e=v("IFormError"),me=v("IOverlay"),we=v("IButton"),Ue=v("IModal"),Oe=ae("t"),se=ae("i-tooltip");return d(),R(Ue,{id:"composeMessageModal",size:"xl","static-backdrop":"","hide-footer":W.value,visible:e.visible,title:Ve.$t("mailclient::inbox.new_message"),onHidden:ye,onShown:le},{"modal-footer":b(({cancel:ke})=>[o("div",oK,[o("div",lK,[D(s(Zn,{modelValue:l(u).task_date,"onUpdate:modelValue":$e[14]||($e[14]=He=>l(u).task_date=He)},null,8,["modelValue"]),[[Y,!!e.resourceName]])]),o("div",aK,[s(we,{class:"w-full sm:w-auto",variant:"white",text:Ve.$t("core::app.cancel"),onClick:ke},null,8,["text","onClick"]),s(we,{class:"w-full sm:w-auto",loading:l(N),variant:K.value?"danger":"primary",disabled:fe.value,text:K.value?Ve.$t("core::app.confirm"):Ve.$t("mailclient::inbox.send"),onClick:$e[15]||($e[15]=He=>Ge(K.value))},null,8,["loading","variant","disabled","text"])])])]),default:b(()=>[o("div",zG,[o("div",MG,[o("div",UG,[D(o("a",{href:"#",class:"link text-sm font-medium",onClick:$e[0]||($e[0]=ie(ke=>W.value=!0,["prevent"]))},null,512),[[Y,!W.value],[Oe,"mailclient.mail.templates.templates"]]),D(o("a",{href:"#",class:"link text-sm font-medium",onClick:$e[1]||($e[1]=ie(ke=>W.value=!1,["prevent"]))},null,512),[[Y,W.value],[Oe,"mailclient.mail.compose"]])]),D(o("div",PG,[s(vn,{modelValue:l(u).associations,"onUpdate:modelValue":$e[2]||($e[2]=ke=>l(u).associations=ke),"primary-record-disabled":!0,"primary-record":e.resourceName?e.relatedResource:void 0,"primary-resource-name":e.resourceName,"initial-associateables":e.resourceName?e.relatedResource:void 0,associateables:l(h),onChange:$e[3]||($e[3]=ke=>(l(w)(),l(x)()))},{"after-record":b(({title:ke,resource:He,record:yt,isSelected:Ke,isSearching:Ze,selectedRecords:ze})=>[l(A)(yt,ze,He,Ke,Ze)?D((d(),k("span",jG,[s(et,{icon:"CodeBracket",class:"h-5 w-5 text-neutral-500 dark:text-neutral-400"})])),[[se,Ve.$t("mailclient::inbox.will_use_placeholders_from_record",{resourceName:ke}),void 0,{top:!0}]]):O("",!0)]),_:1},8,["modelValue","primary-record","primary-resource-name","initial-associateables","associateables"])],512),[[Y,!W.value]])])]),D(o("div",null,[s(me,{show:!ee.value},{default:b(()=>[s(Te,{variant:"danger",dismissible:"",show:l(E)},{default:b(()=>[Q(S(Ve.$t("mailclient::mail.validation.invalid_recipients")),1)]),_:1},8,["show"]),s(jn,{form:l(u),type:"to",label:Ve.$t("mailclient::inbox.to"),onRecipientRemoved:l(U),onRecipientSelected:l(j)},{after:b(()=>[!l(L)||!l(Z)?(d(),k("div",LG,[l(Z)?O("",!0):D((d(),k("a",{key:0,href:"#",class:"link",onClick:$e[4]||($e[4]=ie((...ke)=>l(P)&&l(P)(...ke),["prevent"]))},null,512)),[[Oe,"mailclient.inbox.cc"]]),l(L)?O("",!0):D((d(),k("a",{key:1,href:"#",class:"link",onClick:$e[5]||($e[5]=ie((...ke)=>l(H)&&l(H)(...ke),["prevent"]))},null,512)),[[Oe,"mailclient.inbox.bcc"]])])):O("",!0)]),_:1},8,["form","label","onRecipientRemoved","onRecipientSelected"]),HG,D(o("div",null,[s(jn,{form:l(u),type:"cc",label:Ve.$t("mailclient::inbox.cc"),onRecipientRemoved:l(z),onRecipientSelected:l(B)},null,8,["form","label","onRecipientRemoved","onRecipientSelected"]),GG],512),[[Y,l(Z)]]),D(o("div",null,[s(jn,{form:l(u),type:"bcc",label:Ve.$t("mailclient::inbox.bcc")},null,8,["form","label"]),KG],512),[[Y,l(L)]]),o("div",YG,[s(tt,{label:Ve.$t("mailclient::inbox.from"),class:"w-14"},null,8,["label"]),s(at,{modelValue:ue.value,"onUpdate:modelValue":$e[6]||($e[6]=ke=>ue.value=ke),"adaptive-width":"",items:ce.value,"value-key":"id","label-key":"display_email"},{label:b(({label:ke})=>[Q(S(ue.value.formatted_from_name_header)+" ",1),o("span",{textContent:S("<"+ke+">")},null,8,WG)]),_:1},8,["modelValue","items"])]),QG,o("div",XG,[o("div",ZG,[s(tt,{label:Ve.$t("mailclient::inbox.subject"),for:"subject"},null,8,["label"])]),o("div",JG,[o("div",eK,[s(lt,{id:"subject",ref_key:"subjectRef",ref:oe,class:X({"!border-danger-600":!l(F)||l($),"border-dashed !border-neutral-400":ne.value}),"model-value":pe.value?l(I):l(_),disabled:pe.value,"onUpdate:modelValue":$e[7]||($e[7]=ke=>_.value=ke),onDragover:$e[8]||($e[8]=ke=>pe.value?void 0:ne.value=!0),onDragleave:$e[9]||($e[9]=ke=>ne.value=!1),onDrop:$e[10]||($e[10]=ke=>ne.value=!1)},null,8,["class","model-value","disabled"]),D(o("a",{href:"#",tabindex:"-1",onClick:$e[11]||($e[11]=ie(ke=>pe.value=!1,["prevent"]))},[s(et,{icon:"CodeBracket",class:"absolute bottom-0 right-4 top-0 m-auto h-5 w-5 text-neutral-500"})],512),[[Y,pe.value]]),l(C)&&!pe.value&&l(y).length>0?(d(),k("a",{key:0,href:"#",tabindex:"-1",onClick:$e[12]||($e[12]=ie(ke=>pe.value=!0,["prevent"]))},[s(et,{icon:"ViewfinderCircle",class:"absolute bottom-0 right-4 top-0 m-auto h-5 w-5 text-neutral-500"})])):O("",!0)]),s(_e,{textContent:S(l(u).getError("subject"))},null,8,["textContent"])])]),tK,s(l(ol),{ref_key:"editorRef",ref:G,modelValue:l(u).message,"onUpdate:modelValue":$e[13]||($e[13]=ke=>l(u).message=ke),placeholders:l(g),"with-drop":!0,onPlaceholderInserted:l(w)},null,8,["modelValue","placeholders","onPlaceholderInserted"]),o("div",nK,[s(Hn,{"action-url":`${Ve.$store.state.apiURL}/media/pending/${l(m)}`,"select-file-text":Ve.$t("core::app.attach_files"),onFileUploaded:l(p)},{default:b(()=>[s(Mo,{class:"mb-3",items:l(c),"authorize-delete":!0,onDeleteRequested:l(f)},null,8,["items","onDeleteRequested"])]),_:1},8,["action-url","select-file-text","onFileUploaded"])])]),_:1},8,["show"]),K.value?(d(),R(Te,{key:0,variant:"warning",class:"mt-4"},{default:b(()=>[Q(S(Ve.$t("mailclient::inbox.pre_send_empty_placeholders_found")),1)]),_:1})):O("",!0)],512),[[Y,!W.value]]),W.value?(d(),R(hr,{key:0,onSelected:Ie,onCreated:Ce,onUpdated:Ce,onWillCreate:Ce,onWillEdit:Ce})):O("",!0)]),_:1},8,["hide-footer","visible","title"])}}};function yr(e,t){const n=q([]);return Ho(()=>{n.value=[];const a=l(t),r=l(e);Object.keys(a).length!==0&&(r==="deals"||r==="contacts"?a.companies.length===1&&n.value.push({id:a.companies[0].id,display_name:a.companies[0].display_name,path:a.companies[0].path,resourceName:Innoclapps.resourceName("companies")}):r===Innoclapps.resourceName("companies")&&a.contacts.length===1&&n.value.push({id:a.contacts[0].id,display_name:a.contacts[0].display_name,path:a.contacts[0].path,resourceName:Innoclapps.resourceName("contacts")}))}),{newMessageAdditionalAssociations:n}}const sK=["href","onClick","textContent"],rK={key:2},iK={__name:"EmailSendableField",props:["resource","resourceName","resourceId","field","isFloating"],setup(e){const t=e,n=Pe(),a=q(!1),r=q(null),i=q(null),{newMessageAdditionalAssociations:u}=yr(xe(t,"resourceName"),xe(t,"resource")),c=V(()=>n.getters["emailAccounts/hasConfigured"]),m=V(()=>[{address:t.field.value,name:t.resource.display_name,resourceName:t.resourceName,id:t.resourceId}]);function p(){setTimeout(()=>{a.value=!1},300)}function f(g=!0){i.value.hide(),a.value=g,Fe(()=>{r.value.subjectRef.focus()})}function h(){n.dispatch("fields/fetchPlaceholders"),n.state.emailAccounts.dataFetched||n.dispatch("emailAccounts/fetch")}return(g,y)=>{const _=v("IDropdownItem"),I=v("IButtonCopy"),F=v("IDropdown"),$=v("DetailFieldsItem"),C=ae("i-tooltip");return d(),R($,{field:e.field,"is-floating":e.isFloating,resource:e.resource,"resource-name":e.resourceName,"resource-id":e.resourceId},{field:b(({hasValue:w,value:x})=>[a.value?(d(),R(ll,{key:0,ref_key:"composeRef",ref:r,visible:a.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"related-resource":e.resource,associations:l(u),to:m.value,onModalHidden:p},null,8,["visible","resource-name","resource-id","related-resource","associations","to"])):O("",!0),w?(d(),R(F,{key:1,ref_key:"dropdownRef",ref:i,"no-caret":"",onShow:h},{toggle:b(({toggle:A})=>[o("a",{class:"link text-sm",href:"mailto:"+x,onClick:ie(A,["prevent"]),textContent:S(x)},null,8,sK)]),default:b(()=>[D((d(),k("span",null,[e.isFloating?O("",!0):(d(),R(_,{key:0,href:"#",disabled:!c.value,text:g.$t("mailclient::mail.create"),onClick:y[0]||(y[0]=A=>f(!0))},null,8,["disabled","text"]))])),[[C,c.value?"":g.$t("mailclient::mail.account.integration_not_configured")]]),s(I,{"success-message":g.$t("core::fields.email_copied"),text:x,tag:"IDropdownItem"},{default:b(()=>[Q(S(g.$t("core::app.copy")),1)]),_:2},1032,["success-message","text"]),s(_,{href:"mailto:"+x,text:g.$t("core::app.open_in_app")},null,8,["href","text"])]),_:2},1536)):(d(),k("span",rK,""))]),_:1},8,["field","is-floating","resource","resource-name","resource-id"])}}},uK={__name:"MailEditorField",props:ut,setup(e){const t=e,n=q(""),{field:a,fieldId:r,label:i,isReadonly:u,initialize:c}=ht(n,xe(t,"field"),t.formId,xe(t,"isFloating"));return De(c),(m,p)=>(d(),R(it,{field:l(a),label:l(i),"field-id":l(r),"form-id":m.formId},{default:b(()=>[s(l(ol),Re({modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=f=>n.value=f),disabled:l(u)},l(a).attributes),null,16,["modelValue","disabled"])]),_:1},8,["field","label","field-id","form-id"]))}},dK=Object.assign({inheritAttrs:!1},{__name:"EmailSendableField",props:["column","row","field","resourceName","resourceId"],setup(e){const t=e,n=Pe(),a=q(!1),r=q(null),i=q(null),u=V(()=>n.getters["emailAccounts/hasConfigured"]),c=V(()=>[{address:t.field.value,name:t.row.display_name||t.row.name,resourceName:t.resourceName,id:t.row.id}]);function m(){setTimeout(()=>{a.value=!1},300)}function p(h=!0){a.value=h,i.value.dropdownRef.hide(),Fe(()=>{r.value.subjectRef.focus()})}function f(){n.dispatch("fields/fetchPlaceholders"),n.state.emailAccounts.dataFetched||n.dispatch("emailAccounts/fetch")}return(h,g)=>{const y=v("IDropdownItem"),_=ae("i-tooltip");return d(),k(te,null,[a.value?(d(),R(ll,{key:0,ref_key:"composeRef",ref:r,visible:a.value,to:c.value,onModalHidden:m},null,8,["visible","to"])):O("",!0),s(_s,Re(h.$attrs,{ref_key:"originalColumn",ref:i,column:e.column,row:e.row,field:e.field,"resource-name":e.resourceName,"resource-id":e.resourceId,onShow:f}),vt({_:2},[e.field.value?{name:"start",fn:b(()=>[D((d(),k("span",null,[s(y,{href:"#",disabled:!u.value,text:h.$t("mailclient::mail.create"),onClick:g[0]||(g[0]=I=>p(!0))},null,8,["disabled","text"])])),[[_,u.value?"":h.$t("mailclient::mail.account.integration_not_configured")]])]),key:"0"}:void 0]),1040,["column","row","field","resource-name","resource-id"])],64)}}}),xr={collection:[],dataFetched:!1,endpoint:"/mail/accounts",syncInProgress:!1,accountConfigError:null,formConnectionState:!1,activeInboxAccount:{}},cK={...Ds,SET_ACCOUNT_CONFIG_ERROR(e,t){e.accountConfigError=t},SET_SYNC_IN_PROGRESS(e,t){e.syncInProgress=t},SET_INBOX_ACCOUNT(e,t){typeof t!="number"&&(t=t.id),e.activeInboxAccount=t},SET_FORM_CONNECTION_STATE(e,t){e.formConnectionState=t},SET_ACCOUNT_AS_PRIMARY(e,t){e.collection.forEach((n,a)=>{e.collection[a].is_primary=n.id==t})}},mK={...Ts,shared(e){return Lt(e.collection,["type","shared"])},personal(e){return Lt(e.collection,["type","personal"])},OAuthConnectUrl:()=>(e,t)=>{if(e=="Gmail")return Innoclapps.config("url")+"/mail/accounts/"+t+"/google/connect";if(e=="Outlook")return Innoclapps.config("url")+"/mail/accounts/"+t+"/microsoft/connect"},activeInboxAccount(e){return Ee(e.collection,["id",Number(e.activeInboxAccount)])||{}},accounts(e){return ot(e.collection,["is_primary","email"],["desc","asc"])},hasConfigured(e){return e.collection.length>0},hasPrimary(e){return e.collection.filter(t=>t.is_primary).length>0},latest(e){return ot(e.collection,t=>new Date(t.created_at),["desc"])[0]}},pK={...Vs,removePrimary({state:e,commit:t}){Innoclapps.request().delete(`${e.endpoint}/primary`).then(()=>{t("SET_ACCOUNT_AS_PRIMARY",null)})},setPrimary({state:e,commit:t},n){Innoclapps.request().put(`${e.endpoint}/${n}/primary`).then(()=>{t("SET_ACCOUNT_AS_PRIMARY",n)})},enableSync({state:e,commit:t},n){Innoclapps.request().post(`${e.endpoint}/${n}/sync/enable`).then(({data:a})=>{t("UPDATE",{id:a.id,item:a})})},disableSync({state:e,commit:t},n){Innoclapps.request().post(`${e.endpoint}/${n}/sync/disable`).then(({data:a})=>{t("UPDATE",{id:a.id,item:a})})},async syncAccount({commit:e},t){e("SET_SYNC_IN_PROGRESS",!0);let{data:n}=await Innoclapps.request().get(`/mail/accounts/${t}/sync`).finally(()=>e("SET_SYNC_IN_PROGRESS",!1));return n},async destroy(e,t){let{data:n}=await Innoclapps.request().delete(`${xr.endpoint}/${t}`);return e.commit("REMOVE",t),e.dispatch("updateUnreadCountUI",n.unread_count),n},updateUnreadCountUI(e,t){e.commit("UPDATE_MENU_ITEM",{id:"inbox",data:{badge:t}},{root:!0})},decrementUnreadCountUI(e){let t=e.rootGetters.getMenuItem("inbox");t.badge<1||e.dispatch("updateUnreadCountUI",t.badge-1)}},fK={namespaced:!0,state:xr,mutations:cK,getters:mK,actions:pK},vK={__name:"RecordTabEmails",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>{const a=v("ITab");return St([e.resource.unread_emails_for_user_count],()=>s(a,{badge:e.resource.unread_emails_for_user_count,"badge-variant":"info",title:t.$t("mailclient::mail.emails"),icon:"Mail"},null,8,["badge","title"]),n,0)}}},bK={class:"-mt-[20px] mb-3 rounded-b-md border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-900 sm:mb-7"},hK={class:"px-4 py-5 sm:p-6"},_K={class:"sm:flex sm:items-start sm:justify-between"},gK={class:"text-base/6 font-medium text-neutral-900 dark:text-white"},yK={class:"mt-2 max-w-xl text-sm text-neutral-500 dark:text-neutral-200"},xK={class:"mt-5 sm:ml-6 sm:mt-0 sm:flex sm:shrink-0 sm:items-center"},IK={class:"mt-3 text-sm"},kK=o("span",{"aria-hidden":"true"}," ",-1),$K={class:"space-y-3"},wK={class:"mt-6 text-center text-neutral-800 dark:text-neutral-200"},bl="emails",CK={__name:"RecordTabEmailsPanel",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object},scrollElement:{type:String}},setup(e){const t=e,n=Me("synchronizeResource"),a=Pe(),r=Ye(),i=q(!1),u=q(null),c=q(null),{dataLoadedFirstTime:m,focusToAssociateableElement:p,searchResults:f,isSearching:h,hasSearchResults:g,performSearch:y,search:_,loadData:I,infiniteHandler:F,refresh:$}=Xn({resourceName:t.resourceName,resource:xe(t,"resource"),scrollElement:t.scrollElement,infinityRef:u,synchronizeResource:n,timelineRelation:bl}),{newMessageAdditionalAssociations:C}=yr(xe(t,"resourceName"),xe(t,"resource")),w=V(()=>a.getters["emailAccounts/hasConfigured"]),x=V(()=>ot(f.value||t.resource.emails,"date","desc")),A=V(()=>x.value.length>0),N=V(()=>{if(t.resource.email)return T(t.resource,t.resourceName);if(Object.keys(t.resource).length===0)return[];if(t.resourceName==="contacts"){if(t.resource.companies[0])return T(t.resource.companies[0],"companies")}else if(t.resourceName==="companies"){if(t.resource.contacts[0])return T(t.resource.contacts[0],"contacts")}else if(t.resourceName==="deals"){if(t.resource.contacts[0])return T(t.resource.contacts[0],"contacts");if(t.resource.companies[0])return T(t.resource.companies[0],"companies")}return[]});function T(z,M){return z.email?[{address:z.email,name:z.display_name,id:z.id,resourceName:M}]:[]}function E(z=!0){i.value=z,z&&Fe(()=>c.value.subjectRef.focus())}function B(z){n({[bl]:[z]})}return r.query.resourceId&&r.query.section===bl&&An(m,()=>{p(r.query.resourceId,"email")}),rt("email-accounts-sync-finished",$),rt("email-sent",B),(z,M)=>{const j=v("IButton"),U=v("router-link"),P=v("SearchInput"),H=v("ITabPanel"),L=ae("t"),Z=ae("i-tooltip");return d(),R(H,{lazy:!l(m),onActivatedOnce:l(I)},{default:b(()=>[o("div",bK,[o("div",hK,[o("div",_K,[o("div",null,[D(o("h3",gK,null,512),[[L,"mailclient.mail.manage_emails"]]),o("div",yK,[D(o("p",null,null,512),[[L,"mailclient.mail.info"]])])]),o("div",xK,[D((d(),k("div",null,[s(j,{size:"sm",icon:"Plus",disabled:!w.value,text:z.$t("mailclient::mail.create"),onClick:M[0]||(M[0]=J=>E(!0))},null,8,["disabled","text"])])),[[Z,w.value?null:z.$t("mailclient::mail.account.integration_not_configured")]])])]),o("div",IK,[s(U,{to:{name:"email-accounts-index"},class:"link font-medium"},{default:b(()=>[Q(S(z.$t("mailclient::mail.account.connect"))+" ",1),kK]),_:1})]),D(s(P,{modelValue:l(_),"onUpdate:modelValue":M[1]||(M[1]=J=>xt(_)?_.value=J:null),class:"mt-2",onInput:l(y)},null,8,["modelValue","onInput"]),[[Y,A.value||l(_)]])])]),s(ll,{ref_key:"composeRef",ref:c,visible:i.value,"resource-name":e.resourceName,"resource-id":e.resourceId,"related-resource":e.resource,associations:l(C),to:N.value,onModalHidden:M[2]||(M[2]=J=>E(!1))},null,8,["visible","resource-name","resource-id","related-resource","associations","to"]),o("div",$K,[(d(!0),k(te,null,re(x.value,J=>(d(),R(gr,{key:J.id,email:J,"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource":e.resource},null,8,["email","via-resource","via-resource-id","related-resource"]))),128))]),D(o("div",wK,null,512),[[Y,l(h)&&!l(g)],[L,"core::app.no_search_results"]]),s(xn,{ref_key:"infinityRef",ref:u,"scroll-element":e.scrollElement,onHandle:M[3]||(M[3]=J=>l(F)(J))},null,8,["scroll-element"])]),_:1},8,["lazy","onActivatedOnce"])}}};function Ir(){const{form:e}=Ae(),t=q(!1),n=Pe();function a(r){return e.set({id:r.id||null,connection_type:r.connection_type,email:r.email,password:r.password,username:r.username,imap_server:r.imap_server,imap_port:r.imap_port,imap_encryption:r.imap_encryption,smtp_server:r.smtp_server,smtp_port:r.smtp_port,smtp_encryption:r.smtp_encryption,validate_cert:r.validate_cert}),t.value=!0,new Promise((i,u)=>{e.post("/mail/accounts/connection").then(c=>{n.commit("emailAccounts/SET_FORM_CONNECTION_STATE",!0),i(c)}).catch(c=>{n.commit("emailAccounts/SET_FORM_CONNECTION_STATE",!1),u(c)}).finally(()=>t.value=!1)})}return{testConnection:a,testConnectionInProgress:t,testConnectionForm:e}}const SK=Object.assign({name:"EmailAccountsFormFolder"},{__name:"EmailAccountsFormFolder",props:{folder:{required:!0,type:Object},folders:{required:!0,type:Array},index:{required:!0,type:Number}},setup(e){return(t,n)=>{const a=v("IFormCheckbox"),r=v("EmailAccountsFormFolder",!0);return d(),k("div",null,[(d(),R(a,{id:"form-folder"+e.index+"-"+e.folder.name,key:"form-folder"+e.index+"-"+e.folder.name,checked:e.folders[e.index].syncable,"onUpdate:checked":n[0]||(n[0]=i=>e.folders[e.index].syncable=i),class:"mb-1",disabled:!e.folder.selectable,label:e.folder.display_name},null,8,["id","checked","disabled","label"])),e.folder.children?(d(!0),k(te,{key:0},re(e.folder.children,(i,u)=>(d(),R(r,{key:u+i.name,class:"ml-4 mt-2",folder:i,index:u,folders:e.folder.children},null,8,["folder","index","folders"]))),128)):O("",!0)])}}}),RK={__name:"EmailAccountsFormFolders",props:{folders:Array},setup(e){return(t,n)=>(d(),k("div",null,[(d(!0),k(te,null,re(e.folders,(a,r)=>(d(),R(SK,{key:r+a.name,folder:a,index:r,folders:e.folders},null,8,["folder","index","folders"]))),128))]))}},Ua={__name:"EmailAccountsFormFolderTypeSelect",props:["modelValue","form","field","folders","label","required"],emits:["update:modelValue"],setup(e){return(t,n)=>{const a=v("ICustomSelect"),r=v("IFormError"),i=v("IFormGroup");return d(),R(i,{label:e.label,required:e.required},{default:b(()=>[s(a,{clearable:!1,options:e.folders,"option-label-provider":u=>"--"+u.parent_id+"--"+u.display_name,reduce:u=>u.id,"model-value":e.modelValue,"onUpdate:modelValue":n[0]||(n[0]=u=>t.$emit("update:modelValue",u))},{option:b(u=>[Q(S(u.display_name.replace("--"+u.parent_id+"--","")),1)]),"selected-option":b(u=>[Q(S(u.display_name.replace("--"+u.parent_id+"--","")),1)]),_:1},8,["options","option-label-provider","reduce","model-value"]),s(r,{textContent:S(e.form.getError(e.field))},null,8,["textContent"])]),_:1},8,["label","required"])}}},FK=["innerHTML"],VK={class:"mb-2 mt-4 text-sm text-neutral-800 dark:text-neutral-200"},TK={key:0,class:"mb-3 rounded-md border border-neutral-200 p-3 dark:border-neutral-600"},DK={class:"mt-3 flex flex-col items-center sm:flex-row sm:space-x-2"},qK={class:"mb-3 mt-4"},EK={class:"mb-3 font-medium text-neutral-700 dark:text-neutral-100"},AK={class:"grid grid-cols-6 gap-6"},BK={class:"col-span-2"},NK={class:"col-span-4"},OK={class:"mb-3 font-medium text-neutral-700 dark:text-neutral-100"},zK={class:"grid grid-cols-6 gap-6"},MK={class:"col-span-2"},UK={class:"col-span-4"},PK={class:"mb-3 font-medium text-neutral-700 dark:text-neutral-100"},jK={class:"mb-3 rounded-md border border-neutral-200 p-3 dark:border-neutral-600"},LK={class:"mb-1 font-medium text-neutral-700 dark:text-neutral-100"},HK={class:"mb-2 text-sm text-neutral-700 dark:text-neutral-300"},GK={class:"rounded-md border border-neutral-200 p-3 dark:border-neutral-600"},KK={class:"flex items-center"},YK={class:"mr-4"},WK=["textContent"],QK=["textContent"],XK=["textContent"],ZK={key:1},kr={__name:"EmailAccountsFormFields",props:{type:{required:!0,type:String},account:Object,form:{required:!0,type:Object},testConnectionForm:{required:!0,type:Object}},emits:["submit","ready"],setup(e,{expose:t,emit:n}){const a=e,{t:r}=ve(),i=Pe(),{currentUser:u,setting:c,isMicrosoftGraphConfigured:m,isGoogleApiConfigured:p}=Le(),{localizedDate:f,appDate:h,appMoment:g}=Ne(),y=[{text:r("mailclient::mail.account.sync_period_now"),value:h()},{text:r("mailclient::mail.account.sync_period_1_month_ago"),value:H(1)},{text:r("mailclient::mail.account.sync_period_3_months_ago"),value:H(3)},{text:r("mailclient::mail.account.sync_period_6_months_ago"),value:H(6),warning:!0}],_=q(!1);An(()=>{var K;return(K=a.account)==null?void 0:K.alias_email},K=>{K&&(_.value=!0)});const I=Innoclapps.config("mail.accounts.encryptions"),F=Innoclapps.config("mail.accounts.connections"),$=q([]),C=V(()=>i.getters["emailAccounts/accounts"]),w=V(()=>ao($.value,K=>Ee(C.value,["email",K.email]))),x=V(()=>w.value.length>0),A=V(()=>{let K=Ee(y,["value",a.form.initial_sync_from]);return K?K.warning===!0:!1}),N=V(()=>i.state.emailAccounts.accountConfigError),T=V(()=>a.form.from_name_header?a.form.from_name_header.replace("{agent}",u.value.name).replace("{company}",c("company_name")||""):""),E=V(()=>!a.account),B=V(()=>a.form.connection_type==="Imap"),z=V(()=>E.value&&!B.value),M=V(()=>B.value),j=V(()=>a.form.folders?a.form.folders.length>0:!1);function U(K){return i.commit("emailAccounts/SET_FORM_CONNECTION_STATE",K)}function P(K){return i.commit("emailAccounts/SET_ACCOUNT_CONFIG_ERROR",K)}function H(K){return g().subtract(K,"months").format("YYYY-MM-DD HH:mm:ss")}function L(K){P(null),K=="Outlook"&&!m()?P(`Microsoft application not configured,
                        you must <a href="/settings/integrations/microsoft" rel="noopener noreferrer" target="_blank" class="font-medium underline text-danger-700 hover:text-danger-600 focus:outline-none">configure</a> your
                        Microsoft application in order to connect Outlook mail client.`):K=="Gmail"&&!p()?P(`Google application project not configured,
                        you must <a href="/settings/integrations/google" rel="noopener noreferrer" target="_blank" class="font-medium underline text-danger-700 hover:text-danger-600 focus:outline-none">configure</a> your
                        Google application project in order to connect Gmail mail client.`):K==="Imap"&&!Innoclapps.config("requirements.imap")&&P('In order to use IMAP account type, you will need to enable the PHP extension "imap".')}function Z(){Innoclapps.request().get("oauth/accounts").then(({data:K})=>$.value=K)}function J(K){switch(K.type){case"microsoft":a.form.fill("connection_type","Outlook");break;case"google":a.form.fill("connection_type","Gmail");break;default:a.form.fill("connection_type",K.type)}n("submit")}return De(()=>{Z(),n("ready")}),on(()=>{U(!1),P(null)}),t({initialSyncOptions:y}),(K,G)=>{const oe=v("IAlert"),pe=v("ICustomSelect"),ue=v("IFormError"),ee=v("IFormGroup"),W=v("IButton"),ne=v("IFormLabel"),ce=v("IFormRadio"),fe=v("IFormInput"),Se=v("IFormCheckbox"),Ie=v("Icon"),Ce=ae("t");return d(),k(te,null,[s(oe,{variant:"info",class:"mb-5",show:N.value!==null},{default:b(()=>[o("div",{innerHTML:N.value},null,8,FK)]),_:1},8,["show"]),o("div",{class:X({"mb-3 rounded-md border border-warning-400 px-4 py-3":!e.form.connection_type})},[s(ee,{required:"",label:K.$t("mailclient::mail.account.type"),"label-for":"connection_type"},{default:b(()=>[s(pe,{modelValue:e.form.connection_type,"onUpdate:modelValue":G[0]||(G[0]=le=>e.form.connection_type=le),options:l(F),clearable:!1,placeholder:K.$t("mailclient::mail.account.select_type"),disabled:!E.value,"onOption:selected":L},null,8,["modelValue","options","placeholder","disabled"]),s(ue,{textContent:S(e.form.getError("connection_type"))},null,8,["textContent"])]),_:1},8,["label"]),E.value&&x.value?(d(),k("div",{key:0,class:X({"mb-3":e.form.connection_type})},[D(o("p",VK,null,512),[[Ce,"core::oauth.or_choose_existing"]]),(d(!0),k(te,null,re(w.value,le=>(d(),R(zo,{key:le.id,account:le,"with-reconnect-link":!1,class:"mb-2"},{default:b(()=>[s(W,{class:"ml-2",size:"sm",disabled:le.requires_auth,text:K.$t("core::oauth.connect"),onClick:ye=>J(le)},null,8,["disabled","text","onClick"])]),_:2},1032,["account"]))),128))],2)):O("",!0)],2),E.value?(d(),k("div",TK,[s(ne,{label:K.$t("mailclient::mail.account.sync_emails_from")},null,8,["label"]),o("div",DK,[(d(),k(te,null,re(y,le=>s(ce,{id:"initial-sync-"+le.value,key:le.value,modelValue:e.form.initial_sync_from,"onUpdate:modelValue":G[1]||(G[1]=ye=>e.form.initial_sync_from=ye),label:le.text,class:"self-start",value:le.value,name:"initial_sync_from"},null,8,["id","modelValue","label","value"])),64))]),A.value?(d(),R(oe,{key:0,class:"mt-4"},{default:b(()=>[Q(S(K.$t("mailclient::mail.account.sync_period_note",{date:l(f)(e.form.initial_sync_from)})),1)]),_:1})):O("",!0)])):O("",!0),o("div",{class:X({"pointer-events-none blur-sm":z.value})},[s(ee,{label:K.$t("mailclient::mail.account.email_address"),"label-for":"email",required:""},{default:b(()=>[s(fe,{modelValue:e.form.email,"onUpdate:modelValue":G[2]||(G[2]=le=>e.form.email=le),name:"email",disabled:!E.value,spellcheck:"false",autocomplete:"off",type:"email"},null,8,["modelValue","disabled"]),s(ue,{textContent:S(e.form.getError("email"))},null,8,["textContent"])]),_:1},8,["label"]),_.value?(d(),R(ee,{key:0,label:K.$t("mailclient::mail.account.enter_alias"),"label-for":"alias_email",description:K.$t("mailclient::mail.account.use_aliass_info")},{default:b(()=>[s(fe,{modelValue:e.form.alias_email,"onUpdate:modelValue":G[3]||(G[3]=le=>e.form.alias_email=le),name:"alias_email",spellcheck:"false",autocomplete:"off",type:"email"},null,8,["modelValue"]),s(ue,{textContent:S(e.form.getError("email"))},null,8,["textContent"])]),_:1},8,["label","description"])):O("",!0),s(ee,null,{default:b(()=>[E.value?O("",!0):(d(),R(Se,{key:0,id:"use_alias",checked:_.value,"onUpdate:checked":G[4]||(G[4]=le=>_.value=le),name:"use_alias",label:K.$t("mailclient::mail.account.use_aliass"),onChange:G[5]||(G[5]=le=>e.form.alias_email=null)},null,8,["checked","label"])),s(Se,{id:"create_contact",checked:e.form.create_contact,"onUpdate:checked":G[6]||(G[6]=le=>e.form.create_contact=le),name:"create_contact",label:K.$t("mailclient::mail.account.create_contact")},null,8,["checked","label"])]),_:1})],2),D(o("div",{class:X({"pointer-events-none blur-sm":z.value})},[s(ee,{label:K.$t("mailclient::mail.account.password"),"label-for":"password",required:""},{default:b(()=>[s(fe,{modelValue:e.form.password,"onUpdate:modelValue":G[7]||(G[7]=le=>e.form.password=le),placeholder:e.form.id?"":"",spellcheck:"false",autocomplete:"new-password",type:"password"},null,8,["modelValue","placeholder"]),s(ue,{textContent:S(e.form.getError("password"))},null,8,["textContent"])]),_:1},8,["label"]),s(ee,{"label-for":"username",label:K.$t("mailclient::mail.account.username"),optional:""},{default:b(()=>[s(fe,{id:"username",modelValue:e.form.username,"onUpdate:modelValue":G[8]||(G[8]=le=>e.form.username=le),autocomplete:"off",spellcheck:"false",name:"username"},null,8,["modelValue"])]),_:1},8,["label"]),o("div",qK,[D(o("h5",EK,null,512),[[Ce,"mailclient.mail.account.incoming_mail"]]),s(ee,{required:"",label:K.$t("mailclient::mail.account.server"),"label-for":"imap_server"},{default:b(()=>[s(fe,{modelValue:e.form.imap_server,"onUpdate:modelValue":G[9]||(G[9]=le=>e.form.imap_server=le),name:"imap_server",placeholder:"imap.example.com",spellcheck:"false",autocomplete:"off"},null,8,["modelValue"]),s(ue,{textContent:S(e.form.getError("imap_server"))},null,8,["textContent"])]),_:1},8,["label"]),o("div",AK,[o("div",BK,[s(ee,{label:K.$t("mailclient::mail.account.port"),"label-for":"imap_port",required:""},{default:b(()=>[s(fe,{modelValue:e.form.imap_port,"onUpdate:modelValue":G[10]||(G[10]=le=>e.form.imap_port=le),name:"imap_port",type:"number",autocomplete:"off"},null,8,["modelValue"]),s(ue,{textContent:S(e.form.getError("imap_port"))},null,8,["textContent"])]),_:1},8,["label"])]),o("div",NK,[s(ee,{label:K.$t("mailclient::mail.account.encryption"),"label-for":"imap_encryption"},{default:b(()=>[s(pe,{modelValue:e.form.imap_encryption,"onUpdate:modelValue":G[11]||(G[11]=le=>e.form.imap_encryption=le),options:l(I),placeholder:K.$t("mailclient::mail.account.without_encryption")},null,8,["modelValue","options","placeholder"]),s(ue,{textContent:S(e.form.getError("imap_encryption"))},null,8,["textContent"])]),_:1},8,["label"])])])]),D(o("h5",OK,null,512),[[Ce,"mailclient.mail.account.outgoing_mail"]]),s(ee,{required:"",label:K.$t("mailclient::mail.account.server"),"label-for":"smtp_server"},{default:b(()=>[s(fe,{modelValue:e.form.smtp_server,"onUpdate:modelValue":G[12]||(G[12]=le=>e.form.smtp_server=le),name:"smtp_server",placeholder:"smtp.example.com",spellcheck:"false",autocomplete:"off"},null,8,["modelValue"]),s(ue,{textContent:S(e.form.getError("smtp_server"))},null,8,["textContent"])]),_:1},8,["label"]),o("div",zK,[o("div",MK,[s(ee,{label:K.$t("mailclient::mail.account.port"),"label-for":"smtp_port",required:""},{default:b(()=>[s(fe,{modelValue:e.form.smtp_port,"onUpdate:modelValue":G[13]||(G[13]=le=>e.form.smtp_port=le),name:"smtp_port",type:"number",autocomplete:"off"},null,8,["modelValue"]),s(ue,{textContent:S(e.form.getError("smtp_port"))},null,8,["textContent"])]),_:1},8,["label"])]),o("div",UK,[s(ee,{label:K.$t("mailclient::mail.account.encryption"),"label-for":"smtp_encryption"},{default:b(()=>[s(pe,{modelValue:e.form.smtp_encryption,"onUpdate:modelValue":G[14]||(G[14]=le=>e.form.smtp_encryption=le),options:l(I),placeholder:K.$t("mailclient::mail.account.without_encryption")},null,8,["modelValue","options","placeholder"]),s(ue,{textContent:S(e.form.getError("smtp_encryption"))},null,8,["textContent"])]),_:1},8,["label"])])]),s(ee,null,{default:b(()=>[s(Se,{id:"validate_cert",checked:e.form.validate_cert,"onUpdate:checked":G[15]||(G[15]=le=>e.form.validate_cert=le),name:"validate_cert",label:K.$t("mailclient::mail.account.allow_non_secure_certificate"),value:0,"unchecked-value":1},null,8,["checked","label"]),s(ue,{textContent:S(e.form.getError("validate_cert"))},null,8,["textContent"])]),_:1})],2),[[Y,M.value||E.value]]),o("div",{class:X({"pointer-events-none blur-sm":z.value,hidden:e.form.connection_type==="Outlook"})},[D(o("h5",PK,null,512),[[Ce,"mailclient.mail.from_header"]]),o("div",jK,[s(ee,{label:K.$t("mailclient::mail.from_name"),description:K.$t("mailclient::mail.placeholders_info",{placeholders:"{agent}, {company}"})},{default:b(()=>[s(fe,{modelValue:e.form.from_name_header,"onUpdate:modelValue":G[16]||(G[16]=le=>e.form.from_name_header=le),name:"from_name_header",autocomplete:"off"},null,8,["modelValue"]),s(ue,{textContent:S(e.form.getError("from_name_header"))},null,8,["textContent"])]),_:1},8,["label","description"]),s(ee,null,{default:b(()=>[D(o("p",LK,null,512),[[Ce,"core::app.preview"]]),D(o("p",HK,null,512),[[Ce,"mailclient.mail.from_header_info"]]),o("div",GK,[o("div",KK,[o("div",YK,[s(Ie,{icon:"Mail",class:"h-6 w-6 text-neutral-600 dark:text-neutral-300"})]),o("div",null,[o("h6",{class:"font-medium text-neutral-800 dark:text-neutral-100",textContent:S(T.value)},null,8,WK),D(o("p",{class:"text-neutral-700 dark:text-neutral-300",textContent:S("<"+e.form.email+">")},null,8,QK),[[Y,e.form.email]])])])])]),_:1})])],2),D(o("div",{class:X({"pointer-events-none blur-sm":z.value})},[e.testConnectionForm.errors&&e.testConnectionForm.errors.any()?(d(),R(ee,{key:0},{default:b(()=>[s(oe,{variant:"danger",class:"mt-3",show:""},{default:b(()=>[(d(!0),k(te,null,re(e.testConnectionForm.errors.all(),(le,ye)=>(d(),k("p",{key:ye,class:"mb-1",textContent:S(e.testConnectionForm.getError(ye))},null,8,XK))),128))]),_:1})]),_:1})):O("",!0)],2),[[Y,M.value]]),e.account?(d(),k("div",ZK,[s(Ua,{modelValue:e.form.sent_folder_id,"onUpdate:modelValue":G[17]||(G[17]=le=>e.form.sent_folder_id=le),form:e.form,folders:e.account.folders,field:"sent_folder_id",required:!0,label:K.$t("mailclient::mail.account.select_sent_folder")},null,8,["modelValue","form","folders","label"]),s(Ua,{modelValue:e.form.trash_folder_id,"onUpdate:modelValue":G[18]||(G[18]=le=>e.form.trash_folder_id=le),form:e.form,required:!0,folders:e.account.folders,field:"trash_folder_id",label:K.$t("mailclient::mail.account.select_trash_folder")},null,8,["modelValue","form","folders","label"])])):O("",!0),j.value?(d(),R(ee,{key:2,label:K.$t("mailclient::mail.account.active_folders")},{default:b(()=>[s(RK,{class:"mt-3",folders:e.form.folders},null,8,["folders"])]),_:1},8,["label"])):O("",!0)],64)}}},JK={__name:"EmailAccountsCreate",setup(e){const{t}=ve(),n=Ye(),a=Qe(),r=Pe(),{currentUser:i}=Le(),{testConnectionForm:u,testConnection:c,testConnectionInProgress:m}=Ir(),{form:p}=Ae(),f=Innoclapps.config("requirements"),h=q(null),g=V(()=>!_.value&&I.value||p.busy||y.value!==null||!p.connection_type),y=V(()=>r.state.emailAccounts.accountConfigError),_=V(()=>r.state.emailAccounts.formConnectionState),I=V(()=>p.connection_type==="Imap");function F(){return r.getters["emailAccounts/OAuthConnectUrl"](p.connection_type,n.query.type)+"?period="+p.initial_sync_from}function $(){p.set("initial_sync_from",h.value.initialSyncOptions[1].value)}function C(){if(!I.value){window.location.href=F();return}r.dispatch("emailAccounts/store",p).then(()=>{Innoclapps.success(t("mailclient::mail.account.created")),a.push({name:"email-accounts-index"})})}function w(){c(p).then(A=>{p.requires_auth=!1,p.folders=A.folders})}function x(){let A={connection_type:null,email:null,password:null,username:null,imap_server:null,imap_port:993,imap_encryption:"ssl",smtp_server:null,smtp_port:465,smtp_encryption:"ssl",validate_cert:1,folders:[],create_contact:!1,from_name_header:Innoclapps.config("mail.accounts.from_name")};n.query.type==="personal"?A.user_id=i.value.id:n.query.type!=="shared"&&a.push({name:"404"}),p.set(A)}return x(),(A,N)=>{const T=v("IButton"),E=v("ISlideover");return d(),R(E,{title:A.$t("mailclient::mail.account.create"),visible:"","static-backdrop":"",form:"",onSubmit:C,onKeydown:N[0]||(N[0]=B=>l(p).onKeydown(B)),onHidden:N[1]||(N[1]=B=>A.$router.back())},{"modal-ok":b(()=>[I.value&&l(f).imap?(d(),R(T,{key:0,loading:l(m),disabled:l(m),text:A.$t("mailclient::mail.account.test_connection_and_retrieve_folders"),onClick:w},null,8,["loading","disabled","text"])):O("",!0),s(T,{type:"submit",variant:"primary",disabled:g.value,text:A.$t("mailclient::mail.account.connect"),loading:l(p).busy},null,8,["disabled","text","loading"])]),default:b(()=>[s(kr,{ref_key:"formFieldsRef",ref:h,type:A.$route.query.type,"test-connection-form":l(u),form:l(p),onReady:$,onSubmit:C},null,8,["type","test-connection-form","form"])]),_:1},8,["title"])}}},eY={__name:"EmailAccountsEdit",setup(e){const{t}=ve(),n=Ye(),a=Qe(),r=Pe(),{testConnectionForm:i,testConnection:u,testConnectionInProgress:c}=Ir(),{form:m}=Ae(),p=Innoclapps.config("requirements"),f=q({}),h=V(()=>m.connection_type==="Imap"),g=V(()=>f.value.is_sync_stopped||f.value.is_sync_disabled),y=V(()=>r.state.emailAccounts.formConnectionState);function _(){r.dispatch("emailAccounts/update",{form:m,id:n.params.id}).then(()=>{Innoclapps.success(t("mailclient::mail.account.updated")),a.back()})}function I(){u(m).then($=>{m.requires_auth=!1,m.folders=$.folders})}function F(){r.commit("emailAccounts/SET_FORM_CONNECTION_STATE",!0),r.dispatch("emailAccounts/get",n.params.id).then($=>{m.set($),m.folders=$.folders_tree,f.value=$})}return F(),($,C)=>{const w=v("IAlert"),x=v("IButton"),A=v("ISlideover");return d(),R(A,{title:$.$t("mailclient::mail.account.edit"),visible:"","static-backdrop":"",form:"",onHidden:C[0]||(C[0]=N=>$.$router.back()),onSubmit:_,onKeydown:C[1]||(C[1]=N=>l(m).onKeydown(N))},{"modal-ok":b(()=>[h.value&&l(p).imap?(d(),R(x,{key:0,loading:l(c),disabled:l(c),text:$.$t("mailclient::mail.account.test_connection_and_retrieve_folders"),onClick:I},null,8,["loading","disabled","text"])):O("",!0),s(x,{type:"submit",variant:"primary",loading:l(m).busy,text:$.$t("core::app.save"),disabled:!y.value||l(m).busy},null,8,["loading","text","disabled"])]),default:b(()=>[g.value?(d(),R(w,{key:0,class:"mb-4 border border-warning-200",variant:"warning"},{default:b(()=>[Q(S(f.value.sync_state_comment),1)]),_:1})):O("",!0),s(kr,{form:l(m),"test-connection-form":l(i),type:f.value.type||"",account:f.value},null,8,["form","test-connection-form","type","account"])]),_:1},8,["title"])}}},tY={class:"mt-4 flex w-full flex-col space-y-1 sm:mt-0 sm:w-auto sm:flex-row sm:justify-end sm:space-x-2 sm:space-y-0"},nY={class:"grid sm:inline"},oY={key:0,class:"flex items-center justify-between border-b border-warning-100 bg-warning-50 px-4 py-2"},lY={class:"text-sm font-medium text-warning-700"},aY={key:0},sY=["textContent"],rY={class:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between"},iY={class:"truncate"},uY={class:"flex text-sm"},dY={class:"mt-2 flex"},cY={class:"flex items-center space-x-2 text-sm"},mY={class:"mt-4 shrink-0 sm:ml-5 sm:mt-0"},pY={class:"flex space-x-3"},fY={key:0,class:"ml-5 shrink-0 self-start sm:self-auto"},vY={class:"mx-auto max-w-2xl p-4 sm:p-6"},bY={class:"text-xl font-medium text-neutral-800 dark:text-neutral-200"},hY={class:"text-sm text-neutral-500 dark:text-neutral-300"},_Y={role:"list",class:"mt-6 grid grid-cols-1 gap-6 border-y border-neutral-200 py-6 dark:border-neutral-600 lg:grid-cols-2"},gY={class:"relative -m-2 flex items-center space-x-4 rounded-xl p-2"},yY={class:"flex h-12 w-14 shrink-0 items-center justify-center rounded-lg border border-primary-200 bg-primary-50"},xY=["textContent"],IY={class:"mt-6 space-y-1 sm:space-x-2"},kY={class:"inline-block w-full sm:w-auto"},$Y={__name:"EmailAccountsIndex",setup(e){const{t}=ve(),n=Qe(),a=Ye(),r=Pe(),{setLoading:i,isLoading:u}=Ct(!0),c=V(()=>r.getters["emailAccounts/accounts"]),m=V(()=>r.getters["emailAccounts/latest"]),p=V(()=>c.value.length>0),f=[{description:t("mailclient::mail.account.featured.sync"),icon:"Refresh"},{description:t("mailclient::mail.account.featured.save_time"),icon:"DocumentAdd"},{description:t("mailclient::mail.account.featured.placeholders"),icon:"CodeBracket"},{description:t("mailclient::mail.account.featured.signature"),icon:"Pencil"},{description:t("mailclient::mail.account.featured.associations",{resources:t("contacts::contact.contacts")+", "+t("contacts::company.companies"),resource:t("deals::deal.deals")}),icon:"Mail"},{description:t("mailclient::mail.account.featured.types"),icon:"CheckCircle"}];async function h(C){await Innoclapps.dialog().confirm({message:t("mailclient::mail.account.delete_warning")}),r.dispatch("emailAccounts/destroy",C).then(()=>Innoclapps.success(t("mailclient::mail.account.deleted")))}function g(){Innoclapps.dialog().confirm({message:t("mailclient::mail.account.create_shared_confirmation_message"),title:!1,icon:"QuestionMarkCircle",iconWrapperColorClass:"bg-info-100",iconColorClass:"text-info-400",html:!0,confirmText:t("core::app.continue"),confirmVariant:"secondary"}).then(()=>n.push({name:"create-email-account",query:{type:"shared"}}))}function y(){n.push({name:"create-email-account",query:{type:"personal"}})}function _(C){n.push({name:"edit-email-account",params:{id:C.id}})}function I(C,w){C?r.dispatch("emailAccounts/setPrimary",w.id):r.dispatch("emailAccounts/removePrimary")}function F(C){let w=C.is_sync_disabled?"enable":"disable";r.dispatch(`emailAccounts/${w}Sync`,C.id)}function $(C){C.connection_type==="Imap"?_(C):window.location.href=r.getters["emailAccounts/OAuthConnectUrl"](C.connection_type,C.type)+"?re_auth=1"}return r.dispatch("emailAccounts/fetch").finally(()=>{i(!1),a.query.viaOAuth&&_(m.value)}),(C,w)=>{const x=v("NavbarSeparator"),A=v("IButton"),N=v("IButtonMinimal"),T=v("IBadge"),E=v("IFormToggle"),B=v("IDropdownItem"),z=v("IMinimalDropdown"),M=v("ICard"),j=v("Icon"),U=v("IOverlay"),P=v("router-view"),H=v("ILayout"),L=ae("i-tooltip"),Z=ae("t");return d(),R(H,null,{actions:b(()=>[D(s(x,{class:"hidden lg:block"},null,512),[[Y,p.value]]),D(s(A,{variant:"primary",size:"sm",to:{name:"inbox"},text:C.$t("mailclient::inbox.inbox")},null,8,["text"]),[[Y,p.value]])]),default:b(()=>[D(s(M,{"no-body":"",overlay:l(u),class:"mx-auto max-w-7xl",header:C.$t("mailclient::mail.account.accounts"),"actions-class":"w-full sm:w-auto"},{actions:b(()=>[o("div",tY,[D((d(),k("span",nY,[s(A,{size:"sm",variant:"white",icon:"Share",disabled:C.$gate.isRegularUser(),text:C.$t("mailclient::mail.account.connect_shared"),onClick:g},null,8,["disabled","text"])])),[[L,C.$gate.isRegularUser()?C.$t("users::user.not_authorized"):C.$t("mailclient::mail.account.create_shared_info")]]),s(A,{size:"sm",icon:"User",variant:"white",text:C.$t("mailclient::mail.account.connect_personal"),onClick:y},null,8,["text"])])]),default:b(()=>[s(El,{class:"divide-y divide-neutral-200 dark:divide-neutral-700",name:"flip-list",tag:"ul"},{default:b(()=>[(d(!0),k(te,null,re(c.value,J=>(d(),k("li",{key:J.id},[J.is_sync_stopped||J.requires_auth?(d(),k("div",oY,[o("div",lY,[J.requires_auth?D((d(),k("p",aY,null,512)),[[Z,"core::oauth.requires_authentication"]]):O("",!0),J.is_sync_stopped?(d(),k("p",{key:1,textContent:S(J.sync_state_comment)},null,8,sY)):O("",!0)]),J.requires_auth?(d(),R(N,{key:0,size:"sm",variant:"warning",class:"shrink-0 self-start",text:C.$t("core::oauth.re_authenticate"),onClick:K=>$(J)},null,8,["text","onClick"])):O("",!0)])):O("",!0),o("div",{class:X(["flex items-center px-4 py-4 sm:px-6",{"opacity-70":J.is_sync_stopped||J.is_sync_disabled}])},[o("div",rY,[o("div",iY,[o("div",uY,[(d(),R(We(J.authorizations.update?"a":"p"),{class:X(["truncate font-medium text-primary-600 dark:text-primary-400",J.authorizations.update?"cursor-pointer":""]),onClick:K=>J.authorizations.update?_(J):""},{default:b(()=>[Q(S(J.email)+" "+S(J.alias_email?`(${J.alias_email})`:""),1)]),_:2},1032,["class","onClick"]))]),o("div",dY,[o("div",cY,[J.connection_type==="Gmail"?(d(),R(Os,{key:0,class:"h-5 w-5 shrink-0"})):J.connection_type==="Outlook"?(d(),R(zs,{key:1,class:"h-5 w-5 shrink-0"})):O("",!0),J.authorizations.update?(d(),R(T,{key:2,variant:"info",text:J.connection_type},null,8,["text"])):O("",!0),s(T,{variant:J.is_personal?"neutral":"info",text:C.$t("mailclient::mail.account."+J.type)},null,8,["variant","text"]),J.is_primary||c.value.length===1?(d(),R(T,{key:3,variant:"info",text:C.$t("mailclient::mail.account.is_primary")},null,8,["text"])):O("",!0)])])]),o("div",mY,[o("div",pY,[c.value.length>1?(d(),R(E,{key:0,disabled:J.is_sync_stopped,"model-value":J.is_primary,label:C.$t("mailclient::mail.account.is_primary"),onChange:K=>I(K,J)},null,8,["disabled","model-value","label","onChange"])):O("",!0),D(s(E,{"model-value":J.is_sync_disabled,label:C.$t("mailclient::mail.disable_sync"),onChange:K=>F(J)},null,8,["model-value","label","onChange"]),[[Y,!J.is_sync_stopped&&J.authorizations.update]])])])]),J.authorizations.update||J.authorizations.delete?(d(),k("div",fY,[s(z,null,{default:b(()=>[J.authorizations.update?(d(),R(B,{key:0,text:C.$t("core::app.edit"),onClick:K=>_(J)},null,8,["text","onClick"])):O("",!0),J.authorizations.delete?(d(),R(B,{key:1,text:C.$t("core::app.delete"),onClick:K=>h(J.id)},null,8,["text","onClick"])):O("",!0)]),_:2},1024)])):O("",!0)],2)]))),128))]),_:1})]),_:1},8,["overlay","header"]),[[Y,p.value]]),p.value?O("",!0):(d(),R(U,{key:0,show:l(u),class:"m-auto max-w-5xl"},{default:b(()=>[D(o("div",vY,[D(o("h2",bY,null,512),[[Z,"mailclient.mail.account.no_accounts_configured"]]),D(o("p",hY,null,512),[[Z,"mailclient.mail.account.no_accounts_configured_info"]]),o("ul",_Y,[(d(),k(te,null,re(f,(J,K)=>o("li",{key:K,class:"flow-root"},[o("div",gY,[o("div",yY,[s(j,{icon:J.icon,class:"h-6 w-6 text-primary-600"},null,8,["icon"])]),o("div",null,[o("p",{class:"mt-1 text-sm text-neutral-600 dark:text-neutral-200",textContent:S(J.description)},null,8,xY)])])])),64))]),o("div",IY,[D((d(),k("span",kY,[s(A,{variant:"primary",class:"sm:w-justify-around w-full justify-center sm:w-auto",disabled:C.$gate.isRegularUser(),icon:"Share",text:C.$t("mailclient::mail.account.connect_shared"),onClick:g},null,8,["disabled","text"])])),[[L,C.$gate.isRegularUser()?C.$t("users::user.not_authorized"):C.$t("mailclient::mail.account.create_shared_info")]]),s(A,{variant:"primary",icon:"User",class:"sm:w-justify-around w-full justify-center sm:w-auto",text:C.$t("mailclient::mail.account.connect_personal"),onClick:y},null,8,["text"])])],512),[[Y,!l(u)]])]),_:1},8,["show"])),s(P)]),_:1})}}},wY={class:"flex w-full"},CY={class:"grow"},SY=Object.assign({name:"InboxFolderMenuItem"},{__name:"InboxMessagesFoldersMenuItem",props:{folder:{required:!0,type:Object}},setup(e){const t=e,n=Ye(),a=V(()=>n.params.account_id?{name:"inbox-messages",params:{account_id:n.params.account_id,folder_id:t.folder.id}}:null),r=V(()=>t.folder.children&&t.folder.children.length>0),i=V(()=>t.folder.id==n.params.folder_id&&t.folder.email_account_id==n.params.account_id?"active":"");return(u,c)=>{const m=v("IBadge"),p=v("InboxFolderMenuItem"),f=v("IVerticalNavigationItem");return d(),R(f,{"active-class":i.value,to:a.value,fixed:""},{title:b(()=>[o("div",wY,[o("div",CY,S(e.folder.display_name),1),e.folder.unread_count?(d(),R(m,{key:0,size:"circle",text:e.folder.unread_count},null,8,["text"])):O("",!0)])]),default:b(()=>[r.value?(d(!0),k(te,{key:0},re(e.folder.children,h=>(d(),R(p,{key:h.id,folder:h},null,8,["folder"]))),128)):O("",!0)]),_:1},8,["active-class","to"])}}}),RY={key:0},FY={__name:"InboxMessagesFoldersMenu",props:{folders:{type:Array,required:!0}},setup(e){return(t,n)=>{const a=v("IVerticalNavigation");return d(),k(te,null,[s(a,null,{default:b(()=>[(d(!0),k(te,null,re(e.folders,r=>(d(),R(SY,{key:r.id,folder:r},null,8,["folder"]))),128))]),_:1}),e.folders.length?O("",!0):(d(),k("div",RY,[(d(),k(te,null,re([1,2,3,4],r=>o("div",{key:"p-"+r,class:X(["mb-2 rounded-md bg-neutral-200 dark:bg-neutral-500",r===2||r===3?"p-3":"p-4"])},null,2)),64))]))],64)}}},VY={class:"inline-flex items-center"},TY={class:"mx-auto max-w-7xl"},DY={key:0,class:"grid grid-cols-12 gap-4"},qY={class:"col-span-12 lg:col-span-3"},EY={class:"sm:sticky sm:top-2"},AY={class:"truncate font-medium"},BY={class:"col-span-12 lg:col-span-9"},NY=["textContent"],OY=o("span",{"aria-hidden":"true"},"",-1),zY=o("span",{"aria-hidden":"true"},"",-1),MY=o("span",{"aria-hidden":"true"},"",-1),UY=o("span",{"aria-hidden":"true"},"",-1),PY={key:6,class:"h-60"},jY={class:"mx-auto mt-8 block max-w-2xl text-center"},LY={class:"mt-1 text-sm text-neutral-600 dark:text-neutral-200"},HY={class:"mt-6 space-x-6"},GY=o("span",{"aria-hidden":"true"},"",-1),KY=o("span",{"aria-hidden":"true"},"",-1),YY={__name:"InboxMessages",setup(e){const t=Ye(),n=Qe(),a=Pe(),r=q(!0),i=q(!1);ge(()=>t.query.compose,E=>{E&&$()}),yn((E,B,z)=>{E.name==="inbox"?x(p.value,E.query):z()});const u=V(()=>a.getters["emailAccounts/accounts"]),c=V(()=>a.getters["emailAccounts/hasPrimary"]),m=V(()=>u.value.length>0),p=V(()=>a.getters["emailAccounts/activeInboxAccount"]),f=V(()=>a.state.emailAccounts.syncInProgress),h=V(()=>p.value.active_folders.length>0),g=V(()=>p.value.is_sync_stopped||p.value.is_sync_disabled);function y(E){a.commit("emailAccounts/SET_INBOX_ACCOUNT",E)}function _(E){a.commit("emailAccounts/UPDATE",E)}function I(E){return a.dispatch("emailAccounts/fetch",E)}function F(E){return a.dispatch("emailAccounts/syncAccount",E)}function $(E=!0){if(i.value=E,E==!1){let B=Object.assign({},t.query);delete B.compose,n.replace({query:B})}}function C(E){y(E),x(E)}function w(E){Object.hasOwn(E.response,"account")&&a.commit("emailAccounts/UPDATE",{id:E.response.account.id,item:E.response.account}),Object.hasOwn(E.response,"unread_count")&&a.dispatch("emailAccounts/updateUnreadCountUI",E.response.unread_count)}function x(E,B={}){let z=E.active_folders[0]?E.active_folders[0].id:null;z&&n.replace({name:"inbox-messages",params:{account_id:E.id,folder_id:z},query:{...t.query,...B}})}function A(){N(!0)}async function N(E=!1){if(await I({force:E}),!m.value){n.replace({name:"email-accounts-index"});return}t.params.account_id&&t.params.folder_id?y(Number(t.params.account_id)):Object.keys(p.value).length===0&&y(u.value[0]),t.name==="inbox"&&h.value&&x(p.value)}function T(){F(p.value.id).then(E=>{_({id:E.id,item:E}),Innoclapps.$emit("user-synchronized-email-account",E)})}return N().then(()=>t.query.compose&&$()).finally(()=>r.value=!1),rt("action-executed",w),rt("email-accounts-sync-finished",A),(E,B)=>{const z=v("NavbarSeparator"),M=v("IDropdownItem"),j=v("IMinimalDropdown"),U=v("IButton"),P=v("Icon"),H=v("DropdownSelectInput"),L=v("router-link"),Z=v("IAlert"),J=v("router-view"),K=v("ILayout"),G=ae("i-tooltip"),oe=ae("t");return d(),R(K,{overlay:r.value},{actions:b(()=>[s(z,{class:"hidden lg:block"}),o("div",VY,[s(j,{type:"horizontal",placement:p.value.is_initial_sync_performed&&!g.value?"bottom":"bottom-end"},{default:b(()=>[p.value.authorizations.update?(d(),R(M,{key:0,to:{name:"edit-email-account",params:{id:p.value.id}},text:E.$t("mailclient::mail.account.edit")},null,8,["to","text"])):O("",!0),s(M,{to:{name:"email-accounts-index"},text:E.$t("mailclient::mail.account.manage")},null,8,["text"])]),_:1},8,["placement"]),p.value.is_initial_sync_performed&&!g.value?D((d(),R(U,{key:0,variant:"secondary",size:"sm",class:"ml-3 lg:ml-6",disabled:f.value,loading:f.value,icon:"Refresh",onClick:T},null,8,["disabled","loading"])),[[G,E.$t("mailclient::inbox.synchronize"),void 0,{left:!0}]]):O("",!0)])]),default:b(()=>[o("div",TY,[!r.value&&m.value?(d(),k("div",DY,[o("div",qY,[o("div",EY,[s(H,{"adaptive-width":"",items:u.value,"model-value":p.value,class:"w-full","label-key":"display_email",onChange:C},{default:b(({label:pe,toggle:ue})=>[s(U,{variant:"white",class:"justify-between py-2.5",loading:f.value,block:"",onClick:ue},{default:b(()=>[o("span",AY,S(pe),1),s(P,{icon:"ChevronDown",class:"-mr-1 ml-2 h-5 w-5 shrink-0"})]),_:2},1032,["loading","onClick"])]),_:1},8,["items","model-value"]),s(U,{variant:"primary",class:"my-3",block:"",icon:"Mail",disabled:!p.value.can_send_mails,text:E.$t("mailclient::mail.compose"),onClick:B[0]||(B[0]=pe=>$(!0))},null,8,["disabled","text"]),s(FY,{folders:p.value&&p.value.active_folders_tree},null,8,["folders"])])]),o("div",BY,[g.value?(d(),R(Z,{key:0,class:"mb-4 border border-warning-200",variant:"warning"},{default:b(()=>[o("p",{textContent:S(p.value.sync_state_comment)},null,8,NY),s(L,{to:{name:"email-accounts-index"},class:"font-medium text-warning-700 hover:text-warning-600"},{default:b(()=>[Q(S(E.$t("mailclient::mail.account.manage"))+" ",1),OY]),_:1})]),_:1})):O("",!0),!c.value&&u.value.length>1?(d(),R(Z,{key:1,class:"mb-4 border border-warning-200",variant:"warning"},{default:b(()=>[D(o("p",null,null,512),[[oe,"mailclient::mail.account.missing_primary_account"]]),s(L,{to:{name:"email-accounts-index"},class:"font-medium text-warning-700 hover:text-warning-600"},{default:b(()=>[Q(S(E.$t("mailclient::mail.account.manage"))+" ",1),zY]),_:1})]),_:1})):O("",!0),!p.value.sent_folder_id||!p.value.sent_folder?(d(),R(Z,{key:2,class:"mb-4 border border-warning-200",variant:"warning"},{default:b(()=>[D(o("p",null,null,512),[[oe,"mailclient::mail.account.missing_sent_folder"]]),s(L,{to:{name:"edit-email-account",params:{id:p.value.id}},class:"font-medium text-warning-700 hover:text-warning-600"},{default:b(()=>[Q(S(E.$t("mailclient::mail.account.edit"))+" ",1),MY]),_:1},8,["to"])]),_:1})):O("",!0),!p.value.trash_folder_id||!p.value.trash_folder?(d(),R(Z,{key:3,class:"mb-4 border border-warning-200",variant:"warning"},{default:b(()=>[D(o("p",null,null,512),[[oe,"mailclient::mail.account.missing_trash_folder"]]),s(L,{to:{name:"edit-email-account",params:{id:p.value.id}},class:"font-medium text-warning-700 hover:text-warning-600"},{default:b(()=>[Q(S(E.$t("mailclient::mail.account.edit"))+" ",1),UY]),_:1},8,["to"])]),_:1})):O("",!0),p.value.is_initial_sync_performed?O("",!0):(d(),R(Z,{key:4,class:"mb-4 border border-info-200"},{default:b(()=>[Q(S(E.$t("mailclient::mail.initial_sync_info")),1)]),_:1})),s(J,{name:"message",account:p.value},null,8,["account"]),h.value?(d(),R(J,{key:5,ref:"messages",name:"messages",account:p.value},null,8,["account"])):(d(),k("div",PY,[o("div",jY,[s(P,{icon:"Folder",class:"mx-auto h-12 w-12 text-neutral-400"}),D(o("p",LY,null,512),[[oe,"mailclient.mail.account.no_active_folders"]]),o("div",HY,[p.value.authorizations.update?(d(),R(L,{key:0,class:"link text-sm",to:{name:"edit-email-account",params:{id:p.value.id}}},{default:b(()=>[Q(S(E.$t("mailclient::mail.account.activate_folders"))+" ",1),GY]),_:1},8,["to"])):O("",!0),s(L,{to:{name:"email-accounts-index"},class:"link text-sm"},{default:b(()=>[Q(S(E.$t("mailclient::mail.account.manage"))+" ",1),KY]),_:1})])])]))])])):O("",!0)]),s(ll,{visible:i.value,"default-account":p.value,onModalHidden:B[1]||(B[1]=pe=>$(!1))},null,8,["visible","default-account"])]),_:1},8,["overlay"])}}},WY={class:"font-sans text-sm leading-[initial] dark:text-white"},QY={__name:"MessagePreview",props:{visibleText:null,hiddenText:null},setup(e){return(t,n)=>n[0]||(he(-1),n[0]=o("div",{class:"mail-text all-revert"},[o("div",WY,[s(ea,{html:e.visibleText},null,8,["html"]),s(pr,{text:e.hiddenText},null,8,["text"])])]),he(1),n[0])}},XY={class:"sticky top-2 z-auto"},ZY={class:"mr-3 grow"},JY=["textContent"],eW={class:"mt-2 shrink-0 self-start sm:mt-0"},tW={key:0,class:"flex items-center space-x-3"},nW={key:0,class:"flex"},oW={class:"mr-2"},lW={class:"grow"},aW={class:"mt-2 text-sm text-neutral-800 dark:text-neutral-100"},sW={class:"mr-1 font-semibold"},rW={class:"space-x-1 self-start"},iW=o("span",{class:"mr-2 h-1 w-1 rounded-full bg-info-500"},null,-1),uW={class:"mr-1"},dW={key:0,class:"mb-3 mt-5"},cW={class:"mb-2 text-sm font-medium leading-6 text-neutral-900 dark:text-neutral-100"},mW={__name:"InboxMessage",props:{account:{required:!0,type:Object}},setup(e){const t=e,n=Innoclapps.resourceName("emails"),{t:a}=ve(),r=Ye(),i=Qe(),u=Pe(),c=Ut(),{localizedDateTime:m}=Ne(),{setLoading:p,isLoading:f}=Ct(),{syncAssociations:h,associationsBeingSaved:g}=Je(n),y=q({}),_=q(!1),I=q(!1),F=q(!1),$=q(!1),C=q(!1),w=q(!1),x=q(!1),A=q([]),N=dt([]),T=q({});let E=null;const B=V(()=>Object.keys(y.value).length>0),z=V(()=>y.value.cc&&y.value.cc.length>0),M=V(()=>({folder_id:r.params.folder_id,account_id:r.params.account_id})),j=V(()=>B.value&&!y.value.is_draft),U=V(()=>y.value.subject?y.value.subject:a("mailclient::inbox.no_subject")),P=V(()=>B.value&&y.value.media.length>0),H=V(()=>`/inbox/emails/folders/${r.params.folder_id}/${r.params.id}`),L=V(()=>u.getters.getMenuItem("inbox").badge);async function Z(){let{data:Se}=await Innoclapps.request().get("contacts/search",{params:{q:y.value.from.address,search_fields:"email:="}});N.value=Se,F.value=!0}async function J(){A.value=await G(),_.value=!0}function K(){I.value=!0,T.value.email=y.value.from.address,y.value.from.name&&(T.value["first-name"]=y.value.from.name.split(" ")[0],T.value["last-name"]=y.value.from.name.split(" ")[1]||null)}async function G(){let{data:Se}=await Innoclapps.request().get("contacts/search",{params:{q:y.value.from.address,search_fields:"email:="}});return Se}function oe(){ee(!1),W(!1)}function pe(Se){Se.uriKey==="email-account-message-move"?(ue(Se.response.moved_to_folder_id),ce()):Se.uriKey==="email-account-message-delete"?Number(r.params.folder_id)===Number(t.account.trash_folder.id)?i.replace({name:"inbox"}):(ue(t.account.trash_folder.id),ce()):ce()}function ue(Se){i.replace({name:"inbox-message",params:{account_id:t.account.id,folder_id:Se,id:y.value.id}})}function ee(Se=!0){$.value=Se,w.value=!1}function W(Se=!0){C.value=Se}function ne(){$.value=!0,w.value=!0}function ce(){return fe(!1)}async function fe(Se=!0){p(Se);let{data:Ie}=await Innoclapps.request().get(H.value,{params:{account_id:t.account.id,folder_id:r.params.folder_id}});y.value=Ie,u.commit("emailAccounts/UPDATE",{id:t.account.id,item:{...t.account,active_folders_tree:Ie.account_active_folders_tree}}),Ie.was_unread===!0&&u.dispatch("emailAccounts/updateUnreadCountUI",L.value===0?0:L.value-1),c.value=U.value,p(!1)}return fe(),De(()=>{E=new IntersectionObserver(Se=>{x.value=Se[0].isIntersecting},{root:document.getElementById("main"),threshold:1}),E.observe(document.getElementById("messageInfo"))}),bt(()=>{E&&(E.unobserve(document.getElementById("messageInfo")),E=null)}),(Se,Ie)=>{const Ce=v("IButton"),le=v("IDropdownItem"),ye=v("IMinimalDropdown"),Ge=v("IAvatar"),be=v("IBadge"),Ve=v("Icon"),$e=v("ICard"),et=v("CreateDealModal"),Te=v("CreateContactModal"),tt=v("CreateActivityModal"),at=ae("t");return d(),k(te,null,[o("div",{class:X({"sticky top-0 bg-opacity-75 p-2 backdrop-blur-lg backdrop-filter dark:bg-neutral-500/80":!x.value})},null,2),o("div",XY,[o("div",{class:X([x.value?"rounded-t-lg bg-white dark:bg-neutral-900":"border-t border-neutral-200 bg-neutral-100 dark:border-neutral-800 dark:bg-neutral-900","overflow-hidden shadow"])},[o("div",{class:X([{"pointer-events-none blur":l(f)},"flex flex-col border-b border-neutral-200 px-4 py-5 dark:border-neutral-800 sm:flex-row sm:items-center sm:p-5"])},[o("div",ZY,[o("h5",{class:"text-lg/6 font-semibold text-neutral-800 dark:text-white",textContent:S(U.value)},null,8,JY),s(vn,{class:"inline-flex",placement:"bottom-start","model-value":y.value.associations,disabled:l(g),associateables:y.value.associations,onChange:Ie[0]||(Ie[0]=lt=>l(h)(y.value.id,lt))},null,8,["model-value","disabled","associateables"])]),o("div",eW,[B.value?(d(),k("div",tW,[D(o("div",null,[s(Qn,{type:"dropdown",ids:y.value.id,actions:y.value.actions,"action-request-params":M.value,"resource-name":l(n),onRun:pe},null,8,["ids","actions","action-request-params","resource-name"])],512),[[Y,!e.account.is_sync_stopped]]),j.value?(d(),R(Ce,{key:0,variant:"white",size:"sm",disabled:e.account.is_sync_stopped,icon:"Reply",text:Se.$t("mailclient::inbox.reply"),onClick:Ie[1]||(Ie[1]=lt=>ee(!0))},null,8,["disabled","text"])):O("",!0),j.value&&z.value?(d(),R(Ce,{key:1,variant:"white",size:"sm",disabled:e.account.is_sync_stopped,icon:"Reply",text:Se.$t("mailclient::inbox.reply_all"),onClick:Ie[2]||(Ie[2]=lt=>ne())},null,8,["disabled","text"])):O("",!0),j.value?(d(),R(Ce,{key:2,variant:"white",size:"sm",icon:"Share",disabled:e.account.is_sync_stopped,text:Se.$t("mailclient::inbox.forward"),onClick:Ie[3]||(Ie[3]=lt=>W(!0))},null,8,["disabled","text"])):O("",!0),s(ye,{type:"horizontal"},{default:b(()=>[s(le,{icon:"Users",text:Se.$t("contacts::contact.convert"),onClick:K},null,8,["text"]),s(le,{icon:"Banknotes",text:Se.$t("deals::deal.create"),onClick:J},null,8,["text"]),s(le,{icon:"Calendar",text:Se.$t("activities::activity.create"),onClick:Z},null,8,["text"])]),_:1})])):O("",!0)])],2)],2)]),s($e,{id:"messageInfo",class:"mb-3 rounded-b-md",rounded:!1,overlay:l(f)},{default:b(()=>[B.value?(d(),k("div",nW,[o("div",oW,[Ie[4]||(he(-1),Ie[4]=s(Ge,{src:y.value.avatar_url},null,8,["src"]),he(1),Ie[4])]),o("div",lW,[Ie[5]||(he(-1),Ie[5]=s(Yt,{label:Se.$t("mailclient::inbox.from"),recipients:y.value.from},null,8,["label","recipients"]),he(1),Ie[5]),Ie[6]||(he(-1),Ie[6]=s(Yt,{label:Se.$t("mailclient::inbox.reply_to"),recipients:y.value.reply_to,"show-when-empty":!1},null,8,["label","recipients"]),he(1),Ie[6]),s(Yt,{label:Se.$t("mailclient::inbox.to"),recipients:y.value.to},null,8,["label","recipients"]),Ie[7]||(he(-1),Ie[7]=s(Yt,{label:Se.$t("mailclient::inbox.cc"),recipients:y.value.cc,"show-when-empty":!1},null,8,["label","recipients"]),he(1),Ie[7]),Ie[8]||(he(-1),Ie[8]=s(Yt,{label:Se.$t("mailclient::inbox.bcc"),recipients:y.value.bcc,"show-when-empty":!1},null,8,["label","recipients"]),he(1),Ie[8]),o("p",aW,[D(o("span",sW,null,512),[[at,"mailclient::inbox.date"]]),Ie[9]||(he(-1),Ie[9]=o("span",{class:"text-neutral-700 dark:text-neutral-300",textContent:S(l(m)(y.value.date))},null,8,["textContent"]),he(1),Ie[9])])]),o("div",rW,[(d(!0),k(te,null,re(y.value.folders,lt=>(d(),R(be,{key:lt.id},{default:b(()=>[iW,Q(" "+S(lt.display_name),1)]),_:2},1024))),128))]),Ie[10]||(he(-1),Ie[10]=y.value.opened_at?(d(),R(be,{key:0,variant:"success","wrapper-class":"flex self-start ml-1"},{default:b(()=>[s(Ve,{icon:"Eye",class:"mr-1 h-5 w-5"}),o("span",uW," ("+S(y.value.opens)+") - ",1),Q(" "+S(l(m)(y.value.opened_at)),1)]),_:1})):O("",!0),he(1),Ie[10])])):O("",!0)]),_:1},8,["overlay"]),s($e,{class:"mb-3",overlay:l(f)},{default:b(()=>[l(f)?O("",!0):(d(),R(QY,{key:0,"visible-text":y.value.visible_text,"hidden-text":y.value.hidden_text},null,8,["visible-text","hidden-text"]))]),_:1},8,["overlay"]),P.value?(d(),k("div",dW,[D(o("dd",cW,null,512),[[at,"mailclient.mail.attachments"]]),s(mr,{attachments:y.value.media},null,8,["attachments"])])):O("",!0),j.value?(d(),R(_r,{key:1,message:y.value,visible:$.value||C.value,"to-all":w.value,forward:C.value,onModalHidden:oe},null,8,["message","visible","to-all","forward"])):O("",!0),s(et,{visible:_.value,"onUpdate:visible":Ie[11]||(Ie[11]=lt=>_.value=lt),associations:{emails:[y.value.id]},contacts:A.value,name:y.value.subject,onCreated:Ie[12]||(Ie[12]=lt=>(fe(),_.value=!1))},null,8,["visible","associations","contacts","name"]),s(Te,Re({visible:I.value,"onUpdate:visible":Ie[13]||(Ie[13]=lt=>I.value=lt),associations:{emails:[y.value.id]}},T.value,{onModalHidden:Ie[14]||(Ie[14]=lt=>T.value={}),onCreated:Ie[15]||(Ie[15]=lt=>(fe(),I.value=!1))}),null,16,["visible","associations"]),F.value?(d(),R(tt,{key:2,contacts:N.value,title:Se.$t("activities::activity.title_via_create_message",{subject:y.value.subject}),message:y.value,onCreated:Ie[16]||(Ie[16]=lt=>(fe(),F.value=!1)),onModalHidden:Ie[17]||(Ie[17]=lt=>F.value=!1)},null,8,["contacts","title","message"])):O("",!0)],64)}}},$r={__name:"InboxMessageSubject",props:["subject","messageId","accountId"],setup(e){const t=Ye(),n=q(t.params.folder_id);return(a,r)=>{const i=v("router-link");return d(),R(i,{class:"text-neutral-900 hover:text-neutral-600 dark:text-neutral-100 dark:hover:text-neutral-300",to:{name:"inbox-message",params:{account_id:e.accountId,folder_id:n.value,id:e.messageId}}},{default:b(()=>[Q(S(e.subject?e.subject:"("+a.$t("mailclient::inbox.no_subject")+")"),1)]),_:1},8,["to"])}}};const pW=["textContent"],fW={__name:"InboxMessagesTableIncoming",props:{tableId:{required:!0,type:String},dataRequestQueryString:{type:Object,required:!0},actionRequestParams:{type:Object,required:!0},isSyncStopped:Boolean,accountId:{type:Number,required:!0}},setup(e,{expose:t}){const n=Innoclapps.resourceName("emails"),{localizedDateTime:a}=Ne(),r=q(null);function i(u){return u.is_read?"read":"unread"}return t({tableRef:r}),(u,c)=>(d(),k("div",{class:X({"sync-stopped-by-system":e.isSyncStopped})},[s(l(tn),{ref_key:"tableRef",ref:r,"resource-name":l(n),"table-id":e.tableId,"row-class":i,"action-request-params":e.actionRequestParams,"data-request-query-string":e.dataRequestQueryString},{subject:b(({row:m})=>[s($r,{subject:m.subject,"message-id":m.id,"account-id":e.accountId},null,8,["subject","message-id","account-id"])]),from:b(({row:m})=>[m.from?(d(),R(da,{key:0,recipient:m.from},null,8,["recipient"])):(d(),k("p",{key:1,textContent:S("("+u.$t("mailclient::inbox.unknown_address")+")")},null,8,pW))]),date:b(({row:m})=>[Q(S(l(a)(m.date)),1)]),_:1},8,["resource-name","table-id","action-request-params","data-request-query-string"])],2))}};const vW=["textContent"],bW={__name:"InboxMessagesTableOutgoing",props:{tableId:{required:!0,type:String},dataRequestQueryString:{type:Object,required:!0},actionRequestParams:{type:Object,required:!0},accountId:{type:Number,required:!0},isSyncStopped:Boolean},setup(e,{expose:t}){const n=Innoclapps.resourceName("emails"),{localizedDateTime:a}=Ne(),r=q(null);function i(u){return u.is_read?"read":"unread"}return t({tableRef:r}),(u,c)=>(d(),k("div",{class:X({"sync-stopped-by-system":e.isSyncStopped})},[s(l(tn),{ref_key:"tableRef",ref:r,"resource-name":l(n),"table-id":e.tableId,"row-class":i,"action-request-params":e.actionRequestParams,"data-request-query-string":e.dataRequestQueryString},{subject:b(({row:m})=>[s($r,{subject:m.subject,"message-id":m.id,"account-id":e.accountId},null,8,["subject","message-id","account-id"])]),to:b(({row:m})=>[(d(!0),k(te,null,re(m.to,(p,f)=>(d(),R(da,{key:f,recipient:p},null,8,["recipient"]))),128)),!m.to||m.to.length===0?(d(),k("span",{key:0,textContent:S("("+u.$t("mailclient::inbox.unknown_address")+")")},null,8,vW)):O("",!0)]),date:b(({row:m})=>[Q(S(l(a)(m.date)),1)]),_:1},8,["resource-name","table-id","action-request-params","data-request-query-string"])],2))}};const hW={__name:"InboxMessagesTable",props:{account:{type:Object,required:!0}},setup(e){const t=e,n=Ye(),{reloadTable:a}=Bt(),r=Ut(),i=q(null),u=q(null),c=q({}),m=q(null),p=V(()=>({folder_id:i.value,account_id:u.value})),f=V(()=>({account_id:u.value,folder_id:i.value,folder_type:h.value})),h=V(()=>y.value?"outgoing":_.value?"incoming":Innoclapps.config("mail.folders.other")),g=V(()=>h.value==="incoming"||h.value===Innoclapps.config("mail.folders.other")?"messages-incoming":"messages-outgoing"),y=V(()=>Innoclapps.config("mail.folders.outgoing").indexOf(c.value.type)>-1?!0:I("outgoing")),_=V(()=>Innoclapps.config("mail.folders.incoming").indexOf(c.value.type)>-1?!0:I("incoming"));function I(C,w){let x=w||c.value;if(!x.parent_id)return!1;let A=Ee(t.account.folders,["id",Number(x.parent_id)]);return Innoclapps.config(`mail.folders.${C}`).indexOf(A.type)>-1?!0:A.parent_id?I(C,A):!1}function F(){a(g.value)}function $(){y.value&&F()}return ge(()=>n.params,(C,w)=>{const x=C.account_id&&C.folder_id&&!C.id;u.value=C.account_id,i.value=C.folder_id,(!w||w&&w.folder_id!=C.folder_id)&&(c.value=Ee(t.account.folders,A=>Number(A.id)===Number(C.folder_id))),x&&Fe(()=>r.value=`${c.value.display_name} - ${t.account.display_email}`),x&&w&&Number(C.account_id)!==Number(w.account_id)&&(m.value.tableRef.setPage(1),Fe(()=>{m.value.tableRef.refetchActions()}))},{immediate:!0}),rt("user-synchronized-email-account",F),rt("email-accounts-sync-finished",F),rt("email-sent",$),(C,w)=>(d(),R(We(g.value==="messages-incoming"?fW:bW),{ref_key:"tableComponentRef",ref:m,"table-id":g.value,"account-id":e.account.id,"is-sync-stopped":e.account.is_sync_stopped,"data-request-query-string":f.value,"action-request-params":p.value},null,8,["table-id","account-id","is-sync-stopped","data-request-query-string","action-request-params"]))}},_W=[{path:"/inbox",name:"inbox",component:YY,meta:{title:qe.t("mailclient::inbox.inbox")},children:[{path:":account_id/folder/:folder_id/messages",components:{messages:hW},name:"inbox-messages",meta:{title:qe.t("mailclient::inbox.inbox")}},{path:":account_id/folder/:folder_id/messages/:id",components:{message:mW},name:"inbox-message",meta:{scrollToTop:!1}}]},{path:"/mail/accounts",name:"email-accounts-index",component:$Y,meta:{title:qe.t("mailclient::mail.account.accounts")},children:[{path:"create",name:"create-email-account",component:JK,meta:{title:qe.t("mailclient::mail.account.create")}},{path:":id/edit",name:"edit-email-account",component:eY}]}];window.Innoclapps&&Innoclapps.booting((e,t,n)=>{e.component("RecordTabTimelineEmail",OG),e.component("FormMailEditorField",uK),e.component("DetailEmailSendableField",iK),e.component("IndexEmailSendableField",dK),e.component("EmailsTab",vK),e.component("EmailsTabPanel",CK),n.registerModule("emailAccounts",fK),_W.forEach(a=>t.addRoute(a)),gW(window.Innoclapps,n)});function gW(e,t){Fs("inbox",".Modules\\MailClient\\Events\\EmailAccountsSyncFinished",n=>{e.$emit("email-accounts-sync-finished",n),e.request().get("mail/accounts/unread").then(({data:a})=>t.dispatch("emailAccounts/updateUnreadCountUI",a))})}const yW={__name:"RecordTabNote",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object}},setup(e){return(t,n)=>{const a=v("ITab");return St([e.resource.notes_count],()=>s(a,{badge:e.resource.notes_count,"badge-variant":"neutral",title:t.$t("notes::note.notes"),icon:"PencilAlt"},null,8,["badge","title"]),n,0)}}},xW={class:"flex flex-col sm:flex-row sm:items-center"},IW={class:"mt-2 space-y-2 sm:mt-0 sm:space-x-2 sm:space-y-0"},kW={__name:"NotesCreate",props:{viaResource:{required:!0,type:String},viaResourceId:{required:!0,type:[String,Number]},relatedResourceDisplayName:{required:!0,type:String}},emits:["cancel"],setup(e){const t=e,n=Me("synchronizeResource"),a=Me("incrementResourceCount"),{t:r}=ve(),{createFollowUpActivity:i}=xo(),{createResource:u}=Je(Innoclapps.resourceName("notes")),{form:c}=Ae({body:"",task_date:null}),m=q(null);async function p(h){if(c.task_date){let g=await i(c.task_date,t.viaResource,t.viaResourceId,t.relatedResourceDisplayName,{note:r("notes::note.follow_up_task_body",{content:h.body})});m.value.reset(),g&&(n({activities:[g]}),a("incomplete_activities_for_user_count"))}n({notes:[h]}),a("notes_count"),Innoclapps.success(r("notes::note.created")),c.reset()}function f(){u(c.set(t.viaResource,[t.viaResourceId]).withQueryString({via_resource:t.viaResource,via_resource_id:t.viaResourceId})).then(p)}return(h,g)=>{const y=v("Editor"),_=v("IFormError"),I=v("IButton"),F=v("ICard");return d(),R(F,{tag:"form",method:"POST",onSubmit:ie(f,["prevent"])},{footer:b(()=>[o("div",xW,[s(Zn,{ref_key:"createFollowUpTaskRef",ref:m,modelValue:l(c).task_date,"onUpdate:modelValue":g[3]||(g[3]=$=>l(c).task_date=$),class:"grow"},null,8,["modelValue"]),o("div",IW,[s(I,{class:"w-full sm:w-auto",variant:"white",size:"sm",text:h.$t("core::app.cancel"),onClick:g[4]||(g[4]=$=>h.$emit("cancel"))},null,8,["text"]),s(I,{class:"w-full sm:w-auto",size:"sm",text:h.$t("notes::note.add"),disabled:l(c).busy,onClick:f},null,8,["text","disabled"])])])]),default:b(()=>[s(y,{ref:"editorRef",modelValue:l(c).body,"onUpdate:modelValue":g[0]||(g[0]=$=>l(c).body=$),placeholder:h.$t("notes::note.write"),"with-mention":!0,onInit:g[1]||(g[1]=()=>h.$refs.editorRef.focus()),onInput:g[2]||(g[2]=$=>l(c).errors.clear("body"))},null,8,["modelValue","placeholder"]),s(_,{textContent:S(l(c).getError("body"))},null,8,["textContent"])]),_:1},8,["onSubmit"])}}},$W={class:"flex justify-end space-x-2"},wW={__name:"NotesEdit",props:{noteId:{required:!0,type:Number},body:{required:!0,type:String},viaResource:{required:!0,type:String},viaResourceId:{required:!0,type:[String,Number]}},emits:["updated","cancelled"],setup(e,{emit:t}){const n=e,a=Me("synchronizeResource"),{t:r}=ve(),{updateResource:i}=Je(Innoclapps.resourceName("notes")),{form:u}=Ae({body:n.body});async function c(){let m=await i(u.withQueryString({via_resource:n.viaResource,via_resource_id:n.viaResourceId}),n.noteId);a({notes:m}),t("updated",m),Innoclapps.success(r("notes::note.updated"))}return(m,p)=>{const f=v("Editor"),h=v("IFormError"),g=v("IButton"),y=v("ICard");return d(),R(y,null,{footer:b(()=>[o("div",$W,[s(g,{variant:"white",size:"sm",text:m.$t("core::app.cancel"),onClick:p[2]||(p[2]=_=>m.$emit("cancelled"))},null,8,["text"]),s(g,{variant:"primary",size:"sm",text:m.$t("core::app.save"),disabled:l(u).busy,onClick:c},null,8,["text","disabled"])])]),default:b(()=>[s(f,{modelValue:l(u).body,"onUpdate:modelValue":p[0]||(p[0]=_=>l(u).body=_),"with-mention":!0,onInput:p[1]||(p[1]=_=>l(u).errors.clear("body"))},null,8,["modelValue"]),s(h,{textContent:S(l(u).getError("body"))},null,8,["textContent"])]),_:1})}}},CW={class:"flex space-x-1.5"},SW={class:"font-medium"},RW=["textContent"],FW=["innerHTML"],wr=Object.assign({inheritAttrs:!1},{__name:"NotesView",props:{noteId:{required:!0,type:Number},commentsCount:{required:!0,type:Number},createdAt:{required:!0,type:String},body:{required:!0,type:String},userId:{required:!0,type:Number},authorizations:{required:!0,type:Object},comments:{required:!0,type:Array},viaResource:{required:!0,type:String},viaResourceId:{required:!0,type:[String,Number]},collapsable:Boolean},setup(e){const t=e,n=Innoclapps.resourceName("notes"),a=Me("synchronizeResource"),r=Me("decrementResourceCount"),{t:i}=ve(),{localizedDateTime:u}=Ne(),{findUserById:c}=Le(),{deleteResource:m}=Je(n),{commentsAreVisible:p}=ln(t.noteId,"notes"),f=V(()=>c(t.userId)),h=q(!1),g=q(!1),y=q(!0);async function _(F){await Innoclapps.dialog().confirm(),await m(F),a({notes:{id:F,_delete:!0}}),r("notes_count"),Innoclapps.success(i("notes::note.deleted"))}function I(F){F.type=="dblclick"&&h.value||t.authorizations.update&&(h.value=!h.value)}return(F,$)=>{const C=v("Icon"),w=v("IAvatar"),x=v("i18n-t"),A=v("IDropdownItem"),N=v("IMinimalDropdown"),T=v("TextCollapse"),E=v("CommentsCollapse"),B=v("CommentsAdd"),z=v("ICard");return d(),k(te,null,[D(s(z,Re(F.$attrs,{condensed:"",class:"note-"+e.noteId,"footer-class":"inline-flex flex-col w-full"}),{header:b(()=>[o("div",CW,[g.value?(d(),k("a",{key:0,href:"#",class:"mr-2 mt-0.5 text-neutral-500 dark:text-neutral-300",onClick:$[0]||($[0]=M=>y.value=!y.value)},[s(C,{icon:y.value?"ChevronRight":"ChevronDown",class:"h-4 w-4"},null,8,["icon"])])):O("",!0),$[1]||(he(-1),$[1]=s(w,{size:"xs",src:f.value.avatar_url},null,8,["src"]),he(1),$[1]),$[2]||(he(-1),$[2]=o("div",{class:"flex grow items-center"},[s(x,{scope:"global",keypath:"notes::note.info_created",tag:"span",class:"text-sm text-neutral-700 dark:text-white"},{user:b(()=>[o("span",SW,S(f.value.name),1)]),date:b(()=>[o("span",{class:"font-medium",textContent:S(l(u)(e.createdAt))},null,8,RW)]),_:1})]),he(1),$[2]),e.authorizations.update&&e.authorizations.delete?(d(),R(N,{key:1,class:"ml-2 self-start md:ml-5"},{default:b(()=>[D(s(A,{text:F.$t("core::app.edit"),onClick:I},null,8,["text"]),[[Y,e.authorizations.update]]),D(s(A,{text:F.$t("core::app.delete"),onClick:$[3]||($[3]=M=>_(e.noteId))},null,8,["text"]),[[Y,e.authorizations.delete]])]),_:1})):O("",!0)])]),footer:b(()=>[s(B,{class:"self-end","via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"commentable-id":e.noteId,"commentable-type":"notes",onCreated:$[10]||($[10]=M=>(p.value=!0,l(a)({notes:{id:e.noteId,comments:[M]}})))},null,8,["via-resource","via-resource-id","commentable-id"])]),default:b(()=>[e.collapsable?(d(),R(T,{key:0,collapsed:y.value,"onUpdate:collapsed":$[4]||($[4]=M=>y.value=M),text:e.body,length:250,class:"wysiwyg-text",onHasTextToCollapse:$[5]||($[5]=M=>g.value=M),onDblclick:I},null,8,["collapsed","text"])):(d(),k("div",{key:1,class:"wysiwyg-text",onDblclick:I,innerHTML:e.body},null,40,FW)),s(E,{class:"mt-6","via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"commentable-id":e.noteId,"commentable-type":"notes",count:e.commentsCount,comments:e.comments,onUpdated:$[6]||($[6]=M=>l(a)({notes:{id:e.noteId,comments:M}})),onDeleted:$[7]||($[7]=M=>l(a)({notes:{id:e.noteId,comments:{id:M,_delete:!0}}})),"onUpdate:comments":$[8]||($[8]=M=>l(a)({notes:{id:e.noteId,comments:M}})),"onUpdate:count":$[9]||($[9]=M=>l(a)({notes:{id:e.noteId,comments_count:M}}))},null,8,["via-resource","via-resource-id","commentable-id","count","comments"])]),_:1},16,["class"]),[[Y,!h.value]]),h.value?(d(),R(wW,{key:0,"via-resource":e.viaResource,"via-resource-id":e.viaResourceId,"note-id":e.noteId,body:e.body,onCancelled:$[11]||($[11]=M=>h.value=!1),onUpdated:$[12]||($[12]=M=>h.value=!1)},null,8,["via-resource","via-resource-id","note-id","body"])):O("",!0)],64)}}}),VW={class:"-mt-[20px] mb-3 overflow-hidden rounded-b-md border border-neutral-200 bg-white dark:border-neutral-700 dark:bg-neutral-900 sm:mb-7"},TW={class:"px-4 py-5 sm:p-6"},DW={class:"sm:flex sm:items-start sm:justify-between"},qW={class:"text-base/6 font-medium text-neutral-900 dark:text-white"},EW={class:"mt-2 max-w-xl text-sm text-neutral-500 dark:text-neutral-200"},AW={class:"mt-5 sm:ml-6 sm:mt-0 sm:flex sm:shrink-0 sm:items-center"},BW={class:"space-y-4"},NW={class:"mt-6 text-center text-neutral-800 dark:text-neutral-200"},hl="notes",OW={__name:"RecordTabNotePanel",props:{resourceName:{required:!0,type:String},resourceId:{required:!0,type:[String,Number]},resource:{required:!0,type:Object},scrollElement:{type:String}},setup(e){const t=e,n=Me("synchronizeResource"),a=Ye(),r=q(null),i=q(!1),{commentsAreVisible:u}=ln(a.query.resourceId,hl),{dataLoadedFirstTime:c,focusToAssociateableElement:m,searchResults:p,isSearching:f,hasSearchResults:h,performSearch:g,search:y,loadData:_,infiniteHandler:I}=Xn({resourceName:t.resourceName,resource:xe(t,"resource"),scrollElement:t.scrollElement,infinityRef:r,synchronizeResource:n,timelineRelation:hl}),F=V(()=>ot(p.value||t.resource.notes,"created_at","desc")),$=V(()=>F.value.length>0);return a.query.resourceId&&a.query.section===hl&&An(c,()=>{m(a.query.resourceId,"note").then(()=>{a.query.comment_id&&(u.value=!0)})}),(C,w)=>{const x=v("IButton"),A=v("SearchInput"),N=v("ITabPanel"),T=ae("t");return d(),R(N,{lazy:!l(c),onActivatedOnce:l(_)},{default:b(()=>[o("div",VW,[D(o("div",TW,[o("div",DW,[o("div",null,[D(o("h3",qW,null,512),[[T,"notes::note.manage_notes"]]),o("div",EW,[D(o("p",null,null,512),[[T,"notes::note.info"]])])]),o("div",AW,[s(x,{size:"sm",icon:"Plus",text:C.$t("notes::note.add"),onClick:w[0]||(w[0]=E=>i.value=!0)},null,8,["text"])])]),D(s(A,{modelValue:l(y),"onUpdate:modelValue":w[1]||(w[1]=E=>xt(y)?y.value=E:null),class:"mt-2",onInput:l(g)},null,8,["modelValue","onInput"]),[[Y,$.value||l(y)]])],512),[[Y,!i.value]]),i.value?(d(),R(kW,{key:0,shadow:!1,ring:!1,rounded:!1,"via-resource":e.resourceName,"via-resource-id":e.resourceId,"related-resource-display-name":e.resource.display_name,onCancel:w[2]||(w[2]=E=>i.value=!1)},null,8,["via-resource","via-resource-id","related-resource-display-name"])):O("",!0)]),o("div",BW,[(d(!0),k(te,null,re(F.value,(E,B,z,M)=>{const j=[E.updated_at,E.comments_count];if(M&&M.key===E.id&&Tl(M,j))return M;const U=(d(),k("div",{key:E.id},[s(wr,{"note-id":E.id,"comments-count":E.comments_count,"created-at":E.created_at,body:E.body,"user-id":E.user_id,authorizations:E.authorizations,comments:E.comments||[],"via-resource":e.resourceName,"via-resource-id":e.resourceId},null,8,["note-id","comments-count","created-at","body","user-id","authorizations","comments","via-resource","via-resource-id"])]));return U.memo=j,U},w,3),128))]),D(o("div",NW,null,512),[[Y,l(f)&&!l(h)],[T,"core::app.no_search_results"]]),s(xn,{ref_key:"infinityRef",ref:r,"scroll-element":e.scrollElement,onHandle:w[5]||(w[5]=E=>l(I)(E))},null,8,["scroll-element"])]),_:1},8,["lazy","onActivatedOnce"])}}},zW={class:"mt-3"},MW={__name:"RecordTabTimelineNote",props:Pt,setup(e){return(t,n)=>(d(),R(jt,{"resource-name":t.resourceName,"resource-id":t.resourceId,"created-at":t.log.created_at,"is-pinned":t.log.is_pinned||!1,"timelineable-id":t.log.id,"timeline-relationship":t.log.timeline_relation,"timeline-subject-key":t.resource.timeline_subject_key,"timelineable-key":t.log.timeline_key,icon:"PencilAlt",heading:t.$t("notes::note.timeline.heading"),"heading-class":"font-medium"},{default:b(()=>[o("div",zW,[s(wr,{"note-id":t.log.id,"comments-count":t.log.comments_count,"created-at":t.log.created_at,body:t.log.body,"user-id":t.log.user_id,authorizations:t.log.authorizations,comments:t.log.comments||[],"via-resource":t.resourceName,"via-resource-id":t.resourceId,collapsable:""},null,8,["note-id","comments-count","created-at","body","user-id","authorizations","comments","via-resource","via-resource-id"])])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key","heading"]))}};window.Innoclapps&&Innoclapps.booting(e=>{e.component("NotesTab",yW),e.component("NotesTabPanel",OW),e.component("RecordTabTimelineNote",MW)});const UW={class:"flex items-center space-x-3"},PW={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},jW={class:"hover:bg-neutral-100 dark:hover:bg-neutral-700/60"},LW={class:"flex items-center"},HW={class:"grow"},GW=["onClick","textContent"],KW={class:"ml-2 py-2 pr-7"},YW=["onSubmit"],WW=o("th",{class:"text-left",width:"15%"},"Key",-1),QW=o("th",{class:"text-left",width:"30%"},"Source",-1),XW={class:"text-left",width:"55%"},ZW=["textContent"],JW=["textContent"],eQ={width:"55%"},tQ={class:"-mt-px flex items-center justify-end space-x-3 bg-neutral-50 px-6 py-3 dark:bg-neutral-700"},nQ={class:"divide-y divide-neutral-200 dark:divide-neutral-700"},oQ={class:"hover:bg-neutral-100 dark:hover:bg-neutral-700/60"},lQ={class:"flex items-center"},aQ={class:"grow"},sQ=["onClick","textContent"],rQ={class:"ml-2 py-2 pr-7"},iQ=["onSubmit"],uQ=o("th",{class:"text-left",width:"15%"},"Key",-1),dQ=o("th",{class:"text-left",width:"30%"},"Source",-1),cQ={class:"text-left",width:"55%"},mQ=["textContent"],pQ=["textContent"],fQ={width:"55%"},vQ={class:"-mt-px flex items-center justify-end space-x-3 bg-neutral-50 px-6 py-3 dark:bg-neutral-700"},bQ={__name:"SettingsTranslator",setup(e){const{t}=ve(),n=Pe(),a=Ye(),{locales:r}=Le(),{form:i}=Ae({name:null});let u={};const c=q(a.query.locale||Innoclapps.config("locale")),m=q({source:{groups:{},namespaces:{}},current:{groups:{},namespaces:{}}}),p=q(null),f=q(null),h=q(!1);Fd((x,A,N)=>{g().length>0?Innoclapps.dialog().confirm({message:t("translator::translator.changes_not_saved"),title:"Are you sure you want to leave this page?",confirmText:t("core::app.discard_changes")}).then(()=>N()).catch(()=>N(!1)):N()});function g(){let x=[],A={},N={};f.value?(x=Object.keys(u.namespaces[f.value]),A=u.namespaces[f.value],N=m.value.current.namespaces[f.value]):(x=Object.keys(u.groups),A=u.groups,N=m.value.current.groups);let T=[];return x.forEach(E=>{At(A[E],N[E])||T.push(E)}),T}function y(x,A=null){h.value=!0;let N=null;A?N=m.value.current.namespaces[A][x]:N=m.value.current.groups[x],Innoclapps.request().put(`/translation/${c.value}/${x}`,{translations:N,namespace:A}).then(()=>{window.location.href=`${n.state.url}/settings/translator?locale=${c.value}`}).finally(()=>setTimeout(()=>h.value=!1,1e3))}function _(x){Innoclapps.request().get(`/translation/${x}`).then(({data:A})=>{u=nt(A.current),m.value=A})}function I(){i.post("/translation").then(x=>{r.value.push(x.locale),c.value=x.locale,_(x.locale),Innoclapps.modal().hide("new-locale")})}function F(x,A=null){if(p.value){C(x);return}$(x,A)}function $(x,A=null){p.value=x,f.value=A}function C(x,A=!1){const N=g();let T=f.value;const E=N.indexOf(x)>-1;if(A||!E){p.value=null,f.value=null,E&&w(x,T);return}Innoclapps.dialog().confirm({message:t("translator::translator.changes_not_saved"),title:"The group has unsaved translations!",confirmText:t("core::app.discard_changes")}).then(()=>{f.value=null,p.value=null,w(x,T)})}function w(x,A=null){if(A){m.value.current.namespaces[A][x]=nt(u.namespaces[A][x]);return}m.value.current.groups[x]=nt(u.groups[x])}return _(c.value),(x,A)=>{const N=v("DropdownSelectInput"),T=v("IButton"),E=v("IFormTextarea"),B=v("ITable"),z=v("IFormInput"),M=v("IFormError"),j=v("IFormGroup"),U=v("IModal"),P=v("ICard"),H=ae("i-modal");return d(),R(P,{header:x.$t("translator::translator.translator"),"no-body":""},{actions:b(()=>[o("div",UW,[s(N,{modelValue:c.value,"onUpdate:modelValue":A[0]||(A[0]=L=>c.value=L),items:l(r),placement:"bottom-end",onChange:_},null,8,["modelValue","items"]),D(s(T,{icon:"plus",size:"sm",text:x.$t("translator::translator.new_locale")},null,8,["text"]),[[H,"new-locale"]])])]),default:b(()=>[o("ul",PW,[(d(!0),k(te,null,re(m.value.current.groups,(L,Z)=>D((d(),k("li",{key:Z},[o("div",jW,[o("div",LW,[o("div",HW,[o("a",{href:"#",class:"block px-7 py-2 font-medium text-neutral-600 focus:outline-none dark:text-neutral-200",onClick:ie(J=>F(Z),["prevent"]),textContent:S(l(sl)(Z.replace("_"," ")))},null,8,GW)]),o("div",KW,[s(T,{variant:"white",size:"sm",icon:"ChevronDown",onClick:J=>F(Z)},null,8,["onClick"])])])]),D(o("form",{novalidate:"true",onSubmit:ie(J=>y(Z),["prevent"])},[s(B,{shadow:!1},{default:b(()=>[o("thead",null,[o("tr",null,[WW,QW,o("th",XW,S(c.value),1)])]),o("tbody",null,[(d(!0),k(te,null,re(L,(J,K)=>(d(),k("tr",{key:K},[o("td",{width:"15%",textContent:S(K)},null,8,ZW),o("td",{width:"30%",textContent:S(m.value.source.groups[Z][K])},null,8,JW),o("td",eQ,[Array.isArray(m.value.current.groups[Z][K])?O("",!0):(d(),R(E,{key:0,modelValue:m.value.current.groups[Z][K],"onUpdate:modelValue":G=>m.value.current.groups[Z][K]=G,rows:"3"},null,8,["modelValue","onUpdate:modelValue"]))])]))),128))])]),_:2},1024),o("div",tQ,[s(T,{size:"sm",disabled:h.value,text:x.$t("core::app.cancel"),variant:"white",onClick:J=>C(Z,!0)},null,8,["disabled","text","onClick"]),s(T,{type:"submit",size:"sm",text:x.$t("core::app.save"),disabled:h.value,loading:h.value},null,8,["text","disabled","loading"])])],40,YW),[[Y,p.value===Z]])])),[[Y,!p.value||p.value===Z]])),128))]),(d(!0),k(te,null,re(m.value.current.namespaces,(L,Z)=>(d(),k(te,{key:Z},[D(o("p",{class:"bg-neutral-100 px-7 py-3 font-semibold text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300"},S(l(sl)(Z)),513),[[Y,!p.value]]),o("ul",nQ,[(d(!0),k(te,null,re(m.value.current.namespaces[Z],(J,K)=>D((d(),k("li",{key:K},[o("div",oQ,[o("div",lQ,[o("div",aQ,[o("a",{href:"#",class:"block px-7 py-2 font-medium text-neutral-600 focus:outline-none dark:text-neutral-200",onClick:ie(G=>F(K,Z),["prevent"]),textContent:S(l(sl)(K.replace("_"," ")))},null,8,sQ)]),o("div",rQ,[s(T,{variant:"white",size:"sm",icon:"ChevronDown",onClick:G=>F(K,Z)},null,8,["onClick"])])])]),D(o("form",{novalidate:"true",onSubmit:ie(G=>y(K,Z),["prevent"])},[s(B,{shadow:!1},{default:b(()=>[o("thead",null,[o("tr",null,[uQ,dQ,o("th",cQ,S(c.value),1)])]),o("tbody",null,[(d(!0),k(te,null,re(J,(G,oe)=>(d(),k("tr",{key:oe},[o("td",{width:"15%",textContent:S(oe)},null,8,mQ),o("td",{width:"30%",textContent:S(m.value.source.namespaces[Z][K][oe])},null,8,pQ),o("td",fQ,[Array.isArray(m.value.current.namespaces[Z][K][oe])?O("",!0):(d(),R(E,{key:0,modelValue:m.value.current.namespaces[Z][K][oe],"onUpdate:modelValue":pe=>m.value.current.namespaces[Z][K][oe]=pe,rows:"3"},null,8,["modelValue","onUpdate:modelValue"]))])]))),128))])]),_:2},1024),o("div",vQ,[s(T,{size:"sm",disabled:h.value,text:x.$t("core::app.cancel"),variant:"white",onClick:G=>C(K,!0)},null,8,["disabled","text","onClick"]),s(T,{type:"submit",size:"sm",text:x.$t("core::app.save"),disabled:h.value,loading:h.value},null,8,["text","disabled","loading"])])],40,iQ),[[Y,p.value===K&&f.value===Z]])])),[[Y,!p.value||p.value===K&&f.value===Z]])),128))])],64))),128)),s(U,{id:"new-locale",size:"sm",form:"","ok-title":x.$t("core::app.create"),"cancel-title":x.$t("core::app.cancel"),title:x.$t("translator::translator.create_new_locale"),onSubmit:I,onKeydown:A[2]||(A[2]=L=>l(i).onKeydown(L)),onShown:A[3]||(A[3]=()=>x.$refs.inputNameRef.focus())},{default:b(()=>[s(j,{"label-for":"localeName",label:x.$t("translator::translator.locale_name"),required:""},{default:b(()=>[s(z,{id:"localeName",ref:"inputNameRef",modelValue:l(i).name,"onUpdate:modelValue":A[1]||(A[1]=L=>l(i).name=L)},null,8,["modelValue"]),s(M,{textContent:S(l(i).getError("name"))},null,8,["textContent"])]),_:1},8,["label"])]),_:1},8,["ok-title","cancel-title","title"])]),_:1},8,["header"])}}};window.Innoclapps&&Innoclapps.booting(function(e,t){t.addRoute("settings",{path:"/settings/translator",component:bQ,meta:{title:qe.t("translator::translator.translator")}})});const hQ={class:"space-y-2"},_Q={class:"flex justify-start space-x-1 text-sm font-semibold text-neutral-800 dark:text-neutral-200"},gQ=["innerHTML"],yQ={class:"text-sm text-neutral-600 dark:text-neutral-400"},xQ={key:0,textContent:"/"},IQ=["textContent"],kQ={__name:"RecordTabTimelineWebFormSubmission",props:Pt,setup(e){const{maybeFormatDateValue:t}=Ne(),n=Innoclapps.resources();return(a,r)=>{const i=v("ICard");return d(),R(jt,{"resource-name":a.resourceName,"resource-id":a.resourceId,"created-at":a.log.created_at,"is-pinned":a.log.is_pinned,"timelineable-id":a.log.id,"timeline-relationship":a.log.timeline_relation,"timeline-subject-key":a.resource.timeline_subject_key,"timelineable-key":a.log.timeline_key,icon:"Bars3BottomLeft",heading:a.$t("webforms::form.submission"),"heading-class":"font-medium"},{default:b(()=>[r[0]||(he(-1),r[0]=s(i,{class:"mt-2"},{default:b(()=>[o("div",hQ,[(d(!0),k(te,null,re(a.log.properties,(u,c)=>(d(),k("div",{key:c},[o("div",_Q,[o("span",null,S(l(n)[u.resourceName].singularLabel)+" /",1),o("span",{class:"font-medium",innerHTML:u.label},null,8,gQ)]),o("div",yQ,[u.value===null?(d(),k("span",xQ)):(d(),k("span",{key:1,textContent:S(l(t)(u.value)||u.value)},null,8,IQ))])]))),128))])]),_:1}),he(1),r[0])]),_:1},8,["resource-name","resource-id","created-at","is-pinned","timelineable-id","timeline-relationship","timeline-subject-key","timelineable-key","heading"])}}},ma=Qt(()=>{const{setLoading:e,isLoading:t}=Ct(),n=q([]),a=V(()=>ot(n.value,["status","title"],["asc","asc"]));h();function r(g){return n.value.findIndex(y=>y.id==g)}function i(g){n.value.splice(r(g),1)}function u(g){n.value.push(g)}function c(g,y){n.value[r(g)]=y}function m(g){return n.value[r(g)]}async function p(g,y={}){const{data:_}=await Innoclapps.request().get(`/forms/${g}`,y);return _}async function f(g){await Innoclapps.request().delete(`/forms/${g}`),i(g)}function h(){e(!0),Innoclapps.request().get("/forms").then(({data:g})=>n.value=g).finally(()=>e(!1))}return{webForms:n,webFormsOrderedByNameAndStatus:a,formsAreBeingFetched:t,addWebForm:u,removeWebForm:i,setWebForm:c,findWebForm:m,fetchWebForms:h,fetchWebForm:p,deleteWebForm:f}}),$Q={key:0},wQ={class:"flex items-center px-4 py-4 sm:px-6"},CQ={class:"min-w-0 flex-1 sm:flex sm:items-center sm:justify-between"},SQ={class:"truncate"},RQ={class:"flex"},FQ=["onClick"],VQ={class:"mr-1"},TQ=o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 7l5 5m0 0l-5 5m5-5H6"})],-1),DQ={class:"mt-3 flex"},qQ={class:"flex items-center space-x-4 text-sm"},EQ=["href"],AQ={class:"text-neutral-800 dark:text-neutral-300"},BQ={key:0,class:"flex items-center rounded-md bg-primary-50 px-2 text-sm text-primary-800"},NQ={class:"mt-4 shrink-0 sm:ml-5 sm:mt-0"},OQ={class:"ml-5 shrink-0"},zQ={key:1,class:"p-7"},MQ={class:"mt-2 block font-medium text-neutral-900 dark:text-neutral-100"},UQ={class:"mt-2 block max-w-2xl text-sm text-neutral-600 dark:text-neutral-300"},PQ={__name:"WebFormsIndex",setup(e){const{t}=ve(),n=Qe(),{webFormsOrderedByNameAndStatus:a,formsAreBeingFetched:r,setWebForm:i,deleteWebForm:u}=ma(),{findPipelineById:c,findPipelineStageById:m}=sn(),{form:p}=Ae({status:null}),f=V(()=>a.value.length>0);async function h(I){await Innoclapps.dialog().confirm(),await u(I),Innoclapps.success(t("webforms::form.deleted"))}function g(){n.push({name:"web-form-create"})}function y(I){n.push({name:"web-form-edit",params:{id:I}})}function _(I){p.fill("status",I.status==="active"?"inactive":"active"),p.put(`/forms/${I.id}`).then(F=>{i(F.id,F)})}return(I,F)=>{const $=v("IButton"),C=v("Icon"),w=v("IFormToggle"),x=v("IDropdownItem"),A=v("IMinimalDropdown"),N=v("ICard"),T=v("router-view"),E=ae("t");return d(),k(te,null,[s(N,{header:I.$t("webforms::form.forms"),"no-body":"",overlay:l(r)},{actions:b(()=>[D(s($,{size:"sm",icon:"Plus",text:I.$t("webforms::form.create"),onClick:g},null,8,["text"]),[[Y,f.value]])]),default:b(()=>[l(r)?O("",!0):(d(),k("div",$Q,[f.value?(d(),R(El,{key:0,name:"flip-list",tag:"ul",class:"divide-y divide-neutral-200 dark:divide-neutral-700"},{default:b(()=>[(d(!0),k(te,null,re(l(a),B=>(d(),k("li",{key:B.id},[o("div",{class:X({"opacity-70":B.status==="inactive"})},[o("div",wQ,[o("div",CQ,[o("div",SQ,[o("div",RQ,[o("a",{href:"#",class:"link flex items-center truncate text-sm font-medium",onClick:ie(z=>y(B.id),["prevent"])},[o("span",VQ,S(B.title),1),TQ],8,FQ)]),o("div",DQ,[o("div",qQ,[D(o("a",{href:B.public_url,class:"link",target:"_blank",rel:"noopener noreferrer"},null,8,EQ),[[E,"core::app.preview"]]),o("p",AQ,S(I.$t("webforms::form.total_submissions",{total:B.total_submissions})),1),l(c)(B.submit_data.pipeline_id)?(d(),k("p",BQ,[Q(S(l(c)(B.submit_data.pipeline_id).name)+" ",1),s(C,{icon:"ChevronRight",class:"mx-1 mt-px h-3 w-3"}),Q(" "+S(l(m)(B.submit_data.pipeline_id,B.submit_data.stage_id).name),1)])):O("",!0)])])]),o("div",NQ,[s(w,{class:"mr-4",label:I.$t("webforms::form.active"),value:"active","unchecked-value":"inactive","model-value":B.status,onChange:z=>_(B)},null,8,["label","model-value","onChange"])])]),o("div",OQ,[s(A,null,{default:b(()=>[s(x,{text:I.$t("core::app.edit"),onClick:z=>y(B.id)},null,8,["text","onClick"]),s(x,{text:I.$t("core::app.delete"),onClick:z=>h(B.id)},null,8,["text","onClick"])]),_:2},1024)])])],2)]))),128))]),_:1})):(d(),k("div",zQ,[o("button",{type:"button",class:"relative flex w-full flex-col items-center rounded-lg border-2 border-dashed border-neutral-300 p-6 hover:border-neutral-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 dark:border-neutral-400 dark:hover:border-neutral-300 sm:p-12",onClick:g},[s(C,{icon:"Bars3BottomLeft",class:"mx-auto h-12 w-12 text-primary-500 dark:text-primary-400"}),D(o("span",MQ,null,512),[[E,"webforms::form.create"]]),D(o("p",UQ,null,512),[[E,"webforms::form.info"]])])]))]))]),_:1},8,["header","overlay"]),s(T)],64)}}},jQ={__name:"SettingsWebForms",setup(e){return(t,n)=>(d(),R(PQ))}},ko={section:{required:!0,type:Object},form:{required:!0,type:Object}},LQ={__name:"FieldSection",props:ko,setup(e){return(t,n)=>(d(),R(We(t.section.field.formComponent),{field:t.section.field,"form-id":t.form.formId},null,8,["field","form-id"]))}},HQ={class:"flex flex-col items-center"},GQ=["innerHTML"],KQ={__name:"FileSection",props:ko,setup(e){const t=e;t.form.set(t.section.requestAttribute,t.section.multiple?[]:null);const n=q([]),a=V(()=>n.value.length);return ge(a,()=>{const r=t.section.requestAttribute;n.value.length===0?t.form.fill(r,t.section.multiple?[]:null):t.section.multiple?t.form.fill(r,n.value.map(i=>i.file)):t.form.fill(r,n.value[0].file)}),(r,i)=>{const u=v("Icon"),c=v("IFormError"),m=v("IFormGroup");return d(),R(m,null,{default:b(()=>[s(Hn,{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=p=>n.value=p),drop:!0,multiple:r.section.multiple,"show-upload-button":!1,"automatic-upload":!1,icon:!1,name:r.section.requestAttribute,"input-id":r.section.requestAttribute,"style-classes":"group block rounded-md border border-dashed border-neutral-300 dark:border-neutral-400 w-full py-4 sm:py-5 hover:border-neutral-400 cursor-pointer hover:bg-neutral-50 dark:hover:bg-neutral-700/60 font-medium","wrapper-classes":""},{"upload-text":b(()=>[o("div",HQ,[s(u,{icon:"CloudArrowUp",class:"h-7 w-7 text-neutral-600 dark:text-neutral-300 dark:group-hover:text-white"}),o("p",{class:"mt-1 max-w-sm text-sm text-neutral-700 dark:text-neutral-100 dark:group-hover:text-white",innerHTML:r.section.label},null,8,GQ)])]),_:1},8,["modelValue","multiple","name","input-id"]),s(c,{textContent:S(r.form.getError(r.section.requestAttribute))},null,8,["textContent"])]),_:1})}}},YQ={key:0,class:"mb-3"},WQ=["textContent"],QQ=["innerHTML"],XQ={__name:"IntroductionSection",props:ko,setup(e){const t=e,n=V(()=>t.section.title||t.section.message);return(a,r)=>n.value?(d(),k("div",YQ,[o("h4",{class:"text-lg font-medium text-neutral-800 dark:text-neutral-100",textContent:S(a.section.title)},null,8,WQ),o("div",{class:"wysiwyg-text text-sm text-neutral-600 dark:text-neutral-300",innerHTML:a.section.message},null,8,QQ)])):O("",!0)}},ZQ=["innerHTML"],JQ={__name:"MessageSection",props:ko,setup(e){return(t,n)=>(d(),k("div",{class:"wysiwyg-text mb-3 text-sm text-neutral-600 dark:text-neutral-300",innerHTML:t.section.message},null,8,ZQ))}};const eX={key:1,class:"mb-3 flex"},tX={class:"text-sm text-neutral-600 dark:text-neutral-300"},nX=["href"],oX={__name:"SubmitButtonSection",props:ko,setup(e){const t=e,n=Innoclapps.config("reCaptcha")||{},a=q(!1),r=V(()=>t.section.spamProtected?n.validate&&n.configured:!1);function i(u){t.form.fill("g-recaptcha-response",u)}return(u,c)=>{const m=v("IFormError"),p=v("IFormGroup"),f=v("IFormCheckbox"),h=v("i18n-t"),g=v("IButton"),y=ae("t");return d(),k("div",null,[r.value?(d(),R(p,{key:0},{default:b(()=>[s(l(Sl),{sitekey:l(n).siteKey,onVerify:i},null,8,["sitekey"]),s(m,{textContent:S(u.form.getError("g-recaptcha-response"))},null,8,["textContent"])]),_:1})):O("",!0),u.section.privacyPolicyAcceptIsRequired?(d(),k("div",eX,[s(f,{id:"acceptPrivacyPolicy",checked:a.value,"onUpdate:checked":c[0]||(c[0]=_=>a.value=_),onChange:c[1]||(c[1]=_=>u.form.fill("_privacy-policy",_))},null,8,["checked"]),o("div",tX,[s(h,{scope:"global",keypath:"core::app.agree_to_privacy_policy",class:"inline-block w-full"},{privacyPolicyLink:b(()=>[D(o("a",{href:u.section.privacyPolicyUrl,class:"link"},null,8,nX),[[y,"core::app.privacy_policy"]])]),_:1},8,["keypath"]),o("div",null,[s(m,{textContent:S(u.form.getError("_privacy-policy"))},null,8,["textContent"])])])])):O("",!0),s(g,{id:"submitButton",type:"submit",size:"lg",disabled:u.form.busy,loading:u.form.busy,block:"",text:u.section.text},null,8,["disabled","loading","text"])])}}},lX=["src"],aX={key:0},sX=["textContent"],rX=["innerHTML"],iX=["onSubmit"],uX={__name:"WebFormPublicView",props:{sections:{required:!0,type:Array},styles:{required:!0,type:Object},submitData:{required:!0,type:Object},publicUrl:{required:!0,type:String},logo:String},setup(e){const t=e,n={"field-section":LQ,"file-section":KQ,"introduction-section":XQ,"message-section":JQ,"submit-button-section":oX},a=Ye(),{fields:r}=gt(t.sections.filter(w=>y(w)&&w.field).map(w=>w.field)),{form:i}=It(r),u=q(!1),c=V(()=>{let w=_t(t.sections,x=>(y(x)&&(x.field=r.value.find(x.requestAttribute)),x));return Lt(w,x=>y(x)?!!x.field:!0)}),m=V(()=>c.value.length>0),p=V(()=>Object.hasOwn(a.query,"bgColor")?a.query.bgColor:t.styles.background_color),f=V(()=>Object.hasOwn(a.query,"primaryColor")?"#"+a.query.primaryColor:t.styles.primary_color),h=V(()=>a.query.e==="true");function g(w){const x=Dl(w,{format:"array"});return x[0]+", "+x[1]+", "+x[2]}function y(w){return w.type==="field-section"}function _(){i.hydrate().post(t.publicUrl).then(()=>{t.submitData.action==="redirect"?window.top?window.top.location.href=t.submitData.success_redirect_url:window.location.href=t.submitData.success_redirect_url:u.value=!0})}window.addEventListener("DOMContentLoaded",()=>{document.body.style.backgroundColor=p.value,document.getElementById("app").style.backgroundColor=p.value});let I=new WeakMap,F=function(){return!!window.getComputedStyle(document.body).getPropertyValue("--color-primary-50")}();function $(w){let x=Array.prototype.slice.call(document.querySelectorAll("style"),0),A=/(\-\-[-\w]+)\:\s*(.*?)\;/g,N=w||{};if(F){Object.keys(N).forEach(function(E){document.body.style.setProperty("--"+E,N[E])});return}function T(E){return new RegExp("var\\(s*"+E+"s*\\)","gmi")}x.forEach(function(E){let B=I[E]||(I[E]=E.textContent),z;for(;z=A.exec(B);)B=B.replace(T(z[1]),N[z[1].substr(2)]||z[2]);E.textContent=B})}let C=w=>{try{return g(Wd(f.value,w))}catch{return g(f.value)}};return $({"color-primary-50":C(100),"color-primary-100":C(80),"color-primary-200":C(60),"color-primary-300":C(40),"color-primary-400":C(20),"color-primary-500":C(10),"color-primary-600":C(0),"color-primary-700":C(-10),"color-primary-800":C(-20),"color-primary-900":C(-30)}),De(()=>{}),(w,x)=>{const A=v("IAlert"),N=v("ICard");return d(),k("div",{class:X(["m-auto",{"w-full":h.value,"max-w-2xl":!h.value}]),style:st({"--primary-contrast":l(Vn)(f.value)}),dusk:"web-form"},[e.logo?(d(),k("img",{key:0,src:e.logo,class:"mx-auto mb-3 mt-10 h-12 w-auto"},null,8,lX)):O("",!0),s(N,{rounded:!h.value,shadow:!h.value,class:X(["m-4 sm:m-8 sm:p-3",{"my-5":!h.value}])},{default:b(()=>[u.value?(d(),k("div",aX,[o("h4",{class:"text-lg text-neutral-800",textContent:S(e.submitData.success_title)},null,8,sX),D(o("div",{class:"wysiwyg-text",innerHTML:e.submitData.success_message},null,8,rX),[[Y,e.submitData.success_message]])])):m.value?(d(),k("form",{key:2,novalidate:"true",onSubmit:ie(_,["prevent"])},[(d(!0),k(te,null,re(c.value,(T,E)=>(d(),R(We(n[T.type]),{key:E,form:l(i),section:T},null,8,["form","section"]))),128))],40,iX)):(d(),R(A,{key:1,variant:"warning",class:"border border-warning-200"},{default:b(()=>[Q(S(w.$t("webforms::form.no_sections")),1)]),_:1}))]),_:1},8,["rounded","shadow","class"])],6)}}},dX={class:"mb-2"},cX={class:"mb-3 font-medium text-neutral-700 dark:text-neutral-300"},mX={__name:"WebFormsCreate",setup(e){const t=Qe(),{addWebForm:n}=ma(),a=Innoclapps.config("favourite_colors"),{form:r}=Ae({title:null,styles:{primary_color:"#4f46e5",background_color:"#F3F4F6"}});function i(){r.post("/forms").then(u=>{n(u),t.push({name:"web-form-edit",params:{id:u.id}})})}return(u,c)=>{const m=v("IFormInput"),p=v("IFormError"),f=v("IFormGroup"),h=v("IColorSwatch"),g=v("IModal"),y=ae("t");return d(),R(g,{"ok-title":u.$t("core::app.create"),"ok-disabled":l(r).busy,title:u.$t("webforms::form.create"),size:"sm",visible:"","static-backdrop":"",form:"",onSubmit:i,onKeydown:c[3]||(c[3]=_=>l(r).onKeydown(_)),onHidden:u.$router.back,onShown:c[4]||(c[4]=()=>u.$refs.inputTitleRef.focus())},{default:b(()=>[s(f,{"label-for":"title",description:u.$t("webforms::form.title_visibility_info"),label:u.$t("webforms::form.title"),required:""},{default:b(()=>[s(m,{id:"title",ref:"inputTitleRef",modelValue:l(r).title,"onUpdate:modelValue":c[0]||(c[0]=_=>l(r).title=_)},null,8,["modelValue"]),s(p,{textContent:S(l(r).getError("title"))},null,8,["textContent"])]),_:1},8,["description","label"]),o("div",dX,[D(o("h5",cX,null,512),[[y,"webforms::form.style.style"]]),s(f,{label:u.$t("webforms::form.style.primary_color")},{default:b(()=>[s(h,{modelValue:l(r).styles.primary_color,"onUpdate:modelValue":c[1]||(c[1]=_=>l(r).styles.primary_color=_),"allow-remove":!1,swatches:l(a)},null,8,["modelValue","swatches"]),s(p,{textContent:S(l(r).getError("styles.primary_color"))},null,8,["textContent"])]),_:1},8,["label"]),s(f,{label:u.$t("webforms::form.style.background_color")},{default:b(()=>[s(h,{modelValue:l(r).styles.background_color,"onUpdate:modelValue":c[2]||(c[2]=_=>l(r).styles.background_color=_),"allow-remove":!1,swatches:l(a)},null,8,["modelValue","swatches"]),s(p,{textContent:S(l(r).getError("styles.background_color"))},null,8,["textContent"])]),_:1},8,["label"])])]),_:1},8,["ok-title","ok-disabled","title","onHidden"])}}};function Cr(e,t,n){const a=q(null),r=q(null),i=q(!1),u=V(()=>a.value&&a.value.isRequired&&a.value.primary),c=V(()=>ot(_t(l(t),h=>(h.disabled=f(h),h)),["disabled","order"],["desc","asc"]));function m(){return qt(25)}function p(h){h?(r.value=h.label,i.value=h.isRequired):(r.value="",i.value=!1)}function f(h){return!Ee(l(n),{attribute:h.attribute,resourceName:l(e)})}return{field:a,fieldLabel:r,isRequired:i,fieldMustBeRequired:u,availableFields:c,generateRequestAttribute:m,handleFieldChanged:p,isFieldAlreadySelected:f}}const pX=["textContent"],fX={class:"inline-flex space-x-2"},vX={class:"text-sm text-neutral-900 dark:text-neutral-300"},bX=["innerHTML"],hX={key:0},_X={class:"text-right"},gX={class:"flex items-center justify-between"},yX={class:"space-x-2"},xX={__name:"FieldSection",props:{index:{type:Number},form:{type:Object,required:!0},section:{required:!0,type:Object},companiesFields:{required:!0},contactsFields:{required:!0},dealsFields:{required:!0},availableResources:{required:!0}},emits:["update-section-requested","remove-section-requested"],setup(e,{emit:t}){const n=e,{t:a}=ve(),r=q(!1),i=q(n.section.resourceName),u=V(()=>n[i.value+"Fields"]),c=Ee(u.value,{attribute:n.section.attribute}),{field:m,availableFields:p,handleFieldChanged:f,fieldLabel:h,isRequired:g,fieldMustBeRequired:y,generateRequestAttribute:_}=Cr(i,u,xe(n.form,"sections")),I=V(()=>!r.value&&c),F=V(()=>Ee(n.availableResources,{id:n.section.resourceName}).label),$=V(()=>c?F.value+" | "+c.label+(n.section.isRequired?"":" "+a("core::fields.optional")):a("core::fields.no_longer_available")),C=V(()=>h.value===null||h.value==""||m.value==null);function w(){let N={isRequired:g.value,label:h.value,resourceName:i.value,attribute:m.value.attribute};(!c||i.value!=n.section.resourceName||m.value.attribute!=c.attribute)&&(N.requestAttribute=_()),t("update-section-requested",N),r.value=!1}function x(){m.value=c,i.value=n.section.resourceName,h.value=n.section.label,g.value=n.section.isRequired,r.value=!0}function A(){t("remove-section-requested")}return(N,T)=>{const E=v("IButtonIcon"),B=v("ICustomSelect"),z=v("IFormGroup"),M=v("Editor"),j=v("IFormCheckbox"),U=v("IButton"),P=v("ICard");return d(),R(P,{class:X(["group",{"border border-primary-400":r.value,"border border-danger-500":!l(c),"border border-transparent transition duration-75 hover:border-primary-400 dark:border dark:border-neutral-700":!r.value&&l(c)}])},{header:b(()=>[o("p",{class:X(["font-semibold",l(c)?"text-neutral-800 dark:text-neutral-200":"text-danger-500"]),textContent:S($.value)},null,10,pX)]),actions:b(()=>[o("div",fX,[D(s(E,{icon:"PencilAlt",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:x},null,512),[[Y,I.value]]),s(E,{icon:"Trash",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:A})])]),default:b(()=>[D(o("div",vX,[o("p",{innerHTML:e.section.label},null,8,bX)],512),[[Y,!r.value]]),r.value?(d(),k("div",hX,[s(z,{label:N.$t("webforms::form.sections.field.resourceName"),"label-for":"resourceName"},{default:b(()=>[s(B,{modelValue:i.value,"onUpdate:modelValue":T[0]||(T[0]=H=>i.value=H),label:"label","field-id":"resourceName",clearable:!1,options:e.availableResources,reduce:H=>H.id,"onOption:selected":T[1]||(T[1]=H=>m.value=null)},null,8,["modelValue","options","reduce"])]),_:1},8,["label"]),s(z,{label:N.$t("core::fields.field"),"label-for":"field"},{default:b(()=>[s(B,{modelValue:l(m),"onUpdate:modelValue":T[2]||(T[2]=H=>xt(m)?m.value=H:null),label:"label","field-id":"field",clearable:!1,selectable:H=>H.disabled,options:l(p),"onOption:selected":l(f)},null,8,["modelValue","selectable","options","onOption:selected"])]),_:1},8,["label"]),D(s(z,{label:N.$t("core::fields.label")},{default:b(()=>[s(M,{modelValue:l(h),"onUpdate:modelValue":T[3]||(T[3]=H=>xt(h)?h.value=H:null),"with-image":!1,"default-tag":"div",toolbar:"bold italic underline link removeformat"},null,8,["modelValue"])]),_:1},8,["label"]),[[Y,l(m)!==null]]),o("div",_X,[o("div",gX,[o("div",null,[D(s(j,{id:"is-required",checked:l(g),"onUpdate:checked":T[4]||(T[4]=H=>xt(g)?g.value=H:null),name:"is-required",disabled:l(y),label:N.$t("core::fields.is_required")},null,8,["checked","disabled","label"]),[[Y,l(m)!==null]])]),o("div",yX,[s(U,{size:"sm",variant:"white",text:N.$t("core::app.cancel"),onClick:T[5]||(T[5]=H=>r.value=!1)},null,8,["text"]),s(U,{size:"sm",disabled:C.value,text:N.$t("core::app.save"),variant:"secondary",onClick:w},null,8,["disabled","text"])])])])])):O("",!0)]),_:1},8,["class"])}}},IX=["textContent"],kX={class:"inline-flex space-x-2"},$X={class:"text-sm text-neutral-900 dark:text-neutral-300"},wX=["innerHTML"],CX={key:0},SX={class:"space-x-2 text-right"},RX={__name:"FileSection",props:{index:{type:Number},form:{type:Object,required:!0},section:{required:!0,type:Object},availableResources:{required:!0}},emits:["update-section-requested","remove-section-requested"],setup(e,{emit:t}){const n=e,{t:a}=ve(),r=q(!1),i=q(null),u=q(!1),c=q(null),m=q(!1),p=V(()=>!r.value),f=V(()=>Ee(n.availableResources,{id:n.section.resourceName}).label),h=V(()=>f.value+" | "+(n.section.multiple?a("webforms::form.sections.file.files"):a("webforms::form.sections.file.file"))+(n.section.isRequired?"":" "+a("core::fields.optional"))),g=V(()=>i.value===null||i.value=="");function y(){t("update-section-requested",{resourceName:c.value,label:i.value,isRequired:u.value,multiple:m.value}),r.value=!1}function _(){t("remove-section-requested")}function I(){c.value=n.section.resourceName,i.value=n.section.label,u.value=n.section.isRequired,m.value=n.section.multiple,r.value=!0}return(F,$)=>{const C=v("IButtonIcon"),w=v("ICustomSelect"),x=v("IFormGroup"),A=v("Editor"),N=v("IFormCheckbox"),T=v("IButton"),E=v("ICard");return d(),R(E,{class:X(["group",{"border border-primary-400":r.value,"border border-transparent transition duration-75 hover:border-primary-400 dark:border dark:border-neutral-700":!r.value}])},{header:b(()=>[o("p",{class:"font-semibold text-neutral-800 dark:text-neutral-200",textContent:S(h.value)},null,8,IX)]),actions:b(()=>[o("div",kX,[D(s(C,{icon:"PencilAlt",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:I},null,512),[[Y,p.value]]),s(C,{icon:"Trash",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:_})])]),default:b(()=>[D(o("div",$X,[o("p",{innerHTML:e.section.label},null,8,wX)],512),[[Y,!r.value]]),r.value?(d(),k("div",CX,[s(x,{label:F.$t("webforms::form.sections.field.resourceName"),"label-for":"resourceName"},{default:b(()=>[s(w,{modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=B=>c.value=B),label:"label","field-id":"resourceName",clearable:!1,options:e.availableResources,reduce:B=>B.id},null,8,["modelValue","options","reduce"])]),_:1},8,["label"]),s(x,{label:F.$t("core::fields.label")},{default:b(()=>[s(A,{modelValue:i.value,"onUpdate:modelValue":$[1]||($[1]=B=>i.value=B),"with-image":!1,"default-tag":"div",toolbar:"bold italic underline link removeformat"},null,8,["modelValue"])]),_:1},8,["label"]),s(x,null,{default:b(()=>[s(N,{id:"is-required",checked:u.value,"onUpdate:checked":$[2]||($[2]=B=>u.value=B),name:"is-required",label:F.$t("core::fields.is_required")},null,8,["checked","label"]),s(N,{id:"file-multiple",checked:m.value,"onUpdate:checked":$[3]||($[3]=B=>m.value=B),name:"file-multiple",label:F.$t("webforms::form.sections.file.multiple")},null,8,["checked","label"])]),_:1}),o("div",SX,[s(T,{size:"sm",variant:"white",text:F.$t("core::app.cancel"),onClick:$[4]||($[4]=B=>r.value=!1)},null,8,["text"]),s(T,{size:"sm",disabled:g.value,text:F.$t("core::app.save"),variant:"secondary",onClick:y},null,8,["disabled","text"])])])):O("",!0)]),_:1},8,["class"])}}},FX={class:"font-semibold text-neutral-800 dark:text-neutral-200"},VX=["textContent"],TX=["innerHTML"],DX={key:0},qX={class:"space-x-2 text-right"},EX=Object.assign({inheritAttrs:!1},{__name:"IntroductionSection",props:{index:{type:Number},form:{type:Object,required:!0},section:{required:!0,type:Object}},emits:["update-section-requested"],setup(e,{emit:t}){const n=e,a=q(!1),r=q(null),i=q(null);function u(){t("update-section-requested",{title:r.value,message:i.value}),a.value=!1}function c(){r.value=n.section.title,i.value=n.section.message,a.value=!0}return(m,p)=>{const f=v("IButtonIcon"),h=v("IFormInput"),g=v("IFormGroup"),y=v("Editor"),_=v("IButton"),I=v("ICard"),F=ae("t");return d(),R(I,{class:X(["group",{"border border-primary-400":a.value,"border border-transparent transition duration-75 hover:border-primary-400 dark:border dark:border-neutral-700":!a.value}])},{header:b(()=>[D(o("p",FX,null,512),[[F,"webforms::form.sections.introduction.introduction"]])]),actions:b(()=>[D(s(f,{icon:"PencilAlt",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:c},null,512),[[Y,!a.value]])]),default:b(()=>[D(o("div",null,[o("h4",{class:"text-lg font-medium text-neutral-800 dark:text-neutral-100",textContent:S(e.section.title)},null,8,VX),o("p",{class:"text-sm text-neutral-600 dark:text-neutral-300",innerHTML:e.section.message},null,8,TX)],512),[[Y,!a.value]]),a.value?(d(),k("div",DX,[s(g,{label:m.$t("webforms::form.sections.introduction.title"),"label-for":"title"},{default:b(()=>[s(h,{id:"title",modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=$=>r.value=$)},null,8,["modelValue"])]),_:1},8,["label"]),s(g,{label:m.$t("webforms::form.sections.introduction.message")},{default:b(()=>[s(y,{modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=$=>i.value=$),"with-image":!1},null,8,["modelValue"])]),_:1},8,["label"]),o("div",qX,[s(_,{size:"sm",variant:"white",text:m.$t("core::app.cancel"),onClick:p[2]||(p[2]=$=>a.value=!1)},null,8,["text"]),s(_,{size:"sm",variant:"secondary",text:m.$t("core::app.save"),onClick:u},null,8,["text"])])])):O("",!0)]),_:1},8,["class"])}}}),AX={class:"font-semibold text-neutral-800 dark:text-neutral-200"},BX={class:"inline-flex space-x-2"},NX=["innerHTML"],OX={key:0},zX={class:"space-x-2 text-right"},MX=Object.assign({inheritAttrs:!1},{__name:"MessageSection",props:{index:{type:Number},form:{type:Object,required:!0},section:{required:!0,type:Object}},emits:["update-section-requested","remove-section-requested"],setup(e,{emit:t}){const n=e,a=q(!1),r=q(null);function i(){t("update-section-requested",{message:r.value}),a.value=!1}function u(){t("remove-section-requested")}function c(){r.value=n.section.message,a.value=!0}return(m,p)=>{const f=v("IButtonIcon"),h=v("Editor"),g=v("IFormGroup"),y=v("IButton"),_=v("ICard"),I=ae("t");return d(),R(_,{class:X(["group",{"border border-primary-400":a.value,"border border-transparent transition duration-75 hover:border-primary-400 dark:border dark:border-neutral-700":!a.value}])},{header:b(()=>[D(o("p",AX,null,512),[[I,"webforms::form.sections.message.message"]])]),actions:b(()=>[o("div",BX,[D(s(f,{icon:"PencilAlt",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:c},null,512),[[Y,!a.value]]),s(f,{icon:"Trash",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:u})])]),default:b(()=>[D(o("div",{class:"text-sm text-neutral-600 dark:text-neutral-200",innerHTML:e.section.message},null,8,NX),[[Y,!a.value]]),a.value?(d(),k("div",OX,[s(g,{label:m.$t("webforms::form.sections.message.message")},{default:b(()=>[s(h,{modelValue:r.value,"onUpdate:modelValue":p[0]||(p[0]=F=>r.value=F),"with-image":!1},null,8,["modelValue"])]),_:1},8,["label"]),o("div",zX,[s(y,{size:"sm",variant:"white",text:m.$t("core::app.cancel"),onClick:p[1]||(p[1]=F=>a.value=!1)},null,8,["text"]),s(y,{size:"sm",variant:"secondary",text:m.$t("core::app.save"),onClick:i},null,8,["text"])])])):O("",!0)]),_:1},8,["class"])}}}),UX={class:"font-semibold text-neutral-800 dark:text-neutral-200"},PX={key:1},jX={class:"space-x-2 text-right"},LX=Object.assign({inheritAttrs:!1},{__name:"NewSection",props:{index:{type:Number},form:{type:Object,required:!0},section:{required:!0,type:Object},companiesFields:{required:!0},contactsFields:{required:!0},dealsFields:{required:!0},availableResources:{required:!0}},emits:["create-section-requested","remove-section-requested"],setup(e,{emit:t}){const n=e,{t:a}=ve(),r=q("field"),i=q("contacts"),u=q(!1),c=q(null),m=V(()=>n[i.value+"Fields"]),{field:p,availableFields:f,handleFieldChanged:h,fieldLabel:g,isRequired:y,fieldMustBeRequired:_,generateRequestAttribute:I}=Cr(i,m,xe(n.form,"sections")),F=[{id:"field",label:a("webforms::form.sections.types.input_field")},{id:"message",label:a("webforms::form.sections.types.message")},{id:"file",label:a("webforms::form.sections.types.file")}],$=V(()=>r.value==="field"?g.value===null||g.value==""||p.value==null:r.value==="message"?c.value===null||c.value=="":r.value==="file"?g.value===null||g.value=="":!1);function C(){t("create-section-requested",{type:"message-section",message:c.value})}function w(){t("create-section-requested",{type:"field-section",isRequired:y.value,label:g.value,resourceName:i.value,attribute:p.value.attribute,requestAttribute:I()})}function x(){t("create-section-requested",{type:"file-section",isRequired:y.value,label:g.value,resourceName:i.value,multiple:u.value,requestAttribute:I()})}function A(){r.value==="message"?C():r.value==="file"?x():w()}function N(){t("remove-section-requested")}return(T,E)=>{const B=v("IButtonIcon"),z=v("ICustomSelect"),M=v("IFormGroup"),j=v("Editor"),U=v("IFormCheckbox"),P=v("IButton"),H=v("ICard"),L=ae("t");return d(),R(H,{class:"border border-primary-400"},{header:b(()=>[D(o("p",UX,null,512),[[L,"webforms::form.sections.new"]])]),actions:b(()=>[s(B,{icon:"X","icon-class":"h-4 w-4",onClick:N})]),default:b(()=>[s(M,{label:T.$t("webforms::form.sections.type"),"label-for":"section_type"},{default:b(()=>[s(z,{modelValue:r.value,"onUpdate:modelValue":E[0]||(E[0]=Z=>r.value=Z),label:"label","field-id":"section_type",options:F,clearable:!1,reduce:Z=>Z.id,"onOption:selected":E[1]||(E[1]=Z=>(Z.id==="file"&&(g.value="Attachment"),Z.id!=="field"?p.value=null:""))},null,8,["modelValue","reduce"])]),_:1},8,["label"]),r.value==="message"?(d(),R(M,{key:0,label:T.$t("webforms::form.sections.message.message")},{default:b(()=>[s(j,{modelValue:c.value,"onUpdate:modelValue":E[2]||(E[2]=Z=>c.value=Z),"with-image":!1},null,8,["modelValue"])]),_:1},8,["label"])):(d(),k("div",PX,[s(M,{label:T.$t("webforms::form.sections.field.resourceName"),"label-for":"resourceName"},{default:b(()=>[s(z,{modelValue:i.value,"onUpdate:modelValue":E[3]||(E[3]=Z=>i.value=Z),label:"label","field-id":"resourceName",clearable:!1,options:e.availableResources,reduce:Z=>Z.id,"onOption:selected":E[4]||(E[4]=Z=>p.value=null)},null,8,["modelValue","options","reduce"])]),_:1},8,["label"]),r.value==="field"?(d(),R(M,{key:0,label:T.$t("core::fields.field"),"label-for":"field"},{default:b(()=>[s(z,{modelValue:l(p),"onUpdate:modelValue":E[5]||(E[5]=Z=>xt(p)?p.value=Z:null),label:"label","field-id":"field",clearable:!1,selectable:Z=>Z.disabled,options:l(f),"onOption:selected":l(h)},null,8,["modelValue","selectable","options","onOption:selected"])]),_:1},8,["label"])):O("",!0),D(s(M,{label:T.$t("core::fields.label")},{default:b(()=>[s(j,{modelValue:l(g),"onUpdate:modelValue":E[6]||(E[6]=Z=>xt(g)?g.value=Z:null),"with-image":!1,"default-tag":"div",toolbar:"bold italic underline link removeformat"},null,8,["modelValue"])]),_:1},8,["label"]),[[Y,l(p)!==null||r.value==="file"]]),s(M,null,{default:b(()=>[D(s(U,{id:"new-is-required",checked:l(y),"onUpdate:checked":E[7]||(E[7]=Z=>xt(y)?y.value=Z:null),name:"new-is-required",disabled:l(_),label:T.$t("core::fields.is_required")},null,8,["checked","disabled","label"]),[[Y,l(p)!==null||r.value==="file"]]),D(s(U,{id:"new-file-multiple",checked:u.value,"onUpdate:checked":E[8]||(E[8]=Z=>u.value=Z),name:"new-file-multiple",label:T.$t("webforms::form.sections.file.multiple")},null,8,["checked","label"]),[[Y,r.value==="file"]])]),_:1})])),o("div",jX,[s(P,{size:"sm",variant:"white",text:T.$t("core::app.cancel"),onClick:N},null,8,["text"]),s(P,{size:"sm",disabled:$.value,text:T.$t("core::app.save"),variant:"secondary",onClick:A},null,8,["disabled","text"])])]),_:1})}}}),HX={class:"font-semibold text-neutral-800 dark:text-neutral-200"},GX={class:"text-sm text-neutral-900 dark:text-neutral-300"},KX=["textContent"],YX={key:0},WX={class:"space-x-2 text-right"},QX=Object.assign({inheritAttrs:!1},{__name:"SubmitButtonSection",props:{index:{type:Number},form:{type:Object,required:!0},section:{required:!0,type:Object}},emits:["update-section-requested"],setup(e,{emit:t}){const n=e,a=q(!1),r=q(null),i=q(!1),u=q(!1),c=q(Innoclapps.config("privacyPolicyUrl")),m=Innoclapps.config("reCaptcha.configured");function p(){t("update-section-requested",{text:r.value,spamProtected:i.value,privacyPolicyAcceptIsRequired:u.value,privacyPolicyUrl:c.value}),a.value=!1}function f(){r.value=n.section.text,i.value=n.section.spamProtected,u.value=n.section.privacyPolicyAcceptIsRequired,c.value=n.section.privacyPolicyUrl,a.value=!0}return(h,g)=>{const y=v("IButtonIcon"),_=v("IFormInput"),I=v("IFormGroup"),F=v("IFormCheckbox"),$=v("IButton"),C=v("ICard"),w=ae("t");return d(),R(C,{class:X(["group",{"border border-primary-400":a.value,"border border-transparent transition duration-75 hover:border-primary-400 dark:border dark:border-neutral-700":!a.value}])},{header:b(()=>[D(o("p",HX,null,512),[[w,"webforms::form.sections.submit.button"]])]),actions:b(()=>[D(s(y,{icon:"PencilAlt",class:"block md:hidden md:group-hover:block","icon-class":"h-4 w-4",onClick:f},null,512),[[Y,!a.value]])]),default:b(()=>[D(o("div",GX,[o("p",{textContent:S(e.section.text)},null,8,KX)],512),[[Y,!a.value]]),a.value?(d(),k("div",YX,[s(I,{label:h.$t("webforms::form.sections.submit.button_text"),"label-for":"text"},{default:b(()=>[s(_,{id:"text",modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=x=>r.value=x)},null,8,["modelValue"])]),_:1},8,["label"]),D(s(I,null,{default:b(()=>[s(F,{id:"spam_protected",checked:i.value,"onUpdate:checked":g[1]||(g[1]=x=>i.value=x),name:"spam_protected",label:h.$t("webforms::form.sections.submit.spam_protected")},null,8,["checked","label"])]),_:1},512),[[Y,l(m)]]),s(I,null,{default:b(()=>[s(F,{id:"require_privacy_policy",checked:u.value,"onUpdate:checked":g[2]||(g[2]=x=>u.value=x),name:"require_privacy_policy",label:h.$t("webforms::form.sections.submit.require_privacy_policy")},null,8,["checked","label"])]),_:1}),D(s(I,{label:h.$t("webforms::form.sections.submit.privacy_policy_url"),"label-for":"privacy_policy_url"},{default:b(()=>[s(_,{id:"privacy_policy_url",modelValue:c.value,"onUpdate:modelValue":g[3]||(g[3]=x=>c.value=x)},null,8,["modelValue"])]),_:1},8,["label"]),[[Y,u.value]]),o("div",WX,[s($,{size:"sm",variant:"white",text:h.$t("core::app.cancel"),onClick:g[4]||(g[4]=x=>a.value=!1)},null,8,["text"]),s($,{size:"sm",variant:"secondary",text:h.$t("core::app.save"),onClick:p},null,8,["text"])])])):O("",!0)]),_:1},8,["class"])}}}),XX={class:"mb-3 inline-flex items-center text-lg/6 font-semibold text-neutral-700 dark:text-neutral-100"},ZX={class:"select-all rounded-md border border-neutral-200 bg-neutral-100 p-2 text-neutral-900 dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-200"},JX=Vd('<h3 class="mb-3 mt-8 text-lg/6 font-semibold text-neutral-700 dark:text-neutral-100"> Embed the form on your Website </h3><ul class="ml-5 list-disc leading-7 text-neutral-900 dark:text-neutral-200"><li>Copy the code snippet below</li><li> Paste the code right where you want the form to appear in your template or CMS editor </li></ul><p class="mb-2 mt-4 text-neutral-900 dark:text-neutral-200"><em class="font-italic">* When entering the snippet to your CMS, make sure you are in code editing mode.</em></p><p class="mb-2 mt-4 text-neutral-900 dark:text-neutral-200"><em class="font-italic"> * You must place the iframe snippet on a website that uses the same protocol like your installation, for example, if the current installation uses https:// URL protocol, you will need to add the iframe in a website that uses https:// URL protocol, adding on a non-https url, will prevent the form from loading. </em></p>',4),eZ={class:"mt-3 select-all rounded-md border border-neutral-200 bg-neutral-100 p-2 text-neutral-900 dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-200"},tZ={__name:"WebFormsEditEmbed",props:["form"],setup(e){const t=e,n=V(()=>`<iframe src="${t.form.public_url}?e=true" frameborder="0" width="700" height="500" sandbox="allow-top-navigation allow-scripts allow-forms allow-same-origin"></iframe>`);return(a,r)=>{const i=v("IButtonCopy"),u=ae("i-tooltip");return d(),k("div",null,[o("h3",XX,[Q(" Share via link "),D(s(i,{class:"ml-3",text:e.form.public_url,"success-message":a.$t("core::app.copied")},null,8,["text","success-message"]),[[u,a.$t("core::app.copy")]])]),o("div",ZX,S(e.form.public_url),1),JX,o("div",eZ,S(n.value),1)])}}},nZ={class:"grid max-w-lg grid-cols-1 gap-y-6 sm:grid-cols-3 sm:gap-x-4"},oZ={class:"flex flex-1"},lZ={class:"flex flex-col items-center rounded-md bg-white px-3 py-2"},aZ={__name:"WebFormsEditLogoType",props:{modelValue:String,backgroundColor:String,primaryColor:String},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,{t:a}=ve(),r=[{id:"form_no_logo",title:a("core::app.no"),value:null},{id:"form_logo_light",value:"light",title:a("core::app.logo.light")},{id:"form_logo_dark",value:"dark",title:a("core::app.logo.dark")}],i=Go(n,"modelValue",t);return(u,c)=>{const m=v("Icon");return d(),R(l(zl),{modelValue:l(i),"onUpdate:modelValue":c[0]||(c[0]=p=>xt(i)?i.value=p:null)},{default:b(()=>[s(l(Ln),{class:"sr-only"},{default:b(()=>[Q("Select web form logo type")]),_:1}),o("div",nZ,[(d(),k(te,null,re(r,p=>s(l(Ol),{key:p.id,as:"template",value:p.value},{default:b(({checked:f,active:h})=>[o("div",{class:X([f?"border-transparent":"border-neutral-300 dark:border-neutral-700",h?"border-primary-500 ring-2 ring-primary-500":"","relative flex cursor-pointer flex-col rounded-lg border bg-white p-4 shadow-sm focus:outline-none dark:bg-neutral-800"])},[o("span",oZ,[s(l(Ln),{as:"span",class:"block self-start truncate text-sm font-medium text-neutral-900 dark:text-white"},{default:b(()=>[Q(S(p.title),1)]),_:2},1024),s(m,{icon:"CheckCircle",class:X([f?"":"invisible","ml-auto h-5 w-5 text-primary-600"])},null,8,["class"])]),s(l(Ao),{class:"mt-auto"},{default:b(()=>[o("div",{class:"mt-2 h-[130px] w-full overflow-hidden p-3",style:st({backgroundColor:e.backgroundColor})},[p.value==="dark"?(d(),R(m,{key:0,icon:"RocketLaunch",class:"mx-auto mb-2 h-5 w-5"})):p.value==="light"?(d(),R(m,{key:1,icon:"RocketLaunch",class:"mx-auto mb-2 h-5 w-5 text-white"})):O("",!0),o("div",lZ,[o("div",{class:"mt-1 h-2 w-full rounded-sm border bg-neutral-50",style:st({borderColor:e.primaryColor})},null,4),o("div",{class:"mt-1 h-2 w-full rounded-sm border bg-neutral-50",style:st({borderColor:e.primaryColor})},null,4),o("div",{class:"mt-1 h-2 w-full rounded-sm border bg-neutral-50",style:st({borderColor:e.primaryColor})},null,4),p.value===null?(d(),k("div",{key:0,class:"mt-1 h-2 w-full rounded-sm border bg-neutral-50",style:st({borderColor:e.primaryColor})},null,4)):O("",!0),p.value===null?(d(),k("div",{key:1,class:"mt-1 h-2 w-full rounded-sm border bg-neutral-50",style:st({borderColor:e.primaryColor})},null,4)):O("",!0),o("div",{class:"mt-3 h-3 w-full rounded",style:st({backgroundColor:e.primaryColor})},null,4)])],4)]),_:2},1024),o("span",{class:X([h?"border":"border-2",f?"border-primary-500":"border-transparent","pointer-events-none absolute -inset-px rounded-lg"]),"aria-hidden":"true"},null,2)],2)]),_:2},1032,["value"])),64))])]),_:1},8,["modelValue"])}}};const sZ={class:"text-neutral-900 dark:text-neutral-100"},rZ={class:"mb-3 text-neutral-800 dark:text-neutral-100"},iZ=["onSubmit"],uZ={class:"flex items-center"},dZ={class:"ml-3 w-full"},cZ={class:"border-b border-transparent focus-within:border-primary-500"},mZ={class:"mt-5 flex w-full items-center justify-end space-x-2 sm:mt-0 sm:w-auto"},pZ={class:"flex"},fZ=["href"],vZ={class:"form-wrapper overflow-auto"},bZ={class:"m-auto max-w-full"},hZ={key:0,class:"group relative flex flex-col items-center justify-center"},_Z={class:"absolute"},gZ=o("svg",{height:"56",width:"360"},[o("line",{x1:"180",y1:"0",x2:"180",y2:"56",class:"stroke-current stroke-1 text-neutral-900 dark:text-neutral-700"}),Q(" Sorry, your browser does not support inline SVG. ")],-1),yZ={class:"mb-3 text-lg font-semibold text-neutral-700 dark:text-neutral-100"},xZ={class:"mb-3"},IZ={class:"mb-3 mt-8 text-lg font-semibold text-neutral-700 dark:text-neutral-100"},kZ={class:"relative flex grow items-stretch focus-within:z-10"},$Z=["onClick"],wZ={class:"mb-3 text-lg font-semibold text-neutral-700 dark:text-neutral-100"},CZ={class:"mb-2 mt-4 text-sm font-medium text-neutral-800 dark:text-neutral-100"},SZ={__name:"WebFormsEdit",setup(e){const t={"field-section":xX,"introduction-section":EX,"submit-button-section":QX,"file-section":RX,"new-section":LX,"message-section":MX},{t:n}=ve(),a=Ye(),{users:r,currentUser:i,locales:u}=Le(),{fetchWebForm:c,setWebForm:m,findWebForm:p}=ma(),{orderedPipelines:f}=sn();Ut(V(()=>{var le;return(le=p(a.params.id))==null?void 0:le.title}));const h=Innoclapps.config("favourite_colors"),g=q({email:!0,phones:!0}),y=q([]),_=q([]),I=q([]),F=q(null),$=q(null),C=q(!1),w=q(!1),{form:x}=Ae({notifications:[],sections:[],styles:[],submit_data:[]}),A=[{id:"contacts",label:n("contacts::contact.contact")},{id:"companies",label:n("contacts::company.company")},{id:"deals",label:n("deals::deal.deal")}],N=V(()=>x.notifications.length),T=V(()=>x.notifications.filter(Be).length>0),E=V(()=>x.sections.length),B=V(()=>Ee(x.sections,{resourceName:Innoclapps.resourceName("contacts"),attribute:"email"})!==void 0),z=V(()=>Ee(x.sections,{resourceName:Innoclapps.resourceName("contacts"),attribute:"phones"})!==void 0),M=V(()=>B.value?Ee(x.sections,{resourceName:Innoclapps.resourceName("contacts"),attribute:"email"}).isRequired===!0:!1),j=V(()=>z.value?Ee(x.sections,{resourceName:Innoclapps.resourceName("contacts"),attribute:"phones"}).isRequired===!0:!1),U=V(()=>!B.value&&!z.value),P=V(()=>!M.value&&!j.value);function H(le,ye){K(le,ye,!1),U.value||P.value?W():ce()}function L(){const le=Xe(x.sections,{type:"new-section"});le!==-1&&J(le)}function Z(le){w.value=!0,x.sections.splice(le+1,0,{type:"new-section",label:n("webforms::form.sections.new")})}async function J(le){x.sections[le].type==="new-section"?(w.value=!1,x.sections.splice(le,1)):(await Innoclapps.dialog().confirm(),x.sections.splice(le,1),oe())}function K(le,ye,Ge=!0){x.sections[le]=Object.assign({},x.sections[le],ye),Ge&&ce(!0)}function G(le,ye){x.sections.splice(le+1,0,ye),oe(),L()}function oe(){!U.value&&!P.value&&ce(!0)}function pe(){E.value===0&&(x.sections.push({type:"introduction-section",message:"",title:""}),x.sections.push({type:"submit-button-section",text:n("webforms::form.sections.submit.default_text")}))}function ue(le){x.notifications.splice(le,1)}function ee(){x.notifications.push(""),x.notifications.length===1&&(x.notifications[0]=i.value.email)}function W(){if(U.value){Innoclapps.modal().show("requiresFieldsModal");return}else if(P.value){Innoclapps.modal().show("nonOptionalFieldRequiredModal");return}ce()}function ne(){B.value&&g.value.email&&K(Xe(x.sections,{resourceName:Innoclapps.resourceName("contacts"),attribute:"email"}),{isRequired:!0},!1),z.value&&g.value.phones&&K(Xe(x.sections,{resourceName:Innoclapps.resourceName("contacts"),attribute:"phones"}),{isRequired:!0},!1),ce(),Innoclapps.modal().hide("nonOptionalFieldRequiredModal")}function ce(le=!1){x.submit_data.pipeline_id=F.value?F.value.id:null,x.submit_data.stage_id=$.value?$.value.id:null,L(),x.put(`/forms/${a.params.id}`).then(ye=>{m(ye.id,ye),le||Innoclapps.success(n("webforms::form.updated"))}).catch(ye=>(ye.isValidationError()&&Innoclapps.error(n("core::app.form_validation_failed_with_sections"),3e3),Promise.reject(ye)))}function fe(le){return le.readonly||cn(le,"attributes.readonly")}function Se(le,ye){return le.filter(Ge=>Ge.showOnCreation===!0&&(ye.indexOf(Ge.attribute)===-1||fe(Ge)))}async function Ie(){let{data:le}=await Innoclapps.request().get("/fields/settings/bulk/create?intent=create",{params:{groups:["contacts","companies","deals"]}});y.value=Se(le.contacts,["user_id","source_id","tags"]),I.value=Se(le.deals,["user_id","pipeline_id","stage_id","tags"]),_.value=Se(le.companies,["user_id","parent_company_id","source_id","tags"])}function Ce(){C.value=!0,Ie().finally(()=>{c(a.params.id).then(le=>{x.clear().set(le),F.value=f.value.filter(ye=>ye.id==le.submit_data.pipeline_id)[0],$.value=F.value.stages.filter(ye=>ye.id==le.submit_data.stage_id)[0],pe(),C.value=!1})})}return Ce(),(le,ye)=>{const Ge=v("IModal"),be=v("IFormCheckbox"),Ve=v("Icon"),$e=v("router-link"),et=v("IFormError"),Te=v("IActionMessage"),tt=v("IFormToggle"),at=v("IButton"),lt=v("ITab"),_e=v("ITabList"),me=v("ITabPanel"),we=v("IFormRadio"),Ue=v("IFormGroup"),Oe=v("IFormInput"),se=v("Editor"),ke=v("ICustomSelect"),He=v("ICardBody"),yt=v("IColorSwatch"),Ke=v("ITabPanels"),Ze=v("ITabGroup"),ze=v("ICard"),Vt=v("IOverlay"),Nt=ae("t");return d(),k("div",null,[s(Vt,{show:C.value},{default:b(()=>[s(Ge,{id:"requiresFieldsModal",size:"sm",title:le.$t("webforms::form.fields_action_required"),"hide-footer":""},{default:b(()=>[D(o("p",sZ,null,512),[[Nt,"webforms::form.required_fields_needed"]])]),_:1},8,["title"]),s(Ge,{id:"nonOptionalFieldRequiredModal",size:"sm","cancel-title":le.$t("core::app.cancel"),"ok-title":le.$t("core::app.continue"),"ok-disabled":B.value&&!g.value.email&&z.value&&!g.value.phones,title:le.$t("webforms::form.fields_action_required"),onOk:ne},{default:b(()=>[D(o("p",rZ,null,512),[[Nt,"webforms::form.must_requires_fields"]]),D(s(be,{id:"require-contact-email",checked:g.value.email,"onUpdate:checked":ye[0]||(ye[0]=je=>g.value.email=je),name:"require-contact-email",label:le.$t("contacts::fields.contacts.email")},null,8,["checked","label"]),[[Y,!M.value&&B.value]]),D(s(be,{id:"require-contact-phone",checked:g.value.phones,"onUpdate:checked":ye[1]||(ye[1]=je=>g.value.phones=je),class:"mt-2",name:"require-contact-phone",label:le.$t("contacts::fields.contacts.phone")},null,8,["checked","label"]),[[Y,!j.value&&z.value]])]),_:1},8,["cancel-title","ok-title","ok-disabled","title"]),o("form",{novalidate:"true",onSubmit:ie(W,["prevent"]),onKeydown:ye[18]||(ye[18]=je=>l(x).onKeydown(je))},[s(ze,{"no-body":"","actions-class":"w-full sm:w-auto"},{header:b(()=>[o("div",uZ,[s($e,{to:{name:"web-forms-index"}},{default:b(()=>[s(Ve,{icon:"ChevronLeft",class:"h-5 w-5 text-neutral-500 hover:text-neutral-800 dark:text-neutral-300 dark:hover:text-neutral-400"})]),_:1}),o("div",dZ,[o("div",cZ,[D(o("input",{id:"name","onUpdate:modelValue":ye[2]||(ye[2]=je=>l(x).title=je),type:"text",name:"name",class:"block w-full border-0 border-b border-transparent bg-neutral-50 text-sm font-medium focus:border-primary-500 focus:ring-0 dark:bg-neutral-700 dark:text-white"},null,512),[[Zt,l(x).title]])]),s(et,{class:"text-sm')",textContent:S(l(x).getError("title"))},null,8,["textContent"])])])]),actions:b(()=>[o("div",mZ,[o("div",pZ,[D(s(Te,{message:le.$t("core::app.saved"),class:"mr-2"},null,8,["message"]),[[Y,l(x).recentlySuccessful]]),s(tt,{modelValue:l(x).status,"onUpdate:modelValue":ye[3]||(ye[3]=je=>l(x).status=je),value:"active",class:"mr-2 border-r border-neutral-200 pr-4 dark:border-neutral-700","unchecked-value":"inactive",disabled:w.value||l(x).busy,label:le.$t("webforms::form.active")},null,8,["modelValue","disabled","label"])]),D(o("a",{href:l(x).public_url,target:"_blank",rel:"noopener noreferrer",class:X([{disabled:l(x).busy},"btn-white btn-sm btn rounded"])},null,10,fZ),[[Nt,"core::app.preview"]]),s(at,{size:"sm",loading:l(x).busy,disabled:l(x).busy||w.value,text:le.$t("core::app.save"),onClick:W},null,8,["loading","disabled","text"])])]),default:b(()=>[o("div",vZ,[o("div",bZ,[s(Ze,null,{default:b(()=>[s(_e,{centered:"",class:"sticky top-0 z-10 bg-white dark:bg-neutral-900"},{default:b(()=>[s(lt,{title:le.$t("webforms::form.editor")},null,8,["title"]),s(lt,{title:le.$t("webforms::form.submit_options")},null,8,["title"]),s(lt,{title:le.$t("webforms::form.style.style")},null,8,["title"]),s(lt,{title:le.$t("webforms::form.sections.embed.embed")},null,8,["title"])]),_:1}),s(Ke,null,{default:b(()=>[s(me,null,{default:b(()=>[(d(!0),k(te,null,re(l(x).sections,(je,Rt)=>(d(),k("div",{key:Rt+je.type+je.attribute,class:"m-auto max-w-sm"},[(d(),R(We(t[je.type]),{form:l(x),"companies-fields":_.value,"contacts-fields":y.value,"deals-fields":I.value,index:Rt,"available-resources":A,section:je,onRemoveSectionRequested:Kt=>J(Rt),onUpdateSectionRequested:Kt=>H(Rt,Kt),onCreateSectionRequested:Kt=>G(Rt,Kt)},null,40,["form","companies-fields","contacts-fields","deals-fields","index","section","onRemoveSectionRequested","onUpdateSectionRequested","onCreateSectionRequested"])),E.value-1!=Rt?(d(),k("div",hZ,[D(o("div",_Z,[s(at,{size:"sm",class:"block transition-opacity delay-75 md:opacity-0 md:group-hover:opacity-100",icon:"Plus",variant:"secondary",onClick:Kt=>Z(Rt)},null,8,["onClick"])],512),[[Y,!w.value]]),gZ])):O("",!0)]))),128))]),_:1}),s(me,null,{default:b(()=>[s(He,null,{default:b(()=>[D(o("h5",yZ,null,512),[[Nt,"webforms::form.success_page.success_page"]]),s(Ue,{label:le.$t("webforms::form.success_page.success_page_info")},{default:b(()=>[s(we,{id:"submitMessage",modelValue:l(x).submit_data.action,"onUpdate:modelValue":ye[4]||(ye[4]=je=>l(x).submit_data.action=je),class:"mt-2",label:le.$t("webforms::form.success_page.thank_you_message"),value:"message",name:"submit-action"},null,8,["modelValue","label"]),s(we,{id:"submitRedirect",modelValue:l(x).submit_data.action,"onUpdate:modelValue":ye[5]||(ye[5]=je=>l(x).submit_data.action=je),class:"mt-2",label:le.$t("webforms::form.success_page.redirect"),value:"redirect",name:"submit-action"},null,8,["modelValue","label"]),s(et,{textContent:S(l(x).getError("submit_data.action"))},null,8,["textContent"])]),_:1},8,["label"]),o("div",xZ,[D(o("div",null,[s(Ue,{label:le.$t("webforms::form.success_page.title"),"label-for":"success_title",required:""},{default:b(()=>[s(Oe,{modelValue:l(x).submit_data.success_title,"onUpdate:modelValue":ye[6]||(ye[6]=je=>l(x).submit_data.success_title=je),placeholder:le.$t("webforms::form.success_page.title_placeholder")},null,8,["modelValue","placeholder"]),s(et,{textContent:S(l(x).getError("submit_data.success_title"))},null,8,["textContent"])]),_:1},8,["label"]),s(Ue,{label:le.$t("webforms::form.success_page.message"),optional:""},{default:b(()=>[s(se,{modelValue:l(x).submit_data.success_message,"onUpdate:modelValue":ye[7]||(ye[7]=je=>l(x).submit_data.success_message=je),"with-image":!1},null,8,["modelValue"])]),_:1},8,["label"])],512),[[Y,l(x).submit_data.action==="message"]]),D(o("div",null,[s(Ue,{label:le.$t("webforms::form.success_page.redirect_url"),"label-for":"success_redirect_url",required:""},{default:b(()=>[s(Oe,{modelValue:l(x).submit_data.success_redirect_url,"onUpdate:modelValue":ye[8]||(ye[8]=je=>l(x).submit_data.success_redirect_url=je),type:"url",placeholder:le.$t("webforms::form.success_page.redirect_url_placeholder")},null,8,["modelValue","placeholder"]),s(et,{textContent:S(l(x).getError("submit_data.success_redirect_url"))},null,8,["textContent"])]),_:1},8,["label"])],512),[[Y,l(x).submit_data.action==="redirect"]])]),D(o("h5",IZ,null,512),[[Nt,"webforms::form.saving_preferences.saving_preferences"]]),s(Ue,{"label-for":"title_prefix",label:le.$t("webforms::form.saving_preferences.deal_title_prefix"),description:le.$t("webforms::form.saving_preferences.deal_title_prefix_info"),optional:""},{default:b(()=>[s(Oe,{id:"title_prefix')",modelValue:l(x).title_prefix,"onUpdate:modelValue":ye[9]||(ye[9]=je=>l(x).title_prefix=je)},null,8,["modelValue"])]),_:1},8,["label","description"]),s(Ue,{"label-for":"pipeline_id",label:le.$t("deals::fields.deals.pipeline.name"),required:""},{default:b(()=>[s(ke,{modelValue:F.value,"onUpdate:modelValue":[ye[10]||(ye[10]=je=>F.value=je),ye[11]||(ye[11]=je=>$.value=je.stages[0])],options:l(f),label:"name","input-id":"pipeline_id",clearable:!1},null,8,["modelValue","options"]),s(et,{textContent:S(l(x).getError("submit_data.pipeline_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(Ue,{"label-for":"stage_id",required:"",label:le.$t("deals::fields.deals.stage.name")},{default:b(()=>[s(ke,{modelValue:$.value,"onUpdate:modelValue":ye[12]||(ye[12]=je=>$.value=je),options:F.value?F.value.stages:[],label:"name",clearable:!1,"input-id":"stage_id"},null,8,["modelValue","options"]),s(et,{textContent:S(l(x).getError("submit_data.stage_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(Ue,{"label-for":"user_id",label:le.$t("deals::fields.deals.user.name"),required:""},{default:b(()=>[s(ke,{modelValue:l(x).user_id,"onUpdate:modelValue":ye[13]||(ye[13]=je=>l(x).user_id=je),options:l(r),clearable:!1,label:"name",reduce:je=>je.id,"input-id":"user_id"},null,8,["modelValue","options","reduce"]),s(et,{textContent:S(l(x).getError("user_id"))},null,8,["textContent"])]),_:1},8,["label"]),s(Ue,{"label-for":"notifications",label:le.$t("webforms::form.notifications")},{default:b(()=>[(d(!0),k(te,null,re(l(x).notifications,(je,Rt)=>(d(),k("div",{key:Rt,class:"mb-3 flex rounded-md shadow-sm"},[o("div",kZ,[s(Oe,{modelValue:l(x).notifications[Rt],"onUpdate:modelValue":Kt=>l(x).notifications[Rt]=Kt,rounded:!1,class:"rounded-l-md",type:"email",placeholder:le.$t("webforms::form.notification_email_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(et,{textContent:S(l(x).getError("notifications."+Rt))},null,8,["textContent"])]),s(at,{type:"button",icon:"X",variant:"white",rounded:!1,class:"relative -ml-px rounded-r-md",onClick:Kt=>ue(Rt)},null,8,["onClick"])]))),128)),D(o("a",{href:"#",class:"link text-sm",onClick:ie(ee,["prevent"])},null,8,$Z),[[Y,!T.value||N.value===0],[Nt,"webforms::form.new_notification"]])]),_:1},8,["label"])]),_:1})]),_:1}),s(me,null,{default:b(()=>[s(He,null,{default:b(()=>[D(o("h5",wZ,null,512),[[Nt,"webforms::form.style.style"]]),s(Ue,{class:"mt-3 w-full sm:w-[356px]",label:le.$t("core::app.locale"),"label-for":"locale"},{default:b(()=>[s(ke,{modelValue:l(x).locale,"onUpdate:modelValue":ye[14]||(ye[14]=je=>l(x).locale=je),"input-id":"locale",clearable:!1,options:l(u)},null,8,["modelValue","options"]),s(et,{textContent:S(l(x).getError("locale"))},null,8,["textContent"])]),_:1},8,["label"]),s(Ue,{label:le.$t("webforms::form.style.primary_color")},{default:b(()=>[s(yt,{modelValue:l(x).styles.primary_color,"onUpdate:modelValue":ye[15]||(ye[15]=je=>l(x).styles.primary_color=je),"allow-remove":!1,swatches:l(h)},null,8,["modelValue","swatches"]),s(et,{textContent:S(l(x).getError("styles.primary_color"))},null,8,["textContent"])]),_:1},8,["label"]),s(Ue,{label:le.$t("webforms::form.style.background_color")},{default:b(()=>[s(yt,{modelValue:l(x).styles.background_color,"onUpdate:modelValue":ye[16]||(ye[16]=je=>l(x).styles.background_color=je),"allow-remove":!1,swatches:l(h)},null,8,["modelValue","swatches"]),s(et,{textContent:S(l(x).getError("styles.background_color"))},null,8,["textContent"])]),_:1},8,["label"]),D(o("h3",CZ,null,512),[[Nt,"webforms::form.style.logo"]]),s(aZ,{modelValue:l(x).styles.logo,"onUpdate:modelValue":ye[17]||(ye[17]=je=>l(x).styles.logo=je),"background-color":l(x).styles.background_color,"primary-color":l(x).styles.primary_color},null,8,["modelValue","background-color","primary-color"])]),_:1})]),_:1}),s(me,null,{default:b(()=>[s(He,null,{default:b(()=>[s(tZ,{form:l(x)},null,8,["form"])]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})],40,iZ)]),_:1},8,["show"])])}}};window.Innoclapps&&Innoclapps.booting(function(e,t){e.component("WebFormPublicView",uX),e.component("WebFormSubmissionChangelog",kQ),t.addRoute("settings",{path:"forms/:id/edit",name:"web-form-edit",component:SZ}),t.addRoute("settings",{path:"forms",name:"web-forms-index",component:jQ,meta:{title:qe.t("webforms::form.forms")},children:[{path:"create",name:"web-form-create",component:mX}]})});const RZ=`:root{--navbar-height: 4rem;--color-neutral-50: 248, 250, 252;--color-neutral-100: 241, 245, 249;--color-neutral-200: 226, 232, 240;--color-neutral-300: 203, 213, 225;--color-neutral-400: 148, 163, 184;--color-neutral-500: 100, 116, 139;--color-neutral-600: 71, 85, 105;--color-neutral-700: 51, 65, 85;--color-neutral-800: 30, 41, 59;--color-neutral-900: 15, 23, 42;--color-primary-50: 238, 242, 255;--color-primary-100: 224, 231, 255;--color-primary-200: 199, 210, 254;--color-primary-300: 165, 180, 252;--color-primary-400: 129, 140, 248;--color-primary-500: 99, 102, 241;--color-primary-600: 79, 70, 229;--color-primary-700: 67, 56, 202;--color-primary-800: 55, 48, 163;--color-primary-900: 49, 46, 129;--color-warning-50: 255, 251, 235;--color-warning-100: 254, 243, 199;--color-warning-200: 253, 230, 138;--color-warning-300: 252, 211, 77;--color-warning-400: 251, 191, 36;--color-warning-500: 245, 158, 11;--color-warning-600: 217, 119, 6;--color-warning-700: 180, 83, 9;--color-warning-800: 146, 64, 14;--color-warning-900: 120, 53, 15;--color-danger-50: 254, 242, 242;--color-danger-100: 254, 226, 226;--color-danger-200: 254, 202, 202;--color-danger-300: 252, 165, 165;--color-danger-400: 248, 113, 113;--color-danger-500: 239, 68, 68;--color-danger-600: 220, 38, 38;--color-danger-700: 185, 28, 28;--color-danger-800: 153, 27, 27;--color-danger-900: 127, 29, 29;--color-success-50: 240, 253, 244;--color-success-100: 220, 252, 231;--color-success-200: 187, 247, 208;--color-success-300: 134, 239, 172;--color-success-400: 74, 222, 128;--color-success-500: 34, 197, 94;--color-success-600: 22, 163, 74;--color-success-700: 21, 128, 61;--color-success-800: 22, 101, 52;--color-success-900: 20, 83, 45;--color-info-50: 239, 246, 255;--color-info-100: 219, 234, 254;--color-info-200: 191, 219, 254;--color-info-300: 147, 197, 253;--color-info-400: 96, 165, 250;--color-info-500: 59, 130, 246;--color-info-600: 37, 99, 235;--color-info-700: 29, 78, 216;--color-info-800: 30, 64, 175;--color-info-900: 30, 58, 138}
`,Gn=500,Pn=[0,50,100,200,300,400,500,600,700,800,900,950,1e3],Pa=[50,100,200,300,400,500,600,700,800,900],bn={value:"",valueStop:Gn,swatches:[],h:0,s:0,lMin:0,lMax:100,useLightness:!0};function Sr(e,t,n){const[a,r,i]=[e,t,n].map(function(u){return u/=255,u<.03928?u/12.92:Math.pow((u+.055)/1.055,2.4)});return 21.26*a+71.52*r+7.22*i}function FZ(e){return qZ(Sr(...Object.values(Rr(e))),2)}function VZ(e,t,n){const a={};for(let u=99;u>=0;u--)a[u]=Math.abs(n-Sr(...Object.values(Fr(e,t,u))));let r=100,i=100;for(let u=Object.keys(a).length-1;u>=0;u--)a[u]<r&&(i=u,r=a[u]);return i}function Rr(e){e.length===6&&!e.startsWith("#")&&(e=`#${e}`);let t="0",n="0",a="0";return e.length===4?(t=`0x${e[1]}${e[1]}`,n=`0x${e[2]}${e[2]}`,a=`0x${e[3]}${e[3]}`):e.length===7&&(t=`0x${e[1]}${e[2]}`,n=`0x${e[3]}${e[4]}`,a=`0x${e[5]}${e[6]}`),{r:t,g:n,b:a}}function TZ(e){e.length===6&&!e.startsWith("#")&&(e=`#${e}`);let{r:t,g:n,b:a}=Rr(e);t/=255,n/=255,a/=255;const r=Math.min(t,n,a),i=Math.max(t,n,a),u=i-r;let c=0,m=0,p=0;return u===0?c=0:i===t?c=(n-a)/u%6:i===n?c=(a-t)/u+2:c=(t-n)/u+4,c=Math.round(c*60),c<0&&(c+=360),p=(i+r)/2,m=u===0?0:u/(1-Math.abs(2*p-1)),m=+(m*100).toFixed(1),p=+(p*100).toFixed(1),{h:c,s:m,l:p}}function Fr(e,t,n){t/=100,n/=100;const a=(1-Math.abs(2*n-1))*t,r=a*(1-Math.abs(e/60%2-1)),i=n-a/2;let u=0,c=0,m=0;return e>=0&&e<60?(u=a,c=r,m=0):e>=60&&e<120?(u=r,c=a,m=0):e>=120&&e<180?(u=0,c=a,m=r):e>=180&&e<240?(u=0,c=r,m=a):e>=240&&e<300?(u=r,c=0,m=a):e>=300&&e<360&&(u=a,c=0,m=r),{r:Math.round((u+i)*255),g:Math.round((c+i)*255),b:Math.round((m+i)*255)}}function DZ(e,t,n){let{r:a,g:r,b:i}=Fr(e,t,n);return a=a.toString(16),r=r.toString(16),i=i.toString(16),a.length===1&&(a=`0${a}`),r.length===1&&(r=`0${r}`),i.length===1&&(i=`0${i}`),`#${a}${r}${i}`}function qZ(e,t=0){const n=Math.pow(10,t);return Math.round(e*n)/n}function EZ(e,t,n){return"#"+(16777216+(e<<16|t<<8|n<<0)).toString(16).slice(1)}function AZ(e=0,t=Gn){const n=Pn,a=n.indexOf(t);if(a===-1)throw new Error(`Invalid key value: ${t}`);return n.map(r=>{const i=Math.abs(n.indexOf(r)-a),u=e?Math.round((i+1)*e*(1+i/10)):0;return u>100?{stop:r,tweak:100}:{stop:r,tweak:u}})}function BZ(e=0,t=Gn){const n=Pn,a=n.indexOf(t);if(a===-1)throw new Error(`Invalid parameter value: ${t}`);return n.map(r=>{const i=Math.abs(n.indexOf(r)-a),u=e?(i+1)*e-e:0;return u<0?{stop:r,tweak:360+u}:u>360?{stop:r,tweak:u-360}:{stop:r,tweak:u}})}function NZ(e=0,t=100,n,a=Gn){const r=Pn,i=[{stop:0,tweak:t},{stop:a,tweak:n},{stop:1e3,tweak:e}];for(let u=0;u<r.length;u++){const c=r[u];if(c===0||c===1e3||c===a)continue;const m=Math.abs((c-a)/100),p=c<a?Math.abs(r.indexOf(a)-r.indexOf(Pn[0]))-1:Math.abs(r.indexOf(a)-r.indexOf(Pn[Pn.length-1]))-1,f=c<a?t-n:n-e,h=c<a?f/p*m+n:n-f/p*m;i.push({stop:c,tweak:Math.round(h)})}return i.sort((u,c)=>u.stop-c.stop),i}function OZ(e){const{value:t,valueStop:n}=e,a=e.useLightness??bn.useLightness,r=e.h??bn.h,i=e.s??bn.s,u=e.lMin??bn.lMin,c=e.lMax??bn.lMax,m=BZ(r,n),p=AZ(i,n),{h:f,s:h,l:g}=TZ(t),y=a?g:FZ(t),_=NZ(u,c,y,n);return m.map(({stop:F},$)=>{const C=f+m[$].tweak,w=h+p[$].tweak,x=a?_[$].tweak:VZ(C,w,_[$].tweak),A=DZ(C,w,x);return{stop:F,hex:F===n?`#${t.toUpperCase()}`:A.toUpperCase(),h:C,hScale:m[$].tweak,s:w,sScale:p[$].tweak,l:x}})}const zZ={class:"text-center text-sm font-medium"},MZ={class:"text-center text-xs uppercase opacity-90"},UZ=["for"],PZ=["id","value"],jZ={__name:"SettingsThemeStyleSwatch",props:["swatch","color"],emits:["update:hex"],setup(e,{emit:t}){const n=Dt(function(a){t("update:hex",a.target.value)},300);return(a,r)=>(d(),k("div",{class:"flex h-14 w-full flex-col justify-center rounded-lg p-2 md:h-32 md:p-4",style:st({background:e.swatch.hex})},[o("div",{class:"flex items-center justify-between px-4 md:mt-auto md:block md:px-0",style:st({color:l(Vn)(e.swatch.hex)})},[o("div",zZ,S(e.swatch.stop),1),o("div",MZ,[o("label",{for:e.swatch.hex,class:"cursor-pointer"},S(e.swatch.hex),9,UZ),o("input",{id:e.swatch.hex,type:"color",value:e.swatch.hex,class:"h-0",onInput:r[0]||(r[0]=(...i)=>l(n)&&l(n)(...i))},null,40,PZ)])],4)],4))}},LZ=ct(jZ,[["__scopeId","data-v-22eeebc2"]]),HZ={class:"mb-2 items-center md:flex"},GZ={class:"flex-grow text-center text-base font-medium text-neutral-800 dark:text-neutral-100 md:text-left"},KZ={class:"flex items-center justify-center space-x-3"},YZ=["onClick"],WZ={class:"relative"},QZ={for:"lMax",class:"absolute -top-2.5 left-2 inline-block bg-white px-1 text-xs font-medium text-neutral-900 dark:bg-neutral-900 dark:text-neutral-300"},XZ=["onUpdate:modelValue","onInput"],ZZ={class:"relative"},JZ={for:"lMin",class:"absolute -top-2.5 left-2 inline-block bg-white px-1 text-xs font-medium text-neutral-900 dark:bg-neutral-900 dark:text-neutral-300"},eJ=["onUpdate:modelValue","onInput"],tJ={class:"flex flex-col justify-between space-y-1 overflow-hidden md:flex-row md:space-x-1 md:space-y-0"},nJ={key:0,class:"absolute left-1/2 top-10 hidden h-2 -translate-x-1/2 transform items-center justify-center md:flex"},oJ={__name:"SettingsThemeStyle",setup(e){const t=[],n={},a=[0,950,1e3];C();const r={},i=q({}),u=q(!1);t.forEach(w=>{i.value[w]=I(w),r[w]=I(w)});const{form:c,submit:m,isReady:p,originalSettings:f}=Gt();mn(p,()=>{f.value.theme_style&&g(f.value.theme_style)});function h(w){u.value=!0;let x=nt(i.value);delete x[w],y(x,()=>{i.value[w]=I(w),_(),u.value=!1})}function g(w){let x=JSON.parse(w);Sn(x,(A,N)=>{i.value[N]=A})}function y(w,x=null){let A=nt(w);Sn(A,(N,T)=>{At(r[T],N)&&delete A[T]}),c.theme_style_modified_at=moment.utc().valueOf(),c.theme_style=JSON.stringify(A),m(x)}function _(){Sn(i.value,(w,x)=>{w.swatches.forEach(A=>{let N=`--color-${x}-${A.stop}`;document.documentElement.style.setProperty(N,F(A.hex),"important")})})}function I(w){return{valueStop:Gn,lMax:bn.lMax,lMin:bn.lMin,hex:n[w][Gn].hex,swatches:Pa.filter(x=>!a.includes(x)).map(x=>({stop:x,hex:n[w][x].hex}))}}function F(w){const x=Dl(w,{format:"array"});return x[0]+", "+x[1]+", "+x[2]}const $=Dt(function(w,x){let A=i.value[w];x||(x=A.hex),i.value[w].hex=x;const N=Object.assign({},bn,{value:x.substr(1,x.length-1),valueStop:A.valueStop,lMax:A.lMax,lMin:A.lMin}),T=OZ(N).filter(E=>!a.includes(E.stop));i.value[w].swatches=T.map(E=>({hex:E.hex,stop:E.stop})),_()},300);function C(){const w=/--color-([a-z]+)-([0-9]+):\s[0-9]+,\s[0-9]+,\s[0-9]+/gm;let x;for(;(x=w.exec(RZ))!==null;){x.index===w.lastIndex&&w.lastIndex++;let A=x[0],N=x[1],T=x[2];t.indexOf(N)===-1&&t.push(x[1]),Object.hasOwn(n,N)||(n[N]={}),Object.hasOwn(n[N],T)||(n[N][T]=[]);const E=A.replaceAll(",","").split(" ").map(B=>B.trim());n[N][T]={rgb:A,hex:EZ(E[1],E[2],E[3])}}}return(w,x)=>{const A=v("DropdownSelectInput"),N=v("IFormInput"),T=v("IButton"),E=v("ICard"),B=ae("t");return d(),k("form",{onSubmit:x[1]||(x[1]=ie(z=>y(i.value),["prevent"])),onKeydown:x[2]||(x[2]=z=>l(c).onKeydown(z))},[s(E,{header:w.$t("themestyle::style.theme_style"),class:"mb-3",overlay:!l(p)},{footer:b(()=>[s(T,{type:"submit",disabled:l(c).busy,text:w.$t("core::app.save")},null,8,["disabled","text"])]),default:b(()=>[(d(!0),k(te,null,re(i.value,(z,M)=>(d(),k("div",{key:M,class:"mb-14 last:mb-0"},[o("div",HZ,[o("div",GZ,S(M.charAt(0).toUpperCase()+M.slice(1)),1),o("div",KZ,[l(At)(r[M],i.value[M])?O("",!0):D((d(),k("a",{key:0,href:"#",class:X(["link mr-3 text-sm",{"pointer-events-none":u.value}]),onClick:ie(j=>h(M),["prevent"])},null,10,YZ)),[[B,"core::app.reset"]]),o("div",WZ,[D(o("label",QZ,null,512),[[B,"themestyle::style.lightness_maximum"]]),D(o("input",{id:"lMax","onUpdate:modelValue":j=>z.lMax=j,type:"number",class:"block w-full rounded-md border-0 py-1 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 dark:bg-neutral-900 dark:text-neutral-200 dark:ring-neutral-700 dark:focus:ring-primary-500 sm:text-sm/6",onInput:j=>l($)(M)},null,40,XZ),[[Zt,z.lMax]])]),o("div",ZZ,[D(o("label",JZ,null,512),[[B,"themestyle::style.lightness_minimum"]]),D(o("input",{id:"lMin","onUpdate:modelValue":j=>z.lMin=j,type:"number",class:"block w-full rounded-md border-0 py-1 text-neutral-900 shadow-sm ring-1 ring-inset ring-neutral-300 placeholder:text-neutral-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 dark:bg-neutral-900 dark:text-neutral-200 dark:ring-neutral-700 dark:focus:ring-primary-500 sm:text-sm/6",onInput:j=>l($)(M)},null,40,eJ),[[Zt,z.lMin]])]),s(A,{modelValue:z.valueStop,"onUpdate:modelValue":j=>z.valueStop=j,items:l(Pa),onChange:j=>l($)(M)},null,8,["modelValue","onUpdate:modelValue","items","onChange"]),s(N,{class:"mr-1 h-8 w-8 p-0",type:"color","model-value":z.hex,onInput:j=>l($)(M,j)},null,8,["model-value","onInput"])])]),o("div",tJ,[(d(!0),k(te,null,re(z.swatches,(j,U)=>(d(),k("div",{key:U,class:"relative"},[j.stop===z.valueStop?(d(),k("div",nJ,[o("div",{class:"-mt-2 h-2 w-2 rounded-full shadow",style:st({backgroundColor:l(Vn)(j.hex)})},null,4)])):O("",!0),s(LZ,{hex:j.hex,"onUpdate:hex":[P=>j.hex=P,x[0]||(x[0]=P=>_())],swatch:j,color:M},null,8,["hex","onUpdate:hex","swatch","color"])]))),128))])]))),128))]),_:1},8,["header","overlay"])],32)}}};window.Innoclapps&&Innoclapps.booting(function(e,t){t.addRoute("settings",{path:"/settings/theme-style",component:oJ,meta:{title:qe.t("themestyle::style.theme_style")}})});window.CreateApplication=(e,t=[])=>new lJ(e).booting(t);class lJ{constructor(t){this.bus=Nl(),this.appConfig=t,this.bootingCallbacks=[],this.axios=Wn,this.axios.defaults.baseURL=t.apiURL}start(){let t=this;const n={confirmationDialog:null};al.init();const a=Td({data(){return n},mounted(){t.$on("conflict",u=>{u&&t.info(u)}),t.$on("error-404",()=>{eo.replace({name:"404"})}),t.$on("error-403",u=>{u.response.config.url!=="/broadcasting/auth"&&eo.replace({name:"403",query:{message:u.response.data.message}})}),t.$on("error",u=>{u&&t.error(u)}),t.$on("too-many-requests",()=>{t.error(this.$t("core::app.throttle_error"))}),t.$on("token-expired",()=>{t.error(this.$t("core::app.token_expired"),{action:{onClick:()=>window.location.reload(),text:this.$t("core::app.reload")}},3e4)}),t.$on("maintenance-mode",u=>{t.info(u||"Down for maintenance",{action:{onClick:()=>window.location.reload(),text:this.$t("core::app.reload")}},3e4)})}});if(this.appConfig.broadcasting){const u=new M1(this.appConfig.broadcasting);this.broadcaster=u}a.use(qe.instance),a.use(hn),sJ(this.appConfig),S0(a),$0(a),O1(a),this.boot(a,eo);const r=Ut();eo.beforeEach((u,c,m)=>aJ(u,c,m,a,r)),a.use(eo),this.app=a;const i=a.mount("#app");a.config.globalProperties.$dialog={confirm(u){const c=document.querySelectorAll(".dialog");return new Promise((m,p)=>{i.$data.confirmationDialog=Object.assign({},u,{injectedInDialog:c.length>0,resolve:f=>{m(f),i.$data.confirmationDialog=null},reject:f=>{p(f),i.$data.confirmationDialog=null}})})}}}csrfToken(){return this.appConfig.csrfToken||null}booting(t){return Array.isArray(t)?t.forEach(n=>this.booting(n)):this.bootingCallbacks.push(t),this}boot(t,n){this.bootingCallbacks.forEach(a=>a(t,n,hn)),this.bootingCallbacks=[]}resources(){return this.config("resources")}resource(t){return this.config(`resources.${t}`)}resourceName(t){return this.resource(t).name}config(t){return cn(this.appConfig,t)}request(t){return t!==void 0?this.axios(t):this.axios}$on(...t){this.bus.on(...t)}$off(...t){this.bus.off(...t)}$emit(...t){this.bus.emit(...t)}success(t,n,a=4e3){this.app.config.globalProperties.$notify(Object.assign({},n,{text:t,type:"success",group:"app"}),a)}info(t,n,a=4e3){this.app.config.globalProperties.$notify(Object.assign({},n,{text:t,type:"info",group:"app"}),a)}error(t,n,a=4e3){this.app.config.globalProperties.$notify(Object.assign({},n,{text:t,type:"error",group:"app"}),a)}addShortcut(t,n){al.bind(t,n)}disableShortcut(t){al.unbind(t)}dialog(){return this.app.config.globalProperties.$dialog}modal(){return this.app.config.globalProperties.$iModal}}function aJ(e,t,n,a,r){hn.state.sidebarOpen&&hn.commit("SET_SIDEBAR_OPEN",!1);const i=e.matched.find(u=>u.meta.gate);i&&typeof i.meta.gate=="string"&&a.config.globalProperties.$gate.userCant(i.meta.gate)&&n({path:"/403"}),e.meta.title&&(r.value=e.meta.title),n()}function sJ(e){hn.commit("SET_SETTINGS",e.options??{}),hn.commit("SET_API_URL",e.apiURL??null),hn.commit("SET_URL",e.url??null),hn.commit("SET_MENU",e.menu??[])}export{ea as _,Le as a,Ne as b,$n as c,Je as d,Fs as e,Ba as f,Yn as g,Ct as u};
